[
  {
    "objectID": "index.html#highlights",
    "href": "index.html#highlights",
    "title": "Yosuke Abe",
    "section": "🌟 Highlights",
    "text": "🌟 Highlights\n🗓 2025/11/02\n{fixes}パッケージをバージョン0.7にアップデートしました！（→ 紹介記事へ）\n📌 バグを大幅に修正し、plot_es_interactive()関数を追加しました！\n🗓 2025/10/14\nSoftwareにデータセクションを追加しました！\n📌 第1弾として日本の夜間光データ（GeoTIFF形式）を追加しました！\n🗓 2025/09/28\nggplot2使い方ガイドをアップデートしました！（→ Tipsへ）\n📌 バージョン4.0.0に対応しています！\n🗓 2025/09/01\nPositronのおすすめ設定についての記事を追加しました！\n📌 新しい環境に移行して、Positronを盛り上げましょう！\n🗓 2025/07/21\nShinyアプリケーション「人口ヒートマップ」をアップデートしました！（→ Softwareへ）\n📌 サーバーを変更しました！\n🗓 2025/04/17\nNotsu, Abe, and Harada (2025)がApplied Economics Lettersに掲載されました！\n📌 Abstractはこちら"
  },
  {
    "objectID": "index.html#latest-posts",
    "href": "index.html#latest-posts",
    "title": "Yosuke Abe",
    "section": "📜 Latest Posts",
    "text": "📜 Latest Posts\n\n\n\n\n\n\n\n\n\n\nTypst 入門\n\n\nLaTeXにも代わりうる新しい組版システムTypstの基本的な使い方を、テンプレートを用いてご紹介します。\n\n\n\n\n\n2025/10/26\n\n\n\n\n\n\n\n\n\n\n\n\n【Typst】Quartoで論文を書く【PDF】\n\n\nLaTeXからTypstに乗り換えてみませんか？\n\n\n\n\n\n2025/10/21\n\n\n\n\n\n\n\n\n\n\n\n\n【Positron】拡張機能「Air」を使う【フォーマッタ】\n\n\nRのコードを自動で整えてくれる拡張機能です。\n\n\n\n\n\n2025/10/16\n\n\n\n\n\n\n\n\n\n\n\n\n開発コンテナの環境について\n\n\nVSCodeの開発コンテナを用いたRの開発環境についての一案です。\n\n\n\n\n\n2025/10/11\n\n\n\n\n\n\n\n\n\n\n\n\n【R】仮想環境を設定する【Python】\n\n\nrenvとvenvを使います！\n\n\n\n\n\n2025/09/26\n\n\n\n\n\n一致なし"
  },
  {
    "objectID": "pages/tips/2024/05/240506_gis_on_r/index.html#はじめに",
    "href": "pages/tips/2024/05/240506_gis_on_r/index.html#はじめに",
    "title": "R でGIS を動かす【ハンドリング】",
    "section": "はじめに",
    "text": "はじめに\nR 上で GIS を操作する方法を簡単に紹介します。\nGIS を R 上で実行するメリットは、再現性が担保できることです。同じ作業を繰り返しするような場合、力を発揮すると思います。また、ggplot2 で可視化できる点も便利です。\n主に、使用するパッケージ、データの読み込み、簡単なデータハンドリング、そして交差する地物の抽出を少しご紹介します。"
  },
  {
    "objectID": "pages/tips/2024/05/240506_gis_on_r/index.html#使用するパッケージ",
    "href": "pages/tips/2024/05/240506_gis_on_r/index.html#使用するパッケージ",
    "title": "R でGIS を動かす【ハンドリング】",
    "section": "使用するパッケージ",
    "text": "使用するパッケージ\nsf パッケージを使用します。また、これらのデータを通常のデータと同様 tidyverse でハンドリングできるので、これら2つを主に使います。\nまた、ここでは詳しく紹介しませんが、私は here パッケージも使用します。こちらの記事で紹介しているような方法でプロジェクトを実行している場合、相対パスを使用すると便利です。詳しくは作業の流れで見てみてください。\n\n\n\n\n\n\nNoteDocker で環境を構築する場合\n\n\n\n\n\nDocker を用いた環境構築の記事で紹介している方法で環境を構築する場合、1つ注意点があります。Dockerfile の1行目を以下のように変更してください。\nFROM rocker/geospatial:latest\nrocker/rstudio のままだと、GIS を扱うのに必要なパッケージを使用できません。上のように変更してファイルを保存した後、画面左下「&gt;&lt; 開発コンテナー」 をクリックし、「コンテナーのリビルド」を実行してください。\n\n\n\n\n# パッケージのインストール\ninstall.packages(\"sf\")\ninstall.packages(\"tidyverse\")\ninstall.packages(\"here\")\n\n\n# パッケージの読み込み\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(here)"
  },
  {
    "objectID": "pages/tips/2024/05/240506_gis_on_r/index.html#使用するデータ",
    "href": "pages/tips/2024/05/240506_gis_on_r/index.html#使用するデータ",
    "title": "R でGIS を動かす【ハンドリング】",
    "section": "使用するデータ",
    "text": "使用するデータ\n\n鉄道データ\n今回は日本の鉄道（駅）データを使用してみます。\n\n国土数値情報ダウンロードサイトより「鉄道（ライン）」をクリック、2022年のデータをダウンロード\n\n\n\n\n一番上の2022年データを今回は使用\n\n\n\n\n行政区域データ\n後ほど鉄道データと重ねて使うために使用します。\n同様に国土数値情報ダウンロードサイトから、「行政区域」に進み、今回は福島県の2024年データをダウンロードします。\n鉄道データと同じフォルダに入れておいてください。"
  },
  {
    "objectID": "pages/tips/2024/05/240506_gis_on_r/index.html#データの読み込み",
    "href": "pages/tips/2024/05/240506_gis_on_r/index.html#データの読み込み",
    "title": "R でGIS を動かす【ハンドリング】",
    "section": "データの読み込み",
    "text": "データの読み込み\nダウンロードしたデータには、駅のデータと路線のデータがそれぞれ入っています。\nそれぞれ読み込みます。読み込みには、sf::read_sf() を使います。sf::st_read() もありますが、こちらは読み込む際に設定を施したい場合に使います。基本は前者で OK です。\nUTF-8 で読み込みたいので、utf8 フォルダの中のデータを使用します。読み込むのは Shapefile です。\n\nstation &lt;- read_sf(here(\"data/N02-22_GML/utf8/N02-22_Station.shp\"))\n\nrail &lt;- read_sf(here(\"data/N02-22_GML/utf8/N02-22_RailroadSection.shp\"))\n\n\n\n\n\n\n\nTiphere について\n\n\n\n\n\nご覧の通り、here はワーキングディレクトリをベースとして、そこからの相対パスでファイルの読み込み等を行うことができます。\nR のプロジェクトを使用している場合、.Rproj ファイルがあるところがワーキングディレクトリです。今回はその中の data フォルダにデータを入れているので、このような書き方になっています。here() の中はダブルクォーテーションで囲んでください。"
  },
  {
    "objectID": "pages/tips/2024/05/240506_gis_on_r/index.html#データの可視化",
    "href": "pages/tips/2024/05/240506_gis_on_r/index.html#データの可視化",
    "title": "R でGIS を動かす【ハンドリング】",
    "section": "データの可視化",
    "text": "データの可視化\n\nggplot2\nおなじみ ggplot2 パッケージを使ってこれらの路線を可視化します1。\n\nstation |&gt;\n  ggplot() +\n  geom_sf() + # GIS 用\n  theme_void() # 背景や罫線を除去\n\n\n\n\n\n\n\n図 1: 日本の駅\n\n\n\n\n\nなんとなく日本が形作られましたね。東京と大阪に特に駅が多いことも一目瞭然です。\n同様に路線もプロットします。\n\nrail |&gt;\n  ggplot() +\n  geom_sf() +\n  theme_void()\n\n\n\n\n\n\n\n図 2: 日本の鉄道路線\n\n\n\n\n\nこうして見るとなんか面白いですよね。北海道の北東部は線路がないみたいです。\nここまでシンプルに可視化する方法をご紹介しました。次のセクションでもう少し地域にフォーカスして見ていきます。"
  },
  {
    "objectID": "pages/tips/2024/05/240506_gis_on_r/index.html#データハンドリング",
    "href": "pages/tips/2024/05/240506_gis_on_r/index.html#データハンドリング",
    "title": "R でGIS を動かす【ハンドリング】",
    "section": "データハンドリング",
    "text": "データハンドリング\n\nデータの抽出\n例えば、新幹線の駅だけデータとして使いたいとします。\n先ほどのダウンロードサイトの属性情報の部分をご覧ください。そこから事業者種別コード（変数名：N02-002）を確認してみると、1が新幹線に該当することが分かります。\nここで、tidyverse パッケージを使用しながら、東北新幹線の駅だけを抽出してみましょう。また、列名を変更しながら必要な変数のみ抽出します。\n\nsta_tohoku &lt;- station |&gt;\n  filter(N02_002 == 1, N02_003 == \"東北新幹線\") |&gt;\n  select(\"路線名\" = N02_003, \"駅名\" = N02_005, geometry)\n\n\n\n\n\n表 1: 東北新幹線の駅情報（上から6行を表示）\n\n\n\n\n\n\n\n\n\n路線名\n駅名\ngeometry\n\n\n\n\n東北新幹線\n二戸\nc(141.28627, 141.28491, 40.26107, 40.25848)\n\n\n東北新幹線\nいわて沼宮内\nc(141.21742, 141.21742, 39.96114, 39.96009)\n\n\n東北新幹線\n八戸\nc(141.42981, 141.43206, 40.50822, 40.51043)\n\n\n東北新幹線\n盛岡\nc(141.13807, 141.13499, 39.70015, 39.70295)\n\n\n東北新幹線\n北上\nc(141.12356, 141.12285, 141.12234, 141.12168, 39.28386, 39.28272, 39.28188, 39.28054)\n\n\n東北新幹線\n水沢江刺\nc(141.18919, 141.18822, 39.14381, 39.14651)\n\n\n\n\n\n\n\n\n\n\n表 1 をご覧いただくと分かる通り、東北新幹線の駅のみを抽出できています。また、geometry 変数が地理情報を示しています。\n\n\nラインデータをポイントデータ化する\n駅はラインデータになっています。駅は幅を持っているためです。そこで、これをポイントデータ化し、駅の位置を1点で特定します。\nまず、ラインデータがどうなっているか確認しましょう。地図を拡大して見てみると、線状になっていることが分かります。\n\n\n\n\n\n\n\nこれをポイント化するために使用するのが、sf::st_centroid() です。地物の重心を求めてくれます。\nコードは以下です。\n\nsta_tohoku_c &lt;- sta_tohoku |&gt;\n  st_centroid(geometry)\n\n改めて見てみると、ポイントになっていることが分かります。\n\n\n\n\n\n\n\nポイントデータ化するメリットとしては、距離の算出に使えることなどがあります。ある地点から駅までの距離を算出したい場合、駅が幅を持っていると距離算出の基準が曖昧になってしまうので、そこでポイント化すればその基準を明確化できるというわけです。\n以上、sf::st_centroid() を用いてポイントデータ化する方法をご紹介しました。"
  },
  {
    "objectID": "pages/tips/2024/05/240506_gis_on_r/index.html#交差する地物の抽出",
    "href": "pages/tips/2024/05/240506_gis_on_r/index.html#交差する地物の抽出",
    "title": "R でGIS を動かす【ハンドリング】",
    "section": "交差する地物の抽出",
    "text": "交差する地物の抽出\n先ほど福島県のデータをダウンロードしました。ここで、福島県に含まれる新幹線駅を抽出したいとします2。\n\n行政区域データ\nまず、福島県の行政区域データを読み込み、可視化しましょう。\n\nfukushima &lt;- read_sf(here(\"data/N03-20240101_07_GML/N03-20240101_07.shp\"))\n\n\nfukushima |&gt;\n  ggplot() +\n  geom_sf() +\n  theme_void()\n\n\n\n\n\n\n\n図 3: 福島県\n\n\n\n\n\n\n\n抽出\n次に、sta_tohoku_c を用いて、福島県と交差する（含まれる）駅を抽出します。\n交差する地物を抽出するためには、sf::st_intersects() もしくは sf::st_intersection() を用います。\n正直後者の方がシンプルなのですが、両者には次のような違いがあります。\n\nst_intersects(): 2つのジオメトリが交差するかどうかの論理判定（TRUE/FALSEやインデックスのリスト）を返す\nst_intersection(): 交差部分のジオメトリそのものを新しいオブジェクトとして返します。\n\n何やら難しいので、わかんなくて困ったら後者を使っておけばよいのではないでしょうか3。\nコードは以下のようになります。\n\nsta_07_a &lt;- sta_tohoku_c |&gt;\n  filter(\n    row_number() %in%\n      st_intersects(fukushima, sta_tohoku_c) |&gt;\n      unlist()\n  )\n\n\nsta_07_b &lt;- st_intersection(fukushima, sta_tohoku_c)\n\n\n\n\n\n\n\nNote1つ目の方法について\n\n\n\n\n\n1つ目は大変複雑ですね。プロセスを紐解くと次のようになります。\n\nsta_tohoku_c から抽出するので、sta_tohoku_c からスタート\n抽出するので dplyr::filter() を使用\nsf::st_intersects() で、fukushima と重なる sta_tohoku_cを抽出\nsf::st_intersects() はリスト形式で結果を返すので、unlist() を用いてリスト形式を解除\nsta_tohoku_c の行番号と照らし合わせ、返ってきた結果と同じもののみ抽出\n\n\n\n\n結果は次のようになります。\n\n\n\n\n表 2: st_intersects() を用いた場合\n\n\n\n\n\n\n\n\n\n路線名\n駅名\ngeometry\n\n\n\n\n東北新幹線\n福島\nc(140.458612067603, 37.7540599673619)\n\n\n東北新幹線\n郡山\nc(140.388619989856, 37.3986200007428)\n\n\n東北新幹線\n新白河\nc(140.188827537169, 37.1233084742238)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n表 3: st_intersection() を用いた場合\n\n\n\n\n\n\n\n\n\nN03_001\nN03_002\nN03_003\nN03_004\nN03_005\nN03_007\n路線名\n駅名\ngeometry\n\n\n\n\n福島県\nNA\nNA\n福島市\nNA\n07201\n東北新幹線\n福島\nc(140.458612067603, 37.7540599673619)\n\n\n福島県\nNA\nNA\n郡山市\nNA\n07203\n東北新幹線\n郡山\nc(140.388619989856, 37.3986200007428)\n\n\n福島県\nNA\n西白河郡\n西郷村\nNA\n07461\n東北新幹線\n新白河\nc(140.188827537169, 37.1233084742238)\n\n\n\n\n\n\n\n\n\n\n2つ目のやり方の方が少しごちゃっとしたデータとして返ってきました。\nめんどくさいけどクリーンな方か、簡単だけど煩雑な方か、お好みで使ってみてください。"
  },
  {
    "objectID": "pages/tips/2024/05/240506_gis_on_r/index.html#おわりに",
    "href": "pages/tips/2024/05/240506_gis_on_r/index.html#おわりに",
    "title": "R でGIS を動かす【ハンドリング】",
    "section": "おわりに",
    "text": "おわりに\n今回は GIS を R で動かす基礎的な内容をご紹介しました。\n交差する地物の抽出にも触れましたが、これだけではまだ分析に使える内容ではないので、距離計算などはまた別記事で書こうと思います。\n間違いや効率的なコーディング等ございましたら、コメントにご記入ください。"
  },
  {
    "objectID": "pages/tips/2024/05/240506_gis_on_r/index.html#参考文献",
    "href": "pages/tips/2024/05/240506_gis_on_r/index.html#参考文献",
    "title": "R でGIS を動かす【ハンドリング】",
    "section": "参考文献",
    "text": "参考文献\n\n\n\n\n\n\n事例で学ぶ経済・政策分析のためのGIS入門\n\n\n\n\n\n\n\n\n\nその無茶振り，（Rで）GISが解決します"
  },
  {
    "objectID": "pages/tips/2024/05/240506_gis_on_r/index.html#footnotes",
    "href": "pages/tips/2024/05/240506_gis_on_r/index.html#footnotes",
    "title": "R でGIS を動かす【ハンドリング】",
    "section": "注",
    "text": "注\n\n\nあまりなじみのない方に向けて言っておくと、tidyverse パッケージの中に ggplot2 も含まれています。↩︎\n正直この程度であればこんなことするまでもないですが、例ということで悪しからず。いろいろ応用は利きますよ！↩︎\nしかし後者の方が時間はかかりますし、2つのデータをもとに新しいデータを作るので、できたデータは2つのデータフレームの情報を含みます。つまり、ちょっと煩雑なデータが出来上がります。↩︎"
  },
  {
    "objectID": "pages/tips/index.html",
    "href": "pages/tips/index.html",
    "title": "Tips",
    "section": "",
    "text": "【4.0.0対応！】ggplot2使い方ガイド\n\n\n\n\n\n\n\n【パッケージ開発】fixesでイベントスタディを効率化【Staggered対応】\n\n\n\n\n\n\n\nPositronのおすすめ設定！【R | Python】\n\n\n\n\n\n\n\n【王道】TeX LiveをインストールしてLaTeX環境を構築する\n\n\n\n\n\n\n\n【PDF】Quarto で論文を書く\n\n\n\n\n\n\n\nQuarto & R MarkdownでPDF出力【LaTeX】\n\n\n\n\n\nPrevoius\n\n\n\nNext\n\n\n\n\n\n\n\n\n\n   \n    \n    \n      並び替え\n      デフォルト\n      \n        題名\n      \n      \n        日付 - 日付（昇順）\n      \n      \n        日付 - 日付（降順）\n      \n      \n        作者\n      \n    \n  \n    \n      \n      \n    \n\n\n\n\n\n\n\n\nTypst 入門\n\n\n\nTypst\n\n\n\nLaTeXにも代わりうる新しい組版システムTypstの基本的な使い方を、テンプレートを用いてご紹介します。\n\n\n\n\n\n\n2025/10/26\n\n\n\n\n\n\n\n\n\n\n\n【Typst】Quartoで論文を書く【PDF】\n\n\n\nTypst\n\nQuarto\n\nR\n\n\n\nLaTeXからTypstに乗り換えてみませんか？\n\n\n\n\n\n\n2025/10/21\n\n\n\n\n\n\n\n\n\n\n\n\n\n【Positron】拡張機能「Air」を使う【フォーマッタ】\n\n\n\nR\n\nPositron\n\n\n\nRのコードを自動で整えてくれる拡張機能です。\n\n\n\n\n\n\n2025/10/16\n\n\n\n\n\n\n\n\n\n\n\n開発コンテナの環境について\n\n\n\nR\n\nDocker\n\nVSCode\n\n\n\nVSCodeの開発コンテナを用いたRの開発環境についての一案です。\n\n\n\n\n\n\n2025/10/11\n\n\n\n\n\n\n\n\n\n\n\n\n\n【R】仮想環境を設定する【Python】\n\n\n\nR\n\nPython\n\nVSCode\n\nPositron\n\n\n\nrenvとvenvを使います！\n\n\n\n\n\n\n2025/09/26\n\n\n\n\n\n\n\n\n\n\n\nDuckDBをRで使う\n\n\n\nR\n\nSQL\n\nデータ処理\n\n\n\nR上でデータベース操作を行うために、DuckDBを利用する方法についてまとめます。\n\n\n\n\n\n\n2025/09/19\n\n\n\n\n\n\n\n\n\n\n\nPositronのおすすめ設定！【R | Python】\n\n\n\nPositron\n\nR\n\nPython\n\nQuarto\n\n\n\nRStudioからの移行もスムーズに進めましょう。\n\n\n\n\n\n\n2025/09/01\n\n\n\n\n\n\n\n\n\n\n\n\n\nXMLファイルから情報を抽出する\n\n\n\nR\n\nデータ処理\n\n\n\nxml2パッケージを使います。\n\n\n\n\n\n\n2025/08/26\n\n\n\n\n\n\n\n\n\n\n\n【Python】高速スクレイピングを実装する【並列化】\n\n\n\nPython\n\nデータ処理\n\n\n\nRよりも高速でスクレイピングを実行したい\n\n\n\n\n\n\n2025/08/16\n\n\n\n\n\n\n\n\n\n\n\nrecode関数でデータフレームの中身を置き換える\n\n\n\nR\n\nデータ処理\n\n\n\n表を作るときに重宝するかも…？\n\n\n\n\n\n\n2025/07/27\n\n\n\n\n\n\n\n\n\n\n\n\n\nRStudio Serverをインストールする【リモートデスクトップも】\n\n\n\nR\n\nRStudio\n\nWindows\n\nWSL\n\n\n\n他のデバイスからも操作できます！\n\n\n\n\n\n\n2025/07/15\n\n\n\n\n\n\n\n\n\n\n\n【スクレイピング】Rでe-Statのメッシュ人口データファイルを一気に取得する\n\n\n\nR\n\nデータ処理\n\n備忘録\n\n\n\n今回はメッシュデータのCSVファイルを取得していきます。\n\n\n\n\n\n\n2025/06/13\n\n\n\n\n\n\n\n\n\n\n\n\n\n【データ管理】DVCの設定まとめ\n\n\n\nDVC\n\n\n\nトークン切れによる再認証が必要な問題を解消できるかもしれません。\n\n\n\n\n\n\n2025/06/01\n\n\n\n\n\n\n\n\n\n\n\n【パッケージ開発】fixesでイベントスタディを効率化\n\n\n\nR\n\n\n\nバージョン0.7：バグを大幅に修正し、plot_es_interactive()関数を追加しました。\n\n\n\n\n\n\n2025/05/25\n\n\n\n\n\n\n\n\n\n\n\n【GIS】行政区域データを整理【ファイル有】\n\n\n\nR\n\nGIS\n\nデータ処理\n\n\n\n元データをサマライズし、簡略化・軽量化しました。\n\n\n\n\n\n\n2025/04/13\n\n\n\n\n\n\n\n\n\n\n\n\n\n【スクレイピング】rvestを使ってe-Statからファイルを取得する\n\n\n\nR\n\nデータ処理\n\n\n\nRのrvestパッケージを使って、e-Statの境界データを取得していきます！\n\n\n\n\n\n\n2025/03/19\n\n\n\n\n\n\n\n\n\n\n\ne-Stat APIを使ってデータを取得しよう\n\n\n\nR\n\nデータ処理\n\n\n\nAPIの第一歩についてまとめます！\n\n\n\n\n\n\n2025/03/09\n\n\n\n\n\n\n\n\n\n\n\n【ウェブサイト】設定を追加する\n\n\n\nQuarto\n\n\n\nGoogleアナリティクス、SNSアイコン、フッターの設定を追加します。\n\n\n\n\n\n\n2025/02/05\n\n\n\n\n\n\n\n\n\n\n\npinsでデータ管理\n\n\n\nR\n\n\n\nR × Google Driveでデータ管理\n\n\n\n\n\n\n2024/12/24\n\n\n\n\n\n\n\n\n\n\n\n\n\n【改訂版】開発コンテナを使ってR環境を構築！\n\n\n\nR\n\nDocker\n\nWindows\n\nMac\n\nUbuntu\n\nVSCode\n\nGitHub\n\n\n\nローカル環境から卒業！\n\n\n\n\n\n\n2024/12/19\n\n\n\n\n\n\n\n\n\n\n\n\n\n【Quarto & RStudio】ウェブサイトを作る！\n\n\n\nQuarto\n\nRStudio\n\nGitHub\n\n\n\nQuartoを使ってRStudio上でウェブサイトを作る方法をご紹介します。\n\n\n\n\n\n\n2024/12/13\n\n\n\n\n\n\n\n\n\n\n\nQuartoでアイコンを挿入したい\n\n\n\nQuarto\n\nVSCode\n\nRStudio\n\n備忘録\n\n\n\nQuartoのHTML出力でアイコンを挿入する方法を紹介します。\n\n\n\n\n\n\n2024/12/01\n\n\n\n\n\n\n\n\n\n\n\n\n\n【4.0.0対応！】ggplot2使い方ガイド\n\n\n\nR\n\n\n\nggplotを使うのに役立つコマンドを紹介します！\n\n\n\n\n\n\n2024/11/17\n\n\n\n\n\n\n\n\n\n\n\nRStudio (Server)でGitHub Copilotを使う\n\n\n\nGitHub\n\nRStudio\n\nDocker\n\n\n\nローカルとRStudio Serverに分けて説明します。\n\n\n\n\n\n\n2024/11/13\n\n\n\n\n\n\n\n\n\n\n\n\n\n【データハンドリング】pivot_longer()を使ってロング形式のパネルデータを作る【使い方】\n\n\n\nR\n\nデータ処理\n\n\n\nワイドからロングへ、データを変換します。\n\n\n\n\n\n\n2024/09/17\n\n\n\n\n\n\n\n\n\n\n\n市町村合併を反映させる\n\n\n\nR\n\nデータ処理\n\n\n\n古いデータに市町村合併を反映させる方法をご紹介します。\n\n\n\n\n\n\n2024/09/06\n\n\n\n\n\n\n\n\n\n\n\n\n\n【王道】TeX LiveをインストールしてLaTeX環境を構築する\n\n\n\nLaTeX\n\nVSCode\n\n\n\n王道ともいえるTeX Liveを用いたLaTeX環境の構築を解説します。とりあえずWindows版。\n\n\n\n\n\n\n2024/09/01\n\n\n\n\n\n\n\n\n\n\n\nDVCのためのGoogle Cloud Project\n\n\n\nDVC\n\n備忘録\n\n\n\nDVCにおける設定のエラーへの対処です（2024年8月31日）\n\n\n\n\n\n\n2024/08/31\n\n\n\n\n\n\n\n\n\n\n\n\n\n【RStudio】ローカルへのインストールまとめ\n\n\n\nR\n\nRStudio\n\n\n\nRが初めての方へ。～リンクも添えて～\n\n\n\n\n\n\n2024/08/29\n\n\n\n\n\n\n\n\n\n\n\n【Quarto】マークダウンでできること！\n\n\n\nQuarto\n\n\n\nマークダウンでできることは意外と奥が深い。独断と偏見で使う順にまとめます！\n\n\n\n\n\n\n2024/08/02\n\n\n\n\n\n\n\n\n\n\n\n\n\n【Quarto】論文の体裁を整える\n\n\n\nQuarto\n\nLaTeX\n\n\n\nQuarto × \\(\\LaTeX\\) で論文の体裁を整える方法について考えます。随時更新予定です。\n\n\n\n\n\n\n2024/07/22\n\n\n\n\n\n\n\n\n\n\n\n\n\n【PDF】Quarto で論文を書く\n\n\n\nQuarto\n\nR\n\nLaTeX\n\n\n\nQuarto を使って論文を書く方法（マークダウン、表、図）をまとめました。\n\n\n\n\n\n\n2024/06/29\n\n\n\n\n\n\n\n\n\n\n\n\n\n国勢調査データのクレンジング\n\n\n\nR\n\nデータ処理\n\n\n\n人口データのファイルを一括で読み込んで、分析で使いやすくするためのクレンジングコードです。\n\n\n\n\n\n\n2024/06/22\n\n\n\n\n\n\n\n\n\n\n\n\n\n環境構築におけるトラブルシューティング\n\n\n\n備忘録\n\n\n\n環境構築において直面したエラー等を随時まとめていきます。\n\n\n\n\n\n\n2024/06/19\n\n\n\n\n\n\n\n\n\n\n\n【WSL】割り当てるメモリを増やす方法\n\n\n\nWSL\n\nWindows\n\n備忘録\n\n\n\nWSL はデフォルトで PC の半分のメモリが割り当てられています。\n\n\n\n\n\n\n2024/05/31\n\n\n\n\n\n\n\n\n\n\n\n【ワークフロー】VSCode で GitHub を使う\n\n\n\nVSCode\n\nGitHub\n\n\n\nVSCode で GitHub を使った作業の流れを紹介します。\n\n\n\n\n\n\n2024/05/25\n\n\n\n\n\n\n\n\n\n\n\n\n\nTeX Live を使わずに LaTeX 環境を作る！\n\n\n\nWindows\n\nMac\n\nUbuntu\n\nLaTeX\n\n\n\nTinyTeX を使って R 環境以外でも \\(\\LaTeX\\) を使えるようにしよう！\n\n\n\n\n\n\n2024/05/20\n\n\n\n\n\n\n\n\n\n\n\n【R】アーカイブされたパッケージを使う\n\n\n\nR\n\n\n\nパッケージがインストールできない？\n\n\n\n\n\n\n2024/05/16\n\n\n\n\n\n\n\n\n\n\n\n\n\n【R】プロジェクトを使う\n\n\n\nR\n\n\n\nR プロジェクトを使って作業環境を整えよう！\n\n\n\n\n\n\n2024/05/15\n\n\n\n\n\n\n\n\n\n\n\n\n\n【Quarto】チャンクオプションまとめてみた【R Markdown】\n\n\n\nR\n\nQuarto\n\nR Markdown\n\n備忘録\n\n\n\nチャンクオプションは忘れやすい！\n\n\n\n\n\n\n2024/05/09\n\n\n\n\n\n\n\n\n\n\n\n【R Markdown】相互参照を使いこなす【Quarto】\n\n\n\nR Markdown\n\nQuarto\n\nR\n\n\n\n図や表に自動で番号を振りたい！\n\n\n\n\n\n\n2024/05/09\n\n\n\n\n\n\n\n\n\n\n\n\n\n【R パッケージ】インストールも読み込みも一撃で？【pacman】\n\n\n\nR\n\n\n\ninstall.packages() はもう不要！\n\n\n\n\n\n\n2024/05/07\n\n\n\n\n\n\n\n\n\n\n\nR でGIS を動かす【ハンドリング】\n\n\n\nR\n\nGIS\n\n\n\nR で GIS を動かそう！\n\n\n\n\n\n\n2024/05/06\n\n\n\n\n\n\n\n\n\n\n\n\n\n開発コンテナを使って R 環境を構築！\n\n\n\nR\n\nDocker\n\nWindows\n\nMac\n\nUbuntu\n\nVSCode\n\nGitHub\n\n\n\nローカル環境から卒業！\n\n\n\n\n\n\n2024/05/04\n\n\n\n\n\n\n\n\n\n\n\n政令指定都市・中核市の整理\n\n\n\nR\n\nデータ処理\n\n\n\nRで市区町村データを整理するための政令指定都市・中核市をまとめたコードです。\n\n\n\n\n\n\n2024/04/14\n\n\n\n\n\n\n\n\n\n\n\n【Typst】Quarto & R MarkdownでPDF出力【LaTeX】\n\n\n\nR\n\nR Markdown\n\nQuarto\n\nTypst\n\nLaTeX\n\n\n\nレポートでR Markdown、使ってますか？\n\n\n\n\n\n\n2024/03/29\n\n\n\n\n\n\n一致なし\n\n  \n\n\n\n\n\n\n\n\n\n\n\nNote開発環境\n\n\n\n最終更新日：2025年11月3日\n\nPositron: 2025.12.0 build 9\nR version 4.5.1 (2025-06-13 ucrt)\nPython 3.13.8\nQuarto 1.9.9"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#はじめに",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#はじめに",
    "title": "DuckDBをRで使う",
    "section": "はじめに",
    "text": "はじめに\nRで大量のデータを扱う際、メモリ制限やパフォーマンスの問題に直面することがあります。そんなとき、軽量で高速な組み込み型のデータベースであるDuckDBを利用することで、効率的にデータ操作が可能になります。本記事では、RでDuckDBを使用する方法について解説します。"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#duckdbとは",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#duckdbとは",
    "title": "DuckDBをRで使う",
    "section": "DuckDBとは",
    "text": "DuckDBとは\nDuckDBは、組み込み型のSQLデータベースであり、特に分析ワークロードに最適化されています。SQLiteのように軽量でありながら、大規模なデータセットを効率的に処理できる点が特徴です。DuckDBは、列指向ストレージを採用しており、分析クエリのパフォーマンスが向上します。\nちなみに組み込み型データベースとは、アプリケーションに組み込まれて動作するデータベースのことを指します。サーバー型のデータベースとは異なり、外部のデータベースサーバーを必要とせず、アプリケーション内で直接データベース操作が可能です。すなわちR上で完結するということです。\n列指向については、ブログでparquetを扱った際に少し触れています。以下もご覧ください。簡潔に言うと、列指向データベースは、データを列ごとに格納するため、特定の列に対するクエリが高速に処理されるという特徴があります。\n\n\n\n\n\n\nParquetファイルについて調べてみる"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#duckdbのインストール",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#duckdbのインストール",
    "title": "DuckDBをRで使う",
    "section": "DuckDBのインストール",
    "text": "DuckDBのインストール\nDuckDBをRで使用するには、duckdbパッケージをインストールします。\n\n# install.packages(\"pak\")\npak::pak(\"duckdb\")\n\nもしくは\n\ninstall.packages(\"duckdb\")"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#duckdbの基本的な使い方",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#duckdbの基本的な使い方",
    "title": "DuckDBをRで使う",
    "section": "DuckDBの基本的な使い方",
    "text": "DuckDBの基本的な使い方\n\nデータベースへの接続\nまずは、DuckDBデータベースに接続します。以下のコードでは、メモリ内データベースに接続していますが、ファイルベースのデータベースを使用することも可能です。\nメモリ内データベースはRセッションが終了すると消えてしまいますが、ファイルベースのデータベースは永続的に保存されます。\nファイルベースのデータベースではディスクにデータが保存されるため、Rセッションを終了してもデータが保持されます。一方、メモリ内データベースはRセッションが終了するとデータが失われてしまいますが、読み書きの速度が速いという利点があります。\n\nlibrary(duckdb)\n\n\n# メモリ内データベースに接続\ncon &lt;- dbConnect(duckdb(), dbdir = \":memory:\")\n\nファイルベースのデータベースに接続する場合は、以下のようにします。\n\n# ファイルベースのデータベースに接続\ncon &lt;- dbConnect(duckdb(), dbdir = here::here(\"data/iris.duckdb\"))\n\nこの方法だと、dataフォルダにiris.duckdbという名前でデータベースファイルが作成されます。.duckdbファイルを置くパスは自由に変更してください。\n\n\nデータの読み込み\n\nSQLを使う場合\nDuckDBは様々なデータ形式をサポートしています。ここでは、CSVファイルを読み込む例を示します。\n\n# CSVファイルを読み込む\ndbExecute(con, \"CREATE TABLE iris AS SELECT * FROM read_csv('data/iris.csv')\")\n\nさて、ここで突然SQL文が出てきましたが、なんとなく単語を見てもらえればわかる通り、read_csv('data/iris.csv')から全ての列を選択（*は全ての列を意味します）して、irisという名前のテーブルを作成（CREATE TABLE iris AS）しています。\nちなみに、僕はSQLはあまりわかりません。いちいち調べないと先ほどのコードも書けないレベルなのですが、この方法をとるメリットを先に説明しておきます。\nこの方法のメリットは、Rに一度もデータを読み込まずに、DuckDBが直接CSVファイルを処理できる点です。 そのため、大規模なCSVでもメモリを無駄に消費せず、高速にテーブルを作成できます。\nまた、CREATE TABLE ... AS SELECT ...という形で書けば、SQLの標準的な構文で柔軟に前処理（列の選択やフィルタリングなど）を行いながら、テーブルを作成できます。\n\n\nRを使う場合\nとはいえ新しくSQLを覚えるのは面倒だしRで書けたらうれしいという僕なので、ここでRを使うことの意義を示します。\nそれは、今提示したコードを皆さんおなじみdplyrを使って実行できる、ということです。\nそれはすなわちdplyrを使って書いたコードをSQLに変換して実行してくれるということを意味しています。\nデータベースやSQLはなんだかよくわからないけれども、dplyrが使えるならうれしいですよね1。\nその場合のコードを見てみましょう。\n\nlibrary(tidyverse) # `dplyr`だけでもOKです。\n\n\niris_data &lt;- read_csv(here::here(\"data/iris.csv\"))\nduckdb_register(con, iris, \"iris_data\")\n\nまずはデータベースに入れたいデータをread_csv()で読み込みます。ここではdataフォルダにあるiris.csvを読み込んでいます。\n続いてduckdb_register()を使って、iris_dataをirisという名前でデータベースに登録しています。これでデータベース上にirisテーブルが作成されました。\nちなみにファイルベースのデータベースを使いたい場合は、duckdb_register()の代わりにdbWriteTable()を使います。\n\ndbWriteTable(con, \"iris\", iris_data)\n\nこれで.duckdbファイルにirisテーブルが保存されます。\nちなみに、データベースにはテーブルを複数作成できるので、iris以外のデータもも好きな名前でテーブルを追加できます2。\n\n\n\nデータの操作\nところで、データベースを使うメリットのひとつに、遅延評価（lazy evaluation） があります。これは、実際に結果を取り出すまでSQLが実行されない仕組みのことです。\n通常のデータ処理は\nデータの読み込み → 書いた順に処理を実行 → 結果を返す\nという流れですが、遅延評価では\nデータの読み込み → 書いた順に処理を記録 → 最後にまとめて実行（SQL発行） → 結果を返す\nという流れになります。\nこのおかげで、大規模なデータセットでも不要な計算が省かれ、効率的に処理できます。\n\nSQLを使う場合\nSQLを使ってデータを操作する場合、以下のようにクエリを実行します。\n\n# データをクエリする\nresult &lt;- dbGetQuery(con, \"SELECT * FROM iris WHERE Species = 'setosa'\")\n\nこの例では、irisテーブルからSpeciesがsetosaの行を選択しています。\n\n\ndplyrを使う場合\ndplyrを使ってデータを操作する場合、以下のように記述します（おなじみの感じですね）。\n\nresult &lt;- tbl(con, \"iris\") |&gt;\n  filter(Species == \"setosa\") |&gt;\n  collect()\n\ntbl(con, \"iris\")でデータベース上のirisテーブルを参照し、filter()で条件を指定しています。最後にcollect()を使って結果をRのデータフレームとして取得します。\nここで重要なのは、collect()を呼び出すまではSQLは実行されないという点です。filter()などの処理を追加するたびに、裏でSQLクエリが少しずつ組み立てられていき、最後にcollect()を呼び出した時点でまとめて実行されます。\nつまり、collect()を呼び出すまではデータはRに読み込まれず、操作はあくまで「SQLを組み立てているだけ」です。collect()を実行した瞬間に初めてSQLが発行され、結果がRにデータフレームとして取り込まれます。\nデータベースになじみがない方は違和感があるかもしれませんが（かく言う僕もですが）、con自体はデータそのものではなく、DuckDBデータベースへの接続（コネクション）を表すオブジェクトです。\n普段のRではデータフレームを直接操作しますが、ここではまず接続オブジェクトconを通して「このデータベースの中にあるテーブルを参照しますよ」という指示を出します。\nつまり、conはデータの実体ではなく、「データベースへの窓口」や「リモコン」のようなものと考えると分かりやすいです（ChatGPT曰く）。\nとりあえず、collect()の前までは通常のデータ処理と同じようにdplyrの関数を使って操作できるので、慣れ親しんだ方法でデータを扱うことができます。\n\n\n\nテーブルの削除\n追加したテーブルを削除する場合は、以下のようにします。\n\ndbExecute(con, \"DROP TABLE iris\")\n\nこれでirisテーブルがデータベースから削除されます。\nもし安全に削除したい場合は、\n\ndbExecute(con, \"DROP TABLE IF EXISTS iris\")\n\nとすることで、テーブルが存在しない場合でもエラーにならずに処理を続行できます。\n\n\nデータベースからの切断\nデータベースの操作が終わったら、接続を切断します。\n\ndbDisconnect(con, shutdown = TRUE)\n\nshutdown = TRUEを指定すると、メモリ内データベースの場合はデータが消去され、ファイルベースのデータベースの場合は接続が閉じられます。"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#まとめ",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#まとめ",
    "title": "DuckDBをRで使う",
    "section": "まとめ",
    "text": "まとめ\n今回は、RでDuckDBを使用する方法についてまとめました。\nDuckDBは軽量で高速な組み込み型データベースであり、大規模なデータセットを効率的に処理できます。SQLを直接使う方法と、dplyrを使う方法の両方が利用可能であり、遅延評価によりパフォーマンスが向上します。\n最近は仕事ででかいデータを扱うことが増えてきたので、今後もDuckDBを活用していきたいと思います（というか活用し始めています）。ぜひ試しあれ。"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#参考",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#参考",
    "title": "DuckDBをRで使う",
    "section": "参考",
    "text": "参考\n\n\n\n\n\n\nR Client - DuckDB"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#footnotes",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#footnotes",
    "title": "DuckDBをRで使う",
    "section": "注",
    "text": "注\n\n\nただ、先ほどのメリットの裏返しで、一度R上でデータを読み込んでからデータベースに送り込むことになるので、メモリを多く消費することと、データが大きいと処理速度が遅くなることには注意してください。↩︎\nとはいえ、プロジェクトごとなどで.duckdbは分けた方が良いとは思います。↩︎"
  }
]