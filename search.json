[
  {
    "objectID": "pages/tips/2024/12/241224_pins/index.html#はじめに",
    "href": "pages/tips/2024/12/241224_pins/index.html#はじめに",
    "title": "pinsでデータ管理",
    "section": "はじめに",
    "text": "はじめに\npinsというパッケージをご存じでしょうか。pinsは、Rでデータやオブジェクトを簡単に共有・保存・再利用するためのパッケージです。\nこのパッケージでは、Google Driveなど、様々なツールと連携してデータを管理することができます。\nこれまでの記事1ではDVCを用いた方法を紹介してきましたが、特にGoogle Cloud projectを使用しなければならなくなって以降、正直めんどくさいです。\nここではなるべく簡単にデータを管理、共有できるツールとしてpinsをご紹介します。"
  },
  {
    "objectID": "pages/tips/2024/12/241224_pins/index.html#設定",
    "href": "pages/tips/2024/12/241224_pins/index.html#設定",
    "title": "pinsでデータ管理",
    "section": "設定",
    "text": "設定\n早速設定です。インストールされていない場合、以下のコードでパッケージをインストールしてください。Tidyverseを使っている場合は、googledriveはインストール済みです。\n# install.packages(\"pak\")\npak::pak(c(\"pins\", \"googledrive\"))\n\n\n\n\n\n\nTip\n\n\n\n\n\n余談ですが、最近はパッケージのインストールにpak::pak()をメインで使用しています。pak::pak()は\n\nA Fresh Approach to R Package Installation\n\nであり、install.packages()とdevtools::install_github()を兼ね合わせています2。ミーハーな僕としては使わずにはいられません。\n\n\n\n続いて以下のコードでドライブと連携します。ブラウザ上でデータを保存したいフォルダを作成し、URLをコピーしておいてください。その後、以下のコードのリンク部分を置き換えて実行します。\n\nboard &lt;- board_gdrive(\n  \"https://drive.google.com/drive/u/0/folders/1F3T0SUmdKBrYUvo180KqBf00yoRrzPdP\"\n)\n\nこのコマンドを実行すると、\nIs it OK to cache OAuth access credentials in the folder ~/.cache/gargle between R sessions?\n1: Yes\n2: No\nと出てくると思いますが、基本的に1を打って実行でいいと思います。これでセッションが切れても（RStudioを再起動しても）認証が継続されます。共用のPCなどの場合は2になると思いますが。\n続けてブラウザでGoogleに認証を求められると思いますが、必要な権限を与え（チェックボックスにチェックを入れ）、次へと進んでいきます。\n最後に以下の画面が出てきたら、下部のコードをコピーし、RStudioのコンソールに打ち込み、実行します。\n\n\n\n\n\nこれで認証は完了です。"
  },
  {
    "objectID": "pages/tips/2024/12/241224_pins/index.html#データの管理",
    "href": "pages/tips/2024/12/241224_pins/index.html#データの管理",
    "title": "pinsでデータ管理",
    "section": "データの管理",
    "text": "データの管理\n\nピン留め\npinsでは、パッケージ名通りデータをピン留めすることができます。例えばデフォルトで入っているmtcarsデータを例に、データをフォルダにピン留めします。\n\nboard |&gt;\n  pin_write(mtcars, \"mtcars\")\n\nGuessing `type = 'rds'`\nCreating new version '20251102T151504Z-b8e21'\nWriting to pin 'mtcars'\n\n\nメッセージに出ている通り、デフォルトでは.rdsファイルとして保存されるようです。試しにhead()で行数を絞って、csvで保存してみます。その場合、\n\nboard |&gt; pin_write(head(mtcars), \"mtcars\", type = \"csv\")\n\nCreating new version '20251102T150919Z-f0c51'\nWriting to pin 'mtcars'\n\n\nと、typeを指定してください。\n\n\n読み込み\n保存したデータを読み込みたい場合は、\n\nboard |&gt; pin_read(\"mtcars\")\n\n   mpg cyl disp  hp drat    wt  qsec vs am gear carb\n1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4\n2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4\n3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1\n4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1\n5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2\n6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1\n\n\nで可能です。\n\n\nバージョン管理\nちなみに、バージョン管理も可能です。まずはpin_versions()でバージョンを確認します。\n\nboard |&gt; pin_versions(\"mtcars\")\n\n# A tibble: 4 × 3\n  version                created             hash \n  &lt;chr&gt;                  &lt;dttm&gt;              &lt;chr&gt;\n1 20241223T131135Z-418c9 2024-12-23 22:11:35 418c9\n2 20241223T131142Z-6a6e3 2024-12-23 22:11:42 6a6e3\n3 20251102T150901Z-b8e21 2025-11-03 00:09:01 b8e21\n4 20251102T150919Z-f0c51 2025-11-03 00:09:19 f0c51\n\n\n上はmtcarsの全データ、下はhead()を適用したデータです。\n現在は下のデータで上書きされている状態ですが、ここでやはり全データを読み込みたいとします。\nその場合、以下のようにして読み込みます。\n\nboard |&gt;\n  pin_read(\"mtcars\", version = \"20241223T131135Z-418c9\") |&gt;\n  tibble::as_tibble()\n\n# A tibble: 32 × 11\n     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb\n   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n 1  21       6  160    110  3.9   2.62  16.5     0     1     4     4\n 2  21       6  160    110  3.9   2.88  17.0     0     1     4     4\n 3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1\n 4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1\n 5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2\n 6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1\n 7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4\n 8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2\n 9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2\n10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4\n# ℹ 22 more rows\n\n\nversion引数に、上で出てきたバージョンをペーストしてやれば可能です。"
  },
  {
    "objectID": "pages/tips/2024/12/241224_pins/index.html#まとめ",
    "href": "pages/tips/2024/12/241224_pins/index.html#まとめ",
    "title": "pinsでデータ管理",
    "section": "まとめ",
    "text": "まとめ\n今回はpinsパッケージを使ったデータ管理の方法についてご紹介しました。\nGoogle Driveは多くの人がアカウントを所持しているため、アカウント設定に時間を割かなくてよい点が魅力的だと思います。\n僕が思う良い点としては、直接Google Driveにデータが保存されるため、PCの容量を食わなくていいことがあると思います。\nぜひ使ってみてください。"
  },
  {
    "objectID": "pages/tips/2024/12/241224_pins/index.html#番外編",
    "href": "pages/tips/2024/12/241224_pins/index.html#番外編",
    "title": "pinsでデータ管理",
    "section": "番外編",
    "text": "番外編\nちなみに今回はGoogle Driveでご紹介しましたが、Dropbox等でも可能です。\nboard &lt;- board_folder(\"~/Dropbox\")\nDropboxのパスは環境によって異なると思いますが、Dropboxでの共有設定をしておき、各自そのフォルダへのパスを設定しておけば、Dropboxでもpinsを使うことができます。\nDropboxユーザーの方は是非お試しあれ。"
  },
  {
    "objectID": "pages/tips/2024/12/241224_pins/index.html#footnotes",
    "href": "pages/tips/2024/12/241224_pins/index.html#footnotes",
    "title": "pinsでデータ管理",
    "section": "注",
    "text": "注\n\n\n例えばこちらなど。↩︎\npakドキュメント↩︎"
  },
  {
    "objectID": "pages/tips/index.html",
    "href": "pages/tips/index.html",
    "title": "Tips",
    "section": "",
    "text": "【4.0.0対応！】ggplot2使い方ガイド\n\n\n\n\n\n\n\n【パッケージ開発】fixesでイベントスタディを効率化【Staggered対応】\n\n\n\n\n\n\n\nPositronのおすすめ設定！【R | Python】\n\n\n\n\n\n\n\n【王道】TeX LiveをインストールしてLaTeX環境を構築する\n\n\n\n\n\n\n\n【PDF】Quarto で論文を書く\n\n\n\n\n\n\n\nQuarto & R MarkdownでPDF出力【LaTeX】\n\n\n\n\n\nPrevoius\n\n\n\nNext\n\n\n\n\n\n\n\n\n\n   \n    \n    \n      並び替え\n      デフォルト\n      \n        題名\n      \n      \n        日付 - 日付（昇順）\n      \n      \n        日付 - 日付（降順）\n      \n      \n        作者\n      \n    \n  \n    \n      \n      \n    \n\n\n\n\n\n\n\n\nTypst 入門\n\n\n\nTypst\n\n\n\nLaTeXにも代わりうる新しい組版システムTypstの基本的な使い方を、テンプレートを用いてご紹介します。\n\n\n\n\n\n\n2025/10/26\n\n\n\n\n\n\n\n\n\n\n\n【Typst】Quartoで論文を書く【PDF】\n\n\n\nTypst\n\nQuarto\n\nR\n\n\n\nLaTeXからTypstに乗り換えてみませんか？\n\n\n\n\n\n\n2025/10/21\n\n\n\n\n\n\n\n\n\n\n\n\n\n【Positron】拡張機能「Air」を使う【フォーマッタ】\n\n\n\nR\n\nPositron\n\n\n\nRのコードを自動で整えてくれる拡張機能です。\n\n\n\n\n\n\n2025/10/16\n\n\n\n\n\n\n\n\n\n\n\n開発コンテナの環境について\n\n\n\nR\n\nDocker\n\nVSCode\n\n\n\nVSCodeの開発コンテナを用いたRの開発環境についての一案です。\n\n\n\n\n\n\n2025/10/11\n\n\n\n\n\n\n\n\n\n\n\n\n\n【R】仮想環境を設定する【Python】\n\n\n\nR\n\nPython\n\nVSCode\n\nPositron\n\n\n\nrenvとvenvを使います！\n\n\n\n\n\n\n2025/09/26\n\n\n\n\n\n\n\n\n\n\n\nDuckDBをRで使う\n\n\n\nR\n\nSQL\n\nデータ処理\n\n\n\nR上でデータベース操作を行うために、DuckDBを利用する方法についてまとめます。\n\n\n\n\n\n\n2025/09/19\n\n\n\n\n\n\n\n\n\n\n\nPositronのおすすめ設定！【R | Python】\n\n\n\nPositron\n\nR\n\nPython\n\nQuarto\n\n\n\nRStudioからの移行もスムーズに進めましょう。\n\n\n\n\n\n\n2025/09/01\n\n\n\n\n\n\n\n\n\n\n\n\n\nXMLファイルから情報を抽出する\n\n\n\nR\n\nデータ処理\n\n\n\nxml2パッケージを使います。\n\n\n\n\n\n\n2025/08/26\n\n\n\n\n\n\n\n\n\n\n\n【Python】高速スクレイピングを実装する【並列化】\n\n\n\nPython\n\nデータ処理\n\n\n\nRよりも高速でスクレイピングを実行したい\n\n\n\n\n\n\n2025/08/16\n\n\n\n\n\n\n\n\n\n\n\nrecode関数でデータフレームの中身を置き換える\n\n\n\nR\n\nデータ処理\n\n\n\n表を作るときに重宝するかも…？\n\n\n\n\n\n\n2025/07/27\n\n\n\n\n\n\n\n\n\n\n\n\n\nRStudio Serverをインストールする【リモートデスクトップも】\n\n\n\nR\n\nRStudio\n\nWindows\n\nWSL\n\n\n\n他のデバイスからも操作できます！\n\n\n\n\n\n\n2025/07/15\n\n\n\n\n\n\n\n\n\n\n\n【スクレイピング】Rでe-Statのメッシュ人口データファイルを一気に取得する\n\n\n\nR\n\nデータ処理\n\n備忘録\n\n\n\n今回はメッシュデータのCSVファイルを取得していきます。\n\n\n\n\n\n\n2025/06/13\n\n\n\n\n\n\n\n\n\n\n\n\n\n【データ管理】DVCの設定まとめ\n\n\n\nDVC\n\n\n\nトークン切れによる再認証が必要な問題を解消できるかもしれません。\n\n\n\n\n\n\n2025/06/01\n\n\n\n\n\n\n\n\n\n\n\n【パッケージ開発】fixesでイベントスタディを効率化\n\n\n\nR\n\n\n\nバージョン0.7：バグを大幅に修正し、plot_es_interactive()関数を追加しました。\n\n\n\n\n\n\n2025/05/25\n\n\n\n\n\n\n\n\n\n\n\n【GIS】行政区域データを整理【ファイル有】\n\n\n\nR\n\nGIS\n\nデータ処理\n\n\n\n元データをサマライズし、簡略化・軽量化しました。\n\n\n\n\n\n\n2025/04/13\n\n\n\n\n\n\n\n\n\n\n\n\n\n【スクレイピング】rvestを使ってe-Statからファイルを取得する\n\n\n\nR\n\nデータ処理\n\n\n\nRのrvestパッケージを使って、e-Statの境界データを取得していきます！\n\n\n\n\n\n\n2025/03/19\n\n\n\n\n\n\n\n\n\n\n\ne-Stat APIを使ってデータを取得しよう\n\n\n\nR\n\nデータ処理\n\n\n\nAPIの第一歩についてまとめます！\n\n\n\n\n\n\n2025/03/09\n\n\n\n\n\n\n\n\n\n\n\n【ウェブサイト】設定を追加する\n\n\n\nQuarto\n\n\n\nGoogleアナリティクス、SNSアイコン、フッターの設定を追加します。\n\n\n\n\n\n\n2025/02/05\n\n\n\n\n\n\n\n\n\n\n\npinsでデータ管理\n\n\n\nR\n\n\n\nR × Google Driveでデータ管理\n\n\n\n\n\n\n2024/12/24\n\n\n\n\n\n\n\n\n\n\n\n\n\n【改訂版】開発コンテナを使ってR環境を構築！\n\n\n\nR\n\nDocker\n\nWindows\n\nMac\n\nUbuntu\n\nVSCode\n\nGitHub\n\n\n\nローカル環境から卒業！\n\n\n\n\n\n\n2024/12/19\n\n\n\n\n\n\n\n\n\n\n\n\n\n【Quarto & RStudio】ウェブサイトを作る！\n\n\n\nQuarto\n\nRStudio\n\nGitHub\n\n\n\nQuartoを使ってRStudio上でウェブサイトを作る方法をご紹介します。\n\n\n\n\n\n\n2024/12/13\n\n\n\n\n\n\n\n\n\n\n\nQuartoでアイコンを挿入したい\n\n\n\nQuarto\n\nVSCode\n\nRStudio\n\n備忘録\n\n\n\nQuartoのHTML出力でアイコンを挿入する方法を紹介します。\n\n\n\n\n\n\n2024/12/01\n\n\n\n\n\n\n\n\n\n\n\n\n\n【4.0.0対応！】ggplot2使い方ガイド\n\n\n\nR\n\n\n\nggplotを使うのに役立つコマンドを紹介します！\n\n\n\n\n\n\n2024/11/17\n\n\n\n\n\n\n\n\n\n\n\nRStudio (Server)でGitHub Copilotを使う\n\n\n\nGitHub\n\nRStudio\n\nDocker\n\n\n\nローカルとRStudio Serverに分けて説明します。\n\n\n\n\n\n\n2024/11/13\n\n\n\n\n\n\n\n\n\n\n\n\n\n【データハンドリング】pivot_longer()を使ってロング形式のパネルデータを作る【使い方】\n\n\n\nR\n\nデータ処理\n\n\n\nワイドからロングへ、データを変換します。\n\n\n\n\n\n\n2024/09/17\n\n\n\n\n\n\n\n\n\n\n\n市町村合併を反映させる\n\n\n\nR\n\nデータ処理\n\n\n\n古いデータに市町村合併を反映させる方法をご紹介します。\n\n\n\n\n\n\n2024/09/06\n\n\n\n\n\n\n\n\n\n\n\n\n\n【王道】TeX LiveをインストールしてLaTeX環境を構築する\n\n\n\nLaTeX\n\nVSCode\n\n\n\n王道ともいえるTeX Liveを用いたLaTeX環境の構築を解説します。とりあえずWindows版。\n\n\n\n\n\n\n2024/09/01\n\n\n\n\n\n\n\n\n\n\n\nDVCのためのGoogle Cloud Project\n\n\n\nDVC\n\n備忘録\n\n\n\nDVCにおける設定のエラーへの対処です（2024年8月31日）\n\n\n\n\n\n\n2024/08/31\n\n\n\n\n\n\n\n\n\n\n\n\n\n【RStudio】ローカルへのインストールまとめ\n\n\n\nR\n\nRStudio\n\n\n\nRが初めての方へ。～リンクも添えて～\n\n\n\n\n\n\n2024/08/29\n\n\n\n\n\n\n\n\n\n\n\n【Quarto】マークダウンでできること！\n\n\n\nQuarto\n\n\n\nマークダウンでできることは意外と奥が深い。独断と偏見で使う順にまとめます！\n\n\n\n\n\n\n2024/08/02\n\n\n\n\n\n\n\n\n\n\n\n\n\n【Quarto】論文の体裁を整える\n\n\n\nQuarto\n\nLaTeX\n\n\n\nQuarto × \\(\\LaTeX\\) で論文の体裁を整える方法について考えます。随時更新予定です。\n\n\n\n\n\n\n2024/07/22\n\n\n\n\n\n\n\n\n\n\n\n\n\n【PDF】Quarto で論文を書く\n\n\n\nQuarto\n\nR\n\nLaTeX\n\n\n\nQuarto を使って論文を書く方法（マークダウン、表、図）をまとめました。\n\n\n\n\n\n\n2024/06/29\n\n\n\n\n\n\n\n\n\n\n\n\n\n国勢調査データのクレンジング\n\n\n\nR\n\nデータ処理\n\n\n\n人口データのファイルを一括で読み込んで、分析で使いやすくするためのクレンジングコードです。\n\n\n\n\n\n\n2024/06/22\n\n\n\n\n\n\n\n\n\n\n\n\n\n環境構築におけるトラブルシューティング\n\n\n\n備忘録\n\n\n\n環境構築において直面したエラー等を随時まとめていきます。\n\n\n\n\n\n\n2024/06/19\n\n\n\n\n\n\n\n\n\n\n\n【WSL】割り当てるメモリを増やす方法\n\n\n\nWSL\n\nWindows\n\n備忘録\n\n\n\nWSL はデフォルトで PC の半分のメモリが割り当てられています。\n\n\n\n\n\n\n2024/05/31\n\n\n\n\n\n\n\n\n\n\n\n【ワークフロー】VSCode で GitHub を使う\n\n\n\nVSCode\n\nGitHub\n\n\n\nVSCode で GitHub を使った作業の流れを紹介します。\n\n\n\n\n\n\n2024/05/25\n\n\n\n\n\n\n\n\n\n\n\n\n\nTeX Live を使わずに LaTeX 環境を作る！\n\n\n\nWindows\n\nMac\n\nUbuntu\n\nLaTeX\n\n\n\nTinyTeX を使って R 環境以外でも \\(\\LaTeX\\) を使えるようにしよう！\n\n\n\n\n\n\n2024/05/20\n\n\n\n\n\n\n\n\n\n\n\n【R】アーカイブされたパッケージを使う\n\n\n\nR\n\n\n\nパッケージがインストールできない？\n\n\n\n\n\n\n2024/05/16\n\n\n\n\n\n\n\n\n\n\n\n\n\n【R】プロジェクトを使う\n\n\n\nR\n\n\n\nR プロジェクトを使って作業環境を整えよう！\n\n\n\n\n\n\n2024/05/15\n\n\n\n\n\n\n\n\n\n\n\n\n\n【Quarto】チャンクオプションまとめてみた【R Markdown】\n\n\n\nR\n\nQuarto\n\nR Markdown\n\n備忘録\n\n\n\nチャンクオプションは忘れやすい！\n\n\n\n\n\n\n2024/05/09\n\n\n\n\n\n\n\n\n\n\n\n【R Markdown】相互参照を使いこなす【Quarto】\n\n\n\nR Markdown\n\nQuarto\n\nR\n\n\n\n図や表に自動で番号を振りたい！\n\n\n\n\n\n\n2024/05/09\n\n\n\n\n\n\n\n\n\n\n\n\n\n【R パッケージ】インストールも読み込みも一撃で？【pacman】\n\n\n\nR\n\n\n\ninstall.packages() はもう不要！\n\n\n\n\n\n\n2024/05/07\n\n\n\n\n\n\n\n\n\n\n\nR でGIS を動かす【ハンドリング】\n\n\n\nR\n\nGIS\n\n\n\nR で GIS を動かそう！\n\n\n\n\n\n\n2024/05/06\n\n\n\n\n\n\n\n\n\n\n\n\n\n開発コンテナを使って R 環境を構築！\n\n\n\nR\n\nDocker\n\nWindows\n\nMac\n\nUbuntu\n\nVSCode\n\nGitHub\n\n\n\nローカル環境から卒業！\n\n\n\n\n\n\n2024/05/04\n\n\n\n\n\n\n\n\n\n\n\n政令指定都市・中核市の整理\n\n\n\nR\n\nデータ処理\n\n\n\nRで市区町村データを整理するための政令指定都市・中核市をまとめたコードです。\n\n\n\n\n\n\n2024/04/14\n\n\n\n\n\n\n\n\n\n\n\n【Typst】Quarto & R MarkdownでPDF出力【LaTeX】\n\n\n\nR\n\nR Markdown\n\nQuarto\n\nTypst\n\nLaTeX\n\n\n\nレポートでR Markdown、使ってますか？\n\n\n\n\n\n\n2024/03/29\n\n\n\n\n\n\n一致なし\n\n  \n\n\n\n\n\n\n\n\n\n\n\nNote開発環境\n\n\n\n最終更新日：2025年11月2日\n\nPositron: 2025.12.0 build 9\nR version 4.5.2 (2025-10-31 ucrt)\nPython 3.13.8\nQuarto 1.9.9"
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/index.html#はじめに",
    "href": "pages/tips/2025/10/251021_quarto_typst/index.html#はじめに",
    "title": "【Typst】Quartoで論文を書く【PDF】",
    "section": "はじめに",
    "text": "はじめに\n以前TinyTeXを使ってRStudio×Quartoで論文を書く方法についてご紹介しました。\n\n\n\n\n\n\n【PDF】Quarto で論文を書く\n\n\n\nしかし、TinyTeXを使った方法はいくらTiny（軽量）とはいえLaTeX特有のエラーが発生することもあり、論文を書くとなると、どうせなら細かい設定をするためにローカルのTeXやOverleafで書くことが多いのではないかと思います1。\nそこで今回は、LaTeXも代わりうる新しい組版システムであるTypstを使ってQuartoで論文を書く方法をご紹介します。\nまた、英語論文のバージョンではありますが、Quarto拡張機能を作成し経済学論文のテンプレートも用意しましたので、併せてご紹介します。\nRの出力をシームレスにTypstに組み込むことが可能ですので、R（Python）ユーザーの方はぜひご活用ください。"
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/index.html#typstとは",
    "href": "pages/tips/2025/10/251021_quarto_typst/index.html#typstとは",
    "title": "【Typst】Quartoで論文を書く【PDF】",
    "section": "Typstとは？",
    "text": "Typstとは？\nTypstは、新しいマークアップベースの組版システムで、オープンソースで提供されています。\n基本的にはLaTeXと同様に、学術論文に適した高品質なPDFを生成することができますが、TypstにはLaTeXに比べていくつかの利点があります。\n\nシンプルな文法: Typstの文法はLaTeXに比べて直感的で、学びやすいという特徴があります。\n※ただし、Quarto上で利用する場合はQuartoやR Markdown同様Markdownベースの記述となるため、Typstの文法を直接学ぶ必要はありません。\nリアルタイムプレビュー: Typstの公式オンラインエディタはリアルタイムプレビュー機能を備えており、編集内容が即座に反映されるため、効率的に文書を作成できます。\n※ただし、Quarto上ではリアルタイムプレビューは利用できません。\n\n高速なコンパイル: これはQuarto×Typstの場合ですが、Typst出力は非常に高速なコンパイルを実現しており、LaTeXの数倍の速度でPDFを生成できます。\n\nTypstにはOverleafのような公式オンラインエディタが提供されており、柔軟に文書を編集できますが、当然ながらそちらではTypstの文法を使って記述する必要があります。\n一方で、Quartoを介してTypstを利用することで、Markdownベースの記述を保ちながらTypstの利点を活かすことが可能です。\n中でも特筆すべきはそのコンパイル速度です。LaTeXのコンパイル時間にストレスを感じている方は、Typstの速さにきっと驚くでしょう！（ガチ）"
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/index.html#quartoでtypstを使う方法",
    "href": "pages/tips/2025/10/251021_quarto_typst/index.html#quartoでtypstを使う方法",
    "title": "【Typst】Quartoで論文を書く【PDF】",
    "section": "QuartoでTypstを使う方法",
    "text": "QuartoでTypstを使う方法\nデフォルトの設定でよければ、以下のようにYAMLヘッダーを設定するだけでTypstを利用できます。\n---\ntitle: \"ドキュメントのタイトル\"\nauthor: \"著者名\"\ndate: 2025-10-21\nformat: typst\n---\n課題のレポートであればこれで十分なドキュメントを生成できるはずです。{tinytex}のようなパッケージのインストールも不要です。\n\n\n\n\n\n\nTip参考\n\n\n\n自分の記事で恐縮ですが、以下をご覧いただければQuartoでの書き方がわかるかと思います。\n\n【Typst】Quarto & R MarkdownでPDF出力【LaTeX】\n【Quarto】チャンクオプションまとめてみた【R Markdown】\n【PDF】Quarto で論文を書く\n【Quarto】マークダウンでできること！"
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/index.html#quarto拡張機能を使う",
    "href": "pages/tips/2025/10/251021_quarto_typst/index.html#quarto拡張機能を使う",
    "title": "【Typst】Quartoで論文を書く【PDF】",
    "section": "Quarto拡張機能を使う",
    "text": "Quarto拡張機能を使う\n冒頭にも書きました通り、英語論文用のテンプレートであるQuarto拡張機能を作成しました。作成に当たっては、自分が修士論文をQuartoで書こうとしたときに対応できず挫折した部分をなるべく補うように努めました。\n\n対応環境\nはじめに拡張機能を使うための対応環境について説明します。\n\nQuarto 1.8以上\n\nRを使っていればQuartoはデフォルトで使えるのですが、現在はバージョンが1.8にはなっていないと思います。 その場合は、Quartoの公式サイトから1.8以上をインストールしてください2。\nまた、RStudioあるいはPositronの環境を想定しています。\n\n\n拡張機能のインストール\n拡張機能は以下のコマンドでインストールできます。作業フォルダを開いた状態で実行してください。\n\n\nターミナル\n\nquarto install extension yo5uke/econ-a4\n\n実行するとYse/Noの確認が求められますので、Yを入力して進めてください。最後の「? View documentation using default browser? (Y/n)」はnでもよいのですが、ドキュメントが見れますのでYから使い方を確認してください。\n\n\n拡張機能の利用\n拡張機能を利用するには、YAMLヘッダーのformatフィールドを以下のように設定します。\nformat:\n  econ-a4-typst: default\nこれで、経済学論文用のA4サイズのTypstテンプレートが利用できます。\n使い方はGitHubリポジトリのREADMEにも記載していますので、そちらもご覧ください。\n\n\nサンプルコード\n以下は、拡張機能を利用したサンプルコードです。\n---\ntitle: \"Writing Papers with Quarto and Typst\"\nauthor: \n  - name: Your Name\n    affiliation: Your Affiliation\n    email: your-address@example.com\ndate: 2025-10-21\ndate-format: long\nabstract: |\n  This is a sample abstract.\nkeywords: [Quarto, Typst, Academic Writing, PDF Generation]\nformat:\n  econ-a4-typst:\n    toc: true\n    number-sections: true\n---\n\n## Introduction\n\n@notsu_indirect_2025\n\nThis is a sample introduction text.\n\n## Insert Figures\n\n```{r}\n#| echo: false\n\nlibrary(ggplot2)\n\n# Create a simple plot\nggplot(mtcars, aes(x = wt, y = mpg)) +\n  geom_point() +\n  labs(\n    title = \"Scatter plot of MPG vs Weight\",\n    x = \"Weight (1000 lbs)\",\n    y = \"Miles per Gallon\"\n  )\n```\n\n## Insert Tables\n\n```{r}\n#| echo: false\n\nlibrary(knitr)\n\n# Create a simple table\nkable(head(mtcars), caption = \"Table 1: Sample of mtcars dataset\")\n```\n\n```{=typst}\n#bibliography(\"references.bib\")\n```\n出力結果はこちらからご確認ください（少しダミーテキストで文量を増やしています）。\n参考文献のセクションについては現状生のTypstコードで指定する必要がありますので、例にあるように記述してください。“References”という見出しも自動で生成されます。\nもちろんRコードを使って図や表を挿入することも可能です。分析の結果を一度画像等で出力することなく挿入できるため、論文作成が非常に楽になります（もちろんレポートも！）。\n\n\n今後の展望\n今回は英語論文用のテンプレートを作成しましたが、今後は日本語でも使えるテンプレートを作成したいと考えています。\nやはり海外誌に出すような細かい設定を行う論文はQuartoを介さずTypstやLaTeXで書くことが多くなるかと思いますが、学位論文はこの拡張機能で十分対応できるようになればと考えています（とはいえ将来は細かい設定も詰めたい…！）。\nテンプレートの限界についてはREADMEにも記載していますので、ご覧ください。"
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/index.html#おわりに",
    "href": "pages/tips/2025/10/251021_quarto_typst/index.html#おわりに",
    "title": "【Typst】Quartoで論文を書く【PDF】",
    "section": "おわりに",
    "text": "おわりに\n今回はQuartoの記述方法自体はほぼ説明しませんでしたが、Typst（＆作成したテンプレート）を使うことで、MarkdownベースでTypstの利点を享受できるということをお伝えできたかと思います。\nぜひTypstを使って快適な論文執筆ライフを送りましょう！🚀\n\n\n\n\n\n\nTypst Documentation"
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/index.html#footnotes",
    "href": "pages/tips/2025/10/251021_quarto_typst/index.html#footnotes",
    "title": "【Typst】Quartoで論文を書く【PDF】",
    "section": "注",
    "text": "注\n\n\nかくいう僕も修士論文はローカルのTeXを使って書きました。↩︎\n2025/10/21時点では1.8.5ですので、表示されているものをインストールすればOKです。↩︎"
  },
  {
    "objectID": "pages/tips/2025/10/251016_air/index.html#はじめに",
    "href": "pages/tips/2025/10/251016_air/index.html#はじめに",
    "title": "【Positron】拡張機能「Air」を使う【フォーマッタ】",
    "section": "はじめに",
    "text": "はじめに\nPositronに標準でインストールされている拡張機能がいくつかあるのですが、その一つが「Air - R Language Support」です。\nこの拡張機能は、Rのコードを自動でフォーマットしてくれるもので、コードの可読性を向上させるのに役立ちます。\n例えばどこで改行するのか、インデントはどうするのか、スペースをどこに入れるのかなどは人によってばらばらで、定まったルールがありません。場所によってスペースの有無が異なったり1行が長すぎたりするとコードが読みにくくなります。\nAirは一定の規則に則りコードを整形してくれるので、コードの見た目を統一することができます。\nこれに関しては百聞は一見に如かずということで、早速使い方から実際の例まで見ていきましょう。"
  },
  {
    "objectID": "pages/tips/2025/10/251016_air/index.html#airの使い方",
    "href": "pages/tips/2025/10/251016_air/index.html#airの使い方",
    "title": "【Positron】拡張機能「Air」を使う【フォーマッタ】",
    "section": "Airの使い方",
    "text": "Airの使い方\nAirはPositronに標準でインストールされているので、特にインストールする必要はありません。ただし、有効化はされていないので、設定から有効化していきましょう。\n\nPositronの設定を開きます。\n\n左下の歯車アイコンから開くか、Ctrl-,Ctrl-,で開きます。\n\n画面右上の「設定 (JSON) を開く」から設定ファイルを開きます。\n\n\n\n\n1番左のアイコンです\n\n\n\n設定ファイルに以下のコードを追加します。\n\n既に[ ]の中に記載があれば、その中に追記してください。\n\n\n[\n    \"[r]\": {\n        \"editor.formatOnSave\": true,\n        \"editor.defaultFormatter\": \"Posit.air-vscode\"\n    }\n]\n\n保存します。\n\nこれで設定は完了です。.Rファイル内で、Rのコードは保存するたびに自動で整形されるようになります。"
  },
  {
    "objectID": "pages/tips/2025/10/251016_air/index.html#実際の例",
    "href": "pages/tips/2025/10/251016_air/index.html#実際の例",
    "title": "【Positron】拡張機能「Air」を使う【フォーマッタ】",
    "section": "実際の例",
    "text": "実際の例\nではこのフォーマッタの力はどれほどのものなのか、実際に見ていきましょう。\n例えば以下のようなコードがあったとします。\nmy_function &lt;- function(x,y){\nif(x&gt;y){return(x+y)}else{return(x-y)}\n}\nresult&lt;-my_function(10,5)print(result)\nこのコードはインデントがなく、スペースの使い方も一貫していません。これを修正したいわけですが、手作業だと面倒ですし、ミスも起こり得ます。\nフォーマッタはコードの保存時に整形してくれますから、早速保存してみましょう。すると上のコードは以下のようになります。\nmy_function &lt;- function(x, y) {\n  if (x &gt; y) {\n    return(x + y)\n  } else {\n    return(x - y)\n  }\n}\nresult &lt;- my_function(10, 5)\nprint(result)\nインデントの追加やスペースの挿入など、コードが格段に読みやすくなりました。\nリストなどで中身が多く1行に収まりきらない場合でも、適切に改行してくれます。\nmy_vector &lt;- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)\nmy_data_frame &lt;- data.frame(id = 1:10, value = rnorm(10),\n                            category = sample(letters[1:3], 10, replace = TRUE))\nこのコードも悪いコードではないのですが、やや右に比重がかかっている印象ですね。これをフォーマッタにかけると以下のようになります。\nmy_vector &lt;- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)\nmy_data_frame &lt;- data.frame(\n  id = 1:10,\n  value = rnorm(10),\n  category = sample(letters[1:3], 10, replace = TRUE)\n)\ndata.frame()の中身が見やすくなりました。\nちなみにmy_vectorの方も、最初に1度だけ改行しておくと、全て改行するスタイルにしてくれます。少し中身を変えて試してみます。\n# Before\nmy_vector &lt;- c(\n  \"Jane Doe\",\"John Smith\")\n\n# After\nmy_vector &lt;- c(\n  \"Jane Doe\",\n  \"John Smith\"\n)\nこのように最初だけ改行しておけば、1行が短い場合でも残りの要素を改行してくれます。フォーマッタの力を借りるのであれば、スペースも気にせず書き連ね、必要に応じて1か所改行して保存するだけで整形することができ、非常に楽かもしれません。\n\n\n\n\n\n\nTipコードのスタイルについて\n\n\n\nTidyverseの生みの親であるHadley Wickhamは、『R for Data Science』の中で、コードのスタイルについて以下のように述べています。\n\nIf the function you’re piping into has named arguments (like mutate() or summarize()), put each argument on a new line. If the function doesn’t have named arguments (like select() or filter()), keep everything on one line unless it doesn’t fit, in which case you should put each argument on its own line.\n\nつまり、引数に名前がついている関数（dplyr::mutate()やsummarize()など）では各引数を改行し、名前がついていない関数（dplyr::select()やfilter()など）では1行にまとめるべきだとしています。\n\n\nコード\nlibrary(dplyr)\nlibrary(nycflights13)\n\n# Strive for\nflights |&gt;\n  group_by(tailnum) |&gt;\n  summarize(\n    delay = mean(arr_delay, na.rm = TRUE),\n    n = n()\n  )\n\n# Avoid\nflights |&gt;\n  group_by(\n    tailnum\n  ) |&gt;\n  summarize(delay = mean(arr_delay, na.rm = TRUE), n = n())"
  },
  {
    "objectID": "pages/tips/2025/10/251016_air/index.html#フォーマットを回避",
    "href": "pages/tips/2025/10/251016_air/index.html#フォーマットを回避",
    "title": "【Positron】拡張機能「Air」を使う【フォーマッタ】",
    "section": "フォーマットを回避",
    "text": "フォーマットを回避\n場合によってはフォーマッタの力を借りたくない場合もあるかもしれません。その場合は、以下のようにコードの前後にコメントを入れることで、フォーマットを回避することができます。\n# fmt: skip\nmy_vector &lt;- c(1,2,3,4,5,6,7,\n8,9,10)\nこのように# fmt: skipを入れることで、そのコードブロックはフォーマッタの対象外となります。\nまた、これはコードの途中に挟むこともできます。\ndf &lt;- tibble::tibble(\n  x = 1:5,\n  y = 6:10\n) |&gt;\n  # fmt: skip\n  dplyr::mutate(\n    z = x + y) |&gt;\n  dplyr::select(\n    col1,\n    col2,\n    col3,\n    col4\n  )\n同様に# fmt: skipを入れることで、その行以降はフォーマッタの対象外となります。コードの途中に挟んだ場合、その後のコードは再びフォーマッタの対象となるので注意してください。ここで言えばdplyr::select()の行は再びフォーマッタの対象となり、整形されています。"
  },
  {
    "objectID": "pages/tips/2025/10/251016_air/index.html#quartoにも反映させたい",
    "href": "pages/tips/2025/10/251016_air/index.html#quartoにも反映させたい",
    "title": "【Positron】拡張機能「Air」を使う【フォーマッタ】",
    "section": "Quartoにも反映させたい",
    "text": "Quartoにも反映させたい\n以上の設定は.Rファイルに対してのみ有効です。Quartoドキュメント内のRコードチャンクに対しても同じようにフォーマッタを適用したい場合は、以下の設定を追加してください。\n[\n    \"[r]\": {\n        \"editor.formatOnSave\": true,\n        \"editor.defaultFormatter\": \"Posit.air-vscode\"\n    },\n\n    // 以下を追記\n    \"[quarto]\": {\n        \"editor.formatOnSave\": true,\n        \"editor.defaultFormatter\": \"quarto.quarto\"\n    }\n]\nこれでQuartoドキュメント内のRコードチャンクも保存するたびに自動で整形されるようになります。"
  },
  {
    "objectID": "pages/tips/2025/10/251016_air/index.html#おわりに",
    "href": "pages/tips/2025/10/251016_air/index.html#おわりに",
    "title": "【Positron】拡張機能「Air」を使う【フォーマッタ】",
    "section": "おわりに",
    "text": "おわりに\n今回はPositronに標準でインストールされている拡張機能「Air」を紹介しました。\n個人的にはコードの書き方にはその人の癖が出てそれはそれでよいものだと思っているのですが、とはいえ生成AIが発達してきた昨今ではコードもAIに書いてもらうことが増え、コードの品質の差はなくなってきているのではないかと思いますし、フォーマッタを使用することも今後より一般的になっていくのではないかと考えています。\nAirは非常にシンプルで使いやすい拡張機能なので、ぜひ試してみてください。"
  },
  {
    "objectID": "pages/tips/2025/10/251016_air/index.html#参考",
    "href": "pages/tips/2025/10/251016_air/index.html#参考",
    "title": "【Positron】拡張機能「Air」を使う【フォーマッタ】",
    "section": "参考",
    "text": "参考\n\nAir - R Language Support"
  },
  {
    "objectID": "pages/tips/2025/09/250926_virtual_environment/index.html#はじめに",
    "href": "pages/tips/2025/09/250926_virtual_environment/index.html#はじめに",
    "title": "【R】仮想環境を設定する【Python】",
    "section": "はじめに",
    "text": "はじめに\nみなさん、仮想環境、使っていらっしゃいますでしょうか。\nプログラミングにおける仮想環境とは、プロジェクトごとに依存パッケージを切り分けて管理できる仕組みです。これにより、他のプロジェクトやシステム全体に影響を与えず、再現性の高い開発環境を保つことができます。研究や開発を長期に続ける上で、安定した環境を構築するために欠かせないものです。\n例えば、仮想環境をしない場合とする場合で、以下のような違いがあります。\n【仮想環境なし】\n\n全プロジェクトで共通のRやPythonのパッケージ（同じバージョン）を使用する。\nあるプロジェクトのためにパッケージを更新すると、他のプロジェクトで動かなくなるリスクがある。\nチームで共有するとき、同じ環境を再現するのが難しい。\n\n【仮想環境あり】\n\nプロジェクトごとにパッケージのバージョンを使い分ける。\n依存関係を切り分けることで、環境が壊れるリスクを減らせる。\n設定ファイルを共有すれば、他の人も同じ環境を簡単に再現できる。\n\n本ページでは、これらの違いについて説明しつつ、実際に導入するためのコードも掲載しますので、仮想環境になじみのない方から、知ってはいるけど毎度どうやるんだっけ…となってしまう方までご参考にしていただければと思います。"
  },
  {
    "objectID": "pages/tips/2025/09/250926_virtual_environment/index.html#仮想環境について",
    "href": "pages/tips/2025/09/250926_virtual_environment/index.html#仮想環境について",
    "title": "【R】仮想環境を設定する【Python】",
    "section": "仮想環境について",
    "text": "仮想環境について\n仮想環境のポイントは、上で書いた通りです。もう少し詳しく書きます。\n例えば、3年前のRと現在のRでは、バージョンも利用できるパッケージも大きく異なります。もしRやパッケージを常に最新に保っていた場合、3年前に書いたコードがそのまま期待通りに動作するとは限りません。計算方法が変わっていたり、古い関数が削除されていたりして、過去の研究を再現できない可能性があるのです。\nこの点、仮想環境では「バージョンごとに環境を保存する」ことで問題に対応できます。例えば、あるパッケージの現在のバージョンが1.2.3だとしても、3年後には1.5.4へ更新されているかもしれません。仮想環境を使えば「このプロジェクトではバージョン1.2.3を使用していますよ」とファイルに記録し、後からその環境を再現することができるのです。\nこうすることで、研究当時の環境を正確に呼び出せるため、バージョン変更に伴うトラブルを避け、長期的に安定した再現性を確保できます。\nちなみに本ページではRに関してはrenv、Pythonに関してはvenvを使用します。どちらもメジャーな仮想環境であり、これを使えていれば問題ないと思います。\nPythonに関してはcondaなど他のメジャーな仮想環境もありますが、本ページを見てくださっている方であれば個人的にはvenvで十分だと考えています。これは目的にもよりますので、興味がある方は他の仮想環境も調べてみてください。"
  },
  {
    "objectID": "pages/tips/2025/09/250926_virtual_environment/index.html#renv",
    "href": "pages/tips/2025/09/250926_virtual_environment/index.html#renv",
    "title": "【R】仮想環境を設定する【Python】",
    "section": "renv",
    "text": "renv\nではRの方の説明から始めます。\nrenvは、R プロジェクトごとに使用するパッケージの情報を ロックファイル（renv.lock） に記録し、必要に応じて同じ環境を再現できるようにするパッケージです。このロックファイルが「このパッケージのバージョン1.2.3を使用していますよ」ということを保存しているということですね。\nライブラリはグローバル環境とは分離され、プロジェクト専用のフォルダに保存されます。これにより「どのパッケージを、どのバージョンで使っていたか」が明示され、数年後でも同じ環境を復元することが可能になります。\nもし仮想環境を使ったことがない方であれば、今あなたが使っているのがグローバル環境です。グローバル環境でパッケージをアップデートした場合、もれなくすべてのプロジェクトでパッケージのバージョンが更新されます。renvを使用していれば、そのプロジェクトについてだけバージョンが更新されるという仕組みです。\n\nrenvの始め方\n始め方は極めて簡単です。\nまずはプロジェクトを作成します。プロジェクトとは？という方であれば、RStudioユーザーの方であればこちら、Positronの方であればこちらをご参考になさってください。\nそしたらコンソールで以下を実行します。\n# renvをまだインストールしていない場合は先にこちらを実行\n# install.packages(\"renv\")\n\nrenv::init()\nrenvを開始する、というわかりやすい関数ですね。するとワーキングディレクトリ内にrenvというフォルダと、.Rprofile、renv.lockファイルが作成されます。これで設定やらなにやらをしていますので、ファイルは消さないようにしてください。\n後は通常通り作業を進めます。パッケージのインストールや、アップデートをしても、それはこのファイル内でのみ適用されます。\n\n\n保存の仕方\n作業を一通り終えたら、ロックファイルにパッケージのバージョンを記述しないといけません（もちろん自動でやってくれます）。以下を実行してください。\nrenv::snapshot()\nDo you want to proceed? [Y/n]:と出てきたらYを入力し、- Lockfile written to \"~/yo5uke.github.io/renv.lock\".と出てきたら保存完了です。\n新しいパッケージを追加したらその都度スナップショットを実行してください。ちなみにインストールしただけでは記載の対象にならず、プロジェクト内のコードで使用したパッケージのみ記載されます。この点renvは賢いですよね。\n\n\n環境の呼び出し方\n例えばPCを変更して、環境が移ったとします。すると新しい環境ではパッケージが何もインストールされていない状態です。\nしかしプロジェクトをGit経由等で新しい環境に移せたら、ロックファイルがありますので、その情報をもとに必要なパッケージをインストールすることが可能です。\nrenvパッケージがインストールされていない場合はしてから、以下の関数を実行します。\n# install.packages(\"renv\")\nrenv::restore()\nこれでロックファイル内に記載されているパッケージが、バージョンを保ったまま新しい環境にインストールされます。これで前のPCと同じ環境が再現できるというわけです。\nちなみに新しいPCというわけではなくとも、GitHubにプロジェクトをアップロードしておけば、当然ロックファイルもGitHub上に保存されるわけですので、再度GitHubから引っ張ってくれば、ローカルから一度プロジェクトを削除しても後々再現ができるわけです。これは地味にうれしいですよね。\n\n\nまとめ\ninit()、snapshot()、restore()の3つが使えれば、renvを使いこなせていると言えるでしょう。近年は再現可能な研究への需要が高まってきていますから、Rユーザーの方はぜひrenvを使ってみてください。"
  },
  {
    "objectID": "pages/tips/2025/09/250926_virtual_environment/index.html#venv",
    "href": "pages/tips/2025/09/250926_virtual_environment/index.html#venv",
    "title": "【R】仮想環境を設定する【Python】",
    "section": "venv",
    "text": "venv\nPythonは少々ややこしいと個人的に感じています1。\nrenvはR上で完結する一方、venvはPowerShellないしコマンドプロンプトを使う必要があるからです2。\nそれでは改めてvenvについて説明します。\nvenvはPythonに標準で付属している仮想環境ツールで、プロジェクトごとに独立したパッケージ環境を作成できます。\nvenvで作成した環境はプロジェクト内の.venvフォルダに保存され、そこにPython本体や必要なライブラリがインストールされます。そのため、システム全体のPythonに影響を与えることなく、プロジェクトごとにライブラリのバージョンを固定できます。\nさらに、requirements.txtというファイルを用いれば、使用しているライブラリとそのバージョンを記録し、他の人や別の環境でも同じ構成を再現できます。これはRのrenv.lockに相当する役割です。\n\nvenvの始め方\nそれではvenv環境を作る手順に移ります。\nVSCodeもしくはPositronの場合、まずプロジェクト（ワークスペース）を開いたのち、Ctrl + Shift + @でターミナルを開きます。\n開けたら、以下を入力して実行します。\npython -m venv .venv\nこれは独立したPython環境を.venvというフォルダに作るということを意味しており、.venvという名前で作成すると、VSCodeやPositronが自動的に「これを仮想環境だな」と認識し、インタープリタの候補に出してくれるので必須ではないですがおすすめです3。\nしかし、環境を作るだけでは自動でアクティベートされません（最初は自動で起動しないということです）。\nVSCodeの場合方法は2つあります。1つ目は簡単で、ターミナルを新しくするということです。ターミナルの右上に+ボタンがありますので、これを押して新しいターミナルを開きます。すると以下のような表示が出ますので、これでアクティベートされています。\n\n\n\nVSCodeのターミナル\n\n\n頭に(.venv)と表示されていれば、アクティベートされています。\n2つ目は、1つ目の方法でうまくいかなかったときにも有効な方法で、ターミナルに以下を打ち込んで実行します。\n.venv/Scripts/activate\nこれでアクティベートされます4。上の画像と同じ表示になると思いますのでご確認ください。\nPositronの場合は、ウィンドウ右上の「R 4.5.1」や「Python 3.13.7」と表示があるところからインタープリタを選択します。\n\n\n\nPositronのイメージ\n\n\n「Venv: .venv」とあるものを選択すればvenv環境に移れます。こちらは簡単ですね。\nちなみに少し細かい話をすると、.venvは容量が大きい一方で、環境の再現自体はrequirements.txtのみで担保できるため、Gitには保存せず.gitignoreに.venv/と記載しておくのがよいと思います。そのため、後述しますが新しい環境では再度venv環境を作成してください。\n\n\n保存の仕方\n保存もターミナル上で行います（Pythonのコンソールではありません）。\nターミナルで以下を実行します。\npip freeze &gt; requirements.txt\nこれは先述の通り、requirements.txtというファイルにパッケージ名とバージョンを保存します。まさにロックファイルと同じような感じですが、中身を見てみると、polars==1.33.1のように、非常にシンプルな形で記載されています。\n作業が終わったら、適宜保存してください。\n\n\nパッケージの呼び出し方\nR同様、新しい環境に移行したら、このrequirements.txtファイルからパッケージをバージョンごと再現する必要があります。\n新しい環境だとまだ.venvが存在しないと思うので、前と同じ方法でvenv環境を作成したのち、renv::restore()と同じような働きをする以下のコマンドを実行します。\npip install -r requirements.txt\n-rは「ファイルに書かれたリストを読む」という意味で、これでファイル内に記載されているパッケージがまとめてインストールできます。\n\n\nまとめ\nrenvよりはやや複雑ですが、ターミナル上で仮想環境の作成から再現まで行うことができます。必要なのは以下の3つです。\npython -m venv .venv\npip freeze &gt; requirements.txt\npip install -r requirements.txt"
  },
  {
    "objectID": "pages/tips/2025/09/250926_virtual_environment/index.html#まとめ-2",
    "href": "pages/tips/2025/09/250926_virtual_environment/index.html#まとめ-2",
    "title": "【R】仮想環境を設定する【Python】",
    "section": "まとめ",
    "text": "まとめ\n今回は仮想環境のrenvとvenvについて簡単にご紹介しました。簡単にとはいうものの、エンジニアでもなければこれで十分ではないかと思っています。\n仮想環境を活用しながら、再現可能な研究を進めていきましょう！\n（余談：サムネイルの設定をミスったのですが、でかでかと.venvが表示されたので、これで良しとします！）"
  },
  {
    "objectID": "pages/tips/2025/09/250926_virtual_environment/index.html#footnotes",
    "href": "pages/tips/2025/09/250926_virtual_environment/index.html#footnotes",
    "title": "【R】仮想環境を設定する【Python】",
    "section": "注",
    "text": "注\n\n\nPythonはまだ勉強中ということもあり、マスターすれば大したことはないのかもしれません。↩︎\nMacユーザーの方へは十分な説明になっていないかもしれませんが、ターミナルを使うことになると思います。↩︎\nインタープリタというのは、使用するPythonのバージョンのようなイメージです。PCにインストールしたグローバルなPython環境と、venv環境がこの場合の選択肢です。↩︎\n.venvとは異なるフォルダ名で作成した場合はその名前に変えてください。↩︎"
  },
  {
    "objectID": "pages/tips/2025/09/250901_positron_setting/index.html#はじめに",
    "href": "pages/tips/2025/09/250901_positron_setting/index.html#はじめに",
    "title": "Positronのおすすめ設定！【R | Python】",
    "section": "はじめに",
    "text": "はじめに\n\n\n\n\n\n\nNoteユーザー設定とワークスペース設定\n\n\n\n\n\nPositron（VSCode）にはユーザー設定とワークスペース設定があります。ユーザー設定はプロジェクトに依らずPositron全体に適用される設定で、ワークスペース設定は特定のワークスペース（フォルダ）にのみ適用される設定です。\n本ページで何回か設定をいじる場面があります。全体に適用したい場合は設定を開いたのち検索窓の下にある「ユーザー」を選択したうえで設定を進め、特定のプロジェクトにのみ適用したい場合はプロジェクトを開き「ワークスペース」を選択してから設定を進めてください。\n\n\n\nユーザーとワークスペースの切り替え\n\n\n\n\n\n9月に入りましたが引き続き暑いですね。オフィスにこもってパソコンをカタカタしているのでまだましですが、たまに外へ出ると秋はいつ来るのかと、考えてしまいます…。\nところで、僕はと言えば最近も仕事でRを使う機会が多いのですが、最近はRStudioではなくPositronを主に使うようにしています。理由はシンプルで、新しいものが好きだからです。\nVSCodeをベースに作られていることもあり、なんとなく敬遠していたのですが（RStudioユーザーがVSCodeで満足のいくRの環境を整えるのは一苦労なので…）、RStudioのキーボードショートカットが使えることに気づいたり、レイアウトを変更できることも知れたりと、ようやく新しい環境を試せそう！と思い立って一気に設定を終わらせた次第です1。\n今回は個人的に満足がいっている設定をピックアップしてまとめていこうと思います。\nこの記事は適宜更新する予定です。"
  },
  {
    "objectID": "pages/tips/2025/09/250901_positron_setting/index.html#positronとは",
    "href": "pages/tips/2025/09/250901_positron_setting/index.html#positronとは",
    "title": "Positronのおすすめ設定！【R | Python】",
    "section": "Positronとは？",
    "text": "Positronとは？\nそもそもPositronとは何なんだという方もいらっしゃることを想定し、ごく簡単にPositronについてまとめます。\nPositronはPosit社（旧RStudio社）が開発している統合開発環境（IDE）で、VSCodeをベースに作られており、RとPythonのために最適化されているのが特徴です。\n従来のVSCodeにおけるRの使い勝手はあまりよくないと個人的に感じており、例えばRStudioで使い慣れたキーボードショートカットを自分で設定しなければいけなかったり、環境変数（格納したデータ等）が見にくかったりしていましたが、PositronではRStudioの要素も取り入れつつ、これまでRStudioを使用していたユーザーにとって移行しやすいコーディング環境が提供されています2。\n\n\n\n設定をいじっているのでデフォルトとは異なっています\n\n\nPositronの画面はこんな感じで、右上の「R 4.5.1」の部分からPythonへの切り替えも可能です。\nデフォルトでは下にコンソール、右上に変数とデフォルトのRStudioと同じ構成になっているのですが、このあたりの設定についてもこれから書いていきます。\nインストールについては書きませんが、以下からダウンロードできます。\nDownload Positron\nWindowsの方であれば一番上のをダウンロードすればよいと思います。"
  },
  {
    "objectID": "pages/tips/2025/09/250901_positron_setting/index.html#キーボードショートカットの設定",
    "href": "pages/tips/2025/09/250901_positron_setting/index.html#キーボードショートカットの設定",
    "title": "Positronのおすすめ設定！【R | Python】",
    "section": "キーボードショートカットの設定",
    "text": "キーボードショートカットの設定\n\nRStudioからの移行\nまずRStudioからの移行を検討する場合、やはりキーボードショートカットは引き続き使えた方が良いですよね。\n画面左下歯車マークから「設定」を開きます。すると設定画面が出てきますので、上部に出てきた「設定の検索」窓に「workbench.keybindings.rstudioKeybindings」と入力します（ぜひコピペしてくださいね）。\nすると設定が1つヒットし、チェックボックスにはチェックが入っていない状況かと思います。\nそこにチェックを入れ、確認出来たら上部の×印から設定を閉じます。再起動が必要ですので、一度Positronを閉じてから再度開いてください。これで基本的なRStudioのキーボードショートカットが使えるようになります。\n\n\n\nこの項目にチェックを入れてください\n\n\n\n\n地味にイヤな設定の解消\n\n\n\n\n\n\nCautionMacユーザーの方へ\n\n\n\nここではWindowsのキーに基づいて説明しています。Macの方は適宜キーを置き換えながら読み進めてください。Macの正しいキーについて存じ上げず、申し訳ありません。\n\n\n続いて、地味に困ったのがQuarto Markdownにおけるチャンク挿入についてです3。\nRStudio上ではチャンク（```{r}で始まるコードブロック）を挿入する際にCtrl-Alt-ICtrl-Alt-Iでチャンクを挿入できるわけなのですが、これはカーソルを置いている位置から始まります。カーソルを置いているその行に```{r}が挿入されるということです。\nしかしPositronでは、その行を空行にしたうえで、1行下に挿入される設定になっています。気にされないようであれば放置でよいのですが、僕は気になってしまったので、修正することにしました。\n先ほどと同様画面左下歯車マークから「キーボードショートカット」（キーボードを使う場合Ctrl-K+Ctrl-SCtrl-K+Ctrl-S）を開きます。\nするとキーボードショートカットに関する設定がずらーっと出てきますが、出てきた画面右上の「キーボードショートカットを開く（JSON）」というアイコンをクリックして開きます。\n\n\n\n赤で示した部分です\n\n\nすると// 既定値を上書きするには、このファイル内にキー バインドを挿入しますという文言とともに[ ]があると思います。\n初期段階では何も記載されていないと思いますが、この中に以下を記述します（[ ]は一応表示しています）。\n[\n  {\n    \"key\": \"ctrl+alt+i\",\n    \"command\": \"editor.action.insertSnippet\",\n    \"when\": \"editorTextFocus && editorLangId == 'quarto'\",\n    \"args\": {\n      \"snippet\": \"```{r}\\n$0\\n```\\n\"\n    }\n  }\n]\nこれでデフォルトの設定が上書きされ、Ctrl-Alt-ICtrl-Alt-Iでチャンクを挿入すると、カーソルを置いている行に直接チャンクが挿入されるようになります。\nちなみに、この設定だとRのチャンクが強制的に挿入されるので、Pythonも使う方は困る！と思うかもしれません。\nそのような方には、同じ書き方でCtrl-Shift-ICtrl-Shift-Iを使ってPythonのチャンクを挿入するようにするのがおすすめです。そもそもPositronではデフォルトのチャンク挿入がCtrl-Shift-ICtrl-Shift-I（AltAltではなく）であるため、もしRとPythonしか使わないのであれば、これをPython専用のショートカットにしてしまうのがよいのではないでしょうか。\n上の設定に書き足す形で、カンマで区切った後ろに以下のように記述します。\n[\n  {\n    \"key\": \"ctrl+alt+i\",\n    \"command\": \"editor.action.insertSnippet\",\n    \"when\": \"editorTextFocus && editorLangId == 'quarto'\",\n    \"args\": {\n      \"snippet\": \"```{r}\\n$0\\n```\\n\"\n    }\n  },\n\n  // ここから追記\n  {\n    \"key\": \"ctrl+shift+i\",\n    \"command\": \"editor.action.insertSnippet\",\n    \"when\": \"editorTextFocus && editorLangId == 'quarto'\",\n    \"args\": {\n      \"snippet\": \"```{python}\\n$0\\n```\\n\"\n    }\n  }\n]\nこれでCtrl-Shift-ICtrl-Shift-IをPython専用のショートカットに変更できました。やっていることはキーとスニペットを変えているだけで、他は一緒です。"
  },
  {
    "objectID": "pages/tips/2025/09/250901_positron_setting/index.html#レイアウトの設定",
    "href": "pages/tips/2025/09/250901_positron_setting/index.html#レイアウトの設定",
    "title": "Positronのおすすめ設定！【R | Python】",
    "section": "レイアウトの設定",
    "text": "レイアウトの設定\nこれは個人の好みが大きく、僕がマイナーであることもわかっているので共感いただけないかもしれませんが、僕はコードとコンソールは縦に並べたいタイプの人間です。\n特にPositronではRStudioと違って、R MarkdownやQuartoを使っている際にチャンクの下に結果が表示されませんので、コンソールを見えるようにしておくことが重要です。縦に並べてしまうと表示できるスペースが狭く、見にくいため左右並べる設定にします。\nまた、左右に並べる以外の設定も選択肢がありますので、いろいろ試してみて気に入ったものにしてみてください。\nまず、左下の歯車から「コマンドパレット」、あるいはCtrl-Shift-PCtrl-Shift-Pを入力します。\n表示された画面上部の検索窓に「customize layout」と入力します。すると1件ドンピシャでヒットすると思いますので、それをクリックします。\n\n\n\n\n\nいろいろな選択肢が出てきますが、デフォルトでは1番上の「Stacked Layout」です。\n僕はコンソールを右に持っていきたいという考えから、2番目の「Side-By-Side Layout」を選択しています。同じ手順で元に戻せますので、いろいろ選択してみてください。\nちなみにSide-By-Sideを選択しただけだと、VARIABLESは右側に配置されています。これを僕はスクリプト画面の下に持ってきているのですが、その方法はドラッグするという原始的な方法です。\n\n\n\n\n\n（2025/09/25追記）Variablesを左下に移す設定をしていましたが、右側をフルでコンソールにする必要性はないかなと思うようになってきたので右側の上半分をコンソールにし、下半分にVariablesを置くことが増えてきました。プロットをあまりしなくなったことが影響しているかもしれません…。プロットをたくさんする方は前述の設定あるいはデフォルト設定の方がスペースを有効活用できるかもしれません。"
  },
  {
    "objectID": "pages/tips/2025/09/250901_positron_setting/index.html#project-manager",
    "href": "pages/tips/2025/09/250901_positron_setting/index.html#project-manager",
    "title": "Positronのおすすめ設定！【R | Python】",
    "section": "Project Manager",
    "text": "Project Manager\n皆さんはR Projectを使用しているでしょうか。再現可能な研究のための1つのツールにR Projectがあります。ここではそれそのものについて詳しくは書きませんが4、PositronにはR Projectと同様のシステムがありません。\nそこでPositron（VSCodeもですが）では、拡張機能を使用してプロジェクト管理を行います。\nざっくりR Projectは.Rprojファイルを作成し、そのファイルが認識されることでそこをワーキングディレクトリとして設定し、here::here()をはじめとした相対パスを使用できるようになり、効率的なプロジェクト管理が可能になります。\n前述のようにPositronでは.Rprojファイルは作成できず、代わりにワークスペースを設定することでプロジェクト管理を行います。\nこのワークスペースとは一体何かと言えば「Positron内でワーキングディレクトリとなるフォルダを開く」ことに他ならないのですが、つまるところ.RprojをダブルクリックしてそのフォルダをRStudioで開くのと同様に、そのフォルダをIDE上で「開く」ことが重要なのです。\nではどうやってそのフォルダを開けばよいのか。それを解決してくれるのが「Project Manager」という拡張機能です。\nPositronの左にあるサイドバーから拡張機能のアイコンを開き、検索窓から「alefragnani.project-manager」と検索してください5。\n\n\n\nこれです\n\n\nこれをインストールすると、サイドバーにアイコンが表示されることと思います。\n画面左上の「ファイル」から「フォルダを開く」へと進み、何かプロジェクトを開いてみてください（なければ適当にフォルダを作ってみてください）。\n開けたら、Project Managerのアイコンをクリックし、拡張機能の画面を開きます。すると上部に下のような表示があると思います。\n\n\n\n\n\nそしてアイコンの一番左にあるフロッピーディスク💾をクリックすると、今開いているフォルダがワークスペースとして保存され、下に表示されると思います。つまりエクスプローラーにおけるクイックアクセスへのピン留めと同じ要領で、次回以降表示されるプロジェクトを選択すればそのフォルダを開けるようになるというわけです。\n.Rprojのようなファイルこそないものの、ワークスペースを開いていればhere::here()をはじめとしたプロジェクト管理のためのツールは同様に使用可能です。\nぜひプロジェクトはここから保存してみてください。\n\n\n\n\n\n\nThe Rproj File - Positron"
  },
  {
    "objectID": "pages/tips/2025/09/250901_positron_setting/index.html#テーマの変更",
    "href": "pages/tips/2025/09/250901_positron_setting/index.html#テーマの変更",
    "title": "Positronのおすすめ設定！【R | Python】",
    "section": "テーマの変更",
    "text": "テーマの変更\n\nデフォルトのテーマ設定\nPositronではテーマも変更可能です。VSCodeと基本的な設定は同じですが、このセクションの終わりに拡張機能を利用したテーマの変更方法も書いておきます。\nまず、左下の歯車マークから「設定」を開きます。\n上部の検索窓に「color theme」と入力します。すると「Workbench: Color Theme」という項目がヒットすると思います。ここがデフォルトでは「Positron Light」になっていると思います。ここをクリックすると、テーマの一覧が表示されます。\n\nダーク系のテーマが好きな方は「Positron Dark」を選択してください。これでダークモードになります。\n他にもいろいろなテーマがあるので、気に入ったものを選んでみてください。\n\n\nテーマの自動切換え\n僕はMicrosoft Storeで入手可能な「Auto Dark Mode」というアプリを使用して、日の出と日没に合わせてWindowsのテーマを自動で切り替えています。昼間ならライトモード、夜ならナイトモードに自動で切り替わるというものです。\nPositronはデフォルトでWindowsのテーマに合わせて自動で切り替わるわけではないのですが、同じく設定から「auto detect color scheme」を検索し、「Window: Auto Detect Color Scheme」という項目にチェックを入れると、Windowsのテーマに合わせて自動で切り替わるようになります。\n別にAuto Dark Modeを使っていない場合でも、Windowsのテーマを手動で切り替えた際にPositronもそれに合わせて切り替えてくれるようになります。\nまた、この際にライトのテーマとダークのテーマをそれぞれ設定する必要があります。「Workbench: Preferred Light Color Theme」と「Workbench: Preferred Dark Color Theme」という項目があるので、それぞれ好きなテーマを選んでください。ここで選んだものがWindowsのテーマに合わせて切り替わるようになります（Macでも同様かと思います）。\n\n\n拡張機能によるテーマの追加\nダークモードに関して、最近1つ新しいテーマを見つけたので、ご紹介します。\n\n\n\n\n\n\nPorting my favorite RStudio color theme to Positron\n\n\n\nこちらはRStudioの「Tomorrow Night Bright」というテーマをPositronに移植するために拡張機能を作成した、という記事です。この拡張機能を用いればRStudioのTomorrow Night BrightのテーマをPositronで使用可能になります。\n拡張機能のインストール方法は前述のProject Managerと同様です。拡張機能のアイコンをクリックし、検索窓に「tomorrow night bright」と入力します。するとRユーザーにはおなじみ、六角形のロゴがアイコンの「Tomomorrow Night Bright (R Classic)」という拡張機能が出てくると思いますので、インストールしてください。\nインストールできたら、先述の「Workbench: Color Theme」から「Tomorrow Night Bright (R Classic)」を選択してください。これでテーマが適用されます6。\n\n\n\nTommorw Night Bright"
  },
  {
    "objectID": "pages/tips/2025/09/250901_positron_setting/index.html#タブのピン留め",
    "href": "pages/tips/2025/09/250901_positron_setting/index.html#タブのピン留め",
    "title": "Positronのおすすめ設定！【R | Python】",
    "section": "タブのピン留め",
    "text": "タブのピン留め\nOne of my favorite recent Positron discoveries is that you can not only (1) pin tabs, but (2) put the pinned tabs on their own dedicated row (after enabling that setting), which is glorious for workspace tab management #rstats[image or embed]— Andrew Heiss (@andrew.heiss.phd) 2025年10月16日 7:42\n上記のポストにあるように、Positronではタブをピン留めし、それを2行にして固定することができます。\nピン留め自体は簡単にできます。タブを右クリックして「ピン留めする」をクリックするだけです。あるいはピン留めしたいタブを開いたうえでCtrl-K+Shift-EnterCtrl-K+Shift-Enterでもピン留めできます。\n\n\n\n\n\n設定方法はポストの画像にある通りですが、設定（Ctrl-,Ctrl-,）から「workbench.editor.pinnedTabsOnSeparateRow」と検索し、ヒットした項目にチェックを入れます。\n設定画面はポストにある通りですが、この設定により、ピン留めしたタブが上段に固定されるようになります。スクリプトとデータビューアを別の段に置けるようになったりして、結構便利だと思います。使いやすいように配置してみてください。"
  },
  {
    "objectID": "pages/tips/2025/09/250901_positron_setting/index.html#rのフォーマッタ",
    "href": "pages/tips/2025/09/250901_positron_setting/index.html#rのフォーマッタ",
    "title": "Positronのおすすめ設定！【R | Python】",
    "section": "Rのフォーマッタ",
    "text": "Rのフォーマッタ\nRのコードフォーマッタとして「Air」という拡張機能があり、Positronにはデフォルトでインストールされています。コードを整形してくれるツールですが、こちらについては単独の記事にしましたので、そちらをご覧ください。\n\n\n\n\n\n\n【Positron】拡張機能「Air」を使う【フォーマッタ】"
  },
  {
    "objectID": "pages/tips/2025/09/250901_positron_setting/index.html#おわりに",
    "href": "pages/tips/2025/09/250901_positron_setting/index.html#おわりに",
    "title": "Positronのおすすめ設定！【R | Python】",
    "section": "おわりに",
    "text": "おわりに\n以上、Positronの設定について書いてきました。\nPositronは今後も発展を続けていくはずですし、さらに便利になることは間違いないと思います。\n個人的にはもうRStudioには戻れない、というところまでいってほしいと思っています（笑）\n今後もアップデートがあれば更新しますので、よろしくお願いいたします。"
  },
  {
    "objectID": "pages/tips/2025/09/250901_positron_setting/index.html#footnotes",
    "href": "pages/tips/2025/09/250901_positron_setting/index.html#footnotes",
    "title": "Positronのおすすめ設定！【R | Python】",
    "section": "注",
    "text": "注\n\n\n新しいものが好きな割に敬遠していたのかというご指摘はごもっともですが、ご容赦ください。↩︎\nとはいえ今でも使いやすいのはRStudioだと思っています。今後より便利になるという期待も込めて、Positronを使っている面が大きいです。↩︎\nここではR Markdownについては書いていませんが、Positronへの移行を考えている前衛的な皆様であれば、R MarkdownからQuartoへ乗り換えるべきです。ということにして、R Markdownの設定は僕もしていないので、説明から逃げています。↩︎\nR Projectについてはこちらをご覧ください。↩︎\nおそらく「project manager」でも一番上に出ます。↩︎\nテーマの自動切換えで使用するには、Preferred Dark Color Themeに設定してください。↩︎"
  },
  {
    "objectID": "pages/tips/2025/08/250816_scraping_python/index.html#はじめに",
    "href": "pages/tips/2025/08/250816_scraping_python/index.html#はじめに",
    "title": "【Python】高速スクレイピングを実装する【並列化】",
    "section": "はじめに",
    "text": "はじめに\nPythonでスクレイピングを実行したくて、ChatGPTに頼んでコードを書いてもらったということを以下の記事に書きました。\n\n\n\n\n\n\nPythonでスクレイピングをやってみる\n\n\n\nまた、これまでRでスクレイピングを実行する方法についていくつか記事を書いてきましたが、1つずつファイルをダウンロード、ZIPファイルを解凍、みたいな流れで実行していたところ、今回は複数のファイルを並列してダウンロードできる方法を学ぶことができました。\nそのコード、手順についてまとめていきたいと思います。"
  },
  {
    "objectID": "pages/tips/2025/08/250816_scraping_python/index.html#環境",
    "href": "pages/tips/2025/08/250816_scraping_python/index.html#環境",
    "title": "【Python】高速スクレイピングを実装する【並列化】",
    "section": "環境",
    "text": "環境\n\nWindows 11\nPython 3.12.3"
  },
  {
    "objectID": "pages/tips/2025/08/250816_scraping_python/index.html#ダウンロードするページ",
    "href": "pages/tips/2025/08/250816_scraping_python/index.html#ダウンロードするページ",
    "title": "【Python】高速スクレイピングを実装する【並列化】",
    "section": "ダウンロードするページ",
    "text": "ダウンロードするページ\nRのコードを紹介したページと同じで、国勢調査をもとに公開しているメッシュごとの人口データをダウンロードします。URLは以下です。\nhttps://www.e-stat.go.jp/gis/statmap-search?page=1&type=1&toukeiCode=00200521&toukeiYear=2020&aggregateUnit=H&serveyId=H002005112020&statsId=T001141&datum=2011"
  },
  {
    "objectID": "pages/tips/2025/08/250816_scraping_python/index.html#コード",
    "href": "pages/tips/2025/08/250816_scraping_python/index.html#コード",
    "title": "【Python】高速スクレイピングを実装する【並列化】",
    "section": "コード",
    "text": "コード\n# ====== Standard library ======\nimport re\nimport shutil\nimport threading\nimport zipfile\nfrom pathlib import Path\nfrom typing import Optional, Tuple\nfrom urllib.parse import urljoin\n\n# ====== Third-party ======\nimport requests\nfrom bs4 import BeautifulSoup\nfrom requests.adapters import HTTPAdapter\nfrom tqdm import tqdm\nfrom urllib3.util.retry import Retry\nfrom concurrent.futures import ThreadPoolExecutor, as_completed\n\nfrom selenium import webdriver\nfrom selenium.webdriver.chrome.options import Options\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.support import expected_conditions as EC\nfrom selenium.webdriver.support.ui import WebDriverWait\n\n\n# ==============================\n# Settings\n# ==============================\n\n# 保存先ディレクトリのパス（存在しない場合は作成）\nOUTPUT_DIR = Path(r\"data\\250813_scraping_python\")\nOUTPUT_DIR.mkdir(parents=True, exist_ok=True)\n\n# ベースURL（相対パスを補完するために使用）\nBASE_URL = \"https://www.e-stat.go.jp\"\n\n# 並列処理設定\nMAX_WORKERS = 6          # 同時DL数（回線速度・先方負荷に応じて調整）\nREQUEST_TIMEOUT = 60     # タイムアウト時間（秒）\n\n# HTTPリクエスト時のUser-Agent（アクセス元をブラウザっぽく偽装）\nUSER_AGENT = (\n    \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) \"\n    \"AppleWebKit/537.36 (KHTML, like Gecko) \"\n    \"Chrome/126 Safari/537.36\"\n)\n\n# ==============================\n# Selenium setup\n# ==============================\n\ndef create_chrome_driver() -&gt; webdriver.Chrome:\n    \"\"\"Headless Chromeのドライバーを作成\"\"\"\n    options = Options()\n    \n    # ヘッドレスモード（ブラウザ画面を表示せずにバックグラウンドで動作）\n    options.add_argument(\"--headless=new\")\n    # GPU無効化（描画関連の不要な処理を省く）\n    options.add_argument(\"--disable-gpu\")\n    # ウィンドウサイズ指定（幅×高さ）\n    options.add_argument(\"--window-size=1280,1800\")\n    # 自動化検知を回避（アクセスブロック対策）\n    options.add_argument(\"--disable-blink-features=AutomationControlled\")\n    # User-Agentを上書き（アクセス元をブラウザっぽく偽装）\n    options.add_argument(f\"user-agent={USER_AGENT}\")\n\n    # Chromeドライバーを生成\n    driver = webdriver.Chrome(options=options)\n    # ページ読み込みのタイムアウト（秒）\n    driver.set_page_load_timeout(60)\n    # JavaScript実行のタイムアウト（秒）\n    driver.set_script_timeout(60)\n\n    return driver\n\n# ==============================\n# Dynamic page loader\n# ==============================\n\ndef fetch_rendered_html(\n    url: str,\n    driver: webdriver.Chrome,\n    wait_for_css: Optional[str] = None,\n    timeout: int = 20,\n) -&gt; str:\n    \"\"\"\n    JavaScript実行後のHTMLを取得する関数\n    必要に応じて、特定のCSSセレクタがDOMに出現するまで待機\n    \"\"\"\n    # 指定したURLにアクセス\n    driver.get(url)\n\n    # ページの読み込み完了まで待機\n    WebDriverWait(driver, timeout).until(\n        lambda d: d.execute_script(\"return document.readyState\") == \"complete\"\n    )\n\n    # もしCSSセレクタが指定されていれば、その要素が表示されるまで待機\n    # （JSによる非同期描画の完了を保証するため）\n    if wait_for_css:\n        WebDriverWait(driver, timeout).until(\n            EC.presence_of_all_elements_located((By.CSS_SELECTOR, wait_for_css))\n        )\n\n    # 最終的なページのHTMLソースを返す\n    return driver.page_source\n\n# ==============================\n# Link extraction\n# ==============================\n\ndef find_csv_links(html: str, pattern: str = r\"data\\?statsId=T001141\") -&gt; list[str]:\n    \"\"\"\n    HTMLから指定パターンに合致するリンク（href属性）を抽出する関数。\n\n    Parameters\n    ----------\n    html : str\n        取得済みのHTML文字列\n    pattern : str\n        hrefがこのパターンにマッチするリンクだけを抽出\n        デフォルトは 'data?statsId=T001141' を含むリンク。\n\n    Returns\n    -------\n    list[str]\n        マッチしたhrefのリスト。\n    \"\"\"\n    # HTML文字列をBeautifulSoupでパース\n    soup = BeautifulSoup(html, \"html.parser\")\n\n    # &lt;a&gt;タグの中でhref属性を持つものをすべて取得し、\n    # さらにhrefが正規表現patternに一致するものだけを抽出\n    return [\n        a[\"href\"]\n        for a in soup.find_all(\"a\", href=True)\n        if re.search(pattern, a[\"href\"])\n    ]\n\n# ==============================\n# Thread-local requests.Session\n# ==============================\n\n# スレッドごとに独立したデータを持てる入れ物を作成\n_thread_local = threading.local()\n\ndef get_session() -&gt; requests.Session:\n    \"\"\"\n    スレッドローカルに保持されるHTTPセッションを取得する関数。\n    接続プーリング、リトライ設定、統一User-Agentを適用。\n    \n    - スレッドローカル: 各スレッドで独立したセッションを保持するための仕組み。\n    - 接続プーリング: 同じホストへの接続を再利用して効率化。\n    - リトライ設定: 一時的なエラー（429, 500, 502, 503, 504）に対して最大3回まで再試行。\n    - User-Agent統一: リクエストの送信元情報を統一してサーバー側の認識を安定化。\n    \"\"\"\n    if getattr(_thread_local, \"session\", None) is None:\n        # 新規セッション作成\n        s = requests.Session()\n        s.headers.update({\"User-Agent\": USER_AGENT})\n\n        # リトライ戦略の設定\n        retries = Retry(\n            total=3,                   # 最大リトライ回数\n            backoff_factor=0.8,        # リトライ間隔の指数的増加係数\n            status_forcelist=(429, 500, 502, 503, 504),  # 再試行対象のHTTPステータスコード\n            allowed_methods=(\"GET\",),  # リトライ対象HTTPメソッド\n        )\n\n        # 接続アダプタの設定（プーリングとリトライ）\n        adapter = HTTPAdapter(\n            pool_connections=MAX_WORKERS,  # 同時接続プール数\n            pool_maxsize=MAX_WORKERS,      # プールの最大接続数\n            max_retries=retries,           # 上記リトライ戦略を適用\n        )\n        s.mount(\"http://\", adapter)\n        s.mount(\"https://\", adapter)\n\n        # スレッドローカルに保存\n        _thread_local.session = s\n\n    return _thread_local.session\n\n# ==============================\n# ZIP download & extract (worker)\n# ==============================\n\ndef fetch_zip_and_extract_txt(task: Tuple[str, str]) -&gt; tuple[str, bool, str]:\n    \"\"\"\n    指定URLからZIPをダウンロードし、中の最初の'.txt'ファイルを\n    'pop_mesh{code}.txt' という名前で保存する関数。\n\n    戻り値:\n        (url, success, message)\n        url     : ダウンロード元のURL\n        success : 成功した場合はTrue、失敗はFalse\n        message : 実行結果の簡易説明\n    \"\"\"\n    full_url, code = task\n    # 一時保存用のZIPファイルパス\n    zip_path = OUTPUT_DIR / f\"pop_mesh{code}.zip\"\n    # 最終的に保存するテキストファイルパス\n    txt_path = OUTPUT_DIR / f\"pop_mesh{code}.txt\"\n\n    # すでにtxtが存在する場合はスキップ\n    if txt_path.exists():\n        return full_url, True, \"skipped (exists)\"\n\n    try:\n        # セッションを取得（接続の再利用などを行う）\n        session = get_session()\n\n        # ZIPをダウンロード（ストリーミングで少しずつ書き込み）\n        with session.get(full_url, stream=True, timeout=REQUEST_TIMEOUT) as resp:\n            resp.raise_for_status()\n            with open(zip_path, \"wb\") as f:\n                for chunk in resp.iter_content(chunk_size=8192):\n                    if chunk:\n                        f.write(chunk)\n\n        # ZIPファイルでなければ削除して終了\n        if not zipfile.is_zipfile(zip_path):\n            zip_path.unlink(missing_ok=True)\n            return full_url, False, \"not a zip file\"\n\n        found_txt = False\n        with zipfile.ZipFile(zip_path, \"r\") as zf:\n            for info in zf.infolist():\n                if info.is_dir():  # ディレクトリはスキップ\n                    continue\n                if info.filename.lower().endswith(\".txt\"):\n                    # 直接上書きせず一時ファイルに保存 → 後でリネーム（競合回避）\n                    tmp_path = txt_path.with_suffix(\".txt.part\")\n                    with zf.open(info) as src, open(tmp_path, \"wb\") as dst:\n                        shutil.copyfileobj(src, dst)\n                    tmp_path.replace(txt_path)\n                    found_txt = True\n                    break\n\n        # ZIPは不要になったので削除\n        zip_path.unlink(missing_ok=True)\n\n        # TXTが見つからなかった場合\n        if not found_txt:\n            return full_url, False, \"no .txt in zip\"\n        return full_url, True, \"ok\"\n\n    except Exception as e:\n        # エラー時はZIPを削除\n        try:\n            zip_path.unlink(missing_ok=True)\n        except Exception:\n            pass\n        return full_url, False, f\"error: {e}\"\n\n# ==============================\n# Main\n# ==============================\ndef main() -&gt; None:\n    \"\"\"一覧ページを巡回→リンク収集→並列ダウンロード。\"\"\"\n    driver = create_chrome_driver()  # Chromeドライバー生成\n    try:\n        tasks: list[tuple[str, str]] = []  # ダウンロード対象の (URL, code) タプルを格納\n\n        # ページ番号 1〜8 を巡回してリンクを収集\n        for i in tqdm(range(1, 9), desc=\"ページ巡回\"):\n            # ページごとのURL生成\n            url = (\n                f\"https://www.e-stat.go.jp/gis/statmap-search?page={i}\"\n                \"&type=1&toukeiCode=00200521&toukeiYear=2020&aggregateUnit=H\"\n                \"&serveyId=H002005112020&statsId=T001141&datum=2011\"\n            )\n            # JavaScriptレンダリング後のHTMLを取得\n            html = fetch_rendered_html(\n                url,\n                driver,\n                wait_for_css=\"a[href*='data?statsId=T001141']\",  # このCSSが出現するまで待機\n                timeout=25,\n            )\n            # CSVリンク抽出\n            csv_links = find_csv_links(html)\n            # 相対パスを絶対URLへ変換\n            full_urls = [urljoin(BASE_URL, link) for link in csv_links]\n\n            # URLとcodeをセットで保存\n            for full_url, csv_link in zip(full_urls, csv_links):\n                m = re.search(r\"code=([0-9]+)\", csv_link)\n                code = m.group(1) if m else \"unknown\"\n                tasks.append((full_url, code))\n\n        # 成功・失敗・スキップ件数カウンタ\n        successes = 0\n        failures = 0\n        skipped = 0\n\n        # 並列ダウンロード処理\n        with ThreadPoolExecutor(max_workers=MAX_WORKERS) as ex:\n            futures = [ex.submit(fetch_zip_and_extract_txt, t) for t in tasks]\n            for fut in tqdm(as_completed(futures), total=len(futures), desc=\"ダウンロード\"):\n                url, ok, msg = fut.result()\n                if ok and msg.startswith(\"ok\"):\n                    successes += 1\n                elif ok and \"skipped\" in msg:\n                    skipped += 1\n                else:\n                    failures += 1\n\n        # 処理結果を表示\n        print(f\"\\nDone. ok={successes}, skipped={skipped}, failed={failures}\")\n\n    finally:\n        driver.quit()  # ブラウザを閉じる\n\n\nif __name__ == \"__main__\":\n    main()"
  },
  {
    "objectID": "pages/tips/2025/08/250816_scraping_python/index.html#ざっくり解説",
    "href": "pages/tips/2025/08/250816_scraping_python/index.html#ざっくり解説",
    "title": "【Python】高速スクレイピングを実装する【並列化】",
    "section": "ざっくり解説",
    "text": "ざっくり解説\nSetting, Selenium setupなど、いくつかのブロックに分かれているので、各ブロックでどのようなことをしているのか、ざっくり確認していきます。\n\nSettings\nスクレイピングに必要な設定をしています。URLは場合に合わせて変える必要があります。\nMAX_WORKERSの部分でいくつ並列でダウンロードするかを設定しているのが今回のミソだと思います。6つ平行することで高速化を図っています。\nUSER_AGENTでは、どのブラウザ、環境からアクセスしているのかを設定するもので、デフォルトだと自動化ツールからのアクセスと判断され、アクセスが拒否される可能性があるので、それを防ぐために設定をしています。\n\n\nSelenium setup\n細かい設定はコメントで書いている通りではあるのですが、ブラウザを自動操作できる環境を整えている部分です。\nブラウザをバックグラウンドで動かしたり、無駄な描画はなくしたりと、効率的な設定をここで指定しています。\n\n\nDynamic page loader\nここがRでいうところのread_html_live()に当たる部分です。\n指定されたURLにアクセスして、HTMLソースを返すといった作業をしています。\nコメントを読んでいただくと、JavaScriptにも対応しているのがお分かりになるかと思います。\n\n\nLink extraction\nこれはRでいうところのhtml_attrs()やhtml_elements()に該当するようなことをしています。\naタグを探してきて、その中に含まれるhrefを引っ張ってくるということをしています。hrefにはダウンロードのためのリンクが含まれています。\n\n\n\n\n\n\nNoteリンクの探し方について\n\n\n\naタグの探し方などについては、こちらで簡単に説明しています。\n\n\n\n\nThread-local requests.Session\nここでは、各スレッドごとに独立したHTTPセッションを用意しています。\nこれにより、並列ダウンロード時に接続が混線せず安全に動作し、さらにセッションの接続再利用（コネクションプール）によって通信が効率化されます。\nまたリトライ設定やUser-Agentの統一もここでまとめて適用しているので、安定性と速度の両立ができます。\n\n\nZIP download & extract (worker)\nここではZIPファイルのダウンロードと解凍の設定をしています。\n今回はダウンロードするものの中身はテキストファイルなので.txtとして解凍するように設定していますが、ここはダウンロードするものに合わせて変更する必要があります。\n変なものをダウンロードしてしまった場合の対処や、既にファイルが存在する場合の対処もしているので、ミスにもある程度対応できるようになっています。エラーメッセージも表示されるようにしているので、何のエラーが起きたのかはわかるようになっています。\n\n\nMain\nその名の通りメインのコードです。\n今回はページ数が1～8まであるとわかっていますので、range(1, 9)と書かれています。Rと違うので戸惑ったのですが、Pythonでは開始値は含み、終了値は含まないようです。なので1と9が記されています。\n流れとしては、ページを巡回してダウンロード先のURLを保存し、巡回し終わったら並列でそれらをダウンロードしていきます。ここが並列になっているので、ダウンロードの速度が向上しているというわけです。\nダウンロード後にはダウンロードに成功したもの、既に存在してスキップしたもの、失敗したものの件数を出力するようにしています。\n最後にはdriver.quit()でブラウザを終了させ、プロセスやメモリが残らないようになっています。\n\n\n最後のif文\n1番最後の行は「このファイルを直接実行したときだけmain()を動かす」という役割を持っています。\n\nPythonでは同じファイルをスクリプトとして実行することも、ライブラリとして他のプログラムから読み込むこともできますが、この仕組みによって「直接実行した場合だけスクレイピング処理を走らせ、importされた場合には余計な処理をしない」ようにしています。"
  },
  {
    "objectID": "pages/tips/2025/08/250816_scraping_python/index.html#おわりに",
    "href": "pages/tips/2025/08/250816_scraping_python/index.html#おわりに",
    "title": "【Python】高速スクレイピングを実装する【並列化】",
    "section": "おわりに",
    "text": "おわりに\n今回はChatGPTに手伝ってもらいながら、RでのスクレイピングコードをPythonに書き換え、簡単にまとめました。\n自分もPythonは勉強を始めたばかりではあるので認識の誤り等あるかもしれませんが、コメントからお寄せいただければ幸いです。\n個人的には業務の効率化を図るうえでPythonでのスクレイピングを活用していきたいと思っているので、引き続きアップデートなどあればまた記事にしていきたいと思います。"
  },
  {
    "objectID": "pages/tips/2025/07/250715_rstudio_server/index.html#はじめに",
    "href": "pages/tips/2025/07/250715_rstudio_server/index.html#はじめに",
    "title": "RStudio Serverをインストールする【リモートデスクトップも】",
    "section": "はじめに",
    "text": "はじめに\nRStudio Serverのインストール方法や使い方についてまとめます。\nRStudio Serverを使えば各OSの違いに左右されず、どの端末からでも同じ環境で作業を継続できるのが特徴です。複数人での分析や大規模データ処理にも適しており、環境構築の一元化と省力化が図れます。\n僕は最近仕事でRStudio Serverを使うかも…みたいな流れがあったので、改めてまとめてみることにしました。"
  },
  {
    "objectID": "pages/tips/2025/07/250715_rstudio_server/index.html#環境",
    "href": "pages/tips/2025/07/250715_rstudio_server/index.html#環境",
    "title": "RStudio Serverをインストールする【リモートデスクトップも】",
    "section": "環境",
    "text": "環境\n\nWindows 11\nPowerShell 7がインストール済み\n\nPowerShellはこちらからインストールできますが、よくわからない場合は標準インストールされている「ターミナル」でも大丈夫です。"
  },
  {
    "objectID": "pages/tips/2025/07/250715_rstudio_server/index.html#インストール",
    "href": "pages/tips/2025/07/250715_rstudio_server/index.html#インストール",
    "title": "RStudio Serverをインストールする【リモートデスクトップも】",
    "section": "インストール",
    "text": "インストール\n\nWSL\nまずはWSLからインストールします。WSLはWindows Subsystem for Linuxの略であり、Windows上でネイティブにLinux環境を動作させる機能で、開発やデータ分析をLinux向けツールで行える柔軟な作業環境を提供してくれます。\nまずはPowerShellを管理者権限で開きます。\n\n\n\n管理者権限で開きます\n\n\n次に以下のコマンドを入力し、実行します。\nwsl --install\nインストールが終わると、Linuxディストリビューションのユーザー名とパスワードの作成を求められます1。\nユーザー名は何でも大丈夫です。パスワードもめちゃくちゃ簡単で問題ありません。パスワードは画面上には表示されませんが、ちゃんと入力されています。慌てて何回も入力しないようにしてください。\nまた、ユーザー名とパスワードは後ほど使うので忘れないようにしてください。\n\n\nRとRStudio Server\n設定まで終わったら、アプリの一覧からUbuntu（これがLinuxのディストリビューションです）を開いてください。\n\n\n\n\n\n\nNoteUbuntuのバージョンについて\n\n\n\n本ページではUbuntu 22を前提に進めています。もしインストールしたバージョンが他のバージョンであった場合は若干コードが変わる可能性がありますので、このページでバージョンを該当するものに変更したうえで都度コードをコピーし、実行してみてください。\nバージョンを確認するためには以下をUbuntu上で実行してください。\nlsb_release -a\n\n\nするとコンソール画面が出てきますので、以下のコードを順々に入力、実行していきます。\nsudo apt update\nsudo apt upgrade -y\n続いてRをインストールします。こちらのページからの転用です。\n# update indices\nsudo apt update -qq\n# install two helper packages we need\nsudo apt install --no-install-recommends software-properties-common dirmngr\n# add the signing key (by Michael Rutter) for these repos\n# To verify key, run gpg --show-keys /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc \n# Fingerprint: E298A3A825C0D65DFD57CBB651716619E084DAB9\nwget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | sudo tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc\n# add the repo from CRAN -- lsb_release adjusts to 'noble' or 'jammy' or ... as needed\nsudo add-apt-repository \"deb https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/\"\n# install R itself\nsudo apt install --no-install-recommends r-base\n次にRStudio Serverをインストールします。Posit社のガイドからの転用です。\nsudo apt-get install gdebi-core\nwget https://download2.rstudio.org/server/focal/amd64/rstudio-server-2025.05.1-513-amd64.deb\nsudo gdebi rstudio-server-2025.05.1-513-amd64.deb\nこれでインストールは完了です。続いて次のコマンドを実行し、RStudio Serverを立ち上げます。\nsudo rstudio-server start"
  },
  {
    "objectID": "pages/tips/2025/07/250715_rstudio_server/index.html#rstudio-serverを立ち上げる",
    "href": "pages/tips/2025/07/250715_rstudio_server/index.html#rstudio-serverを立ち上げる",
    "title": "RStudio Serverをインストールする【リモートデスクトップも】",
    "section": "RStudio Serverを立ち上げる",
    "text": "RStudio Serverを立ち上げる\nそれではRStudio Serverを立ち上げていきましょう。上のコマンドで起動までできているので、ブラウザ上で立ち上げていきます。\nPC上の任意のブラウザを開き、アドレスバーにlocalhost:8787と入力し、開きます。\nすると以下のような画面が出てきます。\n\n\n\n\n\nユーザー名とパスワードを求められますので、先ほどUbuntuで設定したものを入力してください。\nそうしてサインインすることで、RStudioの画面に入ることができます。\n\n\n\n\n\nここからは通常のRと同様に作業を進めることができます。"
  },
  {
    "objectID": "pages/tips/2025/07/250715_rstudio_server/index.html#ファイルの扱いについて",
    "href": "pages/tips/2025/07/250715_rstudio_server/index.html#ファイルの扱いについて",
    "title": "RStudio Serverをインストールする【リモートデスクトップも】",
    "section": "ファイルの扱いについて",
    "text": "ファイルの扱いについて\nどのようにしてデータを入れたりファイルを追加したりすればよいかについて説明します。\nRStudio上でできることはデスクトップ版とほとんど同じで、さらにエクスプローラー上の動作も通常と同じようにすることができます。\nエクスプローラーを開いて左のサイドバーを一番下までスクロールすると、Linuxが作成されていることがわかります。\n\n\n\nサイドバーの一番下です\n\n\nするとUbuntuが中に作成されていますので、ダブルクリックで入っていきます。home/[設定したユーザー名]があると思うので、その中に入ると、そこがWindowsでいうところのC:\\Users\\ユーザー\\に該当します。ベースとなるディレクトリです。\nこの中にプロジェクトのフォルダを作成していけば、RStudio Server上でも見ることができますし、入れたファイルを操作することが可能になります。\nまあまあ面倒なところにあるので、クイックアクセスにピン留めしたりデスクトップにショートカットを作ったりして置くのが便利だと思います。\nここまでの操作で個人の作業はできるようになりました！続いては、ホストとなるPCで環境を作成し、それを別のデバイスからアクセスできるようにする方法についてまとめていきます！"
  },
  {
    "objectID": "pages/tips/2025/07/250715_rstudio_server/index.html#リモートデスクトップを活用する",
    "href": "pages/tips/2025/07/250715_rstudio_server/index.html#リモートデスクトップを活用する",
    "title": "RStudio Serverをインストールする【リモートデスクトップも】",
    "section": "リモートデスクトップを活用する",
    "text": "リモートデスクトップを活用する\n例えば扱うデータが大きすぎて個々のノートパソコンでは扱いきれず、1台高スペックのデスクトップを用意してそこにアクセスして作業をしたい、というようなケースを考えます。\nここで個々のPCからデスクトップにアクセスして作業をするのですが、この作業はあくまでもデスクトップ上で行われるので、各PCがハイスペックである必要はありません。デスクトップの画面を自分のPCに投影しているようなイメージです。\n\n環境\n\n無線LAN（Wi-Fi）を使用\nホストと各PCは同じネットワーク（Wi-Fi）を使用\n\n\n\nデスクトップの環境構築\nまずすべきことは、上で書いたような環境構築を、デスクトップPC（ホスト）で実行することです。RStudio Serverを使えるようにしておいてください。\n\nIPアドレスを確認\n【ホストのPC】\n他のPC（クライアント）からアクセスできるようにするには、まずホストのIPアドレスを確認しておく必要があります。PowerShellを開いたら、以下のコマンドを実行します。\nipconfig\n実行すると、なにやら長々と表示されるはずです。「Windows IP 構成」の下に例えば「イーサネット アダプター vEthernet (Default Switch):」や、「イーサネット アダプター vEthernet (WSL (Hyper-V firewall)):」などいろいろ出てきます。\nその中の下の方に「Wireless LAN adapter Wi-Fi:」があります。この中に「IPv4 アドレス」があり、その右に数字が書かれています（例：192.xxx.x.xx）。これを後ほど使うので、押さえておいてください。\nまた、もう一度PowerShellは使うので、画面も開いておいてください。\n【ホストPCのWSL】\n次にWindowsのアプリ一覧からUbuntu  を開きます。\n開けたら次のコマンドを実行してください。\nip addr\nこれも同様に2種類出てくると思いますが、下にあるeth0が必要な方です。「inet 172.xxx.xx.xx」のような形で表示されていると思いますので、これを押さえておきます。スラッシュの前までで大丈夫です。\n\n\nポートの設定\n今押さえたWSLの方のIPアドレスを使用します（後で確認した方です）。\nPowerShellに戻って次のコマンドを実行します。\nnetsh interface portproxy add v4tov4 listenport=8787 listenaddress=0.0.0.0 connectport=8787 connectaddress=[WSLのIPアドレス]\n最後の部分を四角括弧ごとWSLのIPアドレスに置き換えて下さい。\n\n\nホストPCでファイアウォールの設定\n次に引き続きホストのPC上で、ファイアウォールの設定を行います。\n設定を開き、検索窓から「ファイアウォール」と検索し、「Windows Defender ファイアウォール」をクリックして開きます。\n\n\n\n下から2番目のです\n\n\n開いたウィンドウの左側に「詳細設定」という項目があるのでクリックして進みます。\n「受信の規則」→右側から「新しい規則」→「ポート」を選択して次へ進み、TCP、特定のローカルポートに「8787」を入力して次へ進み、「接続を許可する」でさらに次へ進み、すべてのチェックボックスにチェックが入った状態で次へ進みます。\n名前を付ける必要がありますが、何でもよいと思います。RStudio Serverを使っていることがわかる名前が良いと思います。入力したら完了で終わりです。\n\n\n\n\n\n\nTipコマンドで一発\n\n\n\n以下のコマンドをPowerShellで入力すれば同じことができます。こっちの方が楽かもですね。\nNew-NetFirewallRule -DisplayName \"RStudio Server\" -Direction Inbound -LocalPort 8787 -Protocol TCP -Action Allow\n\n\n\n\nWSL側でRStudio Serverの動作を確認\nUbuntuを再度開き、以下のコマンドを実行してRStudio Serverが起動しているかどうかを再確認します。\nsudo rstudio-server status\nsudoで始まるコマンドはパスワードを求められますので適宜入力して進んでください。\nここでactive (running)が記載されていればOKです。もしinactive (dead)となっていたら、以下のコマンドから起動してください。\nsudo rstudio-server start\n\n\nブラウザでアクセスを確認する\nそれではホスト上で動作確認をしてみましょう。\nブラウザを立ち上げlocalhost:8787を入力し開きます。先ほどと同様のサインイン画面が出てくれば問題ありません。\n\n\n別端末（クライアント）からのアクセス確認\nクライアントからは先ほど確認したローカルのIPアドレスをlocalhostの代わりに使用します。例えば192.xxx.x.xx:8787といった具合です。\nこれが開けてサインイン画面に移行できれば成功です。自分のPCのスペックに依存せず、ホストのPCにアクセスしてRStudioから作業を行うことができます。\n繰り返しになりますが、実行しているのはホストのデスクトップです。ブラウザであれば何でもよいので、同じネットワークに接続しているのであればスマホのブラウザからアクセスすることもできます。"
  },
  {
    "objectID": "pages/tips/2025/07/250715_rstudio_server/index.html#終わり",
    "href": "pages/tips/2025/07/250715_rstudio_server/index.html#終わり",
    "title": "RStudio Serverをインストールする【リモートデスクトップも】",
    "section": "終わり！",
    "text": "終わり！\n特にリモートデスクトップの説明で長くなってしまいましたが、これでRStudio Serverを使えるようになるはずです。\n用途に合わせて、いろいろ試してみてください！"
  },
  {
    "objectID": "pages/tips/2025/07/250715_rstudio_server/index.html#footnotes",
    "href": "pages/tips/2025/07/250715_rstudio_server/index.html#footnotes",
    "title": "RStudio Serverをインストールする【リモートデスクトップも】",
    "section": "注",
    "text": "注\n\n\n求められない場合は、続けてwslとだけ入力して実行してください。↩︎"
  },
  {
    "objectID": "pages/tips/2025/06/250601_dvc/index.html#はじめに",
    "href": "pages/tips/2025/06/250601_dvc/index.html#はじめに",
    "title": "【データ管理】DVCの設定まとめ",
    "section": "はじめに",
    "text": "はじめに\n環境構築の記事でDVCを使用したデータ管理についてもまとめていますが、Google Cloud Projectを使用するため若干ややこしいことに加え、定期的にトークンが切れて認証し直さないといけないという大きいデメリットがありました。\n今回は初回の設定のみで設定がすむ方法について解説します。\n記事と同様の流れでの作業を想定しているので、その点ご留意ください。"
  },
  {
    "objectID": "pages/tips/2025/06/250601_dvc/index.html#google-cloud-console",
    "href": "pages/tips/2025/06/250601_dvc/index.html#google-cloud-console",
    "title": "【データ管理】DVCの設定まとめ",
    "section": "Google Cloud Console",
    "text": "Google Cloud Console\n\nGoogle Cloud Consoleへアクセス\n画面上部のボックスからプロジェクトを作成\n\n左上にGoogle Cloudと書いてある部分の右です\n出てくるウィンドウの右上から作れます\n\n\n\n\n\n\n\n\n画面左のメニューから「IAMと管理」を選択\n\n左にメニューがない場合は左上の3本線から開けます\n\nサイドバーの真ん中上あたりから「サービスアカウント」を選択\n画面上部の「サービスアカウントを作成」へ進む\n任意の名前と説明を入力し、完了を押下\n\n権限のところはスキップで構いません\n\n\n\n\n\n\n\n\nメールの列に書いてある、長いメールアドレスをコピーしておく\n\n後ほどGoogle Driveのフォルダにこのアドレスを共有します\n\n作成したサービスアカウントの一番右にある「操作」から「鍵を管理」を選択\n\n長ったらしいメールアドレスの右側にある点々の部分です\n\n「キーを追加」→「新しい鍵を作成」→「JSON」を選択、作成へ進む\nファイルとして保存されるので、作業ディレクトリへ保存する\n\n.secretsフォルダを作り、その中へ保存してください\nファイル名は変えて問題ありません。key.jsonとかで大丈夫です"
  },
  {
    "objectID": "pages/tips/2025/06/250601_dvc/index.html#google-drive",
    "href": "pages/tips/2025/06/250601_dvc/index.html#google-drive",
    "title": "【データ管理】DVCの設定まとめ",
    "section": "Google Drive",
    "text": "Google Drive\n\nGoogle Driveの任意の場所にプロジェクトでデータをしまうフォルダを作成する\nフォルダの共有の設定から、先ほどコピーしたメールアドレスを貼り付け共有する\n\n\n\n\nメールアドレスを貼り付け、権限を「編集者」にして共有します\n\n\n\nGoogleドライブで作成したフォルダのIDをコピー\n\nIDは、ドライブでフォルダを開いたときのURLで、最後のスラッシュ（~/folders/）より右側の部分です"
  },
  {
    "objectID": "pages/tips/2025/06/250601_dvc/index.html#vscode",
    "href": "pages/tips/2025/06/250601_dvc/index.html#vscode",
    "title": "【データ管理】DVCの設定まとめ",
    "section": "VSCode",
    "text": "VSCode\n\nVSCodeのターミナルで次のコマンドを入力して実行 - 最後の部分（四角括弧ごと）をコピーしたIDに変更してください\n\ndvc init && dvc remote add -d myremote gdrive://[Google DriveのフォルダID]\n\nサービスアカウントを有効にする\n\n以下のコマンドを実行してください\n\n\ndvc remote modify myremote gdrive_use_service_account true\n\n次のコマンドを実行する\n\nフォルダ名やファイル名を自分で変えた場合、修正してから実行してください\n\n\ndvc remote modify myremote --local \\\n    gdrive_service_account_json_file_path .secrets/key.json"
  },
  {
    "objectID": "pages/tips/2025/06/250601_dvc/index.html#設定ファイルをgitignore重要",
    "href": "pages/tips/2025/06/250601_dvc/index.html#設定ファイルをgitignore重要",
    "title": "【データ管理】DVCの設定まとめ",
    "section": "設定ファイルをgitignore（重要！）",
    "text": "設定ファイルをgitignore（重要！）\nいま.secretsを作りましたが、この中身はいわば個人情報であり他人に漏らしていいものではないので、.gitignoreファイルにしっかり記載し、Gitのトラッキングを解除しておく必要があります。\n以下のように.gitignoreに追記してください。\n\n\n.gitignore\n\n/.secrets/\n\nこれで.secretsフォルダの中身がGitに追跡されません。"
  },
  {
    "objectID": "pages/tips/2025/06/250601_dvc/index.html#データフォルダを作ったら適宜add-push",
    "href": "pages/tips/2025/06/250601_dvc/index.html#データフォルダを作ったら適宜add-push",
    "title": "【データ管理】DVCの設定まとめ",
    "section": "データフォルダを作ったら適宜add, push",
    "text": "データフォルダを作ったら適宜add, push\n以上で設定は終了です。\n環境構築の記事でも説明しているように、あとはdataなどデータを入れるフォルダを作りデータを追加したら、dvc add data/を実行し、最後はdvc pushでプッシュすることでデータファイルをGoogle Drive上で管理することができます。"
  },
  {
    "objectID": "pages/tips/2025/06/250601_dvc/index.html#共有する場合",
    "href": "pages/tips/2025/06/250601_dvc/index.html#共有する場合",
    "title": "【データ管理】DVCの設定まとめ",
    "section": "共有する場合",
    "text": "共有する場合\n共同研究などで他の人と作業を進める場合はこのデータフォルダも共有したいということになると思います。その場合は、記事における共有に加え、.secretsは別に送る必要があります（Gitで追跡していないのでクローンしても.secretsは現れないからです）。\n別に共有したうえでワーキングディレクトリに.secretsを置いてもらえばdvc pullでデータを引っ張ってくることができるようになります。\nその際、.dvc/config.localファイルを以下のように編集してもらってください。\n[remote \"myremote\"]\n    gdrive_use_service_account = true\n    gdrive_service_account_json_file_path = ../.secrets/key.json\n../は1つ上の階層のフォルダの～という意味なので、これであっています。.dvc/config.localもgitignoreされているので、クローン下だけでは共有されません。"
  },
  {
    "objectID": "pages/tips/2025/06/250601_dvc/index.html#感想",
    "href": "pages/tips/2025/06/250601_dvc/index.html#感想",
    "title": "【データ管理】DVCの設定まとめ",
    "section": "感想",
    "text": "感想\n今のところ結構いい感じです。例えばこのウェブサイトを作るうえではあまり新しくデータを追加することがないので、追加するたびにトークンが切れて認証のし直しということが頻発していました。今回の方法では再認証がない（はず）なので、ストレスが軽減されたかなという印象です。\n何かあればぜひコメントまでお願いします。"
  },
  {
    "objectID": "pages/tips/2025/04/250413_municipality/index.html#はじめに",
    "href": "pages/tips/2025/04/250413_municipality/index.html#はじめに",
    "title": "【GIS】行政区域データを整理【ファイル有】",
    "section": "はじめに",
    "text": "はじめに\nSoftwareのページで「人口ヒートマップ」などいくつかのwebアプリケーションを公開していますが、これらを作るうえで地理データを軽量化することが課題でした。\n国土数値情報ダウンロードサイトから行政区域データをとってきて使用しているのですが、データを読み込むだけでも時間がかかるため、rmapshaperパッケージを使用して軽量化することにしました。精度は落ちるのですがパッと見ただけでわかるような劣化ではなく、ファイルサイズも1/10以下になっているので、それを公開しておこうと思います。"
  },
  {
    "objectID": "pages/tips/2025/04/250413_municipality/index.html#使用した関数",
    "href": "pages/tips/2025/04/250413_municipality/index.html#使用した関数",
    "title": "【GIS】行政区域データを整理【ファイル有】",
    "section": "使用した関数",
    "text": "使用した関数\nrmapshaperパッケージのms_simplify()でポリゴンの頂点の数を5％程度にまで削減しています。"
  },
  {
    "objectID": "pages/tips/2025/04/250413_municipality/index.html#ファイル",
    "href": "pages/tips/2025/04/250413_municipality/index.html#ファイル",
    "title": "【GIS】行政区域データを整理【ファイル有】",
    "section": "ファイル",
    "text": "ファイル\n以下のリンクからダウンロードできます。Geopackageファイルと言って、シェープファイルほど普及していませんが、シェープファイルよりも高機能かつGeoJSONほどファイルサイズが大きくない形式で提供しています。\n簡略化GPKGファイル"
  },
  {
    "objectID": "pages/tips/2025/04/250413_municipality/index.html#利用規約ライセンス情報",
    "href": "pages/tips/2025/04/250413_municipality/index.html#利用規約ライセンス情報",
    "title": "【GIS】行政区域データを整理【ファイル有】",
    "section": "利用規約・ライセンス情報",
    "text": "利用規約・ライセンス情報\n本ウェブサイトで公開している行政区域データは、国土交通省 国土数値情報ダウンロードサービス から取得した「行政区域データ」をもとに加工・作成したものです。\n\n元データのライセンス： CC BY 4.0\n加工内容：行政区域ポリゴンの簡略化処理（ms_simplify() による座標点の間引き）\n\nデータをご利用いただく場合は、以下の条件に従ってください：\n\n本データの出典として、「国土交通省『国土数値情報 行政区域データ』をもとに作成」と明記してください。\n本データは加工済みであり、正確性・完全性を保証するものではありません。\n本ウェブサイト上のデータは非商用・商用を問わず利用可能ですが、元データと同様にCC BY 4.0ライセンスが適用されます。"
  },
  {
    "objectID": "pages/tips/2025/04/250413_municipality/index.html#見てみる",
    "href": "pages/tips/2025/04/250413_municipality/index.html#見てみる",
    "title": "【GIS】行政区域データを整理【ファイル有】",
    "section": "見てみる",
    "text": "見てみる\n本データがどのようなものか見てみます。\n\n\nコード\nlibrary(tidyverse)\nlibrary(sf)\n\nd &lt;- read_sf(here::here(\"data/jpn_geojson/jp_muni_simplified.gpkg\"))\n\nggplot(d) + \n  geom_sf() + \n  theme_void()\n\n\n\n\n\n\n\n\n\nこのように、見た目では違和感なくプロットできていると思います。\n厳密な地理データを求めない場合は非常に有用だと思いますので、ぜひ使ってみてください。"
  },
  {
    "objectID": "pages/tips/2025/03/250309_estat_api/index.html#はじめに",
    "href": "pages/tips/2025/03/250309_estat_api/index.html#はじめに",
    "title": "e-Stat APIを使ってデータを取得しよう",
    "section": "はじめに",
    "text": "はじめに\n今回は説明するという言い方がおこがましい程度の備忘録的な内容です。\n今後データを使う仕事をするにあたり、もう少し統計データに詳しくなりたいと思い、e-Statでよく目にするAPIに目を付けました。正直APIというのが何かわからないレベルからのスタートでしたが、調べながら初歩的な部分をすこーし理解できた気がしないでもありません。\n今回はAPIの初歩の初歩をまとめていきたいと思います。"
  },
  {
    "objectID": "pages/tips/2025/03/250309_estat_api/index.html#e-statでの準備",
    "href": "pages/tips/2025/03/250309_estat_api/index.html#e-statでの準備",
    "title": "e-Stat APIを使ってデータを取得しよう",
    "section": "e-Statでの準備",
    "text": "e-Statでの準備\nまずはじめにe-Statでユーザー登録をし、アプリケーションIDを取得する必要があります。\nブラウザでe-Statを開き、画面右上の「新規登録」から登録します。難しい点はほとんどないと思うので詳細は省略しますが、登録できたらログインした状態にしておいてください。\n\n\n\n右上の「新規登録」から登録します\n\n\nログインできたら、上部の青いナビゲーションバーに「マイページ」が出てきますので、そこをクリックしてマイページに進みます。\nするとナビゲーションバーの少し下に水色のバーが出てきて、そこに「API機能（アプリケーションID発行）」とあるので、そこをクリックします。\n\n\n\n右から2つ目の項目です\n\n\nするとアプリケーションIDの取得ということで3つの欄が出てきますので、1番上の欄を使用していきます。名称の部分に任意の名前を入れ、URLはそのままにしておきます。右側の「発行」をクリックすれば「appId」の部分にアプリケーションIDが表示され、これを後ほど使うことになります。\n\n\n\n名称は何でも大丈夫です"
  },
  {
    "objectID": "pages/tips/2025/03/250309_estat_api/index.html#使用するパッケージ",
    "href": "pages/tips/2025/03/250309_estat_api/index.html#使用するパッケージ",
    "title": "e-Stat APIを使ってデータを取得しよう",
    "section": "使用するパッケージ",
    "text": "使用するパッケージ\nRに戻ります。\n今回は以下の3つのパッケージを使用します。\n\n# インストール\n# pak::pak(c(\"httr\", \"xml2\", \"tidyverse\"))\n\nlibrary(httr)\nlibrary(xml2)\nlibrary(tidyverse)\n\n{httr}はHTTPリクエストを送信してWeb APIからデータを取得するためのパッケージで、{xml2}はXMLデータを解析して必要な情報を抽出するためのパッケージです。XMLはデータを構造化して表現するためのフォーマットであり、APIなどでデータを受け取る際によく使われるようです。\n{tidyverse}はおなじみのデータハンドリング用です。"
  },
  {
    "objectID": "pages/tips/2025/03/250309_estat_api/index.html#apiでデータを取得",
    "href": "pages/tips/2025/03/250309_estat_api/index.html#apiでデータを取得",
    "title": "e-Stat APIを使ってデータを取得しよう",
    "section": "APIでデータを取得",
    "text": "APIでデータを取得\n\nAPIリクエストURLを取得、格納\nまずはe-Statで取得したい統計のページへアクセスします。今回は令和2年国勢調査の人口等基本集計、総人口と男女別人口のデータを取得したいと思います。今回使うページのURLは以下です。\nhttps://www.e-stat.go.jp/stat-search/database?page=1&layout=datalist&toukei=00200521&tstat=000001136464&cycle=0&tclass1=000001136466&statdisp_id=0003445078&tclass2val=0\nページにAPIと書かれた青いアイコンがあるので、そこをクリックします。するとURLが表示されるので、表示されたURLをコピーしておきます。\n\n\n\n左側にあるAPIと書かれた部分をクリックして出てきたURLをコピーします\n\n\n次にRで今コピーしたURLを格納します。ダブルクォーテーションで囲んでください。\nurl &lt;- \"https://api.e-stat.go.jp/rest/3.0/app/getStatsData?appId=&lang=J&statsDataId=0003445078&metaGetFlg=Y&cntGetFlg=N&explanationGetFlg=Y&annotationGetFlg=Y&sectionHeaderFlg=1&replaceSpChars=0\"\nここで注意ですが、URLの中にappId=という部分があり、ここに先ほど作成したアプリケーションIDを入れる必要があります。仮にアプリケーションIDを123456789とすると、\nurl &lt;- \"https://api.e-stat.go.jp/rest/3.0/app/getStatsData?appId=123456789&lang=J&statsDataId=0003445078&metaGetFlg=Y&cntGetFlg=N&explanationGetFlg=Y&annotationGetFlg=Y&sectionHeaderFlg=1&replaceSpChars=0\"\nとなります。\nappIdの部分を直接入れ替えることに不安がある方は、以下の方法でも可能です。\nappId &lt;- \"123456789\"  # ここにアプリケーションIDを入れます\n\n# コピーしてきたURL\nurl_template &lt;- \"https://api.e-stat.go.jp/rest/3.0/app/getStatsData?appId=%s&lang=J&statsDataId=0003445078&metaGetFlg=Y&cntGetFlg=N&explanationGetFlg=Y&annotationGetFlg=Y&sectionHeaderFlg=1&replaceSpChars=0\"\n\nurl &lt;- sprintf(url_template, appId)\nsprintf()は文字列の中に変数を埋め込む関数です。%sの部分がappIdで置き換えられるようになっています。\n\n\nURLを使ってAPIリクエストを実行\n次に入力したURLを使ってAPIリクエストを実行します。\n\nresponse &lt;- GET(url)\n\nこのレスポンスの内容をテキストとして取得し、XMLとして読み込んでいきます。responseにはステータスコードが含まれているのですが、これが200だと読み込みが成功しています。成功していれば読み込むように設定します。\n\nif (status_code(response) == 200) {\n  xml_data &lt;- read_xml(\n    content(response, as = \"text\", encoding = \"UTF-8\")\n  )\n\n  print(xml_data)\n} else {\n  stop(\n    \"データの取得に失敗しました。HTTPステータスコード: \",\n    status_code(response)\n  )\n}\n\n{xml_document}\n&lt;GET_STATS_DATA noNamespaceSchemaLocation=\"https://api.e-stat.go.jp/rest/3.0/schema/GetStatsData.xsd\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n[1] &lt;RESULT&gt;\\n  &lt;STATUS&gt;0&lt;/STATUS&gt;\\n  &lt;ERROR_MSG&gt;正常に終了しました。&lt;/ERROR_MSG&gt;\\n  &lt;D ...\n[2] &lt;PARAMETER&gt;\\n  &lt;LANG&gt;J&lt;/LANG&gt;\\n  &lt;STATS_DATA_ID&gt;0003445078&lt;/STATS_DATA_ID ...\n[3] &lt;STATISTICAL_DATA&gt;\\n  &lt;RESULT_INF&gt;\\n    &lt;TOTAL_NUMBER&gt;12258&lt;/TOTAL_NUMBER ...\n\n\nステータスコードが200になっていたようなので{xml_document}としていろいろ出てきました。また、xml_dataに読み込んだXMLが保存されています。\n\n\nXMLの構造確認\n次にXMLの構造を確認してみます。しかしこれは非常に長くなるので、結果は表示しません。実際に手元で実行してみてください。\n\nxml_structure(xml_data)\n\n結果の中には様々な情報が構造化されて格納されていることがわかります。僕たちが抽出したい情報は{text}と表示されてしまっているので、このままでは{text}が何か確認することができませんが、この中には統計名や更新日など、統計に関する様々な情報（タグ）が含まれます1。必要に応じてここから情報を取得することができるので、試しにいろいろやってみましょう。\n\n統計表の名前\n\n\ntable_name &lt;- xml_text(xml_find_first(xml_data, \"//TABLE_INF/STATISTICS_NAME\"))\nprint(table_name)\n\n[1] \"令和２年国勢調査 人口等基本集計　（主な内容：男女・年齢・配偶関係，世帯の構成，住居の状態，母子・父子世帯，国籍など）\"\n\n\n\n調査日\n\n\nsurvey_date &lt;- xml_text(xml_find_first(xml_data, \"//TABLE_INF/SURVEY_DATE\"))\nprint(survey_date)\n\n[1] \"202010\"\n\n\n\n統計表の公開日\n\n\nopen_date &lt;- xml_text(xml_find_first(xml_data, \"//TABLE_INF/OPEN_DATE\"))\nprint(open_date)\n\n[1] \"2021-11-30\"\n\n\nいろいろ結果が出てきました。ここで、使用していた関数について説明します。\nまずxml_text()です。これはXML内の ノード2のテキストを取得する関数です。内容をテキストとして抽出するものというようなイメージだと思ってください。\n次にxml_find_first()です。これは括弧内で指定したパスと合致する最初のものを抽出してくるという関数です。例えば上の1番では、\"//TABLE_INF/STATISTICS_NAME\"に一致する部分を探して、そこに書かれている内容を引っ張ってきます。最初ということは複数あるのか？と僕も最初は思ったのですが、どうやら1つしかない要素に対しても一般的に使うようです3。\n\n\n\n\n\n\nTipXPath（XML上のパス）について\n\n\n\nXMLの構造を丁寧に見た方の中には、TABLE_INFは実はGET_STATS_DATAの中のさらにSTATISTICAL_DATAの中に入っているがそれは指定しなくてよいのか、と思った方もいるかもしれません。そこは最初の2つのスラッシュ（//）で対応していて、これは全体のどこにあっても、例えばTABLE_INF/STATISTICS_NAMEとなっている部分を見つけ出して中身を抽出するということを意味しています。つまり、上記の書き方で\"/GET_STATS_DATA/STATISTICAL_DATA/TABLE_INF/STATISTICS_NAME\"をヒットさせることができるわけです。\n\n\n\n\nデータを取得\nではいろいろ確認できたところでデータを取得する作業に入ります。\nデータは//DATA_INF/VALUEというところに含まれているので、このパスを用います。また構造を確認していただけばわかるように、VALUEというのは大量にありますのでxml_find_first()では最初の1つしか取得できず、不適切です。ここではxml_find_all()ですべての用をを取得していきます。\n加えて、\n&lt;VALUE [tab, cat01, area, time, unit]&gt;\nとなっているように、VALUEには5つの属性が付与されており、それぞれ統計表のタブ（表のバージョンや種類）、統計のカテゴリ、自治体コード、時間（ここでは年）、単位を示します。これを踏まえて必要な情報を以下のコードでは取得しています。\n\n# データがあるノードをすべて取得\nvalue_nodes &lt;- xml_find_all(xml_data, \"//DATA_INF/VALUE\")\n\ndf &lt;- tibble(\n  # xml_attr()で特定の属性を取得\n  area = xml_attr(value_nodes, \"area\"),\n  time = xml_attr(value_nodes, \"time\"),\n  category = xml_attr(value_nodes, \"cat01\"),\n  # valueはテキストとして取得したのち数値に変換\n  value = as.numeric(xml_text(value_nodes))\n)\n\nprint(df)\n\n# A tibble: 12,258 × 4\n   area  time       category     value\n   &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt;\n 1 00000 2020000000 0        126146099\n 2 01000 2020000000 0          5224614\n 3 01100 2020000000 0          1973395\n 4 01101 2020000000 0           248680\n 5 01102 2020000000 0           289323\n 6 01103 2020000000 0           265379\n 7 01104 2020000000 0           211835\n 8 01105 2020000000 0           225298\n 9 01106 2020000000 0           135777\n10 01107 2020000000 0           217040\n# ℹ 12,248 more rows\n\n\nこのままだと少しわかりにくいですね。timeは年なので上4桁だけ取り出したいし、categoryには３つの数字があるのですが、それぞれが何を意味しているのか分かりません。\nひとまずカテゴリについて確認しておきましょう。XMLの中にCLASS_INFがあり、その中に情報が含まれています。カテゴリ（cat01がそれです）について知りたい場合は\"//CLASS_INF/CLASS_OBJ[@id='cat01']/CLASS\"で確認できます。以下のコードを実行してください。\n\n# xml_data内のノードを取得\ncat01_nodes &lt;- xml_find_all(\n  xml_data,\n  \"//CLASS_INF/CLASS_OBJ[@id='cat01']/CLASS\"\n)\n\n# cat01のコードと対応する名前を取得\ndf_cat01 &lt;- tibble(\n  cat01_code = xml_attr(cat01_nodes, \"code\"),\n  cat01_name = xml_attr(cat01_nodes, \"name\")\n)\n\n# 結果を表示\nprint(df_cat01)\n\n# A tibble: 3 × 2\n  cat01_code cat01_name\n  &lt;chr&gt;      &lt;chr&gt;     \n1 0          総数      \n2 1          男        \n3 2          女        \n\n\n0が総数、1が男、2が女であることがわかりました。なのでここでカテゴリを書き換え、ついでに年も整理し並べ替えておきましょう。\n\ndf_cleaned &lt;- df |&gt;\n  arrange(area, time, category) |&gt;\n  mutate(\n    # timeは上4桁を取り出す\n    time = as.integer(substr(time, 1, 4)),\n    # case_when()で条件分岐\n    category = case_when(\n      # 文字列として格納されているので\"\"で囲みます\n      category == \"0\" ~ \"population\",\n      category == \"1\" ~ \"pop_male\",\n      category == \"2\" ~ \"pop_female\"\n    )\n  )\n\nprint(df_cleaned)\n\n# A tibble: 12,258 × 4\n   area   time category       value\n   &lt;chr&gt; &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;\n 1 00000  2020 population 126146099\n 2 00000  2020 pop_male    61349581\n 3 00000  2020 pop_female  64796518\n 4 01000  2020 population   5224614\n 5 01000  2020 pop_male     2465088\n 6 01000  2020 pop_female   2759526\n 7 01100  2020 population   1973395\n 8 01100  2020 pop_male      918682\n 9 01100  2020 pop_female   1054713\n10 01101  2020 population    248680\n# ℹ 12,248 more rows\n\n\nもしカテゴリの各種をそれぞれ列にしたければpivot_wider()でできます。\n\ndf_wide &lt;- df_cleaned |&gt;\n  pivot_wider(\n    names_from = category,\n    values_from = value\n  )\n\nprint(df_wide)\n\n# A tibble: 4,086 × 5\n   area   time population pop_male pop_female\n   &lt;chr&gt; &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;\n 1 00000  2020  126146099 61349581   64796518\n 2 01000  2020    5224614  2465088    2759526\n 3 01100  2020    1973395   918682    1054713\n 4 01101  2020     248680   112853     135827\n 5 01102  2020     289323   136596     152727\n 6 01103  2020     265379   126023     139356\n 7 01104  2020     211835   100062     111773\n 8 01105  2020     225298   104154     121144\n 9 01106  2020     135777    62347      73430\n10 01107  2020     217040   100027     117013\n# ℹ 4,076 more rows\n\n\nこれでひとまずデータフレームとして整理することができました。ここからさらに整理したり、分析を回していきましょう！"
  },
  {
    "objectID": "pages/tips/2025/03/250309_estat_api/index.html#データベースから取得する",
    "href": "pages/tips/2025/03/250309_estat_api/index.html#データベースから取得する",
    "title": "e-Stat APIを使ってデータを取得しよう",
    "section": "データベースから取得する",
    "text": "データベースから取得する\n今回は国勢調査のような既にまとめられたデータを用いましたが、e-Statのデータベースを使えば必要なデータを選択して取得することができます。\n例えばこちらから「市区町村データ」を選択し「データ表示」をクリックします。\n出てきた画面から地域を選択し、「確定」をクリックしたのち取得したいデータを選択し、再度「確定」をクリックします。\n\n\n\n地域を選択します\n\n\n\n\n\n取得したい統計項目を選択します\n\n\nするとデータが画面に表示されますが、ここで右上の「API」をクリックし、表示されたURLをコピーします。ここからは上で書いてきた手順と同様です。\n\n\n\nURLの使い方はこれまでと同様です"
  },
  {
    "objectID": "pages/tips/2025/03/250309_estat_api/index.html#おわりに",
    "href": "pages/tips/2025/03/250309_estat_api/index.html#おわりに",
    "title": "e-Stat APIを使ってデータを取得しよう",
    "section": "おわりに",
    "text": "おわりに\nAPIは正直初心者には難しいなと感じましたが、大体のコードはそのまま使いまわせますし、XMLの構造を少し辛抱して眺めてみればどこに何が入っているのか少しずつわかってきました。\nCSVでダウンロードすると余計な情報量が多く分析の手間に感じていましたので、春休みを機に少しではありますが知れてよかったと思います。ぜひ活用してみて下さい。"
  },
  {
    "objectID": "pages/tips/2025/03/250309_estat_api/index.html#footnotes",
    "href": "pages/tips/2025/03/250309_estat_api/index.html#footnotes",
    "title": "e-Stat APIを使ってデータを取得しよう",
    "section": "注",
    "text": "注\n\n\nこちらからタグの種類を確認できます。↩︎\nXMLデータの中の要素（タグ）や属性、テキストなどの構成要素のことを言います。↩︎\n今回取得してきたような要素は全体を見ても1か所にしか出てきません。↩︎"
  },
  {
    "objectID": "pages/tips/2025/02/250205_website_tools/index.html#はじめに",
    "href": "pages/tips/2025/02/250205_website_tools/index.html#はじめに",
    "title": "【ウェブサイト】設定を追加する",
    "section": "はじめに",
    "text": "はじめに\n2月に入りましたが、本年初の更新となります。今年は就職の年ですが、時間があるときに学びを備忘録がてら更新していきたいと思いますのでよろしくお願いします。\n今回は以前ご紹介したウェブサイトの作り方について、さらに設定を追加していこうと思います。\n追加する設定は、\n\nGoogleアナリティクス\nSNSアカウント\nフッター\n\nです。前提として、以下のページ等をもとにQuartoのウェブページが作成されているとします。\n\n\n\n\n\n\n【Quarto & RStudio】ウェブサイトを作る！\n\n\n\n順を追ってみていきましょう。"
  },
  {
    "objectID": "pages/tips/2025/02/250205_website_tools/index.html#googleアナリティクス",
    "href": "pages/tips/2025/02/250205_website_tools/index.html#googleアナリティクス",
    "title": "【ウェブサイト】設定を追加する",
    "section": "Googleアナリティクス",
    "text": "Googleアナリティクス\nそもそもですが、Googleアナリティクスでは、ウェブサイトやアプリの訪問者の動向を分析することができます。例えば、昨日は何人がページを訪れて、どのページを見ていったか、といったことが把握できるようになります。\n\nアナリティクスページ\nまずは、Googleアナリティクスのページでの設定を行います。\n\n\n\nGoogleアナリティクスの画面\n\n\n\nhttps://analytics.google.com/へ移動し、使用するGoogleアカウントでログインする\n「測定を開始」をクリック\n任意のアカウント名を入力、データ共有設定で必要な項目にチェックを入れ、次へ\n\nアカウント名は何でも大丈夫です。\nチェックはそのままでも大丈夫です。\n\n任意のプロパティ名を入力し、次へ\n\nこれはウェブページ名にした方がわかりやすいと思います。\n例：「hogehoge.github.io」\n\nビジネスの説明を入力し、次へ\n\nここは適当で大丈夫だと思います。\n\nビジネス目標を選択し、「作成」を選択\n\n「ウェブ/アプリのトラフィックの分析」や「ユーザーエンゲージメントとユーザーの維持率の把握」あたりが該当すると思います。\n\n「ウェブ」を選択\nURLとストリーム名を入力し、「作成して続行」をクリック\n\nURLはGitHubページであれば「(ユーザー名).github.io」です。不安であればホームページからコピーしてきてください。\nストリーム名はプロパティ名と同じでいいと思います。\n\n\n「Googleタグの設定」という画面が出てくると思いますが、ここは×で閉じて大丈夫です。すると、「ウェブ ストリームの詳細」の画面が出てくるので、そこの測定 ID（Gで始まる）をコピーして下さい。\n画面を閉じてしまっても、表示されている画面で該当するページ部分をクリックすれば再度開くことができます。\n\n\nQuartoの設定\nエディターに戻り、_quarto.ymlを開きます。\n以下のように、google-analyticsにコピーしたIDを追記してください。\nproject:\n  type: website\n  \nwebsite:\n  title: \"ホームページ\"\n  google-analytics: \"G-xxxxxxxxxx\"\n  navbar:\n    right:\n      - about.qmd\nこれで保存して再度パブリッシュ1し、しばらくすると追跡結果がみられるようになります。すぐは見れませんが、しばらくした後再度Googleアナリティクスを訪れてみてください。"
  },
  {
    "objectID": "pages/tips/2025/02/250205_website_tools/index.html#snsアカウントを追加",
    "href": "pages/tips/2025/02/250205_website_tools/index.html#snsアカウントを追加",
    "title": "【ウェブサイト】設定を追加する",
    "section": "SNSアカウントを追加",
    "text": "SNSアカウントを追加\nウェブサイトからXやFacebookなど他のページへ飛んでほしいこともあるかと思います。こうしたSNSアカウントやGitHubなどのアイコンの表示方法をご紹介します。\n\nナビゲーションバー\nまずは画面上部のナビゲーションバーに表示する方法です（本ページも右上にGitHubアイコンがあります）。\n_quarto.ymlを開きます。以下のようにtoolsを追記して下さい。\nproject:\n  type: website\n  \nwebsite:\n  title: \"ホームページ\"\n  google-analytics: \"G-xxxxxxxxxx\"\n  navbar:\n    right:\n      - about.qmd\n    tools:\n      - icon: twitter-x\n        href: https://twitter.com/hogehoge\n        text: Twitter\n      - icon: github\n        href: https://github.com/hogehoge\n        text: GitHub\nicon、href、textの3つがあります。Xはtwitter-xとなっていることに注意してください。Twitterアイコンがよければシンプルにtwitterで表示できます。\nこれで保存しページをレンダリングすると、アイコンが表示されていると思います。\n\n\nページ内で表示\n僕のAboutページにあるように、プロフィールとセットで表示したい場合は、次のように設定します。\n表示したいページの.qmdファイルで、YAMLヘッダーを以下のように変更します。\n---\ntitle: Hogehoge\nabout:\n  template: trestles\n  links: \n    - icon: twitter-x\n      text: X (Twitter)\n      url: https://x.com/5uke_y\n    - text: \" Bluesky\"\n      url: https://bsky.app/profile/5uke.bsky.social\n    - icon: github\n      text: GitHub\n      url: https://github.com/hogehoge\n---\naboutのtemplateはtrestles以外にもいろいろあります。こちらを参照して下さい。\n肝心なのはlinksです。書き方はナビゲーションバーと同じです。about下に書くことで、以下のように表示できます。\n\n\n\n名前の下に3つのアカウントが表示されています\n\n\nちなみにBlueskyの部分の書き方が少々ややこしいですが、これはまだBlueskyのアイコンが提供されていないため、Iconifyのアイコンを使って代用しています。アイコンの挿入についてはこちらを参照してください。\n以上がSNSアイコンの説明になります。概ねこの2か所に表示することが多いかと思いますので、ご参考になれば幸いです。"
  },
  {
    "objectID": "pages/tips/2025/02/250205_website_tools/index.html#フッターの設定",
    "href": "pages/tips/2025/02/250205_website_tools/index.html#フッターの設定",
    "title": "【ウェブサイト】設定を追加する",
    "section": "フッターの設定",
    "text": "フッターの設定\n大体のウェブページにはフッターが付いていますよね。「©2025 Hogehoge」みたいなものです。\nこれもナビゲーションバーと同様に左、真ん中、右でそれぞれ設定できます。\n再び_quarto.ymlを開いて、以下のように設定します。\nproject:\n  type: website\n  \nwebsite:\n  title: \"ホームページ\"\n  navbar:\n    right:\n      - about.qmd\n  page-footer:\n    background: light\n    center: |\n      &#169; 2025 Hogehoge\nbackgroundはフッター部分の背景に少し色が付きます。もちろんdarkもあります。\ncenter部分はleftとrightもあります。また、|で改行することで次の行に書くことができます。center: \"&#169; 2025 Hogehoge\"みたいに1行で書くこともできるのですが、ダブルクォーテーションを忘れないで下さい。\n&#169;はHTMLエンティティといって、これを出力すると「©」となります。別に直接「©」を入れても大丈夫です。\nちなみにフッター内で改行したい場合は、HTMLと同じで&lt;br&gt;を入れれば可能です。&#169; 2025 Hogehoge &lt;br&gt; This website is created with Quartoのように書けます。"
  },
  {
    "objectID": "pages/tips/2025/02/250205_website_tools/index.html#おわりに",
    "href": "pages/tips/2025/02/250205_website_tools/index.html#おわりに",
    "title": "【ウェブサイト】設定を追加する",
    "section": "おわりに",
    "text": "おわりに\n今回はGoogleアナリティクス、SNSアカウント、フッターについての設定をご紹介しました。\nこれらはQuarto公式ガイドを読んだり、人の_quarto.ymlを真似するのがおすすめです。\n最後に僕がこれまで参考にした方々のコードと、僭越ながら自分のコードのリンクも並べておきます。\n\n\n\n\n\n\nSimon P. Couch氏（Posit）\n\n\n\n\n\n\n\n\n\nGarrick Aden-Buie氏（Posit）\n\n\n\n\n\n\n\n\n\n柳本和春さん（CEMFI）\n\n\n\n\n\n\n\n\n\n阿部洋輔"
  },
  {
    "objectID": "pages/tips/2025/02/250205_website_tools/index.html#footnotes",
    "href": "pages/tips/2025/02/250205_website_tools/index.html#footnotes",
    "title": "【ウェブサイト】設定を追加する",
    "section": "注",
    "text": "注\n\n\nquarto publish gh-pagesなど。詳しくは「【Quarto & RStudio】ウェブサイトを作る！」を参照してください。↩︎"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#はじめに",
    "href": "pages/tips/2025/03/250319_scraping/index.html#はじめに",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "はじめに",
    "text": "はじめに\n今回はRでスクレイピングを行っていきます。rvestパッケージを使ったスクレイピング自体は他のウェブサイトでも多数紹介されているのですが、今回JavaScriptが使われているページ（特にe-Stat）にも対応した方法をまとめます。これを行うには既に紹介されている方法からもう一工夫する必要があり、それも少々面倒です。\nこれまで僕はブラウザ拡張機能の「DownThemAll!」1を使って無理くり実行していたのですが、この手の方法は再現が難しいし手間という欠点があるので、できればR上でコードとして残しておきたいと思っていました。そんなところ友人からあるページを紹介してもらい、抱えていた課題2が解決できそうでしたので、これを機にまとめていきます。\n紹介してもらったページはこちらです↓\n\n\n\n\n\n\nrvestで動的サイトをスクレイピングする（Seleniumを使わずに）\n\n\n\nまた、Google Chromeを使用するので、インストールしていない方はしておいてください。"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#使用するパッケージ",
    "href": "pages/tips/2025/03/250319_scraping/index.html#使用するパッケージ",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "使用するパッケージ",
    "text": "使用するパッケージ\n使用するパッケージは以下の通りです。Rプロジェクトを使うなりsetwd()を使うなりでワーキングディレクトリを現在のディレクトリに設定しておいてください。プロジェクトについてはこちら。\nついでに、保存するディレクトリ（dataフォルダ内のshpfiles）をあらかじめ指定しておきます。なければ作成する関数もつけておきます。\nlibrary(rvest)\nlibrary(here)\n\nsave_dir &lt;- here(\"data/shpfiles\")\n# ダウンロード用のフォルダがなければ作成する\nif (!dir.exists(save_dir)) {\n  dir.create(save_dir)\n}"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#ファイルをダウンロードするページ",
    "href": "pages/tips/2025/03/250319_scraping/index.html#ファイルをダウンロードするページ",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "ファイルをダウンロードするページ",
    "text": "ファイルをダウンロードするページ\n今回ファイルを取得していくのは、e-Statの「地図」→「境界データダウンロード」→「3次メッシュ」→「世界測地系平面直角座標系・Shapefile」のページです。\nhttps://www.e-stat.go.jp/gis/statmap-search?page=1&type=2&aggregateUnitForBoundary=S&coordsys=2&format=shape\nメッシュいうのは国土を例えば1km×1kmの正方形で区切ったものをいい、その中の人口等のデータを扱うことができるようになります。このあたりの詳細は以下の書籍が非常にわかりやすいのでおすすめです。RでGISを扱う方法も学べます。\n\n\n\n\n\n\n事例で学ぶ経済・政策分析のためのGIS入門: QGIS,R,GeoDa対応"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#ページを取得",
    "href": "pages/tips/2025/03/250319_scraping/index.html#ページを取得",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "ページを取得",
    "text": "ページを取得\n基本的にはread_html()関数で読み込むことができるのですが、JavaScriptを使用しているような動的なページには対応していません。そこで使用するのがread_html_live()関数です。これらの関数の仕組み自体は冒頭で紹介したページがわかりやすいのでそちらを読んでみてください。\n先ほどのURLを読み込んでみましょう。\nhtml &lt;- read_html_live(\"https://www.e-stat.go.jp/gis/statmap-search?page=1&type=2&aggregateUnitForBoundary=S&coordsys=2&format=shape\")"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#ファイルのリンクを取得",
    "href": "pages/tips/2025/03/250319_scraping/index.html#ファイルのリンクを取得",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "ファイルのリンクを取得",
    "text": "ファイルのリンクを取得\n次にいよいよファイルを取得していきます。僕もHTMLに詳しいわけではないので詳細は書きませんが、aタグというのがリンクを生成するためのもので、その中にhrefという属性があります。例えば\n&lt;a class=\"stat-dl_icon stat-statistics-table_icon\" tabindex=\"40\" href=\"/gis/statmap-search/data?dlserveyId=S&amp;code=3036&amp;coordSys=2&amp;format=shape&amp;downloadType=5\"&gt;\n&lt;span class=\"stat-dl_text\"&gt;世界測地系平面直角座標系・Shapefile&lt;/span&gt;\n&lt;/a&gt;\nというようになっており、aと/aで囲まれている間にhrefやその他の属性が含まれていることがわかります。\n\n\n\n\n\n\nTipどうやって探す？\n\n\n\n\n\nこのHTMLはどうやって探せばよいのでしょうか。実はブラウザ上から簡単に見ることができます。\nブラウザ上で任意のページを開いたら、Ctrl + Shift + Iを同時に入力します。もしくはブラウザ右上の点々から「その他のツール」→「デベロッパー ツール」でも開けます。\n\n\n\n\n\nすると画面右側になにやらぶわぁーっと出てきますね。これの上半分がHTMLコードです。ここから特定のコードを探すのは骨が折れそうですが、逆にページの要素をクリックすることで該当するコードを探すことができます。デベロッパーツール画面上部の左側にカーソルのようなアイコンがあります。\n\n\n\n一番左側です\n\n\nこれをクリックしたうえでページ上の要素にカーソルを重ねてクリックすると、該当箇所のコードが表示されます。カーソルを「世界測地系平面直角座標系・Shapefile」という文字に重ねると先ほどのコードが表示されます。\n\n\n\nここではaタグを探す→hrefを探し取得する、という手順を踏みます。\nlinks &lt;- html |&gt; \n  html_elements(\"a\") |&gt; \n  html_attr(\"href\")\nhtml_elements(\"a\")でaタグを探し、html_attr(\"href\")で属性（attribute）を探しています。linksにはaタグの中のhrefに入っているリンクがずらーっと入っていることになります。\nここでは表示しませんが、linksの中身を確認すると、想像以上にたくさんのリンクが入っていることがわかります。ここからさらにシェープファイルのダウンロードリンクを探さなければなりません。\n上のaタグの例を見てもらうと、/gis/statmap-search/data?dlserveyId=S&code=3036&coordSys=2&format=shape&downloadType=5というのがシェープファイルのダウンロードリンクであることがわかります。他のシェープファイルのリンクと見比べてもらうと、code=3036の部分だけがそれぞれ異なっており、他は同じです。すなわち、まとめてダウンロードしたければこの部分さえうまいことやれば可能になるということです。\nとりあえず、数多のリンクの中からシェープファイルのリンクだけ抽出しておきましょう。linksの中のリンクを確認すると、data?dlserveyId=S&という部分がシェープファイルのダウンロードリンクにのみ含まれていることがわかる、これを含むリンクを抽出すればよいことになります。\nshp_links &lt;- links[grepl(\"data\\\\?dlserveyId=S&\", links)]\nポイント：\n\ngrepl()で条件に合致するものを抽出\n\ngrepl(x, y)で、yの中でxを含むものにTRUEを返す\nlinksの中でdata\\\\?dlserveyId=S&を含むものにTRUEを返している\n?の前に\\\\が入っているのは、正規表現の中で?は特別な役割を持っているので、その役割として認識されるのを防ぐため（エスケープしている）\n\nlinks[ ] で、TRUEを持つものを抽出している\n\nすなわちgrepl()でTRUEを返したもの（=シェープファイルのダウンロードリンクをもつもの）だけが残る\n\n\n短いコードでもややこしいですね。特に記号のところには気を付けていただければと思います。"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#リンクを整形する",
    "href": "pages/tips/2025/03/250319_scraping/index.html#リンクを整形する",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "リンクを整形する",
    "text": "リンクを整形する\nお気づきの方もいらっしゃると思いますが、実は先ほどのリンクは相対的なものです。https://から始まっていません。ベースとしてhttps://www.e-stat.go.jpというURLがあり、そこに続く形で/gis/...が入ってきます。\n以下では取得したリンクにベースリンクをくっつけていきます。\nbase_url &lt;- \"https://www.e-stat.go.jp\"\nfull_urls &lt;- paste0(base_url, shp_links)\nこれでページ内の20個のリンクを抽出することができました。次にこれらのリンクを使ってダウンロードしていきます。"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#ファイルをダウンロード",
    "href": "pages/tips/2025/03/250319_scraping/index.html#ファイルをダウンロード",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "ファイルをダウンロード",
    "text": "ファイルをダウンロード\nいよいよダウンロードをしていきます。\n全てのリンクに対しダウンロードするコードを適用します。forの出番です。\nfor (i in seq_along(full_urls)) {\n  # リンクからメッシュコードを取得\n  code &lt;- sub(\".*code=([0-9]+).*\", \"\\\\1\", shp_links[i])\n  \n  # ダウンロードするファイルのパスを指定する\n  # 例: shpfiles/shpfile_3036.zip\n  file_path &lt;- file.path(save_dir, paste0(\"shpfile_\", code, \".zip\"))\n\n  # ファイルをダウンロード\n  download.file(full_urls[i], destfile = file_path, mode = \"wb\")\n  \n  # アクセス間隔を空ける\n  # サーバー負荷を考慮\n  Sys.sleep(2)\n}\nポイント：\n\nseq_along(full_urls)はfull_urlsの要素の数を取得している\n\n今回はURLが20個と分かっているが、数が多くて数えにくいような場合にも有用\n\nsub(\".*code=([0-9]+).*\", \"\\1\", shp_links[i])でメッシュコードを取得\n\nsub(pattern, replacement, x)でxのpetternをreplacementに置換する\n.*code=([0-9]+).*はざっくり言うと、前後が何であれcode=(何らかの数字)というものを探してきて、括弧内の数字を取得しているということ\n\\\\1は今取得した数字を返すということ\nxにはshp_links[i]が該当するので、i番目のリンクで上で述べた置換をしているということ\n\nfile_path &lt;- file.path(save_dir, paste0(\"shpfile_\", code, \".zip\"))で保存する際のファイル名を作成\n\n現在のワーキングディレクトリにあるdata内のshpfilesというフォルダの中にshpfile_3036.zipというようなZipファイルを作成する\nダウンロードはZipファイルで行われるので拡張子は.zipとしておく\n\n\nmy_project/\n├── data/\n├── shpfiles/  ← ここにダウンロードする\n└── scripts/\n    ├── download_script.R\n    ├── analysis.R\n    └── ...\n\ndownload.file(full_urls[i], destfile = file_path, mode = \"wb\")でダウンロード\n\ndownload.file(url, destfile, mode)でurlをdestfileにmodeで指定したモードでダウンロードする\n詳細は省くが、Zipファイルに対してはmode=\"wbを指定する\n\nSys.sleep(2)でサーバー負荷を軽減する\n\n作業ごとに2秒のインターバルを設けるということ\n\n\nさすがに面倒すぎますね。最初は困ると思いますが、2回目以降大変便利に思えるはずです。\nひとまずこれでページ上のファイルをダウンロードすることができました！"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#全ページまとめてダウンロード",
    "href": "pages/tips/2025/03/250319_scraping/index.html#全ページまとめてダウンロード",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "全ページまとめてダウンロード",
    "text": "全ページまとめてダウンロード\nここまでは1ページ内のファイルをダウンロードする方法について順を追って見てきました。\nこのセクションではシェープファイルが1～9ページにまたがって並んでいることを踏まえ、さらにforループを構築し、これまでの作業を9ページにわたって実行できるようにします。\nfor (i in 1:9) {\n  url &lt;- paste0(\"https://www.e-stat.go.jp/gis/statmap-search?page=\", i, \"&type=2&aggregateUnitForBoundary=S&coordsys=1&format=shape\")\n  \n  html &lt;- read_html_live(url)\n  Sys.sleep(1)\n  \n  links &lt;- html |&gt; \n    html_elements(\"a\") |&gt; \n    html_attr(\"href\")\n  \n  shp_links &lt;- links[grepl(\"data\\\\?dlserveyId=S&\", links)]\n  \n  full_urls &lt;- paste0(base_url, shp_links)\n  \n  for (j in seq_along(full_urls)) {\n    code &lt;- sub(\".*code=([0-9]+).*\", \"\\\\1\", shp_links[j])\n    file_path &lt;- file.path(save_dir, paste0(\"shpfile_\", code, \".zip\"))\n    \n    if (!file.exists(file_path)) {\n      tryCatch({\n        download.file(full_urls[j], destfile = file_path, mode = \"wb\")\n      }, error = function(e) {})\n      Sys.sleep(2)\n    }\n  }\n}\nポイント：\n\nURLのpage=の部分に1から9が入るように設定\n\nURLを分割し、ページ数の部分にiで数字を入れています。\n\nHTMLを読み込んだ後にSys.sleep(1)で1秒待機\n\nHTMLを読み込んですぐ次のコマンドに移ると、中身を最後まで読み込まないまま次を実行してしまうので、しっかり読み込めるようにするための設定です。\n\nforループ2段階目\n\n大外のforでiを使っているので、今度はjにしています。\nifでファイルがない場合に実行するようにしている。\n\n何らかの理由で途中エラーが発生し、再度全体を実行しても、既にダウンロードできているファイルを重複してダウンロードせずに済みます。\n\ntryCatchは、途中でエラーが起きたときでもスクリプト全体を止めずに柔軟に処理を続けるための関数で、エラーが起きても一旦スキップして最後まで実行します。\n\n\n見慣れない関数も登場しましたが、このコードを実行すれば9ページ分まとめてダウンロードすることが可能です。"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#コードまとめ",
    "href": "pages/tips/2025/03/250319_scraping/index.html#コードまとめ",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "コードまとめ",
    "text": "コードまとめ\n最後に今回のコードをまとめます。\nlibrary(rvest)\nlibrary(here)\n\nfor (i in 1:9) {\n  url &lt;- paste0(\"https://www.e-stat.go.jp/gis/statmap-search?page=\", i, \"&type=2&aggregateUnitForBoundary=S&coordsys=1&format=shape\")\n  \n  html &lt;- read_html_live(url)\n  Sys.sleep(1)\n  \n  links &lt;- html |&gt; \n    html_elements(\"a\") |&gt; \n    html_attr(\"href\")\n  \n  shp_links &lt;- links[grepl(\"data\\\\?dlserveyId=S&\", links)]\n  \n  full_urls &lt;- paste0(base_url, shp_links)\n  \n  for (j in seq_along(full_urls)) {\n    code &lt;- sub(\".*code=([0-9]+).*\", \"\\\\1\", shp_links[j])\n    file_path &lt;- here(\"shpfiles\", paste0(\"shpfile_\", code, \".zip\"))\n    \n    if (!file.exists(file_path)) {\n      tryCatch({\n        download.file(full_urls[j], destfile = file_path, mode = \"wb\")\n      }, error = function(e) {})\n      Sys.sleep(2)\n    }\n  }\n}"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#おわりに",
    "href": "pages/tips/2025/03/250319_scraping/index.html#おわりに",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "おわりに",
    "text": "おわりに\n今回はRでe-Statのシェープファイルを取得してきました。個人的にもずっとやりたいことだったので、不完全とはいえ、念願かなった感じです。\n今後も調査して全ページを一つのループでダウンロードできるようなコードを書いていきたいと思います。"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#おまけ",
    "href": "pages/tips/2025/03/250319_scraping/index.html#おまけ",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "おまけ",
    "text": "おまけ\nZipファイルでダウンロードすることになりますが、今回の流れでエクスプローラーから直接展開したりファイルを削除するのは面倒だと思います。\n解凍し、使用済みのZipファイルを削除するには以下を実行します。\nzip_files &lt;- list.files(save_dir, pattern = \"\\\\.zip$\", full.names = TRUE)\n\nfor (zip_path in zip_files) {\n  unzip(zip_path, exdir = save_dir)\n  file.remove(zip_path)\n}\nunzip()でZipファイルを解凍して、file.remove()でZipファイルを削除します。"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#その他の実用例",
    "href": "pages/tips/2025/03/250319_scraping/index.html#その他の実用例",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "その他の実用例",
    "text": "その他の実用例\n最近仕事の一環で時間がかかりそうな作業をスクレイピングでサクッと解決したので、地味な例ではありますがご参考までに紹介します。\n\nシーン\n各省庁が出している白書のリストが載っているページがあるのですが、ここから白書名、省庁名、リンクをぱぱーっと取ってきたいという場面です。\n\n\n\nこんな感じでずらーっと並んでいます\n\n\n\n\n手順\n\nread_html()でURLを読み込む（今回はliveの方でなくてもできる例です）\n\n\nlibrary(rvest)\nlibrary(tidyverse)\n\nurl &lt;- \"https://www.e-gov.go.jp/about-government/white-papers.html\"\nhtml &lt;- read_html(url)\n\n\n要素を確認する\n\nCtrl + Shift + Iでデベロッパーツールを開き、白書名やリンクなどがどうなっているか確認します\n\n\n\n\n\n水循環白書はこのようになっています\n\n\n\n要素を取得する\n\nitems &lt;- html |&gt; \n  html_element(\"main\") |&gt; \n  html_element(\"ul\")\n\nhakusho &lt;- items |&gt; \n  html_elements(\"span\") |&gt; \n  html_text()\n\nministry &lt;- items |&gt; \n  html_elements(\"p\") |&gt; \n  html_text()\n\nlinks &lt;- items |&gt; \n  html_elements(\"a\") |&gt; \n  html_attr(\"href\")\n\nデータフレームにまとめる\n\ndf &lt;- tibble::tibble(\n  白書名 = hakusho, \n  省庁名 = ministry, \n  リンク = links\n)\n\n\n詳細\nブラウザ上でHTMLコードを下の方まで見てみるとわかるのですが、白書の情報は&lt;main role=\"main\"&gt;から&lt;/main&gt;の間に含まれていることがわかります。さらに、画像をジーっと見てみると、欲しい要素は\n\nspanで囲まれている部分\npで囲まれている部分\naタグの中のhref\n\nであることがわかります。試しにこれまで説明したコードを用いて取得してみると、\n\nhakusho &lt;- html |&gt; \n  html_elements(\"span\")\n\n\n\n{xml_nodeset (62)}\n [1] &lt;span class=\"egovui-title\"&gt;\\n        ポータル&lt;/span&gt;\n [2] &lt;span class=\"egovui-english-link\"&gt;&lt;a href=\"/en/\" class=\"egovui-textlink- ...\n [3] &lt;span class=\"egovui-label\"&gt;サイト内検索&lt;/span&gt;\n [4] &lt;span class=\"egovui-label\"&gt;行政機関横断検索&lt;/span&gt;\n [5] &lt;span class=\"egovui-search \"&gt;\\n          &lt;input type=\"text\" name=\"q\" cla ...\n [6] &lt;span&gt;水循環白書&lt;/span&gt;\n [7] &lt;span&gt;年次報告書&lt;/span&gt;\n [8] &lt;span&gt;経済財政白書&lt;/span&gt;\n [9] &lt;span&gt;原子力白書&lt;/span&gt;\n[10] &lt;span&gt;防災白書&lt;/span&gt;\n[11] &lt;span&gt;高齢社会白書&lt;/span&gt;\n[12] &lt;span&gt;障害者白書&lt;/span&gt;\n[13] &lt;span&gt;交通安全白書&lt;/span&gt;\n[14] &lt;span&gt;男女共同参画白書&lt;/span&gt;\n[15] &lt;span&gt;年次報告&lt;/span&gt;\n[16] &lt;span&gt;警察白書&lt;/span&gt;\n[17] &lt;span&gt;犯罪被害者白書&lt;/span&gt;\n[18] &lt;span&gt;年次報告&lt;/span&gt;\n[19] &lt;span&gt;金融庁の１年&lt;/span&gt;\n[20] &lt;span&gt;消費者白書&lt;/span&gt;\n...\n\n\n欲しいのは「水循環白書」みたいな白書名だけですが、&lt;span&gt;の文字など余計な要素も取れてしまいました。中身のテキストだけ抜きたい場合はhtml_text()を使います。\n\nhakusho &lt;- html |&gt; \n  html_elements(\"span\") |&gt; \n  html_text()\n\n\n\n [1] \"\\n        ポータル\"     \"English\"                \"サイト内検索\"          \n [4] \"行政機関横断検索\"       \"\\n          \\n        \" \"水循環白書\"            \n [7] \"年次報告書\"             \"経済財政白書\"           \"原子力白書\"            \n[10] \"防災白書\"              \n\n\n表示しているのは一部ですが、それでも、そもそも余計なものが多いことがわかります。これは、欲しいのが&lt;main&gt;で囲まれている部分であるにもかかわらず、ページ全体からspanを探して拾ってきているためです。\nさらに画像をよーく見ると、mainの中でもpは「各行政機関が～」という文言も含んでしまっていることがわかります。main→pと指定すると、この文言も拾ってきてしまいます。そのため絞り込みとしてはmain、さらにはulにも絞った方が良いということが考えられます3。すなわちmain→ul→pという絞り方です。\nまずは対象をmain→ulに絞っておきます。\n\nitems &lt;- html |&gt; \n  html_element(\"main\") |&gt; \n  html_element(\"ul\")\n\nhtml_elements()もありますが、これは複数形なので要素が多くあり、全部取りたいような場合に使います。今回はmainが1つでその中のulも1つとわかっているので単数形です。\nこの上でitemsを用いて取得します。\n\nhakusho &lt;- items |&gt; \n  html_elements(\"span\") |&gt; \n  html_text()\n\n\n\n [1] \"水循環白書\"       \"年次報告書\"       \"経済財政白書\"     \"原子力白書\"      \n [5] \"防災白書\"         \"高齢社会白書\"     \"障害者白書\"       \"交通安全白書\"    \n [9] \"男女共同参画白書\" \"年次報告\"        \n\n\nこれも表示しているのは一部ですが、しっかりとれています。同様の手順で要素を確認しつつ取得を進めます。\n\nministry &lt;- items |&gt; \n  html_elements(\"p\") |&gt; \n  html_text()\n\nlinks &lt;- items |&gt; \n  html_elements(\"a\") |&gt; \n  html_attr(\"href\")\n\nこれで全53件分そろいました。最後にデータフレーム化して終了です。\n\ndf &lt;- tibble(\n  白書名 = hakusho, \n  省庁名 = ministry, \n  リンク = links\n)\n\n\n\n\n\n    \n\n    \n\n    \n    \n    \n      \n        \n        \n              \n                白書名\n                省庁名\n                リンク\n              \n        \n        \n        \n                \n                  水循環白書\n                  内閣官房\n                  https://www.cas.go.jp/jp/seisaku/mizu_junkan/materials/materials/white_paper.html\n                \n                \n                  年次報告書\n                  人事院\n                  https://www.jinji.go.jp/kouho_houdo/koumuinhakusyo.html\n                \n                \n                  経済財政白書\n                  内閣府\n                  https://www5.cao.go.jp/keizai3/whitepaper.html#keizai\n                \n                \n                  原子力白書\n                  内閣府\n                  http://www.aec.go.jp/jicst/NC/about/hakusho/index.htm\n                \n                \n                  防災白書\n                  内閣府\n                  http://www.bousai.go.jp/kaigirep/hakusho/index.html\n                \n                \n                  高齢社会白書\n                  内閣府\n                  https://www8.cao.go.jp/kourei/whitepaper/index-w.html\n                \n        \n      \n    \n\n\n\nいい感じに整理できました。\nウェブサイトからたくさんの情報を繰り返し同じ動作で集めなければならないとき、役に立ちそうですね！\nおまけもおまけで、もはや本題には関係ありませんが、厳密に白書と明記されているもののみをとりたいならデータフレームにフィルタリングしてしまいましょう。\n\ndf_hakusho &lt;- df |&gt; \n  filter(str_detect(hakusho, \"白書\"))\n\n\n\n\n\n    \n\n    \n\n    \n    \n    \n      \n        \n        \n              \n                白書名\n                省庁名\n                リンク\n              \n        \n        \n        \n                \n                  水循環白書\n                  内閣官房\n                  https://www.cas.go.jp/jp/seisaku/mizu_junkan/materials/materials/white_paper.html\n                \n                \n                  経済財政白書\n                  内閣府\n                  https://www5.cao.go.jp/keizai3/whitepaper.html#keizai\n                \n                \n                  原子力白書\n                  内閣府\n                  http://www.aec.go.jp/jicst/NC/about/hakusho/index.htm\n                \n                \n                  防災白書\n                  内閣府\n                  http://www.bousai.go.jp/kaigirep/hakusho/index.html\n                \n                \n                  高齢社会白書\n                  内閣府\n                  https://www8.cao.go.jp/kourei/whitepaper/index-w.html\n                \n                \n                  障害者白書\n                  内閣府\n                  https://www8.cao.go.jp/shougai/whitepaper/index-w.html\n                \n        \n      \n    \n\n\n\n「年次報告書」などは抜くことができています。str_detect(変数名, パターン)で対応するものを抜き取ることができます。"
  },
  {
    "objectID": "pages/tips/2025/03/250319_scraping/index.html#footnotes",
    "href": "pages/tips/2025/03/250319_scraping/index.html#footnotes",
    "title": "【スクレイピング】rvestを使ってe-Statからファイルを取得する",
    "section": "注",
    "text": "注\n\n\nChromeではサービスが終了したみたいです。Firefoxではまだあるようです。↩︎\n先述のJavaScriptが使われているページで実行できないという課題↩︎\n絞り込み方はこれ以外にもいろいろあると思います。↩︎"
  },
  {
    "objectID": "pages/tips/2025/05/250525_fixes/index.html#はじめに",
    "href": "pages/tips/2025/05/250525_fixes/index.html#はじめに",
    "title": "【パッケージ開発】fixesでイベントスタディを効率化",
    "section": "はじめに",
    "text": "はじめに\n本ページでは、two-way fixed effects (TWFE)モデルのDifference-in-Differences (DiD)におけるイベントスタディを行うパッケージ、fixesについて説明します。\n僕が今年（2025年）の年始から地道に作成してきたパッケージで、初のパッケージ作成で試行錯誤、紆余曲折を経ながらアップデートを重ねてきました。\n\n\n\n\n\n\nNoteご意見待ってます\n\n\n\n実戦経験が足りないパッケージなので、挙動がおかしかったり、こういう機能にも対応してほしいということがあれば、ページ下のコメントからどしどしお寄せください。こぢんまりしたページなので、いただいたものは余裕で全部対応できると思います。\n\n\nこれまでは処置個体において処置タイミングが同一のベーシックなイベントスタディにのみ対応していましたが、アップデートを経て各個体で処置タイミングが異なる、いわゆるStaggered DiDにおけるイベントスタディにも対応しました。\n果たしてあらゆるケースに対応できているか、個人で開発しているパッケージとしては不安ではありますが、いくつかのデータセットでテストした分には問題なかったので、そのテストコードと併せて解説していきます。"
  },
  {
    "objectID": "pages/tips/2025/05/250525_fixes/index.html#使用するパッケージ",
    "href": "pages/tips/2025/05/250525_fixes/index.html#使用するパッケージ",
    "title": "【パッケージ開発】fixesでイベントスタディを効率化",
    "section": "使用するパッケージ",
    "text": "使用するパッケージ\n使用するのはfixesです。インストールは以下のコマンドでできます。\ninstall.packages(\"fixes\")\n\n# or\n# pak::pak(\"fixes\")\nです。開発版はGitHubからインストールできます。\n# install.packages(\"pak\")\npak::pak(\"yo5uke/fixes\")"
  },
  {
    "objectID": "pages/tips/2025/05/250525_fixes/index.html#準備",
    "href": "pages/tips/2025/05/250525_fixes/index.html#準備",
    "title": "【パッケージ開発】fixesでイベントスタディを効率化",
    "section": "準備",
    "text": "準備\nパッケージを読み込んで、デモに使うデータを準備します。\n\nlibrary(fixes)\nlibrary(tidyverse)\n\nデータはfixestパッケージで用意されているbase_didおよびbase_staggと、MixtapeのStaggered DiDの章で使用されているcastleを使います。\ndf_castleに関しては、Mixtape内で行われている処理をし、変数を使用するものに絞っておきます1。\nまた、少し後で述べる通り、never-treatedユニットの扱いに注意しながら、year_treatedとtime_to_treatmentを作成しておきます。\n\nlibrary(fixest)\n\ncastle &lt;- haven::read_dta(\n  \"https://github.com/scunning1975/mixtape/raw/master/castle.dta\"\n)\n\n# 以下Mixtape参考\n# fmt: skip\ndropped_vars &lt;- c(\n  \"r20004\", \"r20014\", \"r20024\", \"r20034\", \"r20044\", \"r20054\", \"r20064\",\n  \"r20074\", \"r20084\", \"r20094\", \"r20101\", \"r20102\", \"r20103\", \"r20104\",\n  \"trend_9\", \"trend_46\", \"trend_49\", \"trend_50\", \"trend_51\"\n)\n\nregion &lt;- castle |&gt;\n  select(starts_with(\"r20\")) |&gt;\n  names() |&gt;\n  setdiff(dropped_vars)\n\ndf_castle &lt;- castle |&gt;\n  select(state, sid, year, treatment_date, l_homicide, all_of(region), popwt) |&gt;\n  mutate(\n    is_treated = if_else(!is.na(treatment_date), 1, 0),\n    year_treated = if_else(is_treated == 1, treatment_date, 10000L),\n    time_to_treatment = if_else(is_treated == 1, year - treatment_date, -1000L)\n  )\n\n各データフレームは以下のような感じになっています。先頭の15行を見てみましょう。\n\nbase_didbase_staggdf_castle\n\n\n\n\n\n\n    \n\n    \n\n    \n    \n    \n      \n        \n        \n              \n                y\n                x1\n                id\n                period\n                post\n                treat\n              \n        \n        \n        \n                \n                  2.87530627\n                  0.53653768\n                  1\n                  1\n                  0\n                  1\n                \n                \n                  1.86065272\n                  -3.04318942\n                  1\n                  2\n                  0\n                  1\n                \n                \n                  0.09416524\n                  5.57684387\n                  1\n                  3\n                  0\n                  1\n                \n                \n                  3.78147485\n                  -2.83005866\n                  1\n                  4\n                  0\n                  1\n                \n                \n                  -2.55819959\n                  -5.04435440\n                  1\n                  5\n                  0\n                  1\n                \n                \n                  1.72873240\n                  -0.63638485\n                  1\n                  6\n                  1\n                  1\n                \n                \n                  6.28423629\n                  -2.12988365\n                  1\n                  7\n                  1\n                  1\n                \n                \n                  4.76688778\n                  3.49185577\n                  1\n                  8\n                  1\n                  1\n                \n                \n                  5.34753392\n                  0.83798615\n                  1\n                  9\n                  1\n                  1\n                \n                \n                  4.95146934\n                  0.63388904\n                  1\n                  10\n                  1\n                  1\n                \n                \n                  -4.25798295\n                  -5.26462514\n                  2\n                  1\n                  0\n                  1\n                \n                \n                  0.60611067\n                  -3.70483485\n                  2\n                  2\n                  0\n                  1\n                \n                \n                  5.61637038\n                  -0.21742509\n                  2\n                  3\n                  0\n                  1\n                \n                \n                  -6.16941931\n                  -2.02699419\n                  2\n                  4\n                  0\n                  1\n                \n                \n                  0.71186875\n                  0.01140001\n                  2\n                  5\n                  0\n                  1\n                \n        \n      \n    \n\n\n\n\n\n\n\n\n\n    \n\n    \n\n    \n    \n    \n      \n        \n        \n              \n                id\n                year\n                year_treated\n                time_to_treatment\n                treated\n                treatment_effect_true\n                x1\n                y\n              \n        \n        \n        \n                \n                  90\n                  1\n                  2\n                  -1\n                  1\n                  0\n                  -1.09470213\n                  0.01722971\n                \n                \n                  89\n                  1\n                  3\n                  -2\n                  1\n                  0\n                  -3.71006765\n                  -4.58084528\n                \n                \n                  88\n                  1\n                  4\n                  -3\n                  1\n                  0\n                  2.52744015\n                  2.73817174\n                \n                \n                  87\n                  1\n                  5\n                  -4\n                  1\n                  0\n                  -0.72042631\n                  -0.65103066\n                \n                \n                  86\n                  1\n                  6\n                  -5\n                  1\n                  0\n                  -3.67116779\n                  -5.33381664\n                \n                \n                  85\n                  1\n                  7\n                  -6\n                  1\n                  0\n                  -0.31521367\n                  0.49562631\n                \n                \n                  84\n                  1\n                  8\n                  -7\n                  1\n                  0\n                  0.32856334\n                  -1.58378245\n                \n                \n                  83\n                  1\n                  9\n                  -8\n                  1\n                  0\n                  -0.08850915\n                  -1.33526257\n                \n                \n                  82\n                  1\n                  10\n                  -9\n                  1\n                  0\n                  -2.34951611\n                  -1.35136167\n                \n                \n                  81\n                  1\n                  10000\n                  -1000\n                  0\n                  0\n                  2.31318716\n                  1.77231442\n                \n                \n                  80\n                  1\n                  10000\n                  -1000\n                  0\n                  0\n                  -0.56561061\n                  -0.78198640\n                \n                \n                  79\n                  1\n                  10000\n                  -1000\n                  0\n                  0\n                  -3.15996610\n                  -4.78190340\n                \n                \n                  78\n                  1\n                  10000\n                  -1000\n                  0\n                  0\n                  -7.24864781\n                  -8.69961178\n                \n                \n                  77\n                  1\n                  10000\n                  -1000\n                  0\n                  0\n                  1.32056216\n                  1.67147189\n                \n                \n                  76\n                  1\n                  10000\n                  -1000\n                  0\n                  0\n                  -1.68121120\n                  -1.85575812\n                \n        \n      \n    \n\n\n\n\n\n\n\n\n\n    \n\n    \n\n    \n    \n    \n      \n        \n        \n              \n                state\n                sid\n                year\n                treatment_date\n                l_homicide\n                r20001\n                r20002\n                r20003\n                r20011\n                r20012\n                r20013\n                r20021\n                r20022\n                r20023\n                r20031\n                r20032\n                r20033\n                r20041\n                r20042\n                r20043\n                r20051\n                r20052\n                r20053\n                r20061\n                r20062\n                r20063\n                r20071\n                r20072\n                r20073\n                r20081\n                r20082\n                r20083\n                r20091\n                r20092\n                r20093\n                popwt\n                is_treated\n                year_treated\n                time_to_treatment\n              \n        \n        \n        \n                \n                  Alabama\n                  1\n                  2000\n                  2006\n                  2.027356\n                  0\n                  0\n                  1\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  4499293.0\n                  1\n                  2006\n                  -6\n                \n                \n                  Alabama\n                  1\n                  2001\n                  2006\n                  2.164867\n                  0\n                  0\n                  0\n                  0\n                  0\n                  1\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  4499293.0\n                  1\n                  2006\n                  -5\n                \n                \n                  Alabama\n                  1\n                  2002\n                  2006\n                  1.936334\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  1\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  4499293.0\n                  1\n                  2006\n                  -4\n                \n                \n                  Alabama\n                  1\n                  2003\n                  2006\n                  1.919567\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  1\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  4499293.0\n                  1\n                  2006\n                  -3\n                \n                \n                  Alabama\n                  1\n                  2004\n                  2006\n                  1.749841\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  1\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  4499293.0\n                  1\n                  2006\n                  -2\n                \n                \n                  Alabama\n                  1\n                  2005\n                  2006\n                  2.130440\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  1\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  4499293.0\n                  1\n                  2006\n                  -1\n                \n                \n                  Alabama\n                  1\n                  2006\n                  2006\n                  2.079652\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  1\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  4499293.0\n                  1\n                  2006\n                  0\n                \n                \n                  Alabama\n                  1\n                  2007\n                  2006\n                  2.145690\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  1\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  4499293.0\n                  1\n                  2006\n                  1\n                \n                \n                  Alabama\n                  1\n                  2008\n                  2006\n                  2.043598\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  1\n                  0\n                  0\n                  0\n                  4499293.0\n                  1\n                  2006\n                  2\n                \n                \n                  Alabama\n                  1\n                  2009\n                  2006\n                  1.938684\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  1\n                  4499293.0\n                  1\n                  2006\n                  3\n                \n                \n                  Alabama\n                  1\n                  2010\n                  2006\n                  1.747940\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  4499293.0\n                  1\n                  2006\n                  4\n                \n                \n                  Alaska\n                  2\n                  2000\n                  2005\n                  1.491518\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  651473.2\n                  1\n                  2005\n                  -5\n                \n                \n                  Alaska\n                  2\n                  2001\n                  2005\n                  1.846246\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  651473.2\n                  1\n                  2005\n                  -4\n                \n                \n                  Alaska\n                  2\n                  2002\n                  2005\n                  1.665124\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  651473.2\n                  1\n                  2005\n                  -3\n                \n                \n                  Alaska\n                  2\n                  2003\n                  2005\n                  1.823279\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  0\n                  651473.2\n                  1\n                  2005\n                  -2\n                \n        \n      \n    \n\n\n\n\n\n\nbase_staggに関して、year_treatedが10000、time_to_treatmentが-1000となっているユニットがありますが、これは処置を受けないユニット（never-treated）を示しています。\nfixesが内部的に使用しているfixest::sunab()関数は、year_treatedにデータのyearの範囲外にある大きな値（ここでは10000）を設定することで、これらを自動的にnever-treatedとして認識し、参照グループ（対照群）として扱います。time_to_treatmentにも同様に極端に小さい負の値（-1000）を設定しています。\nこれは、Staggered DIDにおいてnever-treatedのユニットの値をNAにしてしまうと、推定から完全に除外されてしまい、処置群と比較する対照群が失われてしまうためです。Never-treatedは処置効果を識別するための重要な比較対象なので、データに含める必要があります。\n\n# never-treatedの確認\nbase_stagg |&gt; \n  filter(year_treated == 10000) |&gt; \n  select(id, year, year_treated, time_to_treatment, treated) |&gt; \n  head()\n\n  id year year_treated time_to_treatment treated\n1 81    1        10000             -1000       0\n2 80    1        10000             -1000       0\n3 79    1        10000             -1000       0\n4 78    1        10000             -1000       0\n5 77    1        10000             -1000       0\n6 76    1        10000             -1000       0\n\n\n\n\n\n\n\n\nTipNever-treatedユニットの扱いについて\n\n\n\nStaggered DIDのデータセットをご自分で用意される場合も、never-treatedのユニットには同様の処理が必要です：\n# 例：処置年がNAのユニットをnever-treatedとして設定\ndf &lt;- df |&gt; \n  mutate(\n    year_treated = if_else(\n      is.na(year_treated),\n      max(year, na.rm = TRUE) + 1000,  # または10000など\n      year_treated\n    ),\n    time_to_treatment = if_else(\n      year_treated &gt; max(year),  # never-treatedの条件\n      -1000,\n      year - year_treated\n    )\n  )\nポイント：year_treatedはデータの時間範囲外の大きな値（例：10000）、time_to_treatmentは極端に小さい負の値（例：-1000）を設定します。これにより、fixesの内部処理（fixest）が適切にnever-treatedを認識します。"
  },
  {
    "objectID": "pages/tips/2025/05/250525_fixes/index.html#run_es",
    "href": "pages/tips/2025/05/250525_fixes/index.html#run_es",
    "title": "【パッケージ開発】fixesでイベントスタディを効率化",
    "section": "run_es()",
    "text": "run_es()\n基本的な使い方と一緒にパッケージについて説明していきます。関数はイベントスタディを実行するrun_es()関数とイベントスタディをggplotベースでプロットするplot_es()です。\nひとまず、run_es()の基本的な引数を説明します。\nrun_es(\n  data,\n  outcome,\n  treatment,\n  time,\n  timing,\n  fe = NULL,\n  lead_range = NULL,\n  lag_range = NULL,\n  covariates = NULL,\n  cluster = NULL,\n  weights = NULL,\n  baseline = -1L,\n  interval = 1,\n  time_transform = FALSE,\n  unit = NULL,\n  staggered = FALSE,\n  method = c(\"classic\", \"sunab\"),\n  conf.level = 0.95,\n  vcov = \"HC1\",\n  vcov_args = list()\n)\n\n\n\n\n\n\n\n引数\n説明\n\n\n\n\ndata\nパネルデータを含むデータフレーム\n\n\noutcome\n結果変数（変数名または式、例：log(y)のように記述）\n\n\ntreatment\n処置変数（0/1または論理値）。method = \"classic\"の場合のみ使用\n\n\ntime\n時間変数（数値型またはDate型）\n\n\ntiming\nclassicの場合：処置タイミング（全ユニット共通の数値/Dateまたはstaggered = TRUE時は変数名）。sunabの場合：処置採用時点を示す変数\n\n\nfe\n固定効果の指定（片側式、例：~ id + year）。固定効果なしの場合はNULL\n\n\nlead_range, lag_range\n処置前後の期間範囲を指定する整数。NULLの場合は自動決定\n\n\ncovariates\n追加の共変量（片側式、例：~ x1 + log(x2)）\n\n\ncluster\nクラスター指定（片側式~ id + year、列名の文字列、またはnrow(data)の長さのベクトル）\n\n\nweights\n観測ウェイト（変数名/片側式またはnrow(data)の長さの数値ベクトル）\n\n\nbaseline\nベースライン期間（デフォルト：-1）。“classic”と”sunab”の両方で、参照期間として結果から除外される\n\n\ninterval\n時間変数の間隔（デフォルト：1。Date型の場合は内部で無視される）\n\n\ntime_transform\nTRUEの場合、ユニット内で連続した整数時間を作成\n\n\nunit\nユニット識別変数（time_transform = TRUEの場合は必須。指定時はメタデータにも使用）\n\n\nstaggered\nTRUEの場合、timing変数を使用（classicの場合）またはsunabで利用\n\n\nmethod\n\"classic\"または\"sunab\"を指定（デフォルト：\"classic\"）\n\n\nconf.level\n信頼水準（デフォルト：0.95）。数値ベクトルで複数指定可能\n\n\nvcov\n分散共分散行列の種類。fixest::vcov()またはbroom::tidy(vcov = ...)に渡される（デフォルト：\"HC1\"）\n\n\nvcov_args\nfixest::vcov()に渡す追加引数のリスト\n\n\n\n文字で見てもわかりにくいと思うので、読み込んだデータを使って関数を回してみましょう。\n\n通常のDiDにおけるイベントスタディ\n\nes &lt;- run_es(\n  data = base_did,\n  outcome = y,\n  treatment = treat,\n  time = period,\n  timing = 6,\n  fe = ~ id + period\n)\n\n基本的なケースであればこれくらいの指定で済みます。プロットは後のセクションでまとめて載せます。\n\n\nStaggered DiD 1\n\nes_stagg1 &lt;- run_es(\n  data = base_stagg,\n  outcome = y,\n  treatment = treated,\n  time = year,\n  timing = year_treated,\n  fe = ~ id + year,\n  staggered = TRUE,\n  method = \"sunab\"\n)\n\n先ほどと違う点は、staggeredがTRUE、methodが”sunab”、timingが具体的な数値ではなく、処置年を示す変数を指定しているところです。\n“sunab”はSun and Abraham (2021)で提唱されている方法を指し、Staggered DiDにおけるイベントスタディで有用です。裏ではfixest::sunab()関数を使っています。\n\n\nStaggered DiD 2\n\n# 共変量の変数を式の形にしておく\ncovariates &lt;- as.formula(paste(\"~\", paste(region, collapse = \"+\")))\n\nes_stagg2 &lt;- run_es(\n  data = df_castle,\n  outcome = l_homicide,\n  treatment = is_treated,\n  time = year,\n  timing = year_treated,\n  fe = ~ state + year,\n  covariates = covariates,\n  cluster = ~ sid,\n  weights = ~ popwt,\n  baseline = 0,\n  staggered = TRUE,\n  vcov = \"cluster\"\n)\n\n今回の例は共変量が多いので事前にas.formula()を使って処理してしまっていますが、関数内でcovariates = ~ cov1 + cov2のような指定の仕方で問題ありません。\nまた、ここではvcovも”cluster”に指定して、sidでクラスタリングした標準誤差を計算しています。vcovについては、?fixest::feols()で詳細を確認できます。"
  },
  {
    "objectID": "pages/tips/2025/05/250525_fixes/index.html#plot_es",
    "href": "pages/tips/2025/05/250525_fixes/index.html#plot_es",
    "title": "【パッケージ開発】fixesでイベントスタディを効率化",
    "section": "plot_es()",
    "text": "plot_es()\nこだわりがなければ、plot_es(es)の程度の書き方でプロットを出力することができます。引数の説明は後に回して、一旦先ほどのイベントスタディの結果をプロットしてみましょう。\n\n通常のDiDにおけるイベントスタディ\n\nplot_es(es)\n\n\n\n\n\n\n\n\n後の2つもそうですが、ベースラインがデフォルトのままなので、処置前年（-1）が抜けて値が0をとっています。\n\n\nStaggered DiD 1\n\nplot_es(es_stagg1)\n\n\n\n\n\n\n\n\n\n\nStaggered DiD 2\n\nplot_es(es_stagg2)\n\n\n\n\n\n\n\n\nStaggeredの方もいい感じにプロットできています。この図はMixtape内でlead変数とlag変数を手作業で作って実装しプロットされていますが、その図と見比べても同じ推移が示されていることがわかります。\n\n\n使い方\n基本的には上の使い方で十分ですが、ggplotベースで作ったこともあり、柔軟な対応も可能です。\nplot_es(\n  data,\n  type = \"ribbon\",\n  vline_val = 0,\n  vline_color = \"#000\",\n  hline_val = 0,\n  hline_color = \"#000\",\n  linewidth = 1,\n  pointsize = 2,\n  alpha = 0.2,\n  barwidth = 0.2,\n  color = \"#B25D91FF\",\n  fill = \"#B25D91FF\"\n)\n\ndata：run_es()で作成した結果のデータフレーム\ntype：ribbonとerrorbarが指定可能\nvline_val：縦の破線の位置（デフォルトは0）\nvline_color：縦の破線の色（デフォルトは#000（黒））\nhline_val：横の破線の位置（デフォルトは0）\nhline_color：縦の破線の色（デフォルトは#000（黒））\nlinewidth：折れ線の太さ（デフォルトは1）\npointsize：点の大きさ（デフォルトは2）\nalpha：リボンの透明度（デフォルトは0.2）\ncolor：線と点の色（デフォルトは#B25D91FF（ピンク））\nfillリボンの色（デフォルトは#B25D91FF（ピンク））\n\n\nplot_es()関数内でもある程度自由度をもって設定できます。\n例えばプロットをエラーバーのタイプにしてみましょう。\n\nplot_es(es_stagg2, type = \"errorbar\")\n\n\n\n\n\n\n\n\nさらに色も変えてみます。\n\nplot_es(es_stagg2, type = \"errorbar\", color = \"#000\")\n\n\n\n\n\n\n\n\nリボンタイプとエラーバータイプがあり、さらにそこからある程度の自由度もある点が他のパッケージに対する優位性にもなっています。\nちなみに、ggplotベースということで、ggplotの関数をつなげることも可能です！\n\nplot_es(es_stagg2, type = \"errorbar\", color = \"#000\") +\n  geom_hline(yintercept = .08, color = \"red\") +\n  annotate(\n    \"text\",\n    x = 3,\n    y = -.1,\n    label = \"DD Coefficient = 0.08\\n(s.e. = 0.03)\"\n  )\n\n\n\n\n\n\n\n\nMixtape風に係数を示す水平線と注釈を追加してみました。このようにどんどん要素を追加していくことができます。"
  },
  {
    "objectID": "pages/tips/2025/05/250525_fixes/index.html#plot_es_interactive",
    "href": "pages/tips/2025/05/250525_fixes/index.html#plot_es_interactive",
    "title": "【パッケージ開発】fixesでイベントスタディを効率化",
    "section": "plot_es_interactive()",
    "text": "plot_es_interactive()\nplot_es()で作成したプロットをインタラクティブにする関数も用意しています。plot_es_interactive()です。\nこの関数で表示したプロットは、マウスオーバーで各点の推定値と信頼区間が表示されたり、ズームイン・ズームアウトができたりします。\n論文に載せるための関数ではないものの、結果の確認やコミュニケーションの際に便利かと思います。\n\nplot_es_interactive(es_stagg2)\n\n\n\n\n\nマウスオーバーすると値が表示されます。\nこちらもplot_es()と同様に、引数で色や線の太さなどを指定できますので、いろいろ試してみてください。"
  },
  {
    "objectID": "pages/tips/2025/05/250525_fixes/index.html#おわりに",
    "href": "pages/tips/2025/05/250525_fixes/index.html#おわりに",
    "title": "【パッケージ開発】fixesでイベントスタディを効率化",
    "section": "おわりに",
    "text": "おわりに\nまだまだ開発途上ですが、staggeredまで対応できたので、これからしばらくはブラッシュアップを念頭にアップデートしていこうと思います。\n冒頭にも書きましたが、もし使っていただいて「使いにくい」や「こんな機能が欲しい」等ありましたら、以下のコメントやGitHubのIssuesまでお願いします。"
  },
  {
    "objectID": "pages/tips/2025/05/250525_fixes/index.html#データ出典",
    "href": "pages/tips/2025/05/250525_fixes/index.html#データ出典",
    "title": "【パッケージ開発】fixesでイベントスタディを効率化",
    "section": "🔗 データ出典",
    "text": "🔗 データ出典\nデータ出典：Causal Inference: The Mixtape（Scott Cunnningham, 2021）\nデータはGitHub上で公開されており、以下のリポジトリから入手可能です：\nhttps://github.com/scunning1975/mixtape\nまた、データはMITライセンスのもとで提供されています。"
  },
  {
    "objectID": "pages/tips/2025/05/250525_fixes/index.html#footnotes",
    "href": "pages/tips/2025/05/250525_fixes/index.html#footnotes",
    "title": "【パッケージ開発】fixesでイベントスタディを効率化",
    "section": "注",
    "text": "注\n\n\n参考：Mixtape↩︎"
  },
  {
    "objectID": "pages/tips/2025/06/250613_scraping_pop_by_mesh/index.html#はじめに",
    "href": "pages/tips/2025/06/250613_scraping_pop_by_mesh/index.html#はじめに",
    "title": "【スクレイピング】Rでe-Statのメッシュ人口データファイルを一気に取得する",
    "section": "はじめに",
    "text": "はじめに\n以前の記事でe-Statから境界データ（シェープファイル）をスクレイピングで取得する方法をご紹介しました。\n今回は国勢調査をもとに公開しているメッシュごとの人口データを取得するコードの覚書です。時々実行することがあるので自分は忘れっぽいですし残しておくことにしました。\n詳細は前回とほぼ同じで、URL等が若干異なるくらいです。コードについては以下で詳しめに書いたので、不明点があればご覧下さい。\n\n\n\n\n\n\n【スクレイピング】rvestを使ってe-Statからファイルを取得する"
  },
  {
    "objectID": "pages/tips/2025/06/250613_scraping_pop_by_mesh/index.html#コード",
    "href": "pages/tips/2025/06/250613_scraping_pop_by_mesh/index.html#コード",
    "title": "【スクレイピング】Rでe-Statのメッシュ人口データファイルを一気に取得する",
    "section": "コード",
    "text": "コード\nlibrary(rvest)\n\n# データを保存したいフォルダを指定\nsave_dir &lt;- here::here(\"data/pop_by_mesh\")\n\n# 保存したいフォルダがない場合に作成\nif (!dir.exists(save_dir)) {\n  dir.create(save_dir)\n}\n\nbase_url &lt;- \"https://www.e-stat.go.jp\"\n\nfor (i in 1:8) {\n  url &lt;- paste0(\n    \"https://www.e-stat.go.jp/gis/statmap-search?page=\",\n    i,\n    \"&type=1&toukeiCode=00200521&toukeiYear=2020&aggregateUnit=H\",\n    \"&serveyId=H002005112020&statsId=T001141&datum=2011\"\n  )\n\n  html &lt;- read_html_live(url)\n  Sys.sleep(1)\n\n  links &lt;- html |&gt;\n    html_elements(\"a\") |&gt;\n    html_attr(\"href\")\n\n  csv_links &lt;- links[grepl(\"data\\\\?statsId=T001141\", links)]\n  full_urls &lt;- paste0(base_url, csv_links)\n\n  for (j in seq_along(full_urls)) {\n    code &lt;- sub(\".*code=([0-9]+).*\", \"\\\\1\", csv_links[j])\n    zip_path &lt;- file.path(save_dir, paste0(\"pop_mesh\", code, \".zip\"))\n    txt_path &lt;- file.path(save_dir, paste0(\"pop_mesh\", code, \".txt\"))\n    \n    # 既にファイルがある場合は次のループへ\n    if (file.exists(txt_path)) next\n\n    tryCatch({\n      download.file(full_urls[j], destfile = zip_path, mode = \"wb\")\n      Sys.sleep(1)\n\n      unzip_files &lt;- unzip(zip_path, list = TRUE)$Name\n      unzip(zip_path, exdir = save_dir)\n\n      for (original_name in unzip_files) {\n        if (grepl(\"\\\\.txt$\", original_name, ignore.case = TRUE)) {\n          old_path &lt;- file.path(save_dir, original_name)\n          new_path &lt;- txt_path\n          file.rename(old_path, new_path)\n        }\n      }\n\n      file.remove(zip_path)\n\n    }, error = function(e) {\n      warning(paste(\"エラー：\", full_urls[j]))\n    })\n\n    Sys.sleep(2)\n  }\n}\n最初の\nsave_dir &lt;- here::here(\"data/pop_by_mesh\")\nの部分だけ自分のディレクトリのパスに変えれば、あとはそっくりそのまま実行できると思います。次のifでもしディレクトリがない場合でも作成するようにしている1ので、エクスプローラー上でフォルダを作らなくても使うことができます。\nダウンロードにはまあまあ時間がかかりますが、手作業よりは圧倒的に速いので、機会があれば使ってみてください。"
  },
  {
    "objectID": "pages/tips/2025/06/250613_scraping_pop_by_mesh/index.html#footnotes",
    "href": "pages/tips/2025/06/250613_scraping_pop_by_mesh/index.html#footnotes",
    "title": "【スクレイピング】Rでe-Statのメッシュ人口データファイルを一気に取得する",
    "section": "注",
    "text": "注\n\n\nある場合はスキップするので、わざわざ消さなくても問題ありません。↩︎"
  },
  {
    "objectID": "pages/tips/2025/07/250727_recode/index.html#はじめに",
    "href": "pages/tips/2025/07/250727_recode/index.html#はじめに",
    "title": "recode関数でデータフレームの中身を置き換える",
    "section": "はじめに",
    "text": "はじめに\n今回は{dplyr}パッケージのrecode()関数を紹介します。\n例えばデータフレーム内の変数がカテゴリ変数で、便宜的に数値で表されているような場合、そのまま表に出すことはできないかもしれません。\nそんなときに中身を置き換える手段として使えるのがrecode()関数で、イメージとしてはcase_when()と似ているかもしれません1。\n1度きりの変換であればcase_whenでもあまり労力は変わらないかもしれませんが、何回も繰り返し置き換えたいときは、シンプルで強みを発揮します。"
  },
  {
    "objectID": "pages/tips/2025/07/250727_recode/index.html#使い方",
    "href": "pages/tips/2025/07/250727_recode/index.html#使い方",
    "title": "recode関数でデータフレームの中身を置き換える",
    "section": "使い方",
    "text": "使い方\n\nパッケージ\n{dplyr}に入っているので、{tidyverse}を読み込んでいれば使えます。\n\nlibrary(tidyverse)\n# あるいは\n# library(dplyr)\n\n\n\nデータフレーム\n今回は以下のようなデータフレームを想定します。\n\ndf &lt;- tibble(\n  id = 1:4,\n  sex = rep(1:2, times = 2)\n)\n\n\n\n\n\n表 1: テーブルの例\n\n\n\n\n\n    \n\n    \n\n    \n    \n    \n      \n        \n        \n              \n                id\n                sex\n              \n        \n        \n        \n                \n                  1\n                  1\n                \n                \n                  2\n                  2\n                \n                \n                  3\n                  1\n                \n                \n                  4\n                  2\n                \n        \n      \n    \n\n\n\n\n\n\n超絶簡単なデータフレームです。4人のIDと性別が1, 2の表記で含まれているだけです。ここで1を男性、2を女性とします。\n\n\n対応表を作る\nこれを表に起こしたいとき、たとえばそのままtinytable::tt()で表示したとしたら、 表 1 がそのまま出てきてしまい、数字が誰を、何を表しているのかがわかりませんよね。\nそこで、あらかじめ対応表を作って置きます。\n\nid_map &lt;- c(\n  \"1\" = \"Michael\",\n  \"2\" = \"Emily\",\n  \"3\" = \"John\",\n  \"4\" = \"Jessica\"\n)\n\nsex_map &lt;- c(\n  \"1\" = \"Male\",\n  \"2\" = \"Female\"\n)\n\nc()の中に、=の左にデータフレーム内の表記を、右に表示したい表記を書いていきます。\n今回はIDと性別を両方書き換えたいので、2種類の対応関係を示したベクトルを作成しています。\n\n\nrecode()を使う\nこの対応表をもとに、recode()関数を使っていきます。使う際は、mutate()と組み合わせます。\n\ndf_recode &lt;- df |&gt;\n  mutate(\n    id = recode(id, !!!id_map),\n    sex = recode(sex, !!!sex_map)\n  )\n\n\n\n\n\n表 2: recode()を使用した表\n\n\n\n\n\n    \n\n    \n\n    \n    \n    \n      \n        \n        \n              \n                id\n                sex\n              \n        \n        \n        \n                \n                  Michael\n                  Male\n                \n                \n                  Emily\n                  Female\n                \n                \n                  John\n                  Male\n                \n                \n                  Jessica\n                  Female\n                \n        \n      \n    \n\n\n\n\n\n\nしっかり置き換えられていますね。\n!!!という表記は見慣れないと思いますが、id_mapやsex_mapで作成したベクトルをバラバラにして渡すということです2。recode(sex, \"1\" = \"Male\", \"2\" = \"Female\")と同じ働きをします。\nあらかじめ対応関係を表すベクトルを作って置くことで、使いまわすことができ、特に何回も表を作る際に効率化が図れます。"
  },
  {
    "objectID": "pages/tips/2025/07/250727_recode/index.html#おまけ",
    "href": "pages/tips/2025/07/250727_recode/index.html#おまけ",
    "title": "recode関数でデータフレームの中身を置き換える",
    "section": "おまけ",
    "text": "おまけ\n表にするなら、列名も変えたいですよね。そんなときは{purrr}パッケージのset_names()関数を使います。これも{tidyverse}に入っていますので、特に追加でライブラリを読み込む必要はありません。\n\ncol_names &lt;- c(\"名前\", \"性別\")\n\ndf_set_names &lt;- df_recode |&gt;\n  set_names(col_names)\n\n\n\n\n\n表 3: 列名を変更\n\n\n\n\n\n    \n\n    \n\n    \n    \n    \n      \n        \n        \n              \n                名前\n                性別\n              \n        \n        \n        \n                \n                  Michael\n                  Male\n                \n                \n                  Emily\n                  Female\n                \n                \n                  John\n                  Male\n                \n                \n                  Jessica\n                  Female\n                \n        \n      \n    \n\n\n\n\n\n\nあらかじめcol_namesを作成しておきましたが、ここは任意です。set_names()の中に直接書くのも可能です。"
  },
  {
    "objectID": "pages/tips/2025/07/250727_recode/index.html#おわりに",
    "href": "pages/tips/2025/07/250727_recode/index.html#おわりに",
    "title": "recode関数でデータフレームの中身を置き換える",
    "section": "おわりに",
    "text": "おわりに\n今回は表を整えるためのrecode()関数とおまけのset_names()関数をまとめました。\n以前Quartoで論文を書くという記事を書きましたが、論文はLaTeXで書きたい！という方には表だけLaTeXコードにして出力するという方法もありますので、それもまたまとめようかと思います。"
  },
  {
    "objectID": "pages/tips/2025/07/250727_recode/index.html#footnotes",
    "href": "pages/tips/2025/07/250727_recode/index.html#footnotes",
    "title": "recode関数でデータフレームの中身を置き換える",
    "section": "注",
    "text": "注\n\n\nただし、case_when()だと「○○以上○○以下」みたいな条件分岐に対応できるという強みがありますが、今回は想定しません。あくまでもデータフレーム内の値をある別の表記に値 = 値で置き換えるということを想定します。↩︎\nややこしいですが、id_map自体はベクトルなので、ベクトルを渡すのではなく、中身を展開して渡したいということです。↩︎"
  },
  {
    "objectID": "pages/tips/2025/08/250826_xml/index.html#はじめに",
    "href": "pages/tips/2025/08/250826_xml/index.html#はじめに",
    "title": "XMLファイルから情報を抽出する",
    "section": "はじめに",
    "text": "はじめに\n今度は仕事でXMLファイルを扱う機会がやってきました。\nXMLファイルは、データを「タグ」で階層的に記述するテキスト形式のファイルで、構造化された情報を表現・交換するための標準仕様であり、システム間でデータ連携や保存に広く利用されています。\n見たことがない方にはとんとイメージがわかないと思うのですが、XMLは以下のような構造をしています。\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Library&gt;\n  &lt;Book id=\"B001\"&gt;\n    &lt;Title&gt;データ分析入門&lt;/Title&gt;\n    &lt;Author&gt;山田太郎&lt;/Author&gt;\n    &lt;Year&gt;2021&lt;/Year&gt;\n  &lt;/Book&gt;\n  &lt;Book id=\"B002\"&gt;\n    &lt;Title&gt;XML活用ガイド&lt;/Title&gt;\n    &lt;Author&gt;佐藤花子&lt;/Author&gt;\n    &lt;Year&gt;2023&lt;/Year&gt;\n  &lt;/Book&gt;\n  &lt;Magazine id=\"M001\" category=\"Technology\"&gt;\n    &lt;Title&gt;Tech Monthly&lt;/Title&gt;\n    &lt;Issue&gt;2024-08&lt;/Issue&gt;\n  &lt;/Magazine&gt;\n&lt;/Library&gt;\nLibraryの中にBookやMagazineが入っていることがわかります。インデントされているので少しはわかりやすいのではないでしょうか。\nさらにその中にはタイトルや著者等の情報が含まれています。\nこれが簡単なXMLの例です。\nこれがもっと長くずらーっと書かれているものの中から情報を取ってくる作業が仕事で必要になったので、その方法についてまとめたいと思います。"
  },
  {
    "objectID": "pages/tips/2025/08/250826_xml/index.html#準備",
    "href": "pages/tips/2025/08/250826_xml/index.html#準備",
    "title": "XMLファイルから情報を抽出する",
    "section": "準備",
    "text": "準備\n必要なパッケージはxml2です。\n\nlibrary(xml2)\n\nまた、解析に使用するXMLは以下です。著作権の問題で、データはいかにもそれっぽいですが、中身は架空のものに置き換えています。\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Mdevices xmlns=\"http://info.pmda.go.jp/namespace/medical_devices/package_insert\" version=\"1.0\"&gt;\n  &lt;PackageInsertNo&gt;99Z9Z99999999999_1_00_01&lt;/PackageInsertNo&gt;\n  &lt;CompanyIdentifier&gt;999999&lt;/CompanyIdentifier&gt;\n  &lt;DateOfPreparationOrRevisionArray&gt;\n    &lt;DateOfPreparationOrRevisionDetail id=\"初版\"&gt;\n      &lt;YearMonth&gt;2025-08&lt;/YearMonth&gt;\n      &lt;Version&gt;1.0&lt;/Version&gt;\n      &lt;ReasonForRevision&gt;新規作成&lt;/ReasonForRevision&gt;\n    &lt;/DateOfPreparationOrRevisionDetail&gt;\n  &lt;/DateOfPreparationOrRevisionArray&gt;\n  &lt;ApprovalEtcArray&gt;\n    &lt;ApprovalEtcDetail&gt;\n      &lt;ApprovalAndLicenseNo approvalType=\"1\"&gt;99Z9Z99999999999&lt;/ApprovalAndLicenseNo&gt;\n      &lt;ApprovalBrandNameDetail&gt;\n        &lt;ApprovalBrandName id=\"BRD_ApprovalBrandName_01\"&gt;サンプルデバイスα&lt;/ApprovalBrandName&gt;\n        &lt;AccessoriesOrCompositionArticle&gt;架空データ&lt;/AccessoriesOrCompositionArticle&gt;\n        &lt;ApprovalBrandNameReading&gt;さんぷるでばいすあるふぁ&lt;/ApprovalBrandNameReading&gt;\n      &lt;/ApprovalBrandNameDetail&gt;\n      &lt;DoNotReuse&gt;No&lt;/DoNotReuse&gt;\n    &lt;/ApprovalEtcDetail&gt;\n  &lt;/ApprovalEtcArray&gt;\n  &lt;CategoryAndGeneralName&gt;\n    &lt;Category&gt;A9999&lt;/Category&gt;\n    &lt;GeneralName&gt;\n      &lt;PrimaryGeneralNameDetail&gt;\n        &lt;PrimaryGeneralName id=\"GNN_Main_PrimaryGeneralName\"&gt;架空一般医療機器&lt;/PrimaryGeneralName&gt;\n        &lt;JMDNCode&gt;99999999&lt;/JMDNCode&gt;\n        &lt;Classification&gt;2&lt;/Classification&gt;\n      &lt;/PrimaryGeneralNameDetail&gt;\n    &lt;/GeneralName&gt;\n    &lt;DiscernmentOfMaintenanceInstallation&gt;None&lt;/DiscernmentOfMaintenanceInstallation&gt;\n    &lt;DiscernmentOfTheLivingThingOriginEtc&gt;None&lt;/DiscernmentOfTheLivingThingOriginEtc&gt;\n    &lt;TransgenicsMaterial&gt;None&lt;/TransgenicsMaterial&gt;\n  &lt;/CategoryAndGeneralName&gt;\n  &lt;FormAndStructureDetail id=\"HDR_FormAndStructure\"/&gt;\n  &lt;InfoIndicationsOrEfficacy id=\"HDR_InfoIndicationsOrEfficacy\" wordingPatternOfInfoIndicationsOrEfficacy=\"1\"/&gt;\n  &lt;PrecautionsForUseDetail id=\"HDR_PrecautionsForUse\"/&gt;\n  &lt;AManufacturingAndSellingContractorsNameOrANameEtc id=\"HDR_AManufacturingAndSellingContractorsNameOrANameEtc\"&gt;\n    &lt;AManufacturingAndSellingContractorsNameOrANameDetail id=\"HDR_AManufacturingAndSellingContractorsNameOrAName\"&gt;\n      &lt;ANameOfManufacturerEtc&gt;株式会社サンプル医療&lt;/ANameOfManufacturerEtc&gt;\n      &lt;Phonenumber&gt;000-0000-0000&lt;/Phonenumber&gt;\n    &lt;/AManufacturingAndSellingContractorsNameOrANameDetail&gt;\n    &lt;ANameOrAnOverseasNameEtcOfAFactoryArray id=\"HDR_ANameOrAnOverseasNameEtcOfAFactory\"&gt;\n      &lt;ANameOrAnOverseasNameEtcOfAFactoryDetail&gt;\n        &lt;ANameOfManufacturerEtc&gt;サンプル工場&lt;/ANameOfManufacturerEtc&gt;\n        &lt;Phonenumber&gt;000-1111-2222&lt;/Phonenumber&gt;\n        &lt;TheCompanyNameOfSpecificationIntoEnglish&gt;Sample Factory Inc.&lt;/TheCompanyNameOfSpecificationIntoEnglish&gt;\n        &lt;TheCountryCode&gt;888&lt;/TheCountryCode&gt;\n        &lt;NameOfACountry&gt;架空国&lt;/NameOfACountry&gt;\n      &lt;/ANameOrAnOverseasNameEtcOfAFactoryDetail&gt;\n    &lt;/ANameOrAnOverseasNameEtcOfAFactoryArray&gt;\n  &lt;/AManufacturingAndSellingContractorsNameOrANameEtc&gt;\n  &lt;PleaseSeeTechnicalManual&gt;False&lt;/PleaseSeeTechnicalManual&gt;\n&lt;/Mdevices&gt;\nこれをsample.xmlとします。人によってファイルへのパスは異なるかと思いますが、今回はhere::here(\"data/xml_sample/sample.xmlに格納されているとして進めます。\n一応サンプルファイルを以下からダウンロードできるようにしておきました。\nXMLファイル"
  },
  {
    "objectID": "pages/tips/2025/08/250826_xml/index.html#データの取得",
    "href": "pages/tips/2025/08/250826_xml/index.html#データの取得",
    "title": "XMLファイルから情報を抽出する",
    "section": "データの取得",
    "text": "データの取得\nそれでは早速XMLファイルを読み込んで、必要な情報を抽出したいと思います。\n抽出したい情報は、\n\n承認番号（&lt;ApprovalAndLicenseNo&gt;）\n一般名称（&lt;PrimaryGeneralName&gt;）\n日本医療機器名コード（&lt;JMDNCode&gt;）\n\nとします。他のタグについても同様の方法で取得できるので、一旦この3つに絞ります。\nまずはファイルを読み込みましょう。\n\n# ファイルのパスは適宜変更\nxml_sample &lt;- read_xml(here::here(\"data/xml_sample/sample.xml\"))\n\n次に、タグを検索し、該当するものを引っ張ってきます。タグは上の括弧内で記したとおりです。\n\nxml_sample |&gt; \n  xml_find_all(\"//*[local-name()='ApprovalAndLicenseNo']\") |&gt; \n  xml_text()\n\n[1] \"99Z9Z99999999999\"\n\n\nxml_find_all()はXML内の要素を探してくるための関数です。複数ヒットすればすべて返してきますが、xml_find_first()であれば最初の一つを返します。今回はタグは重複がないのでどちらでも同じ結果が返ってきます。\nところで見慣れない書き方が出てきています。//もlocal-nameなどです。これらについて1つずつまとめます。\n\n//\n\nこれはXMLのタグがどの階層にあっても探す、ということです。\n特定の階層のみを探すこともできるのですが、今回は全体から探してきたいのでこれを使います。\n\n*\n\nこれはワイルドカードと呼ばれ、どんな要素でも問わない、ということを示します。\nこの後に条件を指定しているのですが、その条件を満たすあらゆる要素、ということを示すイメージです。\n\n[local-name()=]\n\nここがややこしいのですが、XMLの冒頭2行目にxmlns=\"http://info.pmda.go.jp/namespace/medical_devices/package_insert\"という表記があります。\nこれがあるとこの後に出てくるタグはこれの後に続くことになる、ということを意味します。\n例：http://info.pmda.go.jp/namespace/medical_devices/package_insert/ApprovalAndLicenseNo\nすなわち、一見ApprovalAndLicenseNoでヒットしそうですが、実際はこの例のように長い表記が正しいので、ApprovalAndLicenseNo単体だとヒットしません。\nxmlnsの部分を「名前空間」というのですが、名前空間がない場合でもこの書き方でヒットしますので、これを書いておけば間違いないといった感じです1。\n\n\nややこしい書き方でしたが、これで注目しているタグを引っ張ってこれます。\n最後にxml_text()で、タグの中身のテキストを取得でき、今回であれば99Z9Z99999999999が表示できています。\nXMLファイルから情報を取得する方法については以上です。"
  },
  {
    "objectID": "pages/tips/2025/08/250826_xml/index.html#ファイルを巡回してデータフレームを作る",
    "href": "pages/tips/2025/08/250826_xml/index.html#ファイルを巡回してデータフレームを作る",
    "title": "XMLファイルから情報を抽出する",
    "section": "ファイルを巡回してデータフレームを作る",
    "text": "ファイルを巡回してデータフレームを作る\n複数のXMLファイルを巡回して、同じ要素を引っ張ってきたいことがありますよね。\nその方法についてもまとめます。今回はXMLファイルが2つ、here::here(\"data/xml_sample\")内にあると仮定します。\n\n# `tibble()`や`map_dfr()`のため\nlibrary(tidyverse)\n\nxml_files &lt;- list.files(here::here(\"data/xml_sample\"), pattern = \"*.xml$\", \n                        full.names = TRUE)\n\nextract_info &lt;- function(fp) {\n  doc &lt;- read_xml(fp)\n  \n  tibble(\n    承認番号 = xml_text(xml_find_all(doc, \"//*[local-name()='ApprovalAndLicenseNo']\")), \n    一般名称 = xml_text(xml_find_all(doc, \"//*[local-name()='PrimaryGeneralName']\")), \n    日本医療機器名コード = xml_text(xml_find_all(doc, \"//*[local-name()='JMDNCode']\"))\n  )\n}\n\ndf &lt;- map_dfr(xml_files, extract_info)\nprint(df)\n\n# A tibble: 2 × 3\n  承認番号         一般名称          日本医療機器名コード\n  &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;               \n1 99Z9Z99999999999 架空一般医療機器  99999999            \n2 88Y8Y88888888888 架空一般医療機器B 88888888            \n\n\nポイントをまとめます。\n\nlist.files()でディレクトリ内のXMLファイルのファイル名（パス込み）を取得します。\n\nワイルドカード*が使われています。前が何であれ、.xmlという条件にマッチする要素を取得するということです。\nまた、$はそれで終わるということを指します。.xml.csvみたいに、.xmlの後に別の要素が続くものは取得しないということです。\n\nfunctionで要素をデータフレームに入れる関数を作ります。\n\ndocに読み込んだXMLを格納し、そこからこれまでに見てきた方法で要素を抽出し、tibble（要はデータフレーム）の各列に格納します。\nパイプを使っていないので関数の出てくる順が先ほどと逆ですが、doc |&gt; xml_find_all() |&gt; xml_text()の流れと同じです。\n\nmap_dfr()で順番に処理しデータフレームを作成\n\nそもそもmap()関数はリストやベクトルに対して関数を適用するものです。\nmap_dfr()のdfrはdata frame row-bindの略で、map()の結果を行方向に結合することを指します。\nすなわち、各ファイルを読み込んで要素を抽出、1行3列（今回の場合）のデータフレームを作成し、それをどんどん下に結合していくというイメージです。\n\n\nちなみにforループでもできますが、そちらは今回は省略します。"
  },
  {
    "objectID": "pages/tips/2025/08/250826_xml/index.html#おわりに",
    "href": "pages/tips/2025/08/250826_xml/index.html#おわりに",
    "title": "XMLファイルから情報を抽出する",
    "section": "おわりに",
    "text": "おわりに\n今回はXMLファイルの扱い方について取り上げました。\n私は繰り返し処理までこれからやることになりそうなので、出番が増えそうです。\nご参考になれば幸いです。"
  },
  {
    "objectID": "pages/tips/2025/08/250826_xml/index.html#footnotes",
    "href": "pages/tips/2025/08/250826_xml/index.html#footnotes",
    "title": "XMLファイルから情報を抽出する",
    "section": "注",
    "text": "注\n\n\n名前空間がない場合は//ApprovalAndLicenseNoでもヒットします。↩︎"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#はじめに",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#はじめに",
    "title": "DuckDBをRで使う",
    "section": "はじめに",
    "text": "はじめに\nRで大量のデータを扱う際、メモリ制限やパフォーマンスの問題に直面することがあります。そんなとき、軽量で高速な組み込み型のデータベースであるDuckDBを利用することで、効率的にデータ操作が可能になります。本記事では、RでDuckDBを使用する方法について解説します。"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#duckdbとは",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#duckdbとは",
    "title": "DuckDBをRで使う",
    "section": "DuckDBとは",
    "text": "DuckDBとは\nDuckDBは、組み込み型のSQLデータベースであり、特に分析ワークロードに最適化されています。SQLiteのように軽量でありながら、大規模なデータセットを効率的に処理できる点が特徴です。DuckDBは、列指向ストレージを採用しており、分析クエリのパフォーマンスが向上します。\nちなみに組み込み型データベースとは、アプリケーションに組み込まれて動作するデータベースのことを指します。サーバー型のデータベースとは異なり、外部のデータベースサーバーを必要とせず、アプリケーション内で直接データベース操作が可能です。すなわちR上で完結するということです。\n列指向については、ブログでparquetを扱った際に少し触れています。以下もご覧ください。簡潔に言うと、列指向データベースは、データを列ごとに格納するため、特定の列に対するクエリが高速に処理されるという特徴があります。\n\n\n\n\n\n\nParquetファイルについて調べてみる"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#duckdbのインストール",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#duckdbのインストール",
    "title": "DuckDBをRで使う",
    "section": "DuckDBのインストール",
    "text": "DuckDBのインストール\nDuckDBをRで使用するには、duckdbパッケージをインストールします。\n\n# install.packages(\"pak\")\npak::pak(\"duckdb\")\n\nもしくは\n\ninstall.packages(\"duckdb\")"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#duckdbの基本的な使い方",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#duckdbの基本的な使い方",
    "title": "DuckDBをRで使う",
    "section": "DuckDBの基本的な使い方",
    "text": "DuckDBの基本的な使い方\n\nデータベースへの接続\nまずは、DuckDBデータベースに接続します。以下のコードでは、メモリ内データベースに接続していますが、ファイルベースのデータベースを使用することも可能です。\nメモリ内データベースはRセッションが終了すると消えてしまいますが、ファイルベースのデータベースは永続的に保存されます。\nファイルベースのデータベースではディスクにデータが保存されるため、Rセッションを終了してもデータが保持されます。一方、メモリ内データベースはRセッションが終了するとデータが失われてしまいますが、読み書きの速度が速いという利点があります。\n\nlibrary(duckdb)\n\n\n# メモリ内データベースに接続\ncon &lt;- dbConnect(duckdb(), dbdir = \":memory:\")\n\nファイルベースのデータベースに接続する場合は、以下のようにします。\n\n# ファイルベースのデータベースに接続\ncon &lt;- dbConnect(duckdb(), dbdir = here::here(\"data/iris.duckdb\"))\n\nこの方法だと、dataフォルダにiris.duckdbという名前でデータベースファイルが作成されます。.duckdbファイルを置くパスは自由に変更してください。\n\n\nデータの読み込み\n\nSQLを使う場合\nDuckDBは様々なデータ形式をサポートしています。ここでは、CSVファイルを読み込む例を示します。\n\n# CSVファイルを読み込む\ndbExecute(con, \"CREATE TABLE iris AS SELECT * FROM read_csv('data/iris.csv')\")\n\nさて、ここで突然SQL文が出てきましたが、なんとなく単語を見てもらえればわかる通り、read_csv('data/iris.csv')から全ての列を選択（*は全ての列を意味します）して、irisという名前のテーブルを作成（CREATE TABLE iris AS）しています。\nちなみに、僕はSQLはあまりわかりません。いちいち調べないと先ほどのコードも書けないレベルなのですが、この方法をとるメリットを先に説明しておきます。\nこの方法のメリットは、Rに一度もデータを読み込まずに、DuckDBが直接CSVファイルを処理できる点です。 そのため、大規模なCSVでもメモリを無駄に消費せず、高速にテーブルを作成できます。\nまた、CREATE TABLE ... AS SELECT ...という形で書けば、SQLの標準的な構文で柔軟に前処理（列の選択やフィルタリングなど）を行いながら、テーブルを作成できます。\n\n\nRを使う場合\nとはいえ新しくSQLを覚えるのは面倒だしRで書けたらうれしいという僕なので、ここでRを使うことの意義を示します。\nそれは、今提示したコードを皆さんおなじみdplyrを使って実行できる、ということです。\nそれはすなわちdplyrを使って書いたコードをSQLに変換して実行してくれるということを意味しています。\nデータベースやSQLはなんだかよくわからないけれども、dplyrが使えるならうれしいですよね1。\nその場合のコードを見てみましょう。\n\nlibrary(tidyverse)  # `dplyr`だけでもOKです。\n\n\niris_data &lt;- read_csv(here::here(\"data/iris.csv\"))\nduckdb_register(con, iris, \"iris_data\")\n\nまずはデータベースに入れたいデータをread_csv()で読み込みます。ここではdataフォルダにあるiris.csvを読み込んでいます。\n続いてduckdb_register()を使って、iris_dataをirisという名前でデータベースに登録しています。これでデータベース上にirisテーブルが作成されました。\nちなみにファイルベースのデータベースを使いたい場合は、duckdb_register()の代わりにdbWriteTable()を使います。\n\ndbWriteTable(con, \"iris\", iris_data)\n\nこれで.duckdbファイルにirisテーブルが保存されます。\nちなみに、データベースにはテーブルを複数作成できるので、iris以外のデータもも好きな名前でテーブルを追加できます2。\n\n\n\nデータの操作\nところで、データベースを使うメリットのひとつに、遅延評価（lazy evaluation） があります。これは、実際に結果を取り出すまでSQLが実行されない仕組みのことです。\n通常のデータ処理は\nデータの読み込み → 書いた順に処理を実行 → 結果を返す\nという流れですが、遅延評価では\nデータの読み込み → 書いた順に処理を記録 → 最後にまとめて実行（SQL発行） → 結果を返す\nという流れになります。\nこのおかげで、大規模なデータセットでも不要な計算が省かれ、効率的に処理できます。\n\nSQLを使う場合\nSQLを使ってデータを操作する場合、以下のようにクエリを実行します。\n\n# データをクエリする\nresult &lt;- dbGetQuery(con, \"SELECT * FROM iris WHERE Species = 'setosa'\")\n\nこの例では、irisテーブルからSpeciesがsetosaの行を選択しています。\n\n\ndplyrを使う場合\ndplyrを使ってデータを操作する場合、以下のように記述します（おなじみの感じですね）。\n\nresult &lt;- tbl(con, \"iris\") |&gt; \n  filter(Species == \"setosa\") |&gt; \n  collect()\n\ntbl(con, \"iris\")でデータベース上のirisテーブルを参照し、filter()で条件を指定しています。最後にcollect()を使って結果をRのデータフレームとして取得します。\nここで重要なのは、collect()を呼び出すまではSQLは実行されないという点です。filter()などの処理を追加するたびに、裏でSQLクエリが少しずつ組み立てられていき、最後にcollect()を呼び出した時点でまとめて実行されます。\nつまり、collect()を呼び出すまではデータはRに読み込まれず、操作はあくまで「SQLを組み立てているだけ」です。collect()を実行した瞬間に初めてSQLが発行され、結果がRにデータフレームとして取り込まれます。\nデータベースになじみがない方は違和感があるかもしれませんが（かく言う僕もですが）、con自体はデータそのものではなく、DuckDBデータベースへの接続（コネクション）を表すオブジェクトです。\n普段のRではデータフレームを直接操作しますが、ここではまず接続オブジェクトconを通して「このデータベースの中にあるテーブルを参照しますよ」という指示を出します。\nつまり、conはデータの実体ではなく、「データベースへの窓口」や「リモコン」のようなものと考えると分かりやすいです（ChatGPT曰く）。\nとりあえず、collect()の前までは通常のデータ処理と同じようにdplyrの関数を使って操作できるので、慣れ親しんだ方法でデータを扱うことができます。\n\n\n\nテーブルの削除\n追加したテーブルを削除する場合は、以下のようにします。\n\ndbExecute(con, \"DROP TABLE iris\")\n\nこれでirisテーブルがデータベースから削除されます。\nもし安全に削除したい場合は、\n\ndbExecute(con, \"DROP TABLE IF EXISTS iris\")\n\nとすることで、テーブルが存在しない場合でもエラーにならずに処理を続行できます。\n\n\nデータベースからの切断\nデータベースの操作が終わったら、接続を切断します。\n\ndbDisconnect(con, shutdown = TRUE)\n\nshutdown = TRUEを指定すると、メモリ内データベースの場合はデータが消去され、ファイルベースのデータベースの場合は接続が閉じられます。"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#まとめ",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#まとめ",
    "title": "DuckDBをRで使う",
    "section": "まとめ",
    "text": "まとめ\n今回は、RでDuckDBを使用する方法についてまとめました。\nDuckDBは軽量で高速な組み込み型データベースであり、大規模なデータセットを効率的に処理できます。SQLを直接使う方法と、dplyrを使う方法の両方が利用可能であり、遅延評価によりパフォーマンスが向上します。\n最近は仕事ででかいデータを扱うことが増えてきたので、今後もDuckDBを活用していきたいと思います（というか活用し始めています）。ぜひ試しあれ。"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#参考",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#参考",
    "title": "DuckDBをRで使う",
    "section": "参考",
    "text": "参考\n\n\n\n\n\n\nR Client - DuckDB"
  },
  {
    "objectID": "pages/tips/2025/09/250919_duckdb/index.html#footnotes",
    "href": "pages/tips/2025/09/250919_duckdb/index.html#footnotes",
    "title": "DuckDBをRで使う",
    "section": "注",
    "text": "注\n\n\nただ、先ほどのメリットの裏返しで、一度R上でデータを読み込んでからデータベースに送り込むことになるので、メモリを多く消費することと、データが大きいと処理速度が遅くなることには注意してください。↩︎\nとはいえ、プロジェクトごとなどで.duckdbは分けた方が良いとは思います。↩︎"
  },
  {
    "objectID": "pages/tips/2025/10/251011_dev_container/index.html#はじめに",
    "href": "pages/tips/2025/10/251011_dev_container/index.html#はじめに",
    "title": "開発コンテナの環境について",
    "section": "はじめに",
    "text": "はじめに\nVSCodeの開発コンテナは、開発環境をコード化し、再現性のある環境を提供する強力なツールです。\nこれまで本サイトでは開発コンテナを用いた環境構築についていくつかの記事を掲載してきました。しかし、自分にとってはややオーバースペックだった感も否めず、もう少しシンプルにできないかと考えることもありました。\n本記事では改めて開発コンテナを用いた環境構築について検討し、Rの開発環境を構築する際に考慮すべきポイントや、実際の設定例についてまとめていきたいと思います。"
  },
  {
    "objectID": "pages/tips/2025/10/251011_dev_container/index.html#実行環境",
    "href": "pages/tips/2025/10/251011_dev_container/index.html#実行環境",
    "title": "開発コンテナの環境について",
    "section": "実行環境",
    "text": "実行環境\n\nWindows 11\nWSL2 (Ubuntu 24.04)\nDocker Desktop 4.47.0\nVSCode"
  },
  {
    "objectID": "pages/tips/2025/10/251011_dev_container/index.html#開発コンテナを用いるメリット",
    "href": "pages/tips/2025/10/251011_dev_container/index.html#開発コンテナを用いるメリット",
    "title": "開発コンテナの環境について",
    "section": "開発コンテナを用いるメリット",
    "text": "開発コンテナを用いるメリット\n開発コンテナを用いることで、以下のようなメリットがあります。\n\n一貫性のある環境: 開発コンテナはコード化された設定ファイル（Dockerfileやdevcontainer.json）を使用するため、チーム全体で同じ環境を再現できます。\n依存関係の管理: 開発コンテナ内で必要なパッケージやツールをインストールすることで、依存関係の衝突を避けることができます。\n環境の分離: 開発コンテナはホストマシンから独立して動作するため、異なるプロジェクトで異なる環境を簡単に切り替えることができます。\nポータビリティ: 開発コンテナは異なるマシンやOS間で同じ環境を提供できるため、開発者がどこでも同じ環境で作業できます。\nVSCodeとの統合: VSCodeは開発コンテナとシームレスに統合されており、コンテナ内で直接コードを編集、デバッグ、実行できます。\nRStudio Serverの利用: 開発コンテナ内にRStudio Serverをセットアップすることで、ブラウザベースでRの開発が可能になります。\n\nチームで研究・開発を行う際には非常に力を発揮することになりますが、個人で使う場合でも、環境の再現性や依存関係の管理が重要な場合には有用です。"
  },
  {
    "objectID": "pages/tips/2025/10/251011_dev_container/index.html#開発コンテナを用いる際の考慮点",
    "href": "pages/tips/2025/10/251011_dev_container/index.html#開発コンテナを用いる際の考慮点",
    "title": "開発コンテナの環境について",
    "section": "開発コンテナを用いる際の考慮点",
    "text": "開発コンテナを用いる際の考慮点\n開発コンテナを用いる際には、以下のような点を考慮する必要があります。\n\n学習コスト: Dockerや開発コンテナの設定に慣れるまでには時間がかかる場合があります。特に初心者にとっては、最初の設定が難しく感じられることがあります。\n設定の複雑さ: 開発コンテナの設定ファイルが複雑になることがあり、特に多くの依存関係やカスタム設定が必要な場合には管理が難しくなることがあります。\nチームの合意形成: 開発コンテナの使用に関して、チーム全体で合意を形成することが重要です。全員が同じツールやワークフローを使用することで、効率的な開発が可能になります。\n\n特に学習コストに関しては、互いに開発コンテナのメリットを理解していないと高くなってしまい、導入が難しくなることがあると感じています。"
  },
  {
    "objectID": "pages/tips/2025/10/251011_dev_container/index.html#rの開発環境構築例",
    "href": "pages/tips/2025/10/251011_dev_container/index.html#rの開発環境構築例",
    "title": "開発コンテナの環境について",
    "section": "Rの開発環境構築例",
    "text": "Rの開発環境構築例\nRの開発環境をDocker上で手軽に再現できるようにしたのが、rockerプロジェクトです。\nそもそもDockerとは、アプリケーションとその依存関係をコンテナとしてパッケージ化し、どこでも同じ環境で実行できるようにする技術です。\nrockerでは、R本体やTidyverse、RStudioなどをあらかじめ組み込んだイメージが用意されており、Dockerを使えばすぐに「同じ環境」で分析を始められます。\n開発コンテナではこのrockerイメージをベースに設定を行うことで、VSCode上でも安定したRの実行環境を構築できます。\n\nプロジェクトフォルダの用意\nまず、VSCodeで開発コンテナを使用するためのプロジェクトフォルダを用意します。\n任意のフォルダを作成し、その中に.devcontainerという名前のサブフォルダを作成します。ここでは仮にプロジェクトフォルダをworkとすると、次に紹介する2つのファイルを追加して以下のような構成になります。\nwork/\n└── .devcontainer/\n    ├── devcontainer.json\n    └── Dockerfile\n\n\n.devcontainer/devcontainer.json\n今回は開発コンテナを使用するということで、devcontainer.jsonとDockerfileの2つのファイルを用いて設定を行います。\nまず、devcontainer.jsonは開発コンテナの設定ファイルで、以下のような内容になります。\n{\n  \"name\": \"yo5uke.github.io\",\n  \"build\": {\n    \"dockerfile\": \"Dockerfile\"\n  },\n\n  \"remoteUser\": \"rstudio\",\n  \"overrideCommand\": false,\n\n  \"containerEnv\": {\n    \"TZ\": \"Asia/Tokyo\",\n    \"DISABLE_AUTH\": \"true\"\n  },\n\n  \"workspaceFolder\": \"/home/rstudio/${localWorkspaceFolderBasename}\",\n  \"workspaceMount\": \"source=${localWorkspaceFolder},target=/home/rstudio/${localWorkspaceFolderBasename},type=bind\",\n\n  \"runArgs\": [\"-p\", \"8787:8787\"],\n  \"forwardPorts\": [8787],\n  \"portsAttributes\": {\n    \"8787\": { \"label\": \"RStudio Server\" }\n  },\n\n  \"features\": {\n    \"ghcr.io/rocker-org/devcontainer-features/quarto-cli:latest\": {\n      \"version\": \"1.8.25\"\n    }\n  },\n\n  \"customizations\": {\n    \"vscode\": {\n      \"extensions\": [\n        \"REditorSupport.r\",\n        \"Posit.air-vscode\",\n        \"ms-python.python\",\n        \"quarto.quarto\",\n        \"ms-toolsai.jupyter\",\n        \"GitHub.copilot\",\n        \"GitHub.vscode-pull-request-github\",\n        \"janisdd.vscode-edit-csv\",\n        \"James-Yu.latex-workshop\"\n      ],\n      \"settings\": {\n        \"python.defaultInterpreterPath\": \"/home/rstudio/.venv/bin/python\",\n        \"python.terminal.activateEnvironment\": false,\n        \"r.plot.useHttpgd\": true\n      }\n    }\n  }\n}\nこの設定ファイルでは、以下のポイントに注目してください。\n\nbuild.dockerfile: 使用するDockerfileを指定します。\n\nここでは同じディレクトリにあるDockerfileを指定しています。\n\nremoteUser: コンテナ内で使用するユーザーを指定します。rockerイメージではrstudioユーザーがデフォルトです。\ncontainerEnv: コンテナ内の環境変数を設定します。ここではタイムゾーンとRStudio Serverの認証無効化を設定しています。\n\nRStudio Serverでは通常ユーザー名とパスワードで認証が必要ですが、DISABLE_AUTHをtrueに設定することで、認証を無効化しています。\n\nworkspaceFolderとworkspaceMount: ホストマシンの作業ディレクトリをコンテナ内にマウントする設定です。\nrunArgsとforwardPorts: RStudio Serverのポート（8787）をホストマシンにフォワードする設定です。\nfeatures: Quarto CLIをインストールするための設定です。バージョンを指定できます。\ncustomizations.vscode: VSCodeの拡張機能や設定を指定します。RやPython、Quartoなどの拡張機能をインストールしています。\n\nここではPythonの設定も含めていますが、Pythonを使わない場合は削除しても問題ありません。具体的にはVSCodeの拡張機能と設定の部分を削除してください。\n\n\n.devcontainer/Dockerfile\n次に、Dockerfileはコンテナのベースイメージや追加のパッケージを指定するファイルです。devcontainer.jsonと同じディレクトリに配置してください。\n以下のような内容になります。\nFROM rocker/verse:4.5.1\n\nENV DEBIAN_FRONTEND=noninteractive\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n\nRUN R -q -e \"install.packages(c('renv','languageserver','httpgd'))\"\n\nRUN apt-get update \\\n && apt-get install -y --no-install-recommends \\\n      python3 python3-venv python3-pip \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/*\n\nRUN python3 -m venv /home/rstudio/.venv \\\n && /home/rstudio/.venv/bin/python -m pip install --upgrade pip \\\n && chown -R rstudio:rstudio /home/rstudio/.venv\n\nENV VIRTUAL_ENV=/home/rstudio/.venv\nENV PATH=\"${VIRTUAL_ENV}/bin:${PATH}\"\n\nEXPOSE 8787\nこのDockerfileでは、以下のポイントに注目してください。\n\nFROM rocker/verse:4.5.1: rockerのverseイメージをベースにしています。verseイメージにはR本体、Tidyverse、RStudioが含まれています。必要に応じて他のrockerイメージを選択できます。\n\n詳しくはrockerの公式ページを参照してください。\n\nRUN R -q -e \"install.packages(c('renv','languageserver','httpgd'))\": Rのパッケージをインストールしています。ここではrenv、languageserver、httpgdをインストールしています。\n\nVSCode上でRを利用しない場合はrenvのみでよいと思います。\n\nRUN apt-get install -y python3 python3-venv python3-pip: Pythonの仮想環境を作成するために必要なパッケージをインストールしています。\n\nPythonを使わない場合はこの行を削除してください。\n\nRUN python3 -m venv /home/rstudio/.venv: RStudioユーザーのホームディレクトリにPythonの仮想環境を作成しています。\n\nPythonを使わない場合はこの行も削除してください。\n\nEXPOSE 8787: RStudio Serverのポートを公開しています。"
  },
  {
    "objectID": "pages/tips/2025/10/251011_dev_container/index.html#開発コンテナの起動",
    "href": "pages/tips/2025/10/251011_dev_container/index.html#開発コンテナの起動",
    "title": "開発コンテナの環境について",
    "section": "開発コンテナの起動",
    "text": "開発コンテナの起動\n設定ファイルが準備できたら、VSCodeでプロジェクトフォルダを開き、コマンドパレット（）から「Dev Containers: Reopen in Container」を選択します。\nこれにより、VSCodeが開発コンテナをビルドし、コンテナ内で作業できるようになります。\nコンテナのビルドには時間がかかる場合がありますが、一度ビルドが完了すれば、次回からは迅速に起動できます。"
  },
  {
    "objectID": "pages/tips/2025/10/251011_dev_container/index.html#rstudio-serverへのアクセス",
    "href": "pages/tips/2025/10/251011_dev_container/index.html#rstudio-serverへのアクセス",
    "title": "開発コンテナの環境について",
    "section": "RStudio Serverへのアクセス",
    "text": "RStudio Serverへのアクセス\n開発コンテナが起動したら、ブラウザでlocalhost:8787にアクセスします。\nRStudio Server上でプロジェクトフォルダを開き、Rプロジェクトを作成して作業を始めましょう。"
  },
  {
    "objectID": "pages/tips/2025/10/251011_dev_container/index.html#おわりに",
    "href": "pages/tips/2025/10/251011_dev_container/index.html#おわりに",
    "title": "開発コンテナの環境について",
    "section": "おわりに",
    "text": "おわりに\n今回はdevcontainer.jsonとDockerfileを紹介することがメインだったので環境構築の手順についてはごく簡単に説明しました。\nもし興味があれば、以下の記事も参考にしてみてください。\n\n\n\n\n\n\n【改訂版】開発コンテナを使ってR環境を構築！\n\n\n\nそこまで大きくないデータでしたらGitHubを通じて管理できます。もしデータが大きくなればDVCなど他のツールを利用することも検討するのがよいと思います。\nご参考まで。"
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/demo/demo.html#introduction",
    "href": "pages/tips/2025/10/251021_quarto_typst/demo/demo.html#introduction",
    "title": "Writing Papers with Quarto and Typst",
    "section": "Introduction",
    "text": "Introduction\n(notsu_indirect_2025?)\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sagittis posuere ligula sit amet lacinia. Duis dignissim pellentesque magna, rhoncus congue sapien finibus mollis. Ut eu sem laoreet, vehicula ipsum in, convallis erat. Vestibulum magna sem, blandit pulvinar augue sit amet, auctor malesuada sapien. Nullam faucibus leo eget eros hendrerit, non laoreet ipsum lacinia. Curabitur cursus diam elit, non tempus ante volutpat a. Quisque hendrerit blandit purus non fringilla. Integer sit amet elit viverra ante dapibus semper. Vestibulum viverra rutrum enim, at luctus enim posuere eu. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.\nNunc ac dignissim magna. Vestibulum vitae egestas elit. Proin feugiat leo quis ante condimentum, eu ornare mauris feugiat. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Mauris cursus laoreet ex, dignissim bibendum est posuere iaculis. Suspendisse et maximus elit. In fringilla gravida ornare. Aenean id lectus pulvinar, sagittis felis nec, rutrum risus. Nam vel neque eu arcu blandit fringilla et in quam. Aliquam luctus est sit amet vestibulum eleifend. Phasellus elementum sagittis molestie. Proin tempor lorem arcu, at condimentum purus volutpat eu. Fusce et pellentesque ligula. Pellentesque id tellus at erat luctus fringilla. Suspendisse potenti."
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/demo/demo.html#insert-figures",
    "href": "pages/tips/2025/10/251021_quarto_typst/demo/demo.html#insert-figures",
    "title": "Writing Papers with Quarto and Typst",
    "section": "Insert Figures",
    "text": "Insert Figures"
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/demo/demo.html#insert-tables",
    "href": "pages/tips/2025/10/251021_quarto_typst/demo/demo.html#insert-tables",
    "title": "Writing Papers with Quarto and Typst",
    "section": "Insert Tables",
    "text": "Insert Tables\n\n\n\n\n    \n\n    \n\n    \n    \n    \n      \n        \n        \n              \n                mpg\n                cyl\n                disp\n                hp\n                drat\n                wt\n                qsec\n                vs\n                am\n                gear\n                carb\n              \n        \n        Note: This table shows the first few rows of the mtcars dataset.\n        \n                \n                  21.0\n                  6\n                  160\n                  110\n                  3.90\n                  2.620\n                  16.46\n                  0\n                  1\n                  4\n                  4\n                \n                \n                  21.0\n                  6\n                  160\n                  110\n                  3.90\n                  2.875\n                  17.02\n                  0\n                  1\n                  4\n                  4\n                \n                \n                  22.8\n                  4\n                  108\n                  93\n                  3.85\n                  2.320\n                  18.61\n                  1\n                  1\n                  4\n                  1\n                \n                \n                  21.4\n                  6\n                  258\n                  110\n                  3.08\n                  3.215\n                  19.44\n                  1\n                  0\n                  3\n                  1\n                \n                \n                  18.7\n                  8\n                  360\n                  175\n                  3.15\n                  3.440\n                  17.02\n                  0\n                  0\n                  3\n                  2\n                \n                \n                  18.1\n                  6\n                  225\n                  105\n                  2.76\n                  3.460\n                  20.22\n                  1\n                  0\n                  3\n                  1\n                \n        \n      \n    \n\nA simple table showing the first few rows of the mtcars dataset."
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/demo/demo.html#mathematical-expressions",
    "href": "pages/tips/2025/10/251021_quarto_typst/demo/demo.html#mathematical-expressions",
    "title": "Writing Papers with Quarto and Typst",
    "section": "Mathematical Expressions",
    "text": "Mathematical Expressions\n\\[\nE=mc^2\n\\]"
  },
  {
    "objectID": "pages/tips/2025/10/251021_quarto_typst/demo/demo.html#appendix",
    "href": "pages/tips/2025/10/251021_quarto_typst/demo/demo.html#appendix",
    "title": "Writing Papers with Quarto and Typst",
    "section": "Appendix",
    "text": "Appendix\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sagittis posuere ligula sit amet lacinia. Duis dignissim pellentesque magna, rhoncus congue sapien finibus mollis. Ut eu sem laoreet, vehicula ipsum in, convallis erat. Vestibulum magna sem, blandit pulvinar augue sit amet, auctor malesuada sapien. Nullam faucibus leo eget eros hendrerit, non laoreet ipsum lacinia. Curabitur cursus diam elit, non tempus ante volutpat a. Quisque hendrerit blandit purus non fringilla. Integer sit amet elit viverra ante dapibus semper. Vestibulum viverra rutrum enim, at luctus enim posuere eu. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.\nNunc ac dignissim magna. Vestibulum vitae egestas elit. Proin feugiat leo quis ante condimentum, eu ornare mauris feugiat. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Mauris cursus laoreet ex, dignissim bibendum est posuere iaculis. Suspendisse et maximus elit. In fringilla gravida ornare. Aenean id lectus pulvinar, sagittis felis nec, rutrum risus. Nam vel neque eu arcu blandit fringilla et in quam. Aliquam luctus est sit amet vestibulum eleifend. Phasellus elementum sagittis molestie. Proin tempor lorem arcu, at condimentum purus volutpat eu. Fusce et pellentesque ligula. Pellentesque id tellus at erat luctus fringilla. Suspendisse potenti.\nEtiam maximus accumsan gravida. Maecenas at nunc dignissim, euismod enim ac, bibendum ipsum. Maecenas vehicula velit in nisl aliquet ultricies. Nam eget massa interdum, maximus arcu vel, pretium erat. Maecenas sit amet tempor purus, vitae aliquet nunc. Vivamus cursus urna velit, eleifend dictum magna laoreet ut. Duis eu erat mollis, blandit magna id, tincidunt ipsum. Integer massa nibh, commodo eu ex vel, venenatis efficitur ligula. Integer convallis lacus elit, maximus eleifend lacus ornare ac. Vestibulum scelerisque viverra urna id lacinia. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Aenean eget enim at diam bibendum tincidunt eu non purus. Nullam id magna ultrices, sodales metus viverra, tempus turpis."
  },
  {
    "objectID": "pages/tips/2025/10/251026_typst/index.html#はじめに",
    "href": "pages/tips/2025/10/251026_typst/index.html#はじめに",
    "title": "Typst 入門",
    "section": "はじめに",
    "text": "はじめに\n皆さん、Typstをご存知でしょうか？\nTypstは、LaTeXにも代わりうる新しい組版システムで、美しいドキュメントを（比較的）簡単に作成できることができます。\nTypstは、シンプルで直感的な構文を持ち、リアルタイムプレビュー機能も備えているため、初心者でも扱いやすいのが特徴です。\nこれまでの僕の記事では、LaTeXを中心にドキュメント作成の方法を紹介してきましたが、Typstも非常に魅力的な選択肢です。\nローカルで環境を整えるというのはインターネット環境に左右されないという利点を強調してきた一方で、実際問題それほど問題になるケースが少なく、オンラインエディタで文書を作成するというのも十分に実用的です。\nTypstはOverleafのようなオンラインエディタを提供しており、なおかつリアルタイムプレビューも備えているため、LaTeXのようにコンパイルを待つことなく書いた内容を確認することができます。\nこの記事では、Typstの基本的な使い方を紹介します。\n書き方がLaTeXとは異なるので最初は戸惑うかもしれませんが、慣れれば非常に便利ですので、ぜひ試してみてください。"
  },
  {
    "objectID": "pages/tips/2025/10/251026_typst/index.html#typstの準備",
    "href": "pages/tips/2025/10/251026_typst/index.html#typstの準備",
    "title": "Typst 入門",
    "section": "Typstの準備",
    "text": "Typstの準備\nTypstはローカルにインストールする必要がなく、オンラインエディタで直接ドキュメントを作成できます。\n\nTypstにアクセスし、アカウントを作成します。\n\n初めてであればSign Upからアカウントを作成してください。\n\nログイン後、ダッシュボードから「Empty document」をクリックして新しいドキュメントを作成します。\n\n\n\n\nTypstのダッシュボード\n\n\n\nドキュメントエディタが開きます。ここでTypstのコードを記述します。\n\nファイルの拡張子は.typです。\n\n\n\n\n\nTypstのドキュメントエディタ"
  },
  {
    "objectID": "pages/tips/2025/10/251026_typst/index.html#typstの基本的な書き方",
    "href": "pages/tips/2025/10/251026_typst/index.html#typstの基本的な書き方",
    "title": "Typst 入門",
    "section": "Typstの基本的な書き方",
    "text": "Typstの基本的な書き方\n\n\n\n\n\n\nNote今回の方針\n\n\n\n今回は僕が作成したTypstテンプレートを使いながら説明します。経済学論文向けのテンプレートを作成しており、最低限の設定はテンプレート内で済ませていますが、もっと根本的に学びたい方はTypstの公式ドキュメントを参照してください。\n\n\nTypstの基本的な書き方をいくつか紹介します。\n最初はややこしいかもしれませんが、慣れてしまえばLaTeXよりもシンプルだと思いますので、ぜひ挑戦してみてください。\n\nエディタを開く\nオンラインエディタを開き、新しいドキュメントを作成します。\n\n\nテンプレートの準備\n今回は僕が作成したTypstテンプレートを使いますので、以下の2ファイルをダウンロードするか、GitHubからご利用ください。\n\ntemplate.typ\nchicago_author_date.csl\nGitHubリポジトリ\n\n2つのファイルを準備できたら、Typstのエディタにアップロードします。サイドバーの「･･･」メニューから「Upload a new file」を選択してアップロードするか、ドラッグアンドドロップでアップロードします。\ntemplate.typとchicago_author_date.cslが表示されている状態でスタートします。\n\n\n表紙\nまずは基本となる表紙の作成から始めます。表紙のイメージは以下です。\n\n\n\nTypstで作成した表紙の例\n\n\nこれを目指していきたいと思います。\n\nサイドバーの  アイコンから新規ファイルを作成します。\n\nファイル名はmain.typとしますが、任意の名前で構いません。\n\nmain.typに以下のコードを記述します。\n\n#import \"template.typ\": article\nこれはtemplate.typからarticleコンポーネントをインポートするコードです。このarticleに表紙の設定が含まれています。\n今回は設定は既定のまま使用しますが、template.typ内のarticleコンポーネントを編集することで、諸々の細かい点を調整できます。\n\n次に、表紙の内容を記述します。main.typに以下のコードを追加します。\n\n#show: article.with(\n  title: [Minimal Article Template (Test)#footnote[#lorem(150)]],\n  authors: (\n    (\n      name: \"Yosuke Abe\",\n      affiliation: \"Example University\",\n      email: \"yosuke.abe0507@gmail.com\"\n    ),\n    (\n      name: \"Taro Yamada\",\n      affiliation: \"Example University\",\n      email: \"taro@example.jp\"\n    )\n  ),\n  date: datetime.today().display(\"[month repr:long] [day], [year]\"),\n  abstract: [\n    #lorem(150)\n  ],\n  jel-codes: (\n    \"A1\",\n    \"A2\",\n    \"A3\",\n    \"A4\"\n  ),\n  keywords: (\n    \"Keyword 1\",\n    \"Keyword 2\",\n    \"Keyword 3\"\n  )\n)\n#show: article.with(...)は、articleコンポーネントを表示するためのコードです。\ntitle、authors、date、abstract、jel-codes、keywordsなどの引数を指定して、表紙の内容を設定します。\ntieleには#footnote[...]を使って脚注を追加しています。謝辞を入れたい場合などに便利です。\n著者は1人でも構いませんし、3人まで対応しています。また、jel-codesやkeywordsも任意です。\ndateは現在の日付を自動的に取得して表示します。文字列で直接指定することも可能です。\nabstract内の#lorem(150)はダミーテキストを生成する関数ですので、実際の文章に置き換えてください。\nTypstはコンパイルが要りませんから、コードを記述するとリアルタイムでプレビューが表示されます。上の設定で先ほどの表紙が表示されるはずです1。\n\n\n本文\n次に本文を追加します。\n先に完成イメージを共有しておきます。\nテンプレートを使って作成したサンプル文書（PDF）\nここからは基本的な書き方を紹介します。ここからの内容は今回のテンプレートに限らずTypst全般に共通する内容です！Updated the description for Typst and corrected the date.\n\nセクション\nセクションは=を使って作成し、サブセクションは==というようにイコールの数で階層を表現します2。\n= セクション1\n== サブセクション1.1\nちなみに今回の設定ではセクション番号が表示されるようになっているので、「1 セクション1」のように自動的に番号が振られます。\n\n\n段落\n段落を改める場合、2通りの方法が使えます。\n\n空行を挟む\n\nこれは1つ目の段落です。\n\nこれは2つ目の段落です。\n\nバックスラッシュを使う\n\nこれは1つ目の段落です。\\\nこれは2つ目の段落です。\nこの場合は空行を入れなくても段落が分かれます。\n\n\n強調\n強調したい部分は*で囲みます。\nこれは*強調*されたテキストです。\nまた、イタリック体にしたい場合は_で囲みます。\nこれは_イタリック体_のテキストです。\n\n\n箇条書き\n箇条書きは-を使って作成します。\n- アイテム1\n- アイテム2\n  - サブアイテム2.1\n  - サブアイテム2.2\n\n\n番号付きリスト\n番号付きリストは1.を使って作成します。\n1. アイテム1\n2. アイテム2\n\n\n数式\n$...$で囲むことでインライン数式を作成できます。\nこれはインライン数式の例です：$E=mc^2$。\nブロック数式は同じく$...$で囲みますが、改行をしてください。\n$\nE = m c^2\n$\n文字を並べる場合にはスペースを空けてください。mc^2と詰めて書くと表示されなくなってしまいます。\n\n\n図の挿入\n図は#figure(...)を使って挿入します。\n#figure(\n  image(\n    \"path_to_image.png\",\n    width: 30%\n  ),\n  caption: [これは図のキャプションです。]\n)&lt;my-fig&gt;\n#figure(...)内でimage(...)を使って画像を指定し、caption引数でキャプションを設定します。width引数で画像の幅を指定できます。\nまた、&lt;my-fig&gt;のように任意のラベルを付けることで、後で参照することができます。文書内で引用したい場合は@my-figと書きます。\n\n\n表の挿入\n表は#figure(...)内でtable(...)を使って挿入します。\n#figure(\n  table(\n    columns: 12,\n    align: (left, right, right, right, right, right, right, right, right, right, right, right),\n    table.hline(),\n    table.header(repeat: true,\n      [model], [mpg], [cyl], [disp], [hp], [drat], [wt], [qsec], [vs], [am], [gear], [carb],\n    ),\n    table.hline(),\n    [Mazda RX4], [21.0], [6], [160], [110], [3.90], [2.620], [16.46], [0], [1], [4], [4],\n    [Mazda RX4 Wag], [21.0], [6], [160], [110], [3.90], [2.875], [17.02], [0], [1], [4], [4],\n    [Datsun 710], [22.8], [4], [108], [93], [3.85], [2.320], [18.61], [1], [1], [4], [1],\n    [Hornet 4 Drive], [21.4], [6], [258], [110], [3.08], [3.215], [19.44], [1], [0], [3], [1],\n    [Hornet Sportabout], [18.7], [8], [360], [175], [3.15], [3.440], [17.02], [0], [0], [3], [2],\n    [Valiant], [18.1], [6], [225], [105], [2.76], [3.460], [20.22], [1], [0], [3], [1],\n    table.hline(),\n    table.footer(repeat: false,\n      table.cell(align: left, colspan: 12,\n        text([\n          #text(style: \"italic\")[Note:] This table shows the first few rows of the mtcars dataset.\n        ])\n      ),\n    ),\n  ),\n  caption: [mtcars data],\n)&lt;mtcars&gt;\ntable(...)内で列数や配置、ヘッダー、フッター、データ行を指定します。\ncolumns引数で列数を指定し、align引数で各列の配置を設定します。\ntable.header(...)でヘッダー行を、table.footer(...)でフッター行を設定します。フッターは複雑ですが、colspanとフッター文をうまく変えながら調整してください。\nデータ行はカンマ区切りで各セルの内容を指定します。\n表も図と同様に&lt;mtcars&gt;のようにラベルを付けることができ、@mtcarsで参照できます。\n表の設定は少々ややこしいのですが、Rで作った表をTypstで出力するというのが1つ手としてあるかと思います。\n今回はその方法については書きませんが、必要であれば調べてみてください。\nまた、Typstの公式ドキュメントのページも参考にしてみてください。\n\n\n\n\n\n\nTable Function - Typst Documentation\n\n\n\n\n\n脚注\n脚注は#footnote[...]を使って挿入します。表紙でも挿入していましたが、本文中でも同様に使えます。\nこれは脚注の例です#footnote[これは脚注の内容です。]。\n\n\n引用文献\n引用文献は#bibliography(...)を使って挿入します。セクションタイトルも「References」と自動的に追加されるようにしてありますので、参考文献を挿入したい場所に以下のコードを追加します。\n#bibliography(\"references.bib\")\nreferences.bibはBibTeX形式の文献データファイルです。自分で用意した.bibファイルをアップロードして指定してください。\n文中で引用したい場合は、#cite(&lt;notsu_indirect_2025&gt;, form: \"prose\")のように書きます。&lt;notsu_indirect_2025&gt;は.bibファイル内で指定したラベルです。form: \"prose\"は引用形式を指定するオプションで、省略可能です。この設定だと\n\nNotsu et al. (2025)\n\nのように表示されます。\n\n(Notsu et al., 2025)\n\nのように表示したい場合は@notsu_indirect_2025のように書きます。こちらは楽でいいですね。\n2つ以上並べたい場合は@notsu_indirect_2025 @martinez_how_2022のようにスペースで区切ってください。\n引用スタイルはtemplate.typ内でchicago_author_date.cslを指定しています。別のスタイルに変更したい場合は、他のCSLファイルをダウンロードしてアップロードし、template.typ内の該当部分を書き換えてください。\n\n\nAppendix\nアペンディクスは参考文献の後に差し込みたいかもしれません。その場合少々やっかいですが、以下のように記述し、その下に文章を書いていってください。\n#block[\n  #heading(\n    level: 1,\n    numbering: none,\n    [Appendix]\n  )\n]\nこれでアペンディクスのセクションが作成されます。\n\n\n改ページ\n改ページは#page-break()を使います。改行したい場所にこのコードを追加することで新しいページに移ることができます。\n\n\n\nコード全文\n基本的な使い方は以上です。\nご参考までに、はじめにご紹介したPDF作成に使用したコード全文を以下に示します。長いので折りたたんで置いておきますので、開いてご確認ください。\n\n\n\n\n\n\nTipコード全文\n\n\n\n\n\n#import \"template.typ\": article\n\n#show: article.with(\n  title: [Minimal Article Template (Test)#footnote[#lorem(150)]],\n  authors: (\n    (\n      name: \"Yosuke Abe\",\n      affiliation: \"Example University\",\n      email: \"yosuke.abe0507@gmail.com\"\n    ),\n    (\n      name: \"Taro Yamada\",\n      affiliation: \"Example University\",\n      email: \"taro@example.jp\"\n    )\n  ),\n  date: datetime.today().display(\"[month repr:long] [day], [year]\"),\n  abstract: [\n    #lorem(150)\n  ],\n  jel-codes: (\n    \"A1\",\n    \"A2\",\n    \"A3\",\n    \"A4\"\n  ),\n  keywords: (\n    \"Keyword 1\",\n    \"Keyword 2\",\n    \"Keyword 3\"\n  )\n)\n\n\n= Introduction\n#lorem(500)#footnote[#lorem(100)]\n\n$\nE = m c^2\n$\n\n#lorem(500)\n\n= Section\nInsert an image. #lorem(100)\n\n#figure(\n  image(\n    \"seiji_souridaijin_woman_kaiken.png\",\n    width: 30%\n  ),\n  caption: [Prime Minister]\n)&lt;prime-minister&gt;\n\n@prime-minister depicts a _female_ prime minister. \n\n- item 1\n- item 2\n  - item2.1\n\n1. item 1\n2. item 2\n\n#lorem(100)\n\nInsert an table. #lorem(100) According to  @notsu_indirect_2025 @martinez_how_2022, hogehoge.\n\n#figure(\n  table(\n    columns: 12,\n    align: (left, right, right, right, right, right, right, right, right, right, right, right),\n    table.hline(),\n    table.header(repeat: true,\n      [model], [mpg], [cyl], [disp], [hp], [drat], [wt], [qsec], [vs], [am], [gear], [carb],\n    ),\n    table.hline(),\n    [Mazda RX4], [21.0], [6], [160], [110], [3.90], [2.620], [16.46], [0], [1], [4], [4],\n    [Mazda RX4 Wag], [21.0], [6], [160], [110], [3.90], [2.875], [17.02], [0], [1], [4], [4],\n    [Datsun 710], [22.8], [4], [108], [93], [3.85], [2.320], [18.61], [1], [1], [4], [1],\n    [Hornet 4 Drive], [21.4], [6], [258], [110], [3.08], [3.215], [19.44], [1], [0], [3], [1],\n    [Hornet Sportabout], [18.7], [8], [360], [175], [3.15], [3.440], [17.02], [0], [0], [3], [2],\n    [Valiant], [18.1], [6], [225], [105], [2.76], [3.460], [20.22], [1], [0], [3], [1],\n    table.hline(),\n    table.footer(repeat: false,\n      table.cell(align: left, colspan: 12,\n        text([\n          #text(style: \"italic\")[Note:] This table shows the first few rows of the mtcars dataset.\n        ])\n      ),\n    ),\n  ),\n  caption: [mtcars data],\n)&lt;mtcars&gt;\n\n@mtcars is mtcars data. #lorem(500)\n\n#bibliography(\"references.bib\")\n\n#pagebreak()\n\n#block[\n  #heading(\n    level: 1,\n    numbering: none,\n    [Appendix]\n  )\n]\n\n#lorem(500)"
  },
  {
    "objectID": "pages/tips/2025/10/251026_typst/index.html#おわりに",
    "href": "pages/tips/2025/10/251026_typst/index.html#おわりに",
    "title": "Typst 入門",
    "section": "おわりに",
    "text": "おわりに\nここまでTypstの基本的な使い方を紹介しました。\nある程度の機能はご紹介できたかと思いますが、実際論文を書くとなるともっと細かい設定が必要になることもあるかと思います。\nTypst公式ドキュメントもご参考にしていただきつつ、気づいた点があれば随時テンプレートを更新していきたいと思います。"
  },
  {
    "objectID": "pages/tips/2025/10/251026_typst/index.html#footnotes",
    "href": "pages/tips/2025/10/251026_typst/index.html#footnotes",
    "title": "Typst 入門",
    "section": "注",
    "text": "注\n\n\nもし何も表示されない場合、template.typがプレビューに表示されているかもしれません。サイドバーの.typファイルの右に目のアイコンがあると思いますが、main.typ横の目をクリックして表示してください。↩︎\nすみません、本ページのフォントの設定上イコールの数が見にくいですが、サブセクションでは2つのイコールを使用しています。↩︎"
  }
]