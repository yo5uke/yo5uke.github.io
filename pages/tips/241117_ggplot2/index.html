<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.5">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="ggplotを使うのに役立つコマンドを紹介します！">

<title>【4.0.0対応！】ggplot2使い方ガイド – Yosuke Abe</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../assets/icons/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-2e0b4708489a94d7cf3aaa82802539fe.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-d2c802e77a2028df721c7926edd66dc0.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-2e0b4708489a94d7cf3aaa82802539fe.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-d43a645695419797cfac10b6ecd37bfe.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-85d9d7ac3b505b360c11d76779ca1e71.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-d43a645695419797cfac10b6ecd37bfe.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/quarto-contrib/fontawesome6-6.7.2/all.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/fontawesome6-6.7.2/latex-fontsize.css" rel="stylesheet">
<script src="../../../site_libs/quarto-contrib/iconify-3.0.0/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "一致なし",
    "search-matching-documents-text": "一致した文書",
    "search-copy-link-title": "検索へのリンクをコピー",
    "search-hide-matches-text": "追加の検索結果を非表示",
    "search-more-match-text": "追加の検索結果",
    "search-more-matches-text": "追加の検索結果",
    "search-clear-button-title": "消去",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "キャンセル",
    "search-submit-button-title": "検索",
    "search-label": "サーチ"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-N3ZP99BG08"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-N3ZP99BG08', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="【4.0.0対応！】ggplot2使い方ガイド – Yosuke Abe">
<meta property="og:description" content="ggplotを使うのに役立つコマンドを紹介します！">
<meta property="og:image" content="https://yo5uke.com/pages/tips/241117_ggplot2/figure/fig-ggrepel.png">
<meta property="og:site_name" content="Yosuke Abe">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
<meta name="twitter:title" content="【4.0.0対応！】ggplot2使い方ガイド – Yosuke Abe">
<meta name="twitter:description" content="ggplotを使うのに役立つコマンドを紹介します！">
<meta name="twitter:image" content="https://yo5uke.com/pages/tips/241117_ggplot2/figure/fig-ggrepel.png">
<meta name="twitter:creator" content="@5uke_y">
<meta name="twitter:site" content="@5uke_y">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1344">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Yosuke Abe</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="サーチ"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="ナビゲーションを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../pages/about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../pages/tips/index.html"> 
<span class="menu-text">Tips</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../pages/software/index.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../pages/gis_in_r/index.html"> 
<span class="menu-text">GIS in <i class="fa-brands fa-r-project" aria-label="r-project"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../pages/blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/yo5uke/yo5uke.github.io/">
            ソースコード
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/yo5uke/yo5uke.github.io/issues/new/">
            問題を報告
            </a>
          </li>
      </ul>
    </div>
    <a href="../../../pages/tips/index.xml" title="RSS" class="quarto-navigation-tool px-1" aria-label="RSS"><i class="bi bi-rss"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="ダークモードの切り替え"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">【4.0.0対応！】<span class="fira-code">ggplot2</span>使い方ガイド</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          <p>ggplotを使うのに役立つコマンドを紹介します！</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">公開</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2024年11月17日</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">最終更新</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">2025年10月18日</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#はじめに" id="toc-はじめに" class="nav-link active" data-scroll-target="#はじめに">はじめに</a></li>
  <li><a href="#ggplot2の基本" id="toc-ggplot2の基本" class="nav-link" data-scroll-target="#ggplot2の基本">{ggplot2}の基本</a>
  <ul>
  <li><a href="#散布図" id="toc-散布図" class="nav-link" data-scroll-target="#散布図">散布図</a></li>
  <li><a href="#折れ線グラフ" id="toc-折れ線グラフ" class="nav-link" data-scroll-target="#折れ線グラフ">折れ線グラフ</a></li>
  <li><a href="#棒グラフ" id="toc-棒グラフ" class="nav-link" data-scroll-target="#棒グラフ">棒グラフ</a></li>
  <li><a href="#箱ひげ図" id="toc-箱ひげ図" class="nav-link" data-scroll-target="#箱ひげ図">箱ひげ図</a></li>
  <li><a href="#バイオリンプロット" id="toc-バイオリンプロット" class="nav-link" data-scroll-target="#バイオリンプロット">バイオリンプロット</a></li>
  </ul></li>
  <li><a href="#sec-color" id="toc-sec-color" class="nav-link" data-scroll-target="#sec-color">色を付ける</a></li>
  <li><a href="#少しいじる" id="toc-少しいじる" class="nav-link" data-scroll-target="#少しいじる">少しいじる</a>
  <ul>
  <li><a href="#点の形" id="toc-点の形" class="nav-link" data-scroll-target="#点の形">点の形</a></li>
  <li><a href="#線の種類と太さ" id="toc-線の種類と太さ" class="nav-link" data-scroll-target="#線の種類と太さ">線の種類と太さ</a></li>
  </ul></li>
  <li><a href="#軸" id="toc-軸" class="nav-link" data-scroll-target="#軸">軸</a>
  <ul>
  <li><a href="#軸ラベル" id="toc-軸ラベル" class="nav-link" data-scroll-target="#軸ラベル">軸ラベル</a></li>
  <li><a href="#軸の目盛り" id="toc-軸の目盛り" class="nav-link" data-scroll-target="#軸の目盛り">軸の目盛り</a></li>
  <li><a href="#軸の範囲" id="toc-軸の範囲" class="nav-link" data-scroll-target="#軸の範囲">軸の範囲</a></li>
  </ul></li>
  <li><a href="#注釈" id="toc-注釈" class="nav-link" data-scroll-target="#注釈">注釈</a>
  <ul>
  <li><a href="#文字" id="toc-文字" class="nav-link" data-scroll-target="#文字">文字</a></li>
  <li><a href="#セグメント" id="toc-セグメント" class="nav-link" data-scroll-target="#セグメント">セグメント</a></li>
  </ul></li>
  <li><a href="#時系列のプロット" id="toc-時系列のプロット" class="nav-link" data-scroll-target="#時系列のプロット">時系列のプロット</a></li>
  <li><a href="#複数のカテゴリのプロットと凡例" id="toc-複数のカテゴリのプロットと凡例" class="nav-link" data-scroll-target="#複数のカテゴリのプロットと凡例">複数のカテゴリのプロットと凡例</a>
  <ul>
  <li><a href="#sec-multi-cat-plot" id="toc-sec-multi-cat-plot" class="nav-link" data-scroll-target="#sec-multi-cat-plot">複数のカテゴリのプロット</a></li>
  <li><a href="#凡例の位置" id="toc-凡例の位置" class="nav-link" data-scroll-target="#凡例の位置">凡例の位置</a></li>
  <li><a href="#凡例の調整" id="toc-凡例の調整" class="nav-link" data-scroll-target="#凡例の調整">凡例の調整</a></li>
  </ul></li>
  <li><a href="#テーマ" id="toc-テーマ" class="nav-link" data-scroll-target="#テーマ">テーマ</a>
  <ul>
  <li><a href="#プリセットのテーマ" id="toc-プリセットのテーマ" class="nav-link" data-scroll-target="#プリセットのテーマ">プリセットのテーマ</a></li>
  <li><a href="#theme関数" id="toc-theme関数" class="nav-link" data-scroll-target="#theme関数"><code>theme()</code>関数</a></li>
  </ul></li>
  <li><a href="#新しくなったthemeの設定" id="toc-新しくなったthemeの設定" class="nav-link" data-scroll-target="#新しくなったthemeの設定">新しくなった<code>theme()</code>の設定</a>
  <ul>
  <li><a href="#paperとink" id="toc-paperとink" class="nav-link" data-scroll-target="#paperとink"><code>paper</code>と<code>ink</code></a></li>
  <li><a href="#geom" id="toc-geom" class="nav-link" data-scroll-target="#geom"><code>geom</code></a></li>
  <li><a href="#from_theme" id="toc-from_theme" class="nav-link" data-scroll-target="#from_theme"><code>from_theme()</code></a>
  <ul class="collapse">
  <li><a href="#使用例" id="toc-使用例" class="nav-link" data-scroll-target="#使用例">使用例</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#新しくなったラベル設定" id="toc-新しくなったラベル設定" class="nav-link" data-scroll-target="#新しくなったラベル設定">新しくなったラベル設定</a></li>
  <li><a href="#カラーパレット" id="toc-カラーパレット" class="nav-link" data-scroll-target="#カラーパレット">カラーパレット</a>
  <ul>
  <li><a href="#連続値のカラースケール" id="toc-連続値のカラースケール" class="nav-link" data-scroll-target="#連続値のカラースケール">連続値のカラースケール</a></li>
  <li><a href="#カテゴリ値のカラースケール" id="toc-カテゴリ値のカラースケール" class="nav-link" data-scroll-target="#カテゴリ値のカラースケール">カテゴリ値のカラースケール</a></li>
  </ul></li>
  <li><a href="#いろいろ含めたグラフを作ってみる" id="toc-いろいろ含めたグラフを作ってみる" class="nav-link" data-scroll-target="#いろいろ含めたグラフを作ってみる">いろいろ含めたグラフを作ってみる</a></li>
  <li><a href="#発展ggrepel" id="toc-発展ggrepel" class="nav-link" data-scroll-target="#発展ggrepel">発展：<code>ggrepel</code></a></li>
  <li><a href="#おわりに" id="toc-おわりに" class="nav-link" data-scroll-target="#おわりに">おわりに</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">

<div class="social-share-buttons">

  <!-- Twitter (X) -->

  <a href="" id="js-share-twitter" class="share_button ri--twitter-x-fill" target="_blank" rel="nofollow noopener noreferrer"></a>



  <!-- Bluesky -->

  <a href="" id="js-share-bluesky" class="share_button ri--bluesky-fill" target="_blank" rel="nofollow noopener noreferrer"></a>

</div>



<script>

  const twitterUsername = "@5uke_y";

  const blueskyUsername = "@5uke.bsky.social";



  const share_url = encodeURIComponent(location.href);

  const share_title = document.title;



  // Twitter (X)

  document.getElementById('js-share-twitter').setAttribute(

    "href",

    "https://twitter.com/share?url=" + share_url + "&text=" + share_title + " " + encodeURIComponent(twitterUsername) + " より" +

    "&hashtags=rstats"

  );



  // Bluesky

  document.getElementById('js-share-bluesky').setAttribute(

    "href",

    "https://bsky.app/intent/compose?text=" + share_title + " " + share_url + " " + encodeURIComponent(blueskyUsername) + " より"

  );

</script>






<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">はじめに</h2>
<p>皆さん、ggplot、使ってますか？多分お使いですよね。</p>
<p>僕は数か月前ggplotのガイドブックを買いまして、いろいろと勉強しているところでございます。</p>
<p>こんなこともできるのか！という発見が多々あり、Rユーザーの皆様にはぜひ買っていただきたい代物なのですが、いかんせんお値段が張りますので、いくつかピックアップしてご紹介します。</p>
<p>書籍のリンクは以下です。</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><a href="https://www.amazon.co.jp/R%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AF%E3%83%83%E3%82%AF%E3%83%96%E3%83%83%E3%82%AF-%E7%AC%AC2%E7%89%88-%E2%80%95ggplot2%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B0%E3%83%A9%E3%83%95%E4%BD%9C%E6%88%90%E3%81%AE%E3%83%AC%E3%82%B7%E3%83%94%E9%9B%86-Winston-Chang/dp/4873118921">Rグラフィックスクックブック 第2版 ―ggplot2によるグラフ作成のレシピ集</a></p>
</div>
</div>
</div>
<p>さらに、2025年9月、ggplot2がバージョン4.0.0にアップデートされました！それを記念し、4.0.0の要素も取り入れたページにアップデートしました！🎉</p>
<p>ぜひご参考になさってください！</p>
</section>
<section id="ggplot2の基本" class="level2">
<h2 class="anchored" data-anchor-id="ggplot2の基本">{ggplot2}の基本</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>使ったことがある方はこの辺はスキップしてください。</p>
<p>今回使うデータは、デフォルトで用意されている<code>iris</code>と<code>Orange</code>です。</p>
</div>
</div>
<p>ひとまず主要なパッケージである{ggplot2}を読み込みます。{ggplot2}はTidyverseに含まれていますので、データを色々加工したうえでグラフを書きたい場合が多いことを考えると、{tidyverse}を読み込むのが便利だと思います。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("tidyverse")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># {ggplot2}単体の場合</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ggplot2")</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>基本的な使い方としては、<code>ggplot()</code>と<code>aes()</code>、そして図に応じて<code>geom_line()</code>（折れ線）や<code>geom_point()</code>（散布図）などを使っていきます。</p>
<p>今回は例として、アイリスのがく片の長さ、幅をそれぞれ軸としてプロットします。</p>
<section id="散布図" class="level3">
<h3 class="anchored" data-anchor-id="散布図">散布図</h3>
<p>まずは基本的な散布図を描いてみます。散布図は<code>geom_point()</code>を使うことで描画できます。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-iris" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iris-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-iris-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iris-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;1: irisデータフレームを使った散布図
</figcaption>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><code>ggplot(data, aes())</code>という形で使用するデータを指定</li>
<li><code>aes()</code>内ではX軸とY軸をそれぞれ指定
<ul>
<li>例：<code>aes(x = Sepal.Length, y = Sepal.Width)</code></li>
<li>第1引数がX、第2引数がYと決まっているので、<code>x =</code>や<code>y =</code>は書かなくてもよいです。</li>
</ul></li>
<li>ggplotのコマンドは<code>+</code>で繋ぐ</li>
<li>散布図を作るために<code>geom_point()</code>を繋げる</li>
</ol>
<p>これが土台です。<code>ggplot()</code>だけではプロットは表示されませんので、<code>geom_point()</code>など何かしら繋ぐ形にしてください。</p>
<p><strong>回帰線を引きたい場合：</strong></p>
<p>早速応用ではありますが、散布図を描いたら回帰線を引きたいことがありますよね。そのためには、<code>geom_smooth()</code>を使います。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-iris-lm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iris-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-iris-lm-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iris-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;2: 回帰直線を引いた散布図
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>method = lm</code>で回帰直線を引くオプションを付けることができ、デフォルトではYをXに回帰する直線が引かれます。式を変えたい場合は<code>formula = y ~ log(x)</code>などと式を追加してください。</p>
<p>また、デフォルトでは信頼区間がプロットされます。要らない場合は、<code>se = FALSE</code>を追加します。</p>
<p>また、lm以外にも、<code>method = "loess"</code>などもあります。<code>?geom_smooth</code>で確認してみてください。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-iris-loess" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iris-loess-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-iris-loess-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iris-loess-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;3: loessを使った散布図
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="折れ線グラフ" class="level3">
<h3 class="anchored" data-anchor-id="折れ線グラフ">折れ線グラフ</h3>
<p>折れ線グラフは<code>geom_line()</code>を使います。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fmt: skip</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>a, <span class="sc">~</span>b,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">5</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">3</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">4</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">2</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> a, <span class="at">y =</span> b)) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-iris-line" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iris-line-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-iris-line-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iris-line-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;4: 折れ線グラフ
</figcaption>
</figure>
</div>
</div>
</div>
<p>今回は<code>d</code>という何のひねりもないデータフレームを作成して、それを用いて折れ線グラフを作成しています。</p>
<p>なぜわざわざデータフレームを自分で作ったかというと、1個体についてのみ時系列をとったデータを探してくるより、作った方が早かったからです😅</p>
<p>というのも、折れ線グラフを作るときは、多くの場合各個体ごとに何本かの折れ線を描くことが多いと思います<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。各個体ごとに折れ線を作る方法については、<a href="#sec-multi-cat-plot">後のセクション</a>でご確認ください。</p>
<p>ここで覚えていただきたいのは<code>geom_line()</code>で折れ線グラフを作れるということです。</p>
</section>
<section id="棒グラフ" class="level3">
<h3 class="anchored" data-anchor-id="棒グラフ">棒グラフ</h3>
<p>棒グラフも汎用性が高いグラフです。棒グラフはデータフレーム内の集計をするときに役に立ちます。</p>
<p>まずは、<code>iris</code>データセットの<code>Species</code>（種）ごとに個体数を数えた棒グラフを作成します。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species)) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-iris-bar" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iris-bar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-iris-bar-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iris-bar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;5: 棒グラフ
</figcaption>
</figure>
</div>
</div>
</div>
<p>おっと…。まさかのすべて50個体ずつで、棒グラフが全部同じ高さになってしまいました。これはミスではありません！</p>
<p><code>geom_bar()</code>を使って棒グラフを書く際には、縦は自動で個体数をカウントすることになるので、<code>aes(x = Species)</code>とXを指定するだけで横に種類、縦にカウントをとった棒グラフが描けてしまいます。</p>
<p>もし横向きにしたければ、<code>aes(y = Species)</code>とYを指定すればOKです。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">y =</span> Species)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-iris-bar-horizontal" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iris-bar-horizontal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-iris-bar-horizontal-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iris-bar-horizontal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;6: 横向きの棒グラフ
</figcaption>
</figure>
</div>
</div>
</div>
<p>もう1種類いきましょう。<code>iris</code>データセットの<code>Species</code>（種）ごとに、<code>Sepal.Length</code>（がく片の長さ）の平均を計算して、その平均値を棒グラフで表示します。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-iris-bar-mean" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iris-bar-mean-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-iris-bar-mean-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iris-bar-mean-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;7: 種ごとのがく片の長さの平均
</figcaption>
</figure>
</div>
</div>
</div>
<p>今回は<code>geom_bar(stat = "summary", fun = "mean")</code>とすることで、<code>Species</code>ごとに<code>Sepal.Length</code>の平均を計算して棒グラフを描いています。種類ごとに集計をするのだけど、じゃあ集計するときには平均を使ってね、ということを<code>geom_bar()</code>内で指定しています。</p>
<p>この場合は種類ごとにがく片の長さを計算する、ということでXもYもデータフレーム内の変数を使いますので<code>aes(x = Species, y = Sepal.Length)</code>とX, Y両方明示しています。</p>
<p>既にプロットしたい値がデータフレーム内に入っている場合には<code>geom_col()</code>が活躍します。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mean_sepal_length <span class="ot">&lt;-</span> iris <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_length =</span> <span class="fu">mean</span>(Sepal.Length),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> Species</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mean_sepal_length, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> mean_length)) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-iris-bar-col" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iris-bar-col-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-iris-bar-col-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iris-bar-col-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;8: geom_colを使った棒グラフ
</figcaption>
</figure>
</div>
</div>
</div>
<p>ここでは<code>mean_sepal_length</code>というデータフレームを作成し、<code>Species</code>ごとに<code>Sepal.Length</code>の平均を計算して格納しています。つまり、既にプロットしたい値がデータフレーム内に入っている状態です。この場合、<code>geom_col()</code>を使うことで、XとY両方を指定して棒グラフを描くことができます（こちらの方が使用頻度は高いかもしれませんね）。</p>
</section>
<section id="箱ひげ図" class="level3">
<h3 class="anchored" data-anchor-id="箱ひげ図">箱ひげ図</h3>
<p>箱ひげ図は、分布を可視化するのに便利なグラフです。散布図と似ていますが、分布の要約がわかるようになっています。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-iris-box" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iris-box-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-iris-box-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iris-box-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;9: 箱ひげ図
</figcaption>
</figure>
</div>
</div>
</div>
<p>各種類において、<code>Sepal.Length</code>（がく片の長さ）の分布がわかります。四分位数や外れ値がわかるのが特徴です。</p>
</section>
<section id="バイオリンプロット" class="level3">
<h3 class="anchored" data-anchor-id="バイオリンプロット">バイオリンプロット</h3>
<p>バイオリンプロットは、分布を可視化するのに便利なグラフです。箱ひげ図と似ていますが、分布の形状もわかるようになっています。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-iris-violin" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iris-violin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-iris-violin-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iris-violin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;10: バイオリンプロット
</figcaption>
</figure>
</div>
</div>
</div>
<p>各種類において、<code>Sepal.Length</code>（がく片の長さ）の分布がわかります。例えば、<code>setosa</code>はがく片の長さが5あたりに集中していることがわかります。<code>virginica</code>は全体的に長い傾向があることもわかりますね。</p>
</section>
</section>
<section id="sec-color" class="level2">
<h2 class="anchored" data-anchor-id="sec-color">色を付ける</h2>
<p>グラフに色を付ける方法について説明します。</p>
<p>基本的には<code>geom_xxx()</code>内で<code>color = "red"</code>のように指定すれば、色を付けることができます。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"red"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-color" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;11: 散布図の点を赤色に
</figcaption>
</figure>
</div>
</div>
</div>
<p>このように、<code>geom_point(color = "red")</code>で点を赤色にしています。</p>
<p>他のケースも見てみましょう。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> a, <span class="at">y =</span> b)) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-color-line" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-line-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-line-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-line-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;12: 折れ線グラフの線を青色に
</figcaption>
</figure>
</div>
</div>
</div>
<p>これも同様に、<code>geom_line(color = "blue")</code>で線を青色にしています。</p>
<p>棒グラフの場合は、少し事情が異なります。<code>color</code>は棒の枠線の色を指定することになるので、棒自体の色を変えたい場合は<code>fill</code>を使います。</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">fill =</span> <span class="st">"darkgreen"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-color-bar-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-bar-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-bar-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-bar-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;13: 棒グラフの枠線が緑色に
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-color-bar-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-bar-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-bar-2.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-bar-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;14: 棒の色が緑色に
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p><code>fill</code>を使うのは棒グラフやバイオリンプロットなど、塗りつぶしがある場合です。もし枠線と塗りつぶしの両方を変えたい場合は、<code>color</code>と<code>fill</code>の両方を指定してください。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-color-violin-both" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-violin-both-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-violin-both-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-violin-both-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;15: 枠線と塗りつぶしの両方を指定
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="少しいじる" class="level2">
<h2 class="anchored" data-anchor-id="少しいじる">少しいじる</h2>
<p>ここでは少しグラフをいじって、点の形を変えたり、線の種類や太さを変えたりする方法を説明します。</p>
<section id="点の形" class="level3">
<h3 class="anchored" data-anchor-id="点の形">点の形</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">17</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-point-shape" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-point-shape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-point-shape-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-point-shape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;16: 点の形と大きさが変わっています
</figcaption>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><code>shape</code>で点の形を指定
<ul>
<li>形は0から25まであります。<code>?points</code>で確認できます。</li>
</ul></li>
<li><code>size</code>で点の大きさを指定
<ul>
<li>数値が大きいほど大きくなります。</li>
</ul></li>
</ol>
</section>
<section id="線の種類と太さ" class="level3">
<h3 class="anchored" data-anchor-id="線の種類と太さ">線の種類と太さ</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> a, <span class="at">y =</span> b)) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-line-type" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-line-type-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-line-type-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-line-type-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;17: 線の種類と太さが変わっています
</figcaption>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><code>linetype</code>で線の種類を指定
<ul>
<li>0から6まであります。<code>?linetype</code>で確認できます。</li>
</ul></li>
<li><code>linewidth</code>で線の太さを指定
<ul>
<li>数値が大きいほど太くなります。</li>
</ul></li>
</ol>
</section>
</section>
<section id="軸" class="level2">
<h2 class="anchored" data-anchor-id="軸">軸</h2>
<p>基本的なグラフを紹介できたところで、次にこれらのグラフを使いながら、軸の扱いについて説明します。</p>
<section id="軸ラベル" class="level3">
<h3 class="anchored" data-anchor-id="軸ラベル">軸ラベル</h3>
<p>まずはX軸、Y軸のラベルを変更します。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Length of Sepal"</span>, <span class="at">y =</span> <span class="st">"Width of Sepal"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-axis-label" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-axis-label-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-axis-label-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-axis-label-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;18: 軸ラベルを変更
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>labs(x = "Length of Sepal", y = "Width of Sepal")</code>でX軸とY軸のラベルを変更しています。</p>
<p>また、以下のコードは同じ結果を示します。</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Length of Sepal"</span>) <span class="sc">+</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Width of Sepal"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<p>すなわち、<code>labs()</code>はそれ一つでX軸もY軸もラベルを変更することができますが、<code>xlab()</code>、<code>ylab()</code>を使えば片方ずつでも変更できるということです。</p>
<p>次に、軸ラベルの体裁を変更したい場合、以下のようにします。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Length of Sepal"</span>, <span class="at">y =</span> <span class="st">"Width of Sepal"</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"Times New Roman"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"italic"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-axis-font" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-axis-font-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-axis-font-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-axis-font-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;19: 文字の体裁が変わっています
</figcaption>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><code>theme()</code>内の<code>axis.title</code>で変更する
<ul>
<li>X軸Y軸のどちらかだけ変更したければ、<code>axis.title.x</code>のようにします。</li>
</ul></li>
<li><code>element_text()</code>内で具体的にフォントの体裁を指定
<ul>
<li><p>フォントはTimes New Romanを使用しています。これはWindowsの設定であり、MacやLinuxではTimesで表示されると思います。</p></li>
<li><p>今回はわかりやすく派手にしましたが、これらの要素を変更すれば調整できます。</p></li>
<li><p>例えば、<code>face = "bold"</code>にすれば太字にできます。</p></li>
<li><p>他にもありますが、おおむね使うのはこのあたりでしょう。</p></li>
</ul></li>
</ol>
</section>
<section id="軸の目盛り" class="level3">
<h3 class="anchored" data-anchor-id="軸の目盛り">軸の目盛り</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">4.5</span>, <span class="dv">8</span>, .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>))</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-axis-scale" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-axis-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-axis-scale-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-axis-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;20: 目盛りの間隔が変わっています
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-axis-font" class="quarto-xref">図&nbsp;19</a> と比較してもらえればわかりますが、目盛りがX軸は0.5刻み、Y軸は1刻みになるよう変更しました。このように、X（Y）が連続値である場合、<code>scale_x_continuous()</code>（<code>scale_y_continuous()</code>）で変更できます。<code>seq()</code>は数列を作る関数で、<code>seq(from, to, by)</code>の順に指定します。</p>
<p>また、連続変数ではなくカテゴリ変数の場合は、<code>scale_x_discrete()</code>（<code>scale_y_discrete()</code>）を使います。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"setosa"</span>, <span class="st">"versicolor"</span>, <span class="st">"virginica"</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-axis-scale-cat" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-axis-scale-cat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-axis-scale-cat-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-axis-scale-cat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;21: カテゴリのラベルが変わっています
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>breaks</code>で元のラベル、<code>labels</code>で新しいラベルを指定します。それぞれ<code>A</code>, <code>B</code>, <code>C</code>に変更されました。</p>
<p>目盛りも同様にフォントのスタイルを変更できます。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"Times New Roman"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-scale-font" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-scale-font-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-scale-font-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-scale-font-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;22: 数字のフォントが変わっています
</figcaption>
</figure>
</div>
</div>
</div>
<p>もはや訳が分からない図ですが、このように体裁は変更可能です。要素は大体上と同じで、<code>axis.text.x</code>のようにどちらかだけ変更することも可能です。</p>
<p>また、<code>axis.ticks</code>で目盛りを消去することも可能です。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"Times New Roman"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-delete-memori" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-delete-memori-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-delete-memori-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-delete-memori-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;23: 目盛りが消えています
</figcaption>
</figure>
</div>
</div>
</div>
<p>お判りいただけますか？軸の数字は残っていますが、目盛り線は消えています。<a href="#fig-scale-font" class="quarto-xref">図&nbsp;22</a> と見比べてみてください。</p>
</section>
<section id="軸の範囲" class="level3">
<h3 class="anchored" data-anchor-id="軸の範囲">軸の範囲</h3>
<p>X軸とY軸の範囲を設定する方法です。これまでの図ではだいたい4から8あたりがXの範囲、2.0から4.5がYの範囲でした。<code>xlim(a, b)</code>と<code>ylim(a, b)</code>で設定できます。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">5</span>, <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">3</span>, <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"Times New Roman"</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-change-range" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-change-range-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-change-range-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-change-range-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;24: 範囲を変えました
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="注釈" class="level2">
<h2 class="anchored" data-anchor-id="注釈">注釈</h2>
<p>グラフの中に文字や線を入れる方法について説明します。文字や線を入れるには<code>annotate()</code>関数を使います。</p>
<section id="文字" class="level3">
<h3 class="anchored" data-anchor-id="文字">文字</h3>
<p>まずは文字を入れる方法です。文字は<code>annotate()</code>内で<code>"text"</code>か<code>"segment"</code>を指定することで挿入可能です。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"ggplot is</span><span class="sc">\n</span><span class="st">wonderful!"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">6.5</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">4</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Times New Roman"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#CC6666"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">10</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-annotate" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-annotate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-annotate-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-annotate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;25: 表内に文字を入れられました
</figcaption>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><p><code>annotate("text", label = "hogehoge")</code>で<code>hogehoge</code>と文字を入れることができる</p></li>
<li><p><code>x</code>と<code>y</code>の位置を指定しないと反映されない</p></li>
<li><p>改行したい場合、<code>\n</code>を入れる</p></li>
<li><p>フォント、色、サイズも指定できる</p></li>
</ol>
<p>関数一つで意外と簡単にできます。</p>
</section>
<section id="セグメント" class="level3">
<h3 class="anchored" data-anchor-id="セグメント">セグメント</h3>
<p>棒線や矢印を付けることも可能です。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"segment"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">5</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="dv">7</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">4</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> <span class="fl">2.5</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#CC6666"</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-segment-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-segment-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-segment-1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-segment-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;26: 斜めに棒線が入りました。
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"segment"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">5</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="dv">7</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">4</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> <span class="fl">2.5</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#CC6666"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="at">units =</span> <span class="st">"cm"</span>))</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-segment-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-segment-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-segment-2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-segment-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;27: 矢印になりました。
</figcaption>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><code>"segment"</code>で棒線ができる</li>
<li><code>x</code>と<code>xend</code>、<code>y</code>と<code>yend</code>を指定する必要がある
<ul>
<li><span class="math inline">\((x, y)\)</span>から<span class="math inline">\((xend, yend)\)</span>までの2点を結ぶようにできます。</li>
</ul></li>
<li><code>linewidth</code>で線の太さを指定可
<ul>
<li>他の要素も文字の場合と同様に指定できますが、<code>size</code>が<code>linewidth</code>に置き換わっています。</li>
</ul></li>
<li><code>arrow = arrow(length = unit(x, units = "cm"))</code>で矢じりが付く
<ul>
<li><code>x</code>で矢じりのサイズ、<code>units</code>は単位で、他にmmやinchesなどがあります。</li>
<li>ややこしいですが、<code>xend</code>と<code>yend</code>の方に向かって矢印が付きます。</li>
</ul></li>
</ol>
<p>以上のように、文字だけでなく線や矢印を追加することができます。</p>
<p>今回はわかりやすくでかでかと描きましたが、例えばグラフ内の特徴的な部分に注釈をつけたい場合などに役立ちます。</p>
</section>
</section>
<section id="時系列のプロット" class="level2">
<h2 class="anchored" data-anchor-id="時系列のプロット">時系列のプロット</h2>
<p>時系列データをプロットする際に、元データには年と月が別々に入っていることもあると思います。それらのデータをうまく使いながら時系列プロットを作成する方法について説明します。</p>
<p>まずは年と月が別々に入っているデータを想定し、仮のデータフレームを作成します。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fmt: skip</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>time_data <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>year, <span class="sc">~</span>month, <span class="sc">~</span>value,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">4</span>, <span class="dv">22</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">5</span>, <span class="dv">30</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">6</span>, <span class="dv">26</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">7</span>, <span class="dv">35</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">8</span>, <span class="dv">40</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">9</span>, <span class="dv">38</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">10</span>, <span class="dv">45</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">11</span>, <span class="dv">50</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">12</span>, <span class="dv">48</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">52</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2021</span>, <span class="dv">2</span>, <span class="dv">55</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2021</span>, <span class="dv">3</span>, <span class="dv">53</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>このように、<code>year</code>と<code>month</code>が別々に入っているデータを想定します。</p>
<p>このデータを時系列プロットにするためには、まず<code>year</code>と<code>month</code>を結合して日付データに変換する必要があります。これには<code>lubridate</code>パッケージを使うと便利です。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("lubridate")</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>time_data <span class="ot">&lt;-</span> time_data <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">make_date</span>(year, month, <span class="dv">1</span>))</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div id="tbl-time-series-data" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-time-series-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;1: 日付データを追加したデータフレーム
</figcaption>
<div aria-describedby="tbl-time-series-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_bup04g9tv8kpdpnsb06u(i, j, css_id) {
          var table = document.getElementById("tinytable_bup04g9tv8kpdpnsb06u");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_bup04g9tv8kpdpnsb06u(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_bup04g9tv8kpdpnsb06u");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '12', j: 0 }, { i: '12', j: 1 }, { i: '12', j: 2 }, { i: '12', j: 3 },  ], css_id: 'tinytable_css_owkhcw6votdiir7f5zxk',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 },  ], css_id: 'tinytable_css_00g49s0jh7f10qfrbs1w',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_bup04g9tv8kpdpnsb06u(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_owkhcw6votdiir7f5zxk, .table th.tinytable_css_owkhcw6votdiir7f5zxk { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_00g49s0jh7f10qfrbs1w, .table th.tinytable_css_00g49s0jh7f10qfrbs1w { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_bup04g9tv8kpdpnsb06u" style="table-layout: fixed; width: 100% !important; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">year</th>
                <th scope="col" data-row="0" data-col="1">month</th>
                <th scope="col" data-row="0" data-col="2">value</th>
                <th scope="col" data-row="0" data-col="3">date</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">2020</td>
                  <td data-row="1" data-col="1">4</td>
                  <td data-row="1" data-col="2">22</td>
                  <td data-row="1" data-col="3">2020-04-01</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">2020</td>
                  <td data-row="2" data-col="1">5</td>
                  <td data-row="2" data-col="2">30</td>
                  <td data-row="2" data-col="3">2020-05-01</td>
                </tr>
                <tr>
                  <td data-row="3" data-col="0">2020</td>
                  <td data-row="3" data-col="1">6</td>
                  <td data-row="3" data-col="2">26</td>
                  <td data-row="3" data-col="3">2020-06-01</td>
                </tr>
                <tr>
                  <td data-row="4" data-col="0">2020</td>
                  <td data-row="4" data-col="1">7</td>
                  <td data-row="4" data-col="2">35</td>
                  <td data-row="4" data-col="3">2020-07-01</td>
                </tr>
                <tr>
                  <td data-row="5" data-col="0">2020</td>
                  <td data-row="5" data-col="1">8</td>
                  <td data-row="5" data-col="2">40</td>
                  <td data-row="5" data-col="3">2020-08-01</td>
                </tr>
                <tr>
                  <td data-row="6" data-col="0">2020</td>
                  <td data-row="6" data-col="1">9</td>
                  <td data-row="6" data-col="2">38</td>
                  <td data-row="6" data-col="3">2020-09-01</td>
                </tr>
                <tr>
                  <td data-row="7" data-col="0">2020</td>
                  <td data-row="7" data-col="1">10</td>
                  <td data-row="7" data-col="2">45</td>
                  <td data-row="7" data-col="3">2020-10-01</td>
                </tr>
                <tr>
                  <td data-row="8" data-col="0">2020</td>
                  <td data-row="8" data-col="1">11</td>
                  <td data-row="8" data-col="2">50</td>
                  <td data-row="8" data-col="3">2020-11-01</td>
                </tr>
                <tr>
                  <td data-row="9" data-col="0">2020</td>
                  <td data-row="9" data-col="1">12</td>
                  <td data-row="9" data-col="2">48</td>
                  <td data-row="9" data-col="3">2020-12-01</td>
                </tr>
                <tr>
                  <td data-row="10" data-col="0">2021</td>
                  <td data-row="10" data-col="1">1</td>
                  <td data-row="10" data-col="2">52</td>
                  <td data-row="10" data-col="3">2021-01-01</td>
                </tr>
                <tr>
                  <td data-row="11" data-col="0">2021</td>
                  <td data-row="11" data-col="1">2</td>
                  <td data-row="11" data-col="2">55</td>
                  <td data-row="11" data-col="3">2021-02-01</td>
                </tr>
                <tr>
                  <td data-row="12" data-col="0">2021</td>
                  <td data-row="12" data-col="1">3</td>
                  <td data-row="12" data-col="2">53</td>
                  <td data-row="12" data-col="3">2021-03-01</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>ここで<code>make_date(year, month, 1)</code>を使って、各年と月の1日の日付データを作成しています。これで<code>date</code>列が追加されました。</p>
<p>次に、この<code>date</code>列を使って時系列プロットを作成します。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-time-series" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-time-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-time-series-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-time-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;28: 時系列プロット
</figcaption>
</figure>
</div>
</div>
</div>
<p>これで時系列がプロットできていることがわかるかと思います。</p>
<p>ただ、このままだと目盛りが「4 2020」のようになっており、日本人には馴染みが薄い形式です。そこで、<code>scale_x_date()</code>を使って目盛りの形式を変更します。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%Y-%m"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"2 month"</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-time-series-format" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-time-series-format-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-time-series-format-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-time-series-format-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;29: 目盛りの形式を変更しました
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>date_labels = "%Y-%m"</code>で年-月の形式に変更し、<code>date_breaks = "2 month"</code>で2か月ごとに目盛りを設定しています。間隔を調整したいときは、<code>date_breaks</code>の値を変更してください。</p>
<p>ラベルはいろいろ変更できます。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%Y年%m月"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"3 month"</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-time-series-format-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-time-series-format-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-time-series-format-2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-time-series-format-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;30: 別の形式に変更しました
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>%Y</code>で年、<code>%m</code>で月を表します。</p>
<p>ちなみにこの状態だと1桁の月は0埋めされてしまいます。1桁の月を0埋めせずに表示したい場合は、WindowsとMac/Linuxで異なるのですが、以下の方法で実装可能です。</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Windowsの場合</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Mac/Linuxの場合</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Windowsの場合は少々複雑です。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="st">"2 months"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> \(x) {</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">format</span>(x, <span class="st">"%Y年"</span>),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.integer</span>(<span class="fu">format</span>(x, <span class="st">"%m"</span>)),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"月"</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-time-series-format-3-win" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-time-series-format-3-win-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-time-series-format-3-win-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-time-series-format-3-win-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;31: 1桁の月を0埋めしない形式（Windows）
</figcaption>
</figure>
</div>
</div>
</div>
<p>注目すべきところは<code>labels = \(x) { ... }</code>の部分です。<code>format(x, "%Y年")</code>で年を取得し、<code>as.integer(format(x, "%m"))</code>で月を取得したのち整数に変換しています。こうすることで1桁の月は0埋めされなくなります。最後に<code>paste0()</code>で年と月の整数、“月”を結合しています。</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>MacやLinuxの場合はWindowsより簡単です。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%Y年%-m月"</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"2 month"</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>僕の環境はWindowsなので実行できませんが、<code>%-m</code>とすることで1桁の月を0埋めせずに表示できます。</p>
</div>
</div>
</div>
</section>
<section id="複数のカテゴリのプロットと凡例" class="level2">
<h2 class="anchored" data-anchor-id="複数のカテゴリのプロットと凡例">複数のカテゴリのプロットと凡例</h2>
<section id="sec-multi-cat-plot" class="level3">
<h3 class="anchored" data-anchor-id="sec-multi-cat-plot">複数のカテゴリのプロット</h3>
<p>ここでは<code>Orange</code>データセットを使って複数のカテゴリのプロットと、凡例について説明します。</p>
<p>複数のカテゴリのプロットとは、以下のデータを見ていただけると早いと思います。</p>
<div class="cell">
<div id="tbl-orange" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-orange-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;2: `Orangeデータセットの一部
</figcaption>
<div aria-describedby="tbl-orange-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_srruz395vpukqfxrr3bq(i, j, css_id) {
          var table = document.getElementById("tinytable_srruz395vpukqfxrr3bq");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_srruz395vpukqfxrr3bq(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_srruz395vpukqfxrr3bq");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '10', j: 0 }, { i: '10', j: 1 }, { i: '10', j: 2 },  ], css_id: 'tinytable_css_vdd1o7t5z9r8543f25f3',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_7ws8jnrhgmc3pzmi4mum',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_srruz395vpukqfxrr3bq(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_vdd1o7t5z9r8543f25f3, .table th.tinytable_css_vdd1o7t5z9r8543f25f3 { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_7ws8jnrhgmc3pzmi4mum, .table th.tinytable_css_7ws8jnrhgmc3pzmi4mum { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_srruz395vpukqfxrr3bq" style="table-layout: fixed; width: 100% !important; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Tree</th>
                <th scope="col" data-row="0" data-col="1">age</th>
                <th scope="col" data-row="0" data-col="2">circumference</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">1</td>
                  <td data-row="1" data-col="1">118</td>
                  <td data-row="1" data-col="2">30</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">1</td>
                  <td data-row="2" data-col="1">484</td>
                  <td data-row="2" data-col="2">58</td>
                </tr>
                <tr>
                  <td data-row="3" data-col="0">1</td>
                  <td data-row="3" data-col="1">664</td>
                  <td data-row="3" data-col="2">87</td>
                </tr>
                <tr>
                  <td data-row="4" data-col="0">1</td>
                  <td data-row="4" data-col="1">1004</td>
                  <td data-row="4" data-col="2">115</td>
                </tr>
                <tr>
                  <td data-row="5" data-col="0">1</td>
                  <td data-row="5" data-col="1">1231</td>
                  <td data-row="5" data-col="2">120</td>
                </tr>
                <tr>
                  <td data-row="6" data-col="0">1</td>
                  <td data-row="6" data-col="1">1372</td>
                  <td data-row="6" data-col="2">142</td>
                </tr>
                <tr>
                  <td data-row="7" data-col="0">1</td>
                  <td data-row="7" data-col="1">1582</td>
                  <td data-row="7" data-col="2">145</td>
                </tr>
                <tr>
                  <td data-row="8" data-col="0">2</td>
                  <td data-row="8" data-col="1">118</td>
                  <td data-row="8" data-col="2">33</td>
                </tr>
                <tr>
                  <td data-row="9" data-col="0">2</td>
                  <td data-row="9" data-col="1">484</td>
                  <td data-row="9" data-col="2">69</td>
                </tr>
                <tr>
                  <td data-row="10" data-col="0">2</td>
                  <td data-row="10" data-col="1">664</td>
                  <td data-row="10" data-col="2">111</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p><code>Tree</code>は木の識別子で、1～5まであります。<code>age</code>は日齢、<code>circumference</code>は幹の周囲です。</p>
<p>ここでやりたいことは、木の種類ごとに、日齢と幹の周囲を軸にとってプロットすることです。これをただプロットしてしまうと、</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference)) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-orange-pool" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-orange-pool-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-orange-pool-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-orange-pool-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;32: すべてのデータを放り込みました
</figcaption>
</figure>
</div>
</div>
</div>
<p>これでは各点がどの木のものなのか判別できない状態です。</p>
<p>これを識別するために、色を付けたいとしましょう。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference, <span class="at">color =</span> Tree)) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-orange-color" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-orange-color-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-orange-color-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-orange-color-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;33: 色が分かれました
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#sec-color">前のセクション</a>では<code>geom_point(color = "red")</code>のように線全体に対して同じ色を付けましたが、今回の方法では、色を付けることを前提として、<code>aes()</code>内の<code>color =</code>で指定した種類ごとに色が付くという設定です。</p>
<p>これでとりあえずはどの点がどの木のものかわかるようになりました。</p>
<p>今は散布図なので色を分けるだけで済みますが、折れ線グラフのような場合は、色だけでなく線の種類を変えたいかもしれません。そんな時は次のようにします。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference, <span class="at">color =</span> Tree, <span class="at">linetype =</span> Tree)) <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-orange-linetype" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-orange-linetype-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-orange-linetype-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-orange-linetype-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;34: 折れ線の種類も分かれました
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>linetype = Tree</code>を追加することで線の種類も木の種類ごとに変更することができました。</p>
<p>このように<code>aes()</code>内で要素を追加することで種類ごとに分けることができます。他にも散布図の点の形をカテゴリごとに変えたければ<code>shape = Tree</code>のようにすれば可能です。</p>
<p>まだ色遣いなどは不格好ですが、いったんこのまま進めます。</p>
</section>
<section id="凡例の位置" class="level3">
<h3 class="anchored" data-anchor-id="凡例の位置">凡例の位置</h3>
<p>次にしたいのは、凡例の設定です。凡例は現在右側に表示されていますが、まずはこれを下に表示したいとします。</p>
<p>これは、<code>theme()</code>内の<code>legend.position</code>で設定できます。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference, <span class="at">color =</span> Tree)) <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-orange-legend-position" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-orange-legend-position-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-orange-legend-position-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-orange-legend-position-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;35: 凡例が下に来ました
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>theme(legend.position = "bottom")</code>を設定することで、凡例の位置が下になりました。もちろんbottom以外にもtop, left, right（デフォルト）などを指定することができます。</p>
<p>さらに凡例を消したい場合は次のようにします。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference, <span class="at">color =</span> Tree)) <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-orange-legend-delete" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-orange-legend-delete-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-orange-legend-delete-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-orange-legend-delete-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;36: 凡例を消しました
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>theme(legend.position = "none")</code>で凡例を消すことができました。</p>
</section>
<section id="凡例の調整" class="level3">
<h3 class="anchored" data-anchor-id="凡例の調整">凡例の調整</h3>
<p>例えば、凡例のタイトルだけ消したい場合が結構あると思います。<a href="#fig-orange-color" class="quarto-xref">図&nbsp;33</a> の例でいえば、Treeという文字は消したいということです。</p>
<p>そんな場合は、<code>guides()</code>を使います。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference, <span class="at">color =</span> Tree)) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="cn">NULL</span>))</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-orange-legend-delte-title" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-orange-legend-delte-title-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-orange-legend-delte-title-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-orange-legend-delte-title-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;37: 凡例のタイトルを削除
</figcaption>
</figure>
</div>
</div>
</div>
<p>Treeというタイトルが消えました。</p>
<p>ここでは<code>guides(color = guide_legend(title = NULL))</code>としていますが、<code>aes()</code>内で例えば<code>linetype</code>を使っている場合は、<code>guides()</code>内も<code>linetype =</code>にする必要があります。</p>
</section>
</section>
<section id="テーマ" class="level2">
<h2 class="anchored" data-anchor-id="テーマ">テーマ</h2>
<p>ggplotではテーマを選ぶことができます。デフォルトではこれまでの図のように背景がグレーになっていますが、ほとんどの場合で背景は白にしたいですよね。</p>
<p>背景だけでなく、罫線等もテーマで変更することができます。</p>
<section id="プリセットのテーマ" class="level3">
<h3 class="anchored" data-anchor-id="プリセットのテーマ">プリセットのテーマ</h3>
<p>いくつかのテーマが準備されています。代表的なものをいくつかご紹介します。</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">minimal</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">bw</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">classic</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false" href="">linedraw</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false" href="">light</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false" href="">void</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-minimal" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-minimal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-minimal-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-minimal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;38: <code>theme_minimal()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-bw" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-bw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-bw-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-bw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;39: <code>theme_bw()</code>
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>theme_minimal()</code>と比べて外枠が付いています。</p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-classic" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-classic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-classic-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-classic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;40: <code>theme_classic()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-linedraw" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-linedraw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-linedraw-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-linedraw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;41: <code>theme_linedraw()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-light" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-light-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-light-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-light-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;42: <code>theme_light()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-void" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-void-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-void-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-void-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;43: <code>theme_void()</code>
</figcaption>
</figure>
</div>
</div>
</div>
<p>さすがにやりすぎでは…と思うかもしれませんが、GISで地図を可視化するようなときに重宝します。</p>
</div>
</div>
</div>
</section>
<section id="theme関数" class="level3">
<h3 class="anchored" data-anchor-id="theme関数"><code>theme()</code>関数</h3>
<p>ここまでご紹介したものの中で<code>theme()</code>を使ったものがいくつかありました。</p>
<p>ここで<code>theme()</code><strong>は</strong><code>theme_xxx()</code><strong>の後に使う</strong>ということに注意してください。</p>
<p>これは、<code>theme_xxx()</code>が<code>theme()</code>の設定を上書きしてしまうためです。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-miss" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-miss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-miss-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-miss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;44: 失敗例
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>theme(axis.title = element_text(color = "red"))</code>で軸ラベルを赤色に設定していますが、出力されたものは黒いラベルになっています。</p>
<p>順番を逆にすれば、</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>))</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-success" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-success-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-success-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-success-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;45: 正しい例
</figcaption>
</figure>
</div>
</div>
</div>
<p>このようにしっかり反映されます。</p>
<p><code>theme()</code>は<code>theme_xxx()</code>で設定できない部分を細かく調整したい場合に使います。できることはたくさんあるので全てを説明することはできませんが、例えば以下のようなことができます。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>, <span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-custom" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-custom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-custom-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-custom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;46: カスタムテーマ
</figcaption>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><code>panel.grid = element_blank()</code>で罫線を消す</li>
<li><code>legend.position = "none"</code>で凡例を消す</li>
<li><code>axis.title</code>と<code>axis.text</code>で軸ラベルと目盛りのフォントとサイズを変更</li>
</ol>
<p>このように、「グラフのここを変えたいんだけどなぁ…」みたいなことは<code>theme()</code>で解決できることが多かったりします。</p>
<p>詳しくは<code>?theme</code>で確認してみてください。引数名はわかりやすいので、比較的目的を見つけやすいと思います。</p>
</section>
</section>
<section id="新しくなったthemeの設定" class="level2">
<h2 class="anchored" data-anchor-id="新しくなったthemeの設定">新しくなった<code>theme()</code>の設定</h2>
<section id="paperとink" class="level3">
<h3 class="anchored" data-anchor-id="paperとink"><code>paper</code>と<code>ink</code></h3>
<p>ggplot2のバージョン4.0.0からは、<code>theme_xxx()</code>内で色に関するデフォルト設定が追加できるようになりました。</p>
<p>百聞は一見に如かずということで、以下のコードをご覧ください。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"papayawhip"</span>, <span class="at">ink =</span> <span class="st">"darkgreen"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-v4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-v4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-v4-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-v4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;47: theme()内での色のデフォルト設定
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>paper</code>で背景色、<code>ink</code>で前景色を指定することができます。前景色は、軸ラベル、目盛り、点などに適用されます。</p>
<p>ここのポイントは、使用する色を統一的に指定できるということで、例えば<code>theme()</code>内で<code>axis.title</code>や<code>axis.text</code>の色を指定する必要がなくなります。</p>
</section>
<section id="geom" class="level3">
<h3 class="anchored" data-anchor-id="geom"><code>geom</code></h3>
<p>また、<code>theme()</code>内で<code>geom</code>を設定することで、色に関するデフォルトを設定しつつ<code>geom_xxx()</code>内でその設定を参照することが可能です。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"papayawhip"</span>, <span class="at">ink =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="fu">element_geom</span>(<span class="at">color =</span> <span class="st">"coral"</span>, <span class="at">pointsize =</span> <span class="dv">3</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-theme-v4-geom" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-v4-geom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-v4-geom-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-v4-geom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;48: geom内での色のデフォルト設定
</figcaption>
</figure>
</div>
</div>
</div>
<p>ここでは、<code>theme(geom = element_geom(color = "coral", pointsize = 3))</code>で点の色と大きさを指定しています。<code>element_geom()</code>は<code>geom_point()</code>、<code>geom_line()</code>、<code>geom_bar()</code>などで共通して使われる設定を指定できます。一元管理できる点が便利ですね。</p>
<p>ちなみに<code>geom</code>を設定しないと、点の色は<code>ink</code>の色、すなわちdarkgreenになります。</p>
</section>
<section id="from_theme" class="level3">
<h3 class="anchored" data-anchor-id="from_theme"><code>from_theme()</code></h3>
<p>さらに、<code>geom_xxx()</code>内で<code>from_theme()</code>を使うことにより、<code>theme()</code>内で設定した色を<code>geom_xxx()</code>内で参照することも可能です。</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width)) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">from_theme</span>(accent))) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">geom =</span> <span class="fu">element_geom</span>(<span class="at">accent =</span> <span class="st">"blue"</span>))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">geom =</span> <span class="fu">element_geom</span>(<span class="at">accent =</span> <span class="st">"orange"</span>))</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-theme-v4-from_theme-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-v4-from_theme-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-v4-from_theme-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-v4-from_theme-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;49: アクセントカラーを青に
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-theme-v4-from_theme-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-v4-from_theme-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-v4-from_theme-2.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-v4-from_theme-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;50: アクセントカラーをオレンジに
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>ここでは、<code>from_theme(accent)</code>で<code>theme()</code>内で設定した<code>accent</code>を参照しています。<code>theme(geom = element_geom(accent = "blue"))</code>のように設定することで、アクセントカラーを青に変更できます。</p>
<p>これは<code>element_geom(color = "blue")</code>と一見同じことをしているように思えますが、たくさんのプロットを作成する場合、<code>accent</code>を一括で変更できる点で便利です。</p>
<section id="使用例" class="level4">
<h4 class="anchored" data-anchor-id="使用例">使用例</h4>
<ul>
<li>ケース：
<ul>
<li>論文執筆をしており、論文用とスライド用で色を変えたい</li>
<li><code>geom_point()</code>と<code>geom_smooth()</code>を使っており、<code>geom_smooth()</code>の色は論文用とスライド用で変えたい</li>
</ul></li>
<li>解決策：</li>
<li>テーマ側でアクセントカラーを定義</li>
<li><code>geom_line()</code>のみ<code>from_theme(accent)</code>を参照させる</li>
<li>こうするとプロットの本体コードは共通のまま、テーマを差し替えるだけで線の色だけ切り替わる</li>
</ul>
<p>まず、あらかじめテーマを2つ用意しておきます。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 論文用のテーマ</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>theme_paper <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"white"</span>, <span class="at">ink =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">geom =</span> <span class="fu">element_geom</span>(<span class="at">accent =</span> <span class="st">"navy"</span>))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># スライド用のテーマ</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>theme_slide <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"black"</span>, <span class="at">ink =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">geom =</span> <span class="fu">element_geom</span>(<span class="at">accent =</span> <span class="st">"orange"</span>))</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>次に、テーマを除くプロット本体を作成します。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(age, circumference)) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 散布図は灰色で固定</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"gray60"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">from_theme</span>(accent)),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> lm,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (days)"</span>, <span class="at">y =</span> <span class="st">"Circumference (mm)"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>この時点で<code>p</code>をプロットしても、折れ線の色は変わりません。まだ<code>theme()</code>を付けておらず、アクセントカラーが指定されていないためです。</p>
<p>それでは先に設定したテーマを<code>p</code>に適用します。</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>p_paper <span class="ot">&lt;-</span> p <span class="sc">+</span> theme_paper</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>p_slide <span class="ot">&lt;-</span> p <span class="sc">+</span> theme_slide</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>p_paper</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>p_slide</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-theme-final-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-final-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-final-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-final-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;51: 論文用のテーマ
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-theme-final-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-theme-final-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-theme-final-2.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-theme-final-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;52: スライド用のテーマ
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>今回は1種類のスライドを論文用とスライド用に分ける想定しかしていませんが、たくさんのスライドを作る場合、アクセントカラーを一括で変えられる点で便利です。コードはそのままに、<code>tmeme_paper</code>と<code>theme_slide</code>の<code>accent</code>だけ変えればよいからです。</p>
</section>
</section>
</section>
<section id="新しくなったラベル設定" class="level2">
<h2 class="anchored" data-anchor-id="新しくなったラベル設定">新しくなったラベル設定</h2>
<p>ここまでは<code>labs()</code>や<code>xlab()</code>、<code>ylab()</code>で軸ラベルを設定してきましたが、あらかじめラベルを設定しておき、自動で表示させることが可能になりました。</p>
<p><code>Orange</code>データセットを使って説明します。</p>
<p>まず、何もしない場合は以下のようになります。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference)) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-label-default" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-label-default-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-label-default-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-label-default-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;53: デフォルトのラベル
</figcaption>
</figure>
</div>
</div>
</div>
<p>X軸は<code>age</code>、Y軸は<code>circumference</code>と表示されています。</p>
<p>これを、あらかじめラベルを設定しておくことができるようになりました。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tibbleは属性を保持しやすい</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Orange)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 単位: age=days, circumference=mm</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>age, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Age (days)"</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>circumference, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Trunk circumference (mm)"</span></span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><code>attr()</code>で変数に属性を追加
<ul>
<li><code>df</code>の<code>age</code>の<code>label</code>属性に<code>Age (days)</code>を追加している、という解釈です。</li>
<li><code>Age (days)</code>や<code>Trunk circumference (mm)</code>の部分がラベルなのでここを自由に変更できます。</li>
</ul></li>
</ul>
<p>これで<code>df</code>を使ってプロットすると、</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference)) <span class="sc">+</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-label-custom" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-label-custom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-label-custom-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-label-custom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;54: カスタムラベル
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>labs()</code>を使わなくても、X軸とY軸のラベルが変更されました。</p>
<p>1つのグラフであれば<code>labs()</code>で設定した方が労力が少ないかもしれませんが、大量のグラフを作成する場合、あらかじめラベルを設定しておけば、<code>labs()</code>をいちいち書く必要がなくなるので便利です。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>tibble形式について
</div>
</div>
<div class="callout-body-container callout-body">
<p>皆さんはCSVデータを読み込むとき、何の関数を使用していますか？</p>
<p>多いのはbase Rの<code>read.csv()</code>や、tidyverseに含まれるreadrパッケージの<code>read_csv()</code>だと思います。</p>
<p><code>read.csv()</code>はdata.frame形式、<code>read_csv()</code>はtibble形式でデータを読み込みます。<strong>tibbleはdata.frameを改良したデータ構造</strong>で、tidyverseの多くのパッケージで標準的に使われており、以下のような特徴があります。</p>
<ul>
<li>見やすい表示 すべての行を出さず、必要に応じて端だけを表示するので、データの中身を把握しやすいです。</li>
<li>型情報を保持 各列のデータ型（数値・文字列など）が一緒に表示され、解析時に便利です。</li>
<li>属性を保持 labelのような属性が処理中に消えにくく、ラベル管理や可視化との相性が良いです。</li>
</ul>
<p>tibbleはdata.frameとほぼ同じように使えるので、tidyverseを使う場合はtibble形式でデータを扱うことをおすすめします。困ったら<code>tibble::as_tibble()</code>で変換できます。</p>
</div>
</div>
</section>
<section id="カラーパレット" class="level2">
<h2 class="anchored" data-anchor-id="カラーパレット">カラーパレット</h2>
<p>ggplot2では、連続値やカテゴリ値を色で表現する際に「カラーパレット」を使います。</p>
<p>例えば<code>scale_colour_brewer()</code>や<code>scale_fill_viridis_c()</code>を指定すると、データの値に応じて自動的に一貫した配色が割り当てられます。</p>
<p>パレットを選ぶことで、見やすさや配色の意味（アクセシビリティ対応や論文用の白黒印刷など）を調整でき、グラフの理解度や印象に大きく影響します。</p>
<section id="連続値のカラースケール" class="level3">
<h3 class="anchored" data-anchor-id="連続値のカラースケール">連続値のカラースケール</h3>
<p>まずは例を見てみましょう。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">colour =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_continuous</span>() <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Petal length"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-color-default" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-default-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-default-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-default-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;55: scale_colour_continuous()を使った例
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>scale_colour_continuous()</code>は連続変数を色で表すためのカラースケールで、デフォルトの配色が使われ、数値の大小をなめらかなグラデーションで示しています。</p>
<p>自分で色を指定することも可能です。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_continuous</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Petal length"</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_continuous</span>(<span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#FEE0D2"</span>, <span class="st">"#FC9272"</span>, <span class="st">"#DE2D26"</span>)) <span class="sc">+</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Petal length"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-color-continuous-custom-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-continuous-custom-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-continuous-custom-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-continuous-custom-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;56: 左: 青から赤へのグラデーション
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-color-continuous-custom-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-continuous-custom-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-continuous-custom-2.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-continuous-custom-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;57: 右: 指定した3色のグラデーション
</figcaption>
</figure>
</div>
</div>
</div>
<p>lowからhighまでの2色を指定する方法や、自分で3色以上を指定する方法などがあります。</p>
<p>また、他の例として<code>scale_colour_viridis_c()</code>を使う方法もあったりします。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Petal length"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-color-viridis" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-viridis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-viridis-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-viridis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;58: scale_colour_viridis_c()を使った例
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>scale_colour_viridis_c()</code>は連続変数を色で表すためのカラースケールで、視認性・色覚バリアフリー・白黒印刷対応に優れたviridisパレットを使います。<code>plasma</code>以外にも<code>magma</code>や<code>inferno</code>、<code>cividis</code>などのバリエーションがあります。</p>
</section>
<section id="カテゴリ値のカラースケール" class="level3">
<h3 class="anchored" data-anchor-id="カテゴリ値のカラースケール">カテゴリ値のカラースケール</h3>
<p>カテゴリ変数を色で表す場合は、<code>scale_colour_brewer()</code>や<code>scale_colour_viridis_d()</code>などを使います<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Species)) <span class="sc">+</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Species"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-color-brewer" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-brewer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-brewer-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-brewer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;59: scale_colour_brewer()を使った例
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>scale_colour_brewer()</code>の<code>palette</code>には<code>Set1</code>、<code>Set2</code>、<code>Dark2</code>、<code>Paired</code>などのカラーパレットがあり、用途に応じて選択できます。</p>
<p>また、<code>scale_colour_discrete()</code>を使う方法もあります。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Species)) <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>() <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Species"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-color-discrete" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-discrete-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-discrete-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-discrete-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;60: scale_colour_discrete()を使った例
</figcaption>
</figure>
</div>
</div>
</div>
<p>なんというか、これぞggplot2！という感じの配色ですね。もちろん色を自分で指定することも可能です。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Species)) <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkred"</span>, <span class="st">"darkblue"</span>, <span class="st">"darkgreen"</span>)) <span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Species"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-color-discrete-custom" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-discrete-custom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-discrete-custom-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-discrete-custom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;61: 指定した3色
</figcaption>
</figure>
</div>
</div>
</div>
<p>さらに、<code>scale_colour_viridis_d()</code>だと以下のようになります。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Species)) <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Species"</span>)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-color-viridis-d" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-color-viridis-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-color-viridis-d-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-color-viridis-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;62: scale_colour_viridis_d()を使った例
</figcaption>
</figure>
</div>
</div>
</div>
<p>今回はSpeciesがカテゴリ変数なので、先ほどの<code>scale_colour_viridis_c()</code>よりも<code>scale_colour_viridis_d()</code>の方が適していると言えますね。</p>
<p>今回は代表的なカラースケールをご紹介しましたが、他にもカラーパレットはたくさんあります。今回は入門編ということでこのあたりにしておきますが、いろいろ紹介してくれているページはあるので、例えば以下のようなページを参考にしてみてください。</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><a href="https://r-graph-gallery.com/">The R Graph Gallery</a></p>
</div>
</div>
</div>
</section>
</section>
<section id="いろいろ含めたグラフを作ってみる" class="level2">
<h2 class="anchored" data-anchor-id="いろいろ含めたグラフを作ってみる">いろいろ含めたグラフを作ってみる</h2>
<p>ではここで、これまでの内容を踏まえて、新しいプロットを作ってみます。データはこれもデフォルトで用意されている<code>mpg</code>データセットを使います。</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(diamonds)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>cut, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Cut"</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>price, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Price (USD)"</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>carat, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Carat"</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>theme_use <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"gray98"</span>, <span class="at">ink =</span> <span class="st">"navy"</span>) <span class="sc">+</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="fu">element_geom</span>(</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">accent =</span> <span class="st">"purple"</span>,</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">paper =</span> <span class="st">"pink"</span>,</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">pointsize =</span> <span class="dv">2</span>,</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">borderwidth =</span> <span class="dv">1</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>),</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>)</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(cut, price)) <span class="sc">+</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">from_theme</span>(accent))) <span class="sc">+</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"gray98"</span>, <span class="at">ink =</span> <span class="st">"navy"</span>) <span class="sc">+</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>  theme_use</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(carat, price, <span class="at">color =</span> cut)) <span class="sc">+</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Fair &lt; Good &lt; Very Good &lt; Premium &lt; Ideal"</span>,</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">3.4</span>,</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">2500</span>,</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Times New Roman"</span></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>  theme_use</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-complex-plot" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-complex-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-complex-plot" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-complex-plot-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-complex-plot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-complex-plot-1.png" class="img-fluid figure-img" data-ref-parent="fig-complex-plot" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-complex-plot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) カットと価格の関係
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-complex-plot" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-complex-plot-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-complex-plot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-complex-plot-2.png" class="img-fluid figure-img" data-ref-parent="fig-complex-plot" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-complex-plot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) カラットと価格の関係
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-complex-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;63: 作ってみました
</figcaption>
</figure>
</div>
</section>
<section id="発展ggrepel" class="level2">
<h2 class="anchored" data-anchor-id="発展ggrepel">発展：<code>ggrepel</code></h2>
<p>ここからは、<code>ggrepel</code>というパッケージを用いて折れ線グラフを発展させた例をご紹介します。ここからはだいぶややこしいので、出来上がったグラフを見て、必要性を感じていただけたらコードを読み解いてもらえればと思います。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># インストール</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pak::pak("ggrepel")</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>まず、以下のようなデータがあるとします。<code>firm_id</code>は30まであります。</p>
<div class="cell">
<div id="tbl-data-prep" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-data-prep-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;3: データの一部
</figcaption>
<div aria-describedby="tbl-data-prep-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_er2p54f3anlfh2ugjmt1(i, j, css_id) {
          var table = document.getElementById("tinytable_er2p54f3anlfh2ugjmt1");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_er2p54f3anlfh2ugjmt1(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_er2p54f3anlfh2ugjmt1");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '6', j: 0 }, { i: '6', j: 1 }, { i: '6', j: 2 }, { i: '6', j: 3 }, { i: '6', j: 4 }, { i: '6', j: 5 },  ], css_id: 'tinytable_css_m80ohasp5y8faa7rn91t',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 },  ], css_id: 'tinytable_css_lh87ju35914i9kw42kj6',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_er2p54f3anlfh2ugjmt1(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_m80ohasp5y8faa7rn91t, .table th.tinytable_css_m80ohasp5y8faa7rn91t { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_lh87ju35914i9kw42kj6, .table th.tinytable_css_lh87ju35914i9kw42kj6 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_er2p54f3anlfh2ugjmt1" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">firm_id</th>
                <th scope="col" data-row="0" data-col="1">state_id</th>
                <th scope="col" data-row="0" data-col="2">year</th>
                <th scope="col" data-row="0" data-col="3">treated_1998</th>
                <th scope="col" data-row="0" data-col="4">is_treated</th>
                <th scope="col" data-row="0" data-col="5">y</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">1</td>
                  <td data-row="1" data-col="1">50</td>
                  <td data-row="1" data-col="2">1980</td>
                  <td data-row="1" data-col="3">0</td>
                  <td data-row="1" data-col="4">0</td>
                  <td data-row="1" data-col="5">0.6546029</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">1</td>
                  <td data-row="2" data-col="1">50</td>
                  <td data-row="2" data-col="2">1981</td>
                  <td data-row="2" data-col="3">0</td>
                  <td data-row="2" data-col="4">0</td>
                  <td data-row="2" data-col="5">1.9160271</td>
                </tr>
                <tr>
                  <td data-row="3" data-col="0">1</td>
                  <td data-row="3" data-col="1">50</td>
                  <td data-row="3" data-col="2">1982</td>
                  <td data-row="3" data-col="3">0</td>
                  <td data-row="3" data-col="4">0</td>
                  <td data-row="3" data-col="5">2.1400894</td>
                </tr>
                <tr>
                  <td data-row="4" data-col="0">1</td>
                  <td data-row="4" data-col="1">50</td>
                  <td data-row="4" data-col="2">1983</td>
                  <td data-row="4" data-col="3">0</td>
                  <td data-row="4" data-col="4">0</td>
                  <td data-row="4" data-col="5">1.8364579</td>
                </tr>
                <tr>
                  <td data-row="5" data-col="0">1</td>
                  <td data-row="5" data-col="1">50</td>
                  <td data-row="5" data-col="2">1984</td>
                  <td data-row="5" data-col="3">0</td>
                  <td data-row="5" data-col="4">0</td>
                  <td data-row="5" data-col="5">1.7661105</td>
                </tr>
                <tr>
                  <td data-row="6" data-col="0">1</td>
                  <td data-row="6" data-col="1">50</td>
                  <td data-row="6" data-col="2">1985</td>
                  <td data-row="6" data-col="3">0</td>
                  <td data-row="6" data-col="4">0</td>
                  <td data-row="6" data-col="5">1.2856041</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>これを使って横軸に<code>Year</code>、縦軸に<code>y</code>をとってグラフにします。</p>
<p>詳細を書くと長くなるので、適宜メモを入れました。ご参考まで。</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ハイライトする群とそれ以外に分ける</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">if_else</span>(treated_1998 <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">as.factor</span>(firm_id), <span class="st">"other"</span>),</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 最後の年にだけラベルを付ける</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_lab =</span> <span class="fu">if_else</span>(</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>      treated_1998 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2015</span>,</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"Firm "</span>, firm_id),</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_character_</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># まずハイライトする群だけプロット</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">|&gt;</span> <span class="fu">filter</span>(treated_1998 <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y, <span class="at">group =</span> firm_id)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 罫線を削除</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 凡例を削除</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 軸のタイトルと文字のフォントとサイズを調整</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># X軸タイトルを若干左寄せ</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.4</span>)</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 垂直線を描写</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">1980</span>, <span class="dv">2015</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray91"</span>,</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> .<span class="dv">6</span></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 水平線を描写</span></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 描写のためにデータを準備</span></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">y =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">5.0</span>, <span class="at">by =</span> <span class="fl">2.5</span>), <span class="at">x1 =</span> <span class="dv">1980</span>, <span class="at">x2 =</span> <span class="dv">2015</span>),</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">xend =</span> x2, <span class="at">y =</span> y, <span class="at">yend =</span> y),</span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray91"</span>,</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> .<span class="dv">6</span></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 薄い水平線を描写</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">y =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">4.5</span>, <span class="at">by =</span> .<span class="dv">5</span>), <span class="at">x1 =</span> <span class="dv">1980</span>, <span class="at">x2 =</span> <span class="dv">2015</span>),</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">xend =</span> x2, <span class="at">y =</span> y, <span class="at">yend =</span> y),</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray97"</span>,</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> .<span class="dv">3</span></span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 縦軸が0のところに水平線を描写</span></span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">y =</span> <span class="dv">0</span>, <span class="at">x1 =</span> <span class="dv">1980</span>, <span class="at">x2 =</span> <span class="dv">2015</span>),</span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">xend =</span> x2, <span class="at">y =</span> y),</span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray40"</span></span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 処置年に垂直線を描写</span></span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> <span class="dv">1998</span>,</span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray40"</span></span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb69-68"><a href="#cb69-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ハイライトしない群をプロット</span></span>
<span id="cb69-69"><a href="#cb69-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df <span class="sc">|&gt;</span> <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"other"</span>),</span>
<span id="cb69-70"><a href="#cb69-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray75"</span>,</span>
<span id="cb69-71"><a href="#cb69-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb69-72"><a href="#cb69-72" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-73"><a href="#cb69-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb69-74"><a href="#cb69-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ハイライトする群をプロット</span></span>
<span id="cb69-75"><a href="#cb69-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> group)</span>
<span id="cb69-76"><a href="#cb69-76" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-77"><a href="#cb69-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb69-78"><a href="#cb69-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ハイライトした線にラベルを追加</span></span>
<span id="cb69-79"><a href="#cb69-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> group, <span class="at">label =</span> group_lab),</span>
<span id="cb69-80"><a href="#cb69-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Times"</span>,</span>
<span id="cb69-81"><a href="#cb69-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb69-82"><a href="#cb69-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2017年の位置にラベルを書く</span></span>
<span id="cb69-83"><a href="#cb69-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2017</span>, <span class="cn">NA</span>),</span>
<span id="cb69-84"><a href="#cb69-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb69-85"><a href="#cb69-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.linetype =</span> <span class="st">"dotted"</span></span>
<span id="cb69-86"><a href="#cb69-86" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-87"><a href="#cb69-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb69-88"><a href="#cb69-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb69-89"><a href="#cb69-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb69-90"><a href="#cb69-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb69-91"><a href="#cb69-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ラベルが見えるように図の端の2015年より広くとる</span></span>
<span id="cb69-92"><a href="#cb69-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1980</span>, <span class="dv">2021</span>),</span>
<span id="cb69-93"><a href="#cb69-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1980</span>, <span class="dv">2015</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb69-94"><a href="#cb69-94" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-95"><a href="#cb69-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb69-96"><a href="#cb69-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb69-97"><a href="#cb69-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">5.0</span>),</span>
<span id="cb69-98"><a href="#cb69-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="dv">0</span>, <span class="fl">2.5</span>, <span class="fl">5.0</span>)</span>
<span id="cb69-99"><a href="#cb69-99" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="コピー" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-ggrepel" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ggrepel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-ggrepel-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ggrepel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;64: ggrepelを使ったプロット
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="おわりに" class="level2">
<h2 class="anchored" data-anchor-id="おわりに">おわりに</h2>
<p>ひとまず僕がよく使うggplotの設定をまとめてみました。ggplotを駆使して、スタイリッシュなプロットを作成していきましょう！</p>
<p>適宜追記する予定ですので、ご参考になれば幸いです。</p>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">注</h2>

<ol>
<li id="fn1"><p>例えば男性と女性という2種類について、それぞれ平均寿命の時系列グラフを作る場合など。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>ちなみに<code>scale_colour_viridis</code>の<code>c</code>の方はcontinuousで、<code>d</code>の方はdiscreteですね。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "コピーしました");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "コピーしました");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/yo5uke\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light_high_contrast">
<input type="hidden" id="giscus-alt-theme" value="light_high_contrast">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      if (authorPrefersDark) {
          [baseTheme, altTheme] = [altTheme, baseTheme];
      }
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "yo5uke/yo5uke.github.io";
    script.dataset.repoId = "R_kgDOLsORUQ";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOLsORUc4CfJ93";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">ソースコード</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb70" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "【4.0.0対応！】[ggplot2]{.fira-code}使い方ガイド"</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> |</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">  ggplotを使うのに役立つコマンドを紹介します！</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2024-11-17</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> 2025-10-18</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span><span class="co"> </span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk: </span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co">    dev: "ragg_png"</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> figure/fig-ggrepel.png</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="fu">## はじめに</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>皆さん、ggplot、使ってますか？多分お使いですよね。</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>僕は数か月前ggplotのガイドブックを買いまして、いろいろと勉強しているところでございます。</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>こんなこともできるのか！という発見が多々あり、Rユーザーの皆様にはぜひ買っていただきたい代物なのですが、いかんせんお値段が張りますので、いくつかピックアップしてご紹介します。</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>書籍のリンクは以下です。</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip appearance="minimal"}</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Rグラフィックスクックブック 第2版 ―ggplot2によるグラフ作成のレシピ集</span><span class="co">](https://www.amazon.co.jp/R%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AF%E3%83%83%E3%82%AF%E3%83%96%E3%83%83%E3%82%AF-%E7%AC%AC2%E7%89%88-%E2%80%95ggplot2%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B0%E3%83%A9%E3%83%95%E4%BD%9C%E6%88%90%E3%81%AE%E3%83%AC%E3%82%B7%E3%83%94%E9%9B%86-Winston-Chang/dp/4873118921)</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>さらに、2025年9月、ggplot2がバージョン4.0.0にアップデートされました！それを記念し、4.0.0の要素も取り入れたページにアップデートしました！🎉</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>ぜひご参考になさってください！</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a><span class="fu">## {ggplot2}の基本</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>使ったことがある方はこの辺はスキップしてください。</span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>今回使うデータは、デフォルトで用意されている<span class="in">`iris`</span>と<span class="in">`Orange`</span>です。</span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>ひとまず主要なパッケージである{ggplot2}を読み込みます。{ggplot2}はTidyverseに含まれていますので、データを色々加工したうえでグラフを書きたい場合が多いことを考えると、{tidyverse}を読み込むのが便利だと思います。</span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("tidyverse")</span></span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a><span class="co"># {ggplot2}単体の場合</span></span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ggplot2")</span></span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a>基本的な使い方としては、<span class="in">`ggplot()`</span>と<span class="in">`aes()`</span>、そして図に応じて<span class="in">`geom_line()`</span>（折れ線）や<span class="in">`geom_point()`</span>（散布図）などを使っていきます。</span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a>今回は例として、アイリスのがく片の長さ、幅をそれぞれ軸としてプロットします。</span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a><span class="fu">### 散布図</span></span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a>まずは基本的な散布図を描いてみます。散布図は<span class="in">`geom_point()`</span>を使うことで描画できます。</span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris</span></span>
<span id="cb70-67"><a href="#cb70-67" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "irisデータフレームを使った散布図"</span></span>
<span id="cb70-68"><a href="#cb70-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-69"><a href="#cb70-69" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-70"><a href="#cb70-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb70-71"><a href="#cb70-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-72"><a href="#cb70-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-73"><a href="#cb70-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-74"><a href="#cb70-74" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`ggplot(data, aes())`</span>という形で使用するデータを指定</span>
<span id="cb70-75"><a href="#cb70-75" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`aes()`</span>内ではX軸とY軸をそれぞれ指定</span>
<span id="cb70-76"><a href="#cb70-76" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>例：<span class="in">`aes(x = Sepal.Length, y = Sepal.Width)`</span></span>
<span id="cb70-77"><a href="#cb70-77" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>第1引数がX、第2引数がYと決まっているので、<span class="in">`x =`</span>や<span class="in">`y =`</span>は書かなくてもよいです。</span>
<span id="cb70-78"><a href="#cb70-78" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>ggplotのコマンドは<span class="in">`+`</span>で繋ぐ</span>
<span id="cb70-79"><a href="#cb70-79" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>散布図を作るために<span class="in">`geom_point()`</span>を繋げる</span>
<span id="cb70-80"><a href="#cb70-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-81"><a href="#cb70-81" aria-hidden="true" tabindex="-1"></a>これが土台です。<span class="in">`ggplot()`</span>だけではプロットは表示されませんので、<span class="in">`geom_point()`</span>など何かしら繋ぐ形にしてください。</span>
<span id="cb70-82"><a href="#cb70-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-83"><a href="#cb70-83" aria-hidden="true" tabindex="-1"></a>**回帰線を引きたい場合：**</span>
<span id="cb70-84"><a href="#cb70-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-85"><a href="#cb70-85" aria-hidden="true" tabindex="-1"></a>早速応用ではありますが、散布図を描いたら回帰線を引きたいことがありますよね。そのためには、<span class="in">`geom_smooth()`</span>を使います。</span>
<span id="cb70-86"><a href="#cb70-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-89"><a href="#cb70-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-90"><a href="#cb70-90" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-lm</span></span>
<span id="cb70-91"><a href="#cb70-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "回帰直線を引いた散布図"</span></span>
<span id="cb70-92"><a href="#cb70-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-93"><a href="#cb70-93" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-94"><a href="#cb70-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-95"><a href="#cb70-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm)</span>
<span id="cb70-96"><a href="#cb70-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-97"><a href="#cb70-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-98"><a href="#cb70-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-99"><a href="#cb70-99" aria-hidden="true" tabindex="-1"></a><span class="in">`method = lm`</span>で回帰直線を引くオプションを付けることができ、デフォルトではYをXに回帰する直線が引かれます。式を変えたい場合は<span class="in">`formula = y ~ log(x)`</span>などと式を追加してください。</span>
<span id="cb70-100"><a href="#cb70-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-101"><a href="#cb70-101" aria-hidden="true" tabindex="-1"></a>また、デフォルトでは信頼区間がプロットされます。要らない場合は、<span class="in">`se = FALSE`</span>を追加します。</span>
<span id="cb70-102"><a href="#cb70-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-103"><a href="#cb70-103" aria-hidden="true" tabindex="-1"></a>また、lm以外にも、<span class="in">`method = "loess"`</span>などもあります。<span class="in">`?geom_smooth`</span>で確認してみてください。</span>
<span id="cb70-104"><a href="#cb70-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-107"><a href="#cb70-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-108"><a href="#cb70-108" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-loess</span></span>
<span id="cb70-109"><a href="#cb70-109" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "loessを使った散布図"</span></span>
<span id="cb70-110"><a href="#cb70-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-111"><a href="#cb70-111" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-112"><a href="#cb70-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-113"><a href="#cb70-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-114"><a href="#cb70-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-115"><a href="#cb70-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-116"><a href="#cb70-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-117"><a href="#cb70-117" aria-hidden="true" tabindex="-1"></a><span class="fu">### 折れ線グラフ</span></span>
<span id="cb70-118"><a href="#cb70-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-119"><a href="#cb70-119" aria-hidden="true" tabindex="-1"></a>折れ線グラフは<span class="in">`geom_line()`</span>を使います。</span>
<span id="cb70-120"><a href="#cb70-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-123"><a href="#cb70-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-124"><a href="#cb70-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-line</span></span>
<span id="cb70-125"><a href="#cb70-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "折れ線グラフ"</span></span>
<span id="cb70-126"><a href="#cb70-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-127"><a href="#cb70-127" aria-hidden="true" tabindex="-1"></a><span class="co"># fmt: skip</span></span>
<span id="cb70-128"><a href="#cb70-128" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb70-129"><a href="#cb70-129" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>a, <span class="sc">~</span>b,</span>
<span id="cb70-130"><a href="#cb70-130" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">5</span>,</span>
<span id="cb70-131"><a href="#cb70-131" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">3</span>,</span>
<span id="cb70-132"><a href="#cb70-132" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">4</span>,</span>
<span id="cb70-133"><a href="#cb70-133" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">2</span></span>
<span id="cb70-134"><a href="#cb70-134" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-135"><a href="#cb70-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-136"><a href="#cb70-136" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> a, <span class="at">y =</span> b)) <span class="sc">+</span></span>
<span id="cb70-137"><a href="#cb70-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb70-138"><a href="#cb70-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-139"><a href="#cb70-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-140"><a href="#cb70-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-141"><a href="#cb70-141" aria-hidden="true" tabindex="-1"></a>今回は<span class="in">`d`</span>という何のひねりもないデータフレームを作成して、それを用いて折れ線グラフを作成しています。</span>
<span id="cb70-142"><a href="#cb70-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-143"><a href="#cb70-143" aria-hidden="true" tabindex="-1"></a>なぜわざわざデータフレームを自分で作ったかというと、1個体についてのみ時系列をとったデータを探してくるより、作った方が早かったからです😅</span>
<span id="cb70-144"><a href="#cb70-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-145"><a href="#cb70-145" aria-hidden="true" tabindex="-1"></a>というのも、折れ線グラフを作るときは、多くの場合各個体ごとに何本かの折れ線を描くことが多いと思います<span class="ot">[^1]</span>。各個体ごとに折れ線を作る方法については、<span class="co">[</span><span class="ot">後のセクション</span><span class="co">](#sec-multi-cat-plot)</span>でご確認ください。</span>
<span id="cb70-146"><a href="#cb70-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-147"><a href="#cb70-147" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>例えば男性と女性という2種類について、それぞれ平均寿命の時系列グラフを作る場合など。</span>
<span id="cb70-148"><a href="#cb70-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-149"><a href="#cb70-149" aria-hidden="true" tabindex="-1"></a>ここで覚えていただきたいのは<span class="in">`geom_line()`</span>で折れ線グラフを作れるということです。</span>
<span id="cb70-150"><a href="#cb70-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-151"><a href="#cb70-151" aria-hidden="true" tabindex="-1"></a><span class="fu">### 棒グラフ</span></span>
<span id="cb70-152"><a href="#cb70-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-153"><a href="#cb70-153" aria-hidden="true" tabindex="-1"></a>棒グラフも汎用性が高いグラフです。棒グラフはデータフレーム内の集計をするときに役に立ちます。</span>
<span id="cb70-154"><a href="#cb70-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-155"><a href="#cb70-155" aria-hidden="true" tabindex="-1"></a>まずは、<span class="in">`iris`</span>データセットの<span class="in">`Species`</span>（種）ごとに個体数を数えた棒グラフを作成します。</span>
<span id="cb70-156"><a href="#cb70-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-159"><a href="#cb70-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-160"><a href="#cb70-160" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-bar</span></span>
<span id="cb70-161"><a href="#cb70-161" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "棒グラフ"</span></span>
<span id="cb70-162"><a href="#cb70-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-163"><a href="#cb70-163" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species)) <span class="sc">+</span></span>
<span id="cb70-164"><a href="#cb70-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb70-165"><a href="#cb70-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-166"><a href="#cb70-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-167"><a href="#cb70-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-168"><a href="#cb70-168" aria-hidden="true" tabindex="-1"></a>おっと…。まさかのすべて50個体ずつで、棒グラフが全部同じ高さになってしまいました。これはミスではありません！</span>
<span id="cb70-169"><a href="#cb70-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-170"><a href="#cb70-170" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_bar()`</span>を使って棒グラフを書く際には、縦は自動で個体数をカウントすることになるので、<span class="in">`aes(x = Species)`</span>とXを指定するだけで横に種類、縦にカウントをとった棒グラフが描けてしまいます。</span>
<span id="cb70-171"><a href="#cb70-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-172"><a href="#cb70-172" aria-hidden="true" tabindex="-1"></a>もし横向きにしたければ、<span class="in">`aes(y = Species)`</span>とYを指定すればOKです。</span>
<span id="cb70-173"><a href="#cb70-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-176"><a href="#cb70-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-177"><a href="#cb70-177" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-bar-horizontal</span></span>
<span id="cb70-178"><a href="#cb70-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "横向きの棒グラフ"</span></span>
<span id="cb70-179"><a href="#cb70-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-180"><a href="#cb70-180" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">y =</span> Species)) <span class="sc">+</span></span>
<span id="cb70-181"><a href="#cb70-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb70-182"><a href="#cb70-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-183"><a href="#cb70-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-184"><a href="#cb70-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-185"><a href="#cb70-185" aria-hidden="true" tabindex="-1"></a>もう1種類いきましょう。<span class="in">`iris`</span>データセットの<span class="in">`Species`</span>（種）ごとに、<span class="in">`Sepal.Length`</span>（がく片の長さ）の平均を計算して、その平均値を棒グラフで表示します。</span>
<span id="cb70-186"><a href="#cb70-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-189"><a href="#cb70-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-190"><a href="#cb70-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-bar-mean</span></span>
<span id="cb70-191"><a href="#cb70-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "種ごとのがく片の長さの平均"</span></span>
<span id="cb70-192"><a href="#cb70-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-193"><a href="#cb70-193" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb70-194"><a href="#cb70-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>)</span>
<span id="cb70-195"><a href="#cb70-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-196"><a href="#cb70-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-197"><a href="#cb70-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-198"><a href="#cb70-198" aria-hidden="true" tabindex="-1"></a>今回は<span class="in">`geom_bar(stat = "summary", fun = "mean")`</span>とすることで、<span class="in">`Species`</span>ごとに<span class="in">`Sepal.Length`</span>の平均を計算して棒グラフを描いています。種類ごとに集計をするのだけど、じゃあ集計するときには平均を使ってね、ということを<span class="in">`geom_bar()`</span>内で指定しています。</span>
<span id="cb70-199"><a href="#cb70-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-200"><a href="#cb70-200" aria-hidden="true" tabindex="-1"></a>この場合は種類ごとにがく片の長さを計算する、ということでXもYもデータフレーム内の変数を使いますので<span class="in">`aes(x = Species, y = Sepal.Length)`</span>とX, Y両方明示しています。</span>
<span id="cb70-201"><a href="#cb70-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-202"><a href="#cb70-202" aria-hidden="true" tabindex="-1"></a>既にプロットしたい値がデータフレーム内に入っている場合には<span class="in">`geom_col()`</span>が活躍します。</span>
<span id="cb70-203"><a href="#cb70-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-206"><a href="#cb70-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-207"><a href="#cb70-207" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-bar-col</span></span>
<span id="cb70-208"><a href="#cb70-208" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "geom_colを使った棒グラフ"</span></span>
<span id="cb70-209"><a href="#cb70-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-210"><a href="#cb70-210" aria-hidden="true" tabindex="-1"></a>mean_sepal_length <span class="ot">&lt;-</span> iris <span class="sc">|&gt;</span></span>
<span id="cb70-211"><a href="#cb70-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb70-212"><a href="#cb70-212" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_length =</span> <span class="fu">mean</span>(Sepal.Length),</span>
<span id="cb70-213"><a href="#cb70-213" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> Species</span>
<span id="cb70-214"><a href="#cb70-214" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-215"><a href="#cb70-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-216"><a href="#cb70-216" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mean_sepal_length, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> mean_length)) <span class="sc">+</span></span>
<span id="cb70-217"><a href="#cb70-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span>
<span id="cb70-218"><a href="#cb70-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-219"><a href="#cb70-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-220"><a href="#cb70-220" aria-hidden="true" tabindex="-1"></a>ここでは<span class="in">`mean_sepal_length`</span>というデータフレームを作成し、<span class="in">`Species`</span>ごとに<span class="in">`Sepal.Length`</span>の平均を計算して格納しています。つまり、既にプロットしたい値がデータフレーム内に入っている状態です。この場合、<span class="in">`geom_col()`</span>を使うことで、XとY両方を指定して棒グラフを描くことができます（こちらの方が使用頻度は高いかもしれませんね）。</span>
<span id="cb70-221"><a href="#cb70-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-222"><a href="#cb70-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-223"><a href="#cb70-223" aria-hidden="true" tabindex="-1"></a><span class="fu">### 箱ひげ図</span></span>
<span id="cb70-224"><a href="#cb70-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-225"><a href="#cb70-225" aria-hidden="true" tabindex="-1"></a>箱ひげ図は、分布を可視化するのに便利なグラフです。散布図と似ていますが、分布の要約がわかるようになっています。</span>
<span id="cb70-226"><a href="#cb70-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-229"><a href="#cb70-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-230"><a href="#cb70-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-box</span></span>
<span id="cb70-231"><a href="#cb70-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "箱ひげ図"</span></span>
<span id="cb70-232"><a href="#cb70-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-233"><a href="#cb70-233" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb70-234"><a href="#cb70-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb70-235"><a href="#cb70-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-236"><a href="#cb70-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-237"><a href="#cb70-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-238"><a href="#cb70-238" aria-hidden="true" tabindex="-1"></a>各種類において、<span class="in">`Sepal.Length`</span>（がく片の長さ）の分布がわかります。四分位数や外れ値がわかるのが特徴です。</span>
<span id="cb70-239"><a href="#cb70-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-240"><a href="#cb70-240" aria-hidden="true" tabindex="-1"></a><span class="fu">### バイオリンプロット</span></span>
<span id="cb70-241"><a href="#cb70-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-242"><a href="#cb70-242" aria-hidden="true" tabindex="-1"></a>バイオリンプロットは、分布を可視化するのに便利なグラフです。箱ひげ図と似ていますが、分布の形状もわかるようになっています。</span>
<span id="cb70-243"><a href="#cb70-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-246"><a href="#cb70-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-247"><a href="#cb70-247" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-violin</span></span>
<span id="cb70-248"><a href="#cb70-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "バイオリンプロット"</span></span>
<span id="cb70-249"><a href="#cb70-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-250"><a href="#cb70-250" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb70-251"><a href="#cb70-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>()</span>
<span id="cb70-252"><a href="#cb70-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-253"><a href="#cb70-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-254"><a href="#cb70-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-255"><a href="#cb70-255" aria-hidden="true" tabindex="-1"></a>各種類において、<span class="in">`Sepal.Length`</span>（がく片の長さ）の分布がわかります。例えば、<span class="in">`setosa`</span>はがく片の長さが5あたりに集中していることがわかります。<span class="in">`virginica`</span>は全体的に長い傾向があることもわかりますね。</span>
<span id="cb70-256"><a href="#cb70-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-257"><a href="#cb70-257" aria-hidden="true" tabindex="-1"></a><span class="fu">## 色を付ける {#sec-color}</span></span>
<span id="cb70-258"><a href="#cb70-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-259"><a href="#cb70-259" aria-hidden="true" tabindex="-1"></a>グラフに色を付ける方法について説明します。</span>
<span id="cb70-260"><a href="#cb70-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-261"><a href="#cb70-261" aria-hidden="true" tabindex="-1"></a>基本的には<span class="in">`geom_xxx()`</span>内で<span class="in">`color = "red"`</span>のように指定すれば、色を付けることができます。</span>
<span id="cb70-262"><a href="#cb70-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-265"><a href="#cb70-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-266"><a href="#cb70-266" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color</span></span>
<span id="cb70-267"><a href="#cb70-267" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "散布図の点を赤色に"</span></span>
<span id="cb70-268"><a href="#cb70-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-269"><a href="#cb70-269" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-270"><a href="#cb70-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb70-271"><a href="#cb70-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-272"><a href="#cb70-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-273"><a href="#cb70-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-274"><a href="#cb70-274" aria-hidden="true" tabindex="-1"></a>このように、<span class="in">`geom_point(color = "red")`</span>で点を赤色にしています。</span>
<span id="cb70-275"><a href="#cb70-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-276"><a href="#cb70-276" aria-hidden="true" tabindex="-1"></a>他のケースも見てみましょう。</span>
<span id="cb70-277"><a href="#cb70-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-280"><a href="#cb70-280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-281"><a href="#cb70-281" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color-line</span></span>
<span id="cb70-282"><a href="#cb70-282" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "折れ線グラフの線を青色に"</span></span>
<span id="cb70-283"><a href="#cb70-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-284"><a href="#cb70-284" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> a, <span class="at">y =</span> b)) <span class="sc">+</span></span>
<span id="cb70-285"><a href="#cb70-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb70-286"><a href="#cb70-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-287"><a href="#cb70-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-288"><a href="#cb70-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-289"><a href="#cb70-289" aria-hidden="true" tabindex="-1"></a>これも同様に、<span class="in">`geom_line(color = "blue")`</span>で線を青色にしています。</span>
<span id="cb70-290"><a href="#cb70-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-291"><a href="#cb70-291" aria-hidden="true" tabindex="-1"></a>棒グラフの場合は、少し事情が異なります。<span class="in">`color`</span>は棒の枠線の色を指定することになるので、棒自体の色を変えたい場合は<span class="in">`fill`</span>を使います。</span>
<span id="cb70-292"><a href="#cb70-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-295"><a href="#cb70-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-296"><a href="#cb70-296" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color-bar</span></span>
<span id="cb70-297"><a href="#cb70-297" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb70-298"><a href="#cb70-298" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap:</span></span>
<span id="cb70-299"><a href="#cb70-299" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "棒グラフの枠線が緑色に"</span></span>
<span id="cb70-300"><a href="#cb70-300" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "棒の色が緑色に"</span></span>
<span id="cb70-301"><a href="#cb70-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-302"><a href="#cb70-302" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb70-303"><a href="#cb70-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>)</span>
<span id="cb70-304"><a href="#cb70-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-305"><a href="#cb70-305" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb70-306"><a href="#cb70-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">fill =</span> <span class="st">"darkgreen"</span>)</span>
<span id="cb70-307"><a href="#cb70-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-308"><a href="#cb70-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-309"><a href="#cb70-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-310"><a href="#cb70-310" aria-hidden="true" tabindex="-1"></a><span class="in">`fill`</span>を使うのは棒グラフやバイオリンプロットなど、塗りつぶしがある場合です。もし枠線と塗りつぶしの両方を変えたい場合は、<span class="in">`color`</span>と<span class="in">`fill`</span>の両方を指定してください。</span>
<span id="cb70-311"><a href="#cb70-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-314"><a href="#cb70-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-315"><a href="#cb70-315" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color-violin-both</span></span>
<span id="cb70-316"><a href="#cb70-316" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "枠線と塗りつぶしの両方を指定"</span></span>
<span id="cb70-317"><a href="#cb70-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-318"><a href="#cb70-318" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb70-319"><a href="#cb70-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>)</span>
<span id="cb70-320"><a href="#cb70-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-321"><a href="#cb70-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-322"><a href="#cb70-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-323"><a href="#cb70-323" aria-hidden="true" tabindex="-1"></a><span class="fu">## 少しいじる</span></span>
<span id="cb70-324"><a href="#cb70-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-325"><a href="#cb70-325" aria-hidden="true" tabindex="-1"></a>ここでは少しグラフをいじって、点の形を変えたり、線の種類や太さを変えたりする方法を説明します。</span>
<span id="cb70-326"><a href="#cb70-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-327"><a href="#cb70-327" aria-hidden="true" tabindex="-1"></a><span class="fu">### 点の形</span></span>
<span id="cb70-328"><a href="#cb70-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-331"><a href="#cb70-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-332"><a href="#cb70-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-point-shape</span></span>
<span id="cb70-333"><a href="#cb70-333" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "点の形と大きさが変わっています"</span></span>
<span id="cb70-334"><a href="#cb70-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-335"><a href="#cb70-335" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-336"><a href="#cb70-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">17</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>)</span>
<span id="cb70-337"><a href="#cb70-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-338"><a href="#cb70-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-339"><a href="#cb70-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-340"><a href="#cb70-340" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`shape`</span>で点の形を指定</span>
<span id="cb70-341"><a href="#cb70-341" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>形は0から25まであります。<span class="in">`?points`</span>で確認できます。</span>
<span id="cb70-342"><a href="#cb70-342" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`size`</span>で点の大きさを指定</span>
<span id="cb70-343"><a href="#cb70-343" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>数値が大きいほど大きくなります。</span>
<span id="cb70-344"><a href="#cb70-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-345"><a href="#cb70-345" aria-hidden="true" tabindex="-1"></a><span class="fu">### 線の種類と太さ</span></span>
<span id="cb70-346"><a href="#cb70-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-349"><a href="#cb70-349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-350"><a href="#cb70-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-line-type</span></span>
<span id="cb70-351"><a href="#cb70-351" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "線の種類と太さが変わっています"</span></span>
<span id="cb70-352"><a href="#cb70-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-353"><a href="#cb70-353" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> a, <span class="at">y =</span> b)) <span class="sc">+</span></span>
<span id="cb70-354"><a href="#cb70-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span>
<span id="cb70-355"><a href="#cb70-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-356"><a href="#cb70-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-357"><a href="#cb70-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-358"><a href="#cb70-358" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`linetype`</span>で線の種類を指定</span>
<span id="cb70-359"><a href="#cb70-359" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>0から6まであります。<span class="in">`?linetype`</span>で確認できます。</span>
<span id="cb70-360"><a href="#cb70-360" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`linewidth`</span>で線の太さを指定</span>
<span id="cb70-361"><a href="#cb70-361" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>数値が大きいほど太くなります。</span>
<span id="cb70-362"><a href="#cb70-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-363"><a href="#cb70-363" aria-hidden="true" tabindex="-1"></a><span class="fu">## 軸</span></span>
<span id="cb70-364"><a href="#cb70-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-365"><a href="#cb70-365" aria-hidden="true" tabindex="-1"></a>基本的なグラフを紹介できたところで、次にこれらのグラフを使いながら、軸の扱いについて説明します。</span>
<span id="cb70-366"><a href="#cb70-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-367"><a href="#cb70-367" aria-hidden="true" tabindex="-1"></a><span class="fu">### 軸ラベル</span></span>
<span id="cb70-368"><a href="#cb70-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-369"><a href="#cb70-369" aria-hidden="true" tabindex="-1"></a>まずはX軸、Y軸のラベルを変更します。</span>
<span id="cb70-370"><a href="#cb70-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-373"><a href="#cb70-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-374"><a href="#cb70-374" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-axis-label</span></span>
<span id="cb70-375"><a href="#cb70-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "軸ラベルを変更"</span></span>
<span id="cb70-376"><a href="#cb70-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-377"><a href="#cb70-377" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-378"><a href="#cb70-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-379"><a href="#cb70-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Length of Sepal"</span>, <span class="at">y =</span> <span class="st">"Width of Sepal"</span>)</span>
<span id="cb70-380"><a href="#cb70-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-381"><a href="#cb70-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-382"><a href="#cb70-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-383"><a href="#cb70-383" aria-hidden="true" tabindex="-1"></a><span class="in">`labs(x = "Length of Sepal", y = "Width of Sepal")`</span>でX軸とY軸のラベルを変更しています。</span>
<span id="cb70-384"><a href="#cb70-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-385"><a href="#cb70-385" aria-hidden="true" tabindex="-1"></a>また、以下のコードは同じ結果を示します。</span>
<span id="cb70-386"><a href="#cb70-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-387"><a href="#cb70-387" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb70-388"><a href="#cb70-388" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span> </span>
<span id="cb70-389"><a href="#cb70-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb70-390"><a href="#cb70-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Length of Sepal"</span>) <span class="sc">+</span> </span>
<span id="cb70-391"><a href="#cb70-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Width of Sepal"</span>)</span>
<span id="cb70-392"><a href="#cb70-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-393"><a href="#cb70-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-394"><a href="#cb70-394" aria-hidden="true" tabindex="-1"></a>すなわち、<span class="in">`labs()`</span>はそれ一つでX軸もY軸もラベルを変更することができますが、<span class="in">`xlab()`</span>、<span class="in">`ylab()`</span>を使えば片方ずつでも変更できるということです。</span>
<span id="cb70-395"><a href="#cb70-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-396"><a href="#cb70-396" aria-hidden="true" tabindex="-1"></a>次に、軸ラベルの体裁を変更したい場合、以下のようにします。</span>
<span id="cb70-397"><a href="#cb70-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-400"><a href="#cb70-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-401"><a href="#cb70-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-axis-font</span></span>
<span id="cb70-402"><a href="#cb70-402" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "文字の体裁が変わっています"</span></span>
<span id="cb70-403"><a href="#cb70-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-404"><a href="#cb70-404" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-405"><a href="#cb70-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-406"><a href="#cb70-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Length of Sepal"</span>, <span class="at">y =</span> <span class="st">"Width of Sepal"</span>) <span class="sc">+</span></span>
<span id="cb70-407"><a href="#cb70-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb70-408"><a href="#cb70-408" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb70-409"><a href="#cb70-409" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"Times New Roman"</span>,</span>
<span id="cb70-410"><a href="#cb70-410" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"italic"</span>,</span>
<span id="cb70-411"><a href="#cb70-411" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb70-412"><a href="#cb70-412" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb70-413"><a href="#cb70-413" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb70-414"><a href="#cb70-414" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-415"><a href="#cb70-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-416"><a href="#cb70-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-417"><a href="#cb70-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-418"><a href="#cb70-418" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`theme()`</span>内の<span class="in">`axis.title`</span>で変更する</span>
<span id="cb70-419"><a href="#cb70-419" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>X軸Y軸のどちらかだけ変更したければ、<span class="in">`axis.title.x`</span>のようにします。</span>
<span id="cb70-420"><a href="#cb70-420" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`element_text()`</span>内で具体的にフォントの体裁を指定</span>
<span id="cb70-421"><a href="#cb70-421" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>フォントはTimes New Romanを使用しています。これはWindowsの設定であり、MacやLinuxではTimesで表示されると思います。</span>
<span id="cb70-422"><a href="#cb70-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-423"><a href="#cb70-423" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>今回はわかりやすく派手にしましたが、これらの要素を変更すれば調整できます。</span>
<span id="cb70-424"><a href="#cb70-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-425"><a href="#cb70-425" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>例えば、<span class="in">`face = "bold"`</span>にすれば太字にできます。</span>
<span id="cb70-426"><a href="#cb70-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-427"><a href="#cb70-427" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>他にもありますが、おおむね使うのはこのあたりでしょう。</span>
<span id="cb70-428"><a href="#cb70-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-429"><a href="#cb70-429" aria-hidden="true" tabindex="-1"></a><span class="fu">### 軸の目盛り</span></span>
<span id="cb70-430"><a href="#cb70-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-433"><a href="#cb70-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-434"><a href="#cb70-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-axis-scale</span></span>
<span id="cb70-435"><a href="#cb70-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "目盛りの間隔が変わっています"</span></span>
<span id="cb70-436"><a href="#cb70-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-437"><a href="#cb70-437" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-438"><a href="#cb70-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-439"><a href="#cb70-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">4.5</span>, <span class="dv">8</span>, .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb70-440"><a href="#cb70-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>))</span>
<span id="cb70-441"><a href="#cb70-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-442"><a href="#cb70-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-443"><a href="#cb70-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-444"><a href="#cb70-444" aria-hidden="true" tabindex="-1"></a>@fig-axis-font と比較してもらえればわかりますが、目盛りがX軸は0.5刻み、Y軸は1刻みになるよう変更しました。このように、X（Y）が連続値である場合、<span class="in">`scale_x_continuous()`</span>（<span class="in">`scale_y_continuous()`</span>）で変更できます。<span class="in">`seq()`</span>は数列を作る関数で、<span class="in">`seq(from, to, by)`</span>の順に指定します。</span>
<span id="cb70-445"><a href="#cb70-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-446"><a href="#cb70-446" aria-hidden="true" tabindex="-1"></a>また、連続変数ではなくカテゴリ変数の場合は、<span class="in">`scale_x_discrete()`</span>（<span class="in">`scale_y_discrete()`</span>）を使います。</span>
<span id="cb70-447"><a href="#cb70-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-450"><a href="#cb70-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-451"><a href="#cb70-451" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-axis-scale-cat</span></span>
<span id="cb70-452"><a href="#cb70-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "カテゴリのラベルが変わっています"</span></span>
<span id="cb70-453"><a href="#cb70-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-454"><a href="#cb70-454" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb70-455"><a href="#cb70-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>) <span class="sc">+</span></span>
<span id="cb70-456"><a href="#cb70-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(</span>
<span id="cb70-457"><a href="#cb70-457" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"setosa"</span>, <span class="st">"versicolor"</span>, <span class="st">"virginica"</span>),</span>
<span id="cb70-458"><a href="#cb70-458" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>)</span>
<span id="cb70-459"><a href="#cb70-459" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-460"><a href="#cb70-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-461"><a href="#cb70-461" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-462"><a href="#cb70-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-463"><a href="#cb70-463" aria-hidden="true" tabindex="-1"></a><span class="in">`breaks`</span>で元のラベル、<span class="in">`labels`</span>で新しいラベルを指定します。それぞれ<span class="in">`A`</span>, <span class="in">`B`</span>, <span class="in">`C`</span>に変更されました。</span>
<span id="cb70-464"><a href="#cb70-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-465"><a href="#cb70-465" aria-hidden="true" tabindex="-1"></a>目盛りも同様にフォントのスタイルを変更できます。</span>
<span id="cb70-466"><a href="#cb70-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-469"><a href="#cb70-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-470"><a href="#cb70-470" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-scale-font</span></span>
<span id="cb70-471"><a href="#cb70-471" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "数字のフォントが変わっています"</span></span>
<span id="cb70-472"><a href="#cb70-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-473"><a href="#cb70-473" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-474"><a href="#cb70-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-475"><a href="#cb70-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb70-476"><a href="#cb70-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(</span>
<span id="cb70-477"><a href="#cb70-477" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"Times New Roman"</span>,</span>
<span id="cb70-478"><a href="#cb70-478" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb70-479"><a href="#cb70-479" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb70-480"><a href="#cb70-480" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb70-481"><a href="#cb70-481" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb70-482"><a href="#cb70-482" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-483"><a href="#cb70-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-484"><a href="#cb70-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-485"><a href="#cb70-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-486"><a href="#cb70-486" aria-hidden="true" tabindex="-1"></a>もはや訳が分からない図ですが、このように体裁は変更可能です。要素は大体上と同じで、<span class="in">`axis.text.x`</span>のようにどちらかだけ変更することも可能です。</span>
<span id="cb70-487"><a href="#cb70-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-488"><a href="#cb70-488" aria-hidden="true" tabindex="-1"></a>また、<span class="in">`axis.ticks`</span>で目盛りを消去することも可能です。</span>
<span id="cb70-489"><a href="#cb70-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-492"><a href="#cb70-492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-493"><a href="#cb70-493" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-delete-memori</span></span>
<span id="cb70-494"><a href="#cb70-494" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "目盛りが消えています"</span></span>
<span id="cb70-495"><a href="#cb70-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-496"><a href="#cb70-496" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-497"><a href="#cb70-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-498"><a href="#cb70-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb70-499"><a href="#cb70-499" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(</span>
<span id="cb70-500"><a href="#cb70-500" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"Times New Roman"</span>,</span>
<span id="cb70-501"><a href="#cb70-501" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb70-502"><a href="#cb70-502" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb70-503"><a href="#cb70-503" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb70-504"><a href="#cb70-504" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb70-505"><a href="#cb70-505" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb70-506"><a href="#cb70-506" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-507"><a href="#cb70-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-508"><a href="#cb70-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-509"><a href="#cb70-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-510"><a href="#cb70-510" aria-hidden="true" tabindex="-1"></a>お判りいただけますか？軸の数字は残っていますが、目盛り線は消えています。@fig-scale-font と見比べてみてください。</span>
<span id="cb70-511"><a href="#cb70-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-512"><a href="#cb70-512" aria-hidden="true" tabindex="-1"></a><span class="fu">### 軸の範囲</span></span>
<span id="cb70-513"><a href="#cb70-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-514"><a href="#cb70-514" aria-hidden="true" tabindex="-1"></a>X軸とY軸の範囲を設定する方法です。これまでの図ではだいたい4から8あたりがXの範囲、2.0から4.5がYの範囲でした。<span class="in">`xlim(a, b)`</span>と<span class="in">`ylim(a, b)`</span>で設定できます。</span>
<span id="cb70-515"><a href="#cb70-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-518"><a href="#cb70-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-519"><a href="#cb70-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-change-range</span></span>
<span id="cb70-520"><a href="#cb70-520" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "範囲を変えました"</span></span>
<span id="cb70-521"><a href="#cb70-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-522"><a href="#cb70-522" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-523"><a href="#cb70-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-524"><a href="#cb70-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">5</span>, <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb70-525"><a href="#cb70-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">3</span>, <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb70-526"><a href="#cb70-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb70-527"><a href="#cb70-527" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(</span>
<span id="cb70-528"><a href="#cb70-528" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"Times New Roman"</span>,</span>
<span id="cb70-529"><a href="#cb70-529" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb70-530"><a href="#cb70-530" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb70-531"><a href="#cb70-531" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb70-532"><a href="#cb70-532" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb70-533"><a href="#cb70-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb70-534"><a href="#cb70-534" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-535"><a href="#cb70-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-536"><a href="#cb70-536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-537"><a href="#cb70-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-538"><a href="#cb70-538" aria-hidden="true" tabindex="-1"></a><span class="fu">## 注釈</span></span>
<span id="cb70-539"><a href="#cb70-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-540"><a href="#cb70-540" aria-hidden="true" tabindex="-1"></a>グラフの中に文字や線を入れる方法について説明します。文字や線を入れるには<span class="in">`annotate()`</span>関数を使います。</span>
<span id="cb70-541"><a href="#cb70-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-542"><a href="#cb70-542" aria-hidden="true" tabindex="-1"></a><span class="fu">### 文字</span></span>
<span id="cb70-543"><a href="#cb70-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-544"><a href="#cb70-544" aria-hidden="true" tabindex="-1"></a>まずは文字を入れる方法です。文字は<span class="in">`annotate()`</span>内で<span class="in">`"text"`</span>か<span class="in">`"segment"`</span>を指定することで挿入可能です。</span>
<span id="cb70-545"><a href="#cb70-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-548"><a href="#cb70-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-549"><a href="#cb70-549" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-annotate</span></span>
<span id="cb70-550"><a href="#cb70-550" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "表内に文字を入れられました"</span></span>
<span id="cb70-551"><a href="#cb70-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-552"><a href="#cb70-552" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-553"><a href="#cb70-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-554"><a href="#cb70-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb70-555"><a href="#cb70-555" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb70-556"><a href="#cb70-556" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"ggplot is</span><span class="sc">\n</span><span class="st">wonderful!"</span>,</span>
<span id="cb70-557"><a href="#cb70-557" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">6.5</span>,</span>
<span id="cb70-558"><a href="#cb70-558" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">4</span>,</span>
<span id="cb70-559"><a href="#cb70-559" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Times New Roman"</span>,</span>
<span id="cb70-560"><a href="#cb70-560" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#CC6666"</span>,</span>
<span id="cb70-561"><a href="#cb70-561" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">10</span></span>
<span id="cb70-562"><a href="#cb70-562" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-563"><a href="#cb70-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-564"><a href="#cb70-564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-565"><a href="#cb70-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-566"><a href="#cb70-566" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`annotate("text", label = "hogehoge")`</span>で<span class="in">`hogehoge`</span>と文字を入れることができる</span>
<span id="cb70-567"><a href="#cb70-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-568"><a href="#cb70-568" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`x`</span>と<span class="in">`y`</span>の位置を指定しないと反映されない</span>
<span id="cb70-569"><a href="#cb70-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-570"><a href="#cb70-570" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>改行したい場合、<span class="in">`\n`</span>を入れる</span>
<span id="cb70-571"><a href="#cb70-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-572"><a href="#cb70-572" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>フォント、色、サイズも指定できる</span>
<span id="cb70-573"><a href="#cb70-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-574"><a href="#cb70-574" aria-hidden="true" tabindex="-1"></a>関数一つで意外と簡単にできます。</span>
<span id="cb70-575"><a href="#cb70-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-576"><a href="#cb70-576" aria-hidden="true" tabindex="-1"></a><span class="fu">### セグメント</span></span>
<span id="cb70-577"><a href="#cb70-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-578"><a href="#cb70-578" aria-hidden="true" tabindex="-1"></a>棒線や矢印を付けることも可能です。</span>
<span id="cb70-579"><a href="#cb70-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-582"><a href="#cb70-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-583"><a href="#cb70-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-segment-1</span></span>
<span id="cb70-584"><a href="#cb70-584" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "斜めに棒線が入りました。"</span></span>
<span id="cb70-585"><a href="#cb70-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-586"><a href="#cb70-586" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-587"><a href="#cb70-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-588"><a href="#cb70-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb70-589"><a href="#cb70-589" aria-hidden="true" tabindex="-1"></a>    <span class="st">"segment"</span>,</span>
<span id="cb70-590"><a href="#cb70-590" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">5</span>,</span>
<span id="cb70-591"><a href="#cb70-591" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="dv">7</span>,</span>
<span id="cb70-592"><a href="#cb70-592" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">4</span>,</span>
<span id="cb70-593"><a href="#cb70-593" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> <span class="fl">2.5</span>,</span>
<span id="cb70-594"><a href="#cb70-594" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb70-595"><a href="#cb70-595" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#CC6666"</span></span>
<span id="cb70-596"><a href="#cb70-596" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-597"><a href="#cb70-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-598"><a href="#cb70-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-599"><a href="#cb70-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-602"><a href="#cb70-602" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-603"><a href="#cb70-603" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-segment-2</span></span>
<span id="cb70-604"><a href="#cb70-604" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "矢印になりました。"</span></span>
<span id="cb70-605"><a href="#cb70-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-606"><a href="#cb70-606" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-607"><a href="#cb70-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-608"><a href="#cb70-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb70-609"><a href="#cb70-609" aria-hidden="true" tabindex="-1"></a>    <span class="st">"segment"</span>,</span>
<span id="cb70-610"><a href="#cb70-610" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">5</span>,</span>
<span id="cb70-611"><a href="#cb70-611" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="dv">7</span>,</span>
<span id="cb70-612"><a href="#cb70-612" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">4</span>,</span>
<span id="cb70-613"><a href="#cb70-613" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> <span class="fl">2.5</span>,</span>
<span id="cb70-614"><a href="#cb70-614" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb70-615"><a href="#cb70-615" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#CC6666"</span>,</span>
<span id="cb70-616"><a href="#cb70-616" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="at">units =</span> <span class="st">"cm"</span>))</span>
<span id="cb70-617"><a href="#cb70-617" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-618"><a href="#cb70-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-619"><a href="#cb70-619" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-620"><a href="#cb70-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-621"><a href="#cb70-621" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`"segment"`</span>で棒線ができる</span>
<span id="cb70-622"><a href="#cb70-622" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`x`</span>と<span class="in">`xend`</span>、<span class="in">`y`</span>と<span class="in">`yend`</span>を指定する必要がある</span>
<span id="cb70-623"><a href="#cb70-623" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$(x, y)$から$(xend, yend)$までの2点を結ぶようにできます。</span>
<span id="cb70-624"><a href="#cb70-624" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span><span class="in">`linewidth`</span>で線の太さを指定可</span>
<span id="cb70-625"><a href="#cb70-625" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>他の要素も文字の場合と同様に指定できますが、<span class="in">`size`</span>が<span class="in">`linewidth`</span>に置き換わっています。</span>
<span id="cb70-626"><a href="#cb70-626" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span><span class="in">`arrow = arrow(length = unit(x, units = "cm"))`</span>で矢じりが付く</span>
<span id="cb70-627"><a href="#cb70-627" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="in">`x`</span>で矢じりのサイズ、<span class="in">`units`</span>は単位で、他にmmやinchesなどがあります。</span>
<span id="cb70-628"><a href="#cb70-628" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>ややこしいですが、<span class="in">`xend`</span>と<span class="in">`yend`</span>の方に向かって矢印が付きます。</span>
<span id="cb70-629"><a href="#cb70-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-630"><a href="#cb70-630" aria-hidden="true" tabindex="-1"></a>以上のように、文字だけでなく線や矢印を追加することができます。</span>
<span id="cb70-631"><a href="#cb70-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-632"><a href="#cb70-632" aria-hidden="true" tabindex="-1"></a>今回はわかりやすくでかでかと描きましたが、例えばグラフ内の特徴的な部分に注釈をつけたい場合などに役立ちます。</span>
<span id="cb70-633"><a href="#cb70-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-634"><a href="#cb70-634" aria-hidden="true" tabindex="-1"></a><span class="fu">## 時系列のプロット</span></span>
<span id="cb70-635"><a href="#cb70-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-636"><a href="#cb70-636" aria-hidden="true" tabindex="-1"></a>時系列データをプロットする際に、元データには年と月が別々に入っていることもあると思います。それらのデータをうまく使いながら時系列プロットを作成する方法について説明します。</span>
<span id="cb70-637"><a href="#cb70-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-638"><a href="#cb70-638" aria-hidden="true" tabindex="-1"></a>まずは年と月が別々に入っているデータを想定し、仮のデータフレームを作成します。</span>
<span id="cb70-639"><a href="#cb70-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-642"><a href="#cb70-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-643"><a href="#cb70-643" aria-hidden="true" tabindex="-1"></a><span class="co"># fmt: skip</span></span>
<span id="cb70-644"><a href="#cb70-644" aria-hidden="true" tabindex="-1"></a>time_data <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb70-645"><a href="#cb70-645" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>year, <span class="sc">~</span>month, <span class="sc">~</span>value,</span>
<span id="cb70-646"><a href="#cb70-646" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">4</span>, <span class="dv">22</span>,</span>
<span id="cb70-647"><a href="#cb70-647" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">5</span>, <span class="dv">30</span>,</span>
<span id="cb70-648"><a href="#cb70-648" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">6</span>, <span class="dv">26</span>,</span>
<span id="cb70-649"><a href="#cb70-649" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">7</span>, <span class="dv">35</span>,</span>
<span id="cb70-650"><a href="#cb70-650" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">8</span>, <span class="dv">40</span>,</span>
<span id="cb70-651"><a href="#cb70-651" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">9</span>, <span class="dv">38</span>,</span>
<span id="cb70-652"><a href="#cb70-652" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">10</span>, <span class="dv">45</span>,</span>
<span id="cb70-653"><a href="#cb70-653" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">11</span>, <span class="dv">50</span>,</span>
<span id="cb70-654"><a href="#cb70-654" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2020</span>, <span class="dv">12</span>, <span class="dv">48</span>,</span>
<span id="cb70-655"><a href="#cb70-655" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">52</span>,</span>
<span id="cb70-656"><a href="#cb70-656" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2021</span>, <span class="dv">2</span>, <span class="dv">55</span>,</span>
<span id="cb70-657"><a href="#cb70-657" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2021</span>, <span class="dv">3</span>, <span class="dv">53</span></span>
<span id="cb70-658"><a href="#cb70-658" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-659"><a href="#cb70-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-660"><a href="#cb70-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-661"><a href="#cb70-661" aria-hidden="true" tabindex="-1"></a>このように、<span class="in">`year`</span>と<span class="in">`month`</span>が別々に入っているデータを想定します。</span>
<span id="cb70-662"><a href="#cb70-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-663"><a href="#cb70-663" aria-hidden="true" tabindex="-1"></a>このデータを時系列プロットにするためには、まず<span class="in">`year`</span>と<span class="in">`month`</span>を結合して日付データに変換する必要があります。これには<span class="in">`lubridate`</span>パッケージを使うと便利です。</span>
<span id="cb70-664"><a href="#cb70-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-667"><a href="#cb70-667" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-668"><a href="#cb70-668" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("lubridate")</span></span>
<span id="cb70-669"><a href="#cb70-669" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb70-670"><a href="#cb70-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-671"><a href="#cb70-671" aria-hidden="true" tabindex="-1"></a>time_data <span class="ot">&lt;-</span> time_data <span class="sc">|&gt;</span></span>
<span id="cb70-672"><a href="#cb70-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">make_date</span>(year, month, <span class="dv">1</span>))</span>
<span id="cb70-673"><a href="#cb70-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-674"><a href="#cb70-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-677"><a href="#cb70-677" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-678"><a href="#cb70-678" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb70-679"><a href="#cb70-679" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-time-series-data</span></span>
<span id="cb70-680"><a href="#cb70-680" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "日付データを追加したデータフレーム"</span></span>
<span id="cb70-681"><a href="#cb70-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-682"><a href="#cb70-682" aria-hidden="true" tabindex="-1"></a>time_data <span class="sc">|&gt;</span></span>
<span id="cb70-683"><a href="#cb70-683" aria-hidden="true" tabindex="-1"></a>  tinytable<span class="sc">::</span><span class="fu">tt</span>(<span class="at">width =</span> <span class="dv">8</span>)</span>
<span id="cb70-684"><a href="#cb70-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-685"><a href="#cb70-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-686"><a href="#cb70-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-687"><a href="#cb70-687" aria-hidden="true" tabindex="-1"></a>ここで<span class="in">`make_date(year, month, 1)`</span>を使って、各年と月の1日の日付データを作成しています。これで<span class="in">`date`</span>列が追加されました。</span>
<span id="cb70-688"><a href="#cb70-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-689"><a href="#cb70-689" aria-hidden="true" tabindex="-1"></a>次に、この<span class="in">`date`</span>列を使って時系列プロットを作成します。</span>
<span id="cb70-690"><a href="#cb70-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-693"><a href="#cb70-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-694"><a href="#cb70-694" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-time-series</span></span>
<span id="cb70-695"><a href="#cb70-695" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "時系列プロット"</span></span>
<span id="cb70-696"><a href="#cb70-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-697"><a href="#cb70-697" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb70-698"><a href="#cb70-698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb70-699"><a href="#cb70-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb70-700"><a href="#cb70-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-701"><a href="#cb70-701" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-702"><a href="#cb70-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-703"><a href="#cb70-703" aria-hidden="true" tabindex="-1"></a>これで時系列がプロットできていることがわかるかと思います。</span>
<span id="cb70-704"><a href="#cb70-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-705"><a href="#cb70-705" aria-hidden="true" tabindex="-1"></a>ただ、このままだと目盛りが「4 2020」のようになっており、日本人には馴染みが薄い形式です。そこで、<span class="in">`scale_x_date()`</span>を使って目盛りの形式を変更します。</span>
<span id="cb70-706"><a href="#cb70-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-709"><a href="#cb70-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-710"><a href="#cb70-710" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-time-series-format</span></span>
<span id="cb70-711"><a href="#cb70-711" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "目盛りの形式を変更しました"</span></span>
<span id="cb70-712"><a href="#cb70-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-713"><a href="#cb70-713" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb70-714"><a href="#cb70-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb70-715"><a href="#cb70-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-716"><a href="#cb70-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb70-717"><a href="#cb70-717" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%Y-%m"</span>,</span>
<span id="cb70-718"><a href="#cb70-718" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"2 month"</span></span>
<span id="cb70-719"><a href="#cb70-719" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-720"><a href="#cb70-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-721"><a href="#cb70-721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-722"><a href="#cb70-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-723"><a href="#cb70-723" aria-hidden="true" tabindex="-1"></a><span class="in">`date_labels = "%Y-%m"`</span>で年-月の形式に変更し、<span class="in">`date_breaks = "2 month"`</span>で2か月ごとに目盛りを設定しています。間隔を調整したいときは、<span class="in">`date_breaks`</span>の値を変更してください。</span>
<span id="cb70-724"><a href="#cb70-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-725"><a href="#cb70-725" aria-hidden="true" tabindex="-1"></a>ラベルはいろいろ変更できます。</span>
<span id="cb70-726"><a href="#cb70-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-729"><a href="#cb70-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-730"><a href="#cb70-730" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-time-series-format-2</span></span>
<span id="cb70-731"><a href="#cb70-731" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "別の形式に変更しました"</span></span>
<span id="cb70-732"><a href="#cb70-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-733"><a href="#cb70-733" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb70-734"><a href="#cb70-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb70-735"><a href="#cb70-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-736"><a href="#cb70-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb70-737"><a href="#cb70-737" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%Y年%m月"</span>,</span>
<span id="cb70-738"><a href="#cb70-738" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"3 month"</span></span>
<span id="cb70-739"><a href="#cb70-739" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-740"><a href="#cb70-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-741"><a href="#cb70-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-742"><a href="#cb70-742" aria-hidden="true" tabindex="-1"></a><span class="in">`%Y`</span>で年、<span class="in">`%m`</span>で月を表します。</span>
<span id="cb70-743"><a href="#cb70-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-744"><a href="#cb70-744" aria-hidden="true" tabindex="-1"></a>ちなみにこの状態だと1桁の月は0埋めされてしまいます。1桁の月を0埋めせずに表示したい場合は、WindowsとMac/Linuxで異なるのですが、以下の方法で実装可能です。</span>
<span id="cb70-745"><a href="#cb70-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-746"><a href="#cb70-746" aria-hidden="true" tabindex="-1"></a>:::{.panel-tabset}</span>
<span id="cb70-747"><a href="#cb70-747" aria-hidden="true" tabindex="-1"></a><span class="fu">## Windowsの場合</span></span>
<span id="cb70-748"><a href="#cb70-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-749"><a href="#cb70-749" aria-hidden="true" tabindex="-1"></a>Windowsの場合は少々複雑です。</span>
<span id="cb70-750"><a href="#cb70-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-753"><a href="#cb70-753" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-754"><a href="#cb70-754" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-time-series-format-3-win</span></span>
<span id="cb70-755"><a href="#cb70-755" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "1桁の月を0埋めしない形式（Windows）"</span></span>
<span id="cb70-756"><a href="#cb70-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-757"><a href="#cb70-757" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb70-758"><a href="#cb70-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb70-759"><a href="#cb70-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-760"><a href="#cb70-760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb70-761"><a href="#cb70-761" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="st">"2 months"</span>,</span>
<span id="cb70-762"><a href="#cb70-762" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> \(x) {</span>
<span id="cb70-763"><a href="#cb70-763" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb70-764"><a href="#cb70-764" aria-hidden="true" tabindex="-1"></a>        <span class="fu">format</span>(x, <span class="st">"%Y年"</span>),</span>
<span id="cb70-765"><a href="#cb70-765" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.integer</span>(<span class="fu">format</span>(x, <span class="st">"%m"</span>)),</span>
<span id="cb70-766"><a href="#cb70-766" aria-hidden="true" tabindex="-1"></a>        <span class="st">"月"</span></span>
<span id="cb70-767"><a href="#cb70-767" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb70-768"><a href="#cb70-768" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-769"><a href="#cb70-769" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-770"><a href="#cb70-770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-771"><a href="#cb70-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-772"><a href="#cb70-772" aria-hidden="true" tabindex="-1"></a>注目すべきところは<span class="in">`labels = \(x) { ... }`</span>の部分です。<span class="in">`format(x, "%Y年")`</span>で年を取得し、<span class="in">`as.integer(format(x, "%m"))`</span>で月を取得したのち整数に変換しています。こうすることで1桁の月は0埋めされなくなります。最後に<span class="in">`paste0()`</span>で年と月の整数、"月"を結合しています。</span>
<span id="cb70-773"><a href="#cb70-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-774"><a href="#cb70-774" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mac/Linuxの場合</span></span>
<span id="cb70-775"><a href="#cb70-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-776"><a href="#cb70-776" aria-hidden="true" tabindex="-1"></a>MacやLinuxの場合はWindowsより簡単です。</span>
<span id="cb70-777"><a href="#cb70-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-780"><a href="#cb70-780" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-781"><a href="#cb70-781" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb70-782"><a href="#cb70-782" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-time-series-format-3-mac</span></span>
<span id="cb70-783"><a href="#cb70-783" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "1桁の月を0埋めしない形式（Mac/Linux）"</span></span>
<span id="cb70-784"><a href="#cb70-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-785"><a href="#cb70-785" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb70-786"><a href="#cb70-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb70-787"><a href="#cb70-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-788"><a href="#cb70-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb70-789"><a href="#cb70-789" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%Y年%-m月"</span>,</span>
<span id="cb70-790"><a href="#cb70-790" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"2 month"</span></span>
<span id="cb70-791"><a href="#cb70-791" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-792"><a href="#cb70-792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-793"><a href="#cb70-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-794"><a href="#cb70-794" aria-hidden="true" tabindex="-1"></a>僕の環境はWindowsなので実行できませんが、<span class="in">`%-m`</span>とすることで1桁の月を0埋めせずに表示できます。</span>
<span id="cb70-795"><a href="#cb70-795" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb70-796"><a href="#cb70-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-797"><a href="#cb70-797" aria-hidden="true" tabindex="-1"></a><span class="fu">## 複数のカテゴリのプロットと凡例</span></span>
<span id="cb70-798"><a href="#cb70-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-799"><a href="#cb70-799" aria-hidden="true" tabindex="-1"></a><span class="fu">### 複数のカテゴリのプロット {#sec-multi-cat-plot}</span></span>
<span id="cb70-800"><a href="#cb70-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-801"><a href="#cb70-801" aria-hidden="true" tabindex="-1"></a>ここでは<span class="in">`Orange`</span>データセットを使って複数のカテゴリのプロットと、凡例について説明します。</span>
<span id="cb70-802"><a href="#cb70-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-803"><a href="#cb70-803" aria-hidden="true" tabindex="-1"></a>複数のカテゴリのプロットとは、以下のデータを見ていただけると早いと思います。</span>
<span id="cb70-804"><a href="#cb70-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-807"><a href="#cb70-807" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-808"><a href="#cb70-808" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb70-809"><a href="#cb70-809" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-orange</span></span>
<span id="cb70-810"><a href="#cb70-810" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "`Orangeデータセットの一部"</span></span>
<span id="cb70-811"><a href="#cb70-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-812"><a href="#cb70-812" aria-hidden="true" tabindex="-1"></a>Orange <span class="sc">|&gt;</span></span>
<span id="cb70-813"><a href="#cb70-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb70-814"><a href="#cb70-814" aria-hidden="true" tabindex="-1"></a>  tinytable<span class="sc">::</span><span class="fu">tt</span>(<span class="at">width =</span> <span class="dv">8</span>)</span>
<span id="cb70-815"><a href="#cb70-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-816"><a href="#cb70-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-817"><a href="#cb70-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-818"><a href="#cb70-818" aria-hidden="true" tabindex="-1"></a><span class="in">`Tree`</span>は木の識別子で、1～5まであります。<span class="in">`age`</span>は日齢、<span class="in">`circumference`</span>は幹の周囲です。</span>
<span id="cb70-819"><a href="#cb70-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-820"><a href="#cb70-820" aria-hidden="true" tabindex="-1"></a>ここでやりたいことは、木の種類ごとに、日齢と幹の周囲を軸にとってプロットすることです。これをただプロットしてしまうと、</span>
<span id="cb70-821"><a href="#cb70-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-824"><a href="#cb70-824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-825"><a href="#cb70-825" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-orange-pool</span></span>
<span id="cb70-826"><a href="#cb70-826" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "すべてのデータを放り込みました"</span></span>
<span id="cb70-827"><a href="#cb70-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-828"><a href="#cb70-828" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference)) <span class="sc">+</span></span>
<span id="cb70-829"><a href="#cb70-829" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb70-830"><a href="#cb70-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-831"><a href="#cb70-831" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-832"><a href="#cb70-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-833"><a href="#cb70-833" aria-hidden="true" tabindex="-1"></a>これでは各点がどの木のものなのか判別できない状態です。</span>
<span id="cb70-834"><a href="#cb70-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-835"><a href="#cb70-835" aria-hidden="true" tabindex="-1"></a>これを識別するために、色を付けたいとしましょう。</span>
<span id="cb70-836"><a href="#cb70-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-839"><a href="#cb70-839" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-840"><a href="#cb70-840" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-orange-color</span></span>
<span id="cb70-841"><a href="#cb70-841" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "色が分かれました"</span></span>
<span id="cb70-842"><a href="#cb70-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-843"><a href="#cb70-843" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference, <span class="at">color =</span> Tree)) <span class="sc">+</span></span>
<span id="cb70-844"><a href="#cb70-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb70-845"><a href="#cb70-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-846"><a href="#cb70-846" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-847"><a href="#cb70-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-848"><a href="#cb70-848" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">前のセクション</span><span class="co">](#sec-color)</span>では<span class="in">`geom_point(color = "red")`</span>のように線全体に対して同じ色を付けましたが、今回の方法では、色を付けることを前提として、<span class="in">`aes()`</span>内の<span class="in">`color =`</span>で指定した種類ごとに色が付くという設定です。</span>
<span id="cb70-849"><a href="#cb70-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-850"><a href="#cb70-850" aria-hidden="true" tabindex="-1"></a>これでとりあえずはどの点がどの木のものかわかるようになりました。</span>
<span id="cb70-851"><a href="#cb70-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-852"><a href="#cb70-852" aria-hidden="true" tabindex="-1"></a>今は散布図なので色を分けるだけで済みますが、折れ線グラフのような場合は、色だけでなく線の種類を変えたいかもしれません。そんな時は次のようにします。</span>
<span id="cb70-853"><a href="#cb70-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-856"><a href="#cb70-856" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-857"><a href="#cb70-857" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-orange-linetype</span></span>
<span id="cb70-858"><a href="#cb70-858" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "折れ線の種類も分かれました"</span></span>
<span id="cb70-859"><a href="#cb70-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-860"><a href="#cb70-860" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference, <span class="at">color =</span> Tree, <span class="at">linetype =</span> Tree)) <span class="sc">+</span></span>
<span id="cb70-861"><a href="#cb70-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-862"><a href="#cb70-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb70-863"><a href="#cb70-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-864"><a href="#cb70-864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-865"><a href="#cb70-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-866"><a href="#cb70-866" aria-hidden="true" tabindex="-1"></a><span class="in">`linetype = Tree`</span>を追加することで線の種類も木の種類ごとに変更することができました。</span>
<span id="cb70-867"><a href="#cb70-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-868"><a href="#cb70-868" aria-hidden="true" tabindex="-1"></a>このように<span class="in">`aes()`</span>内で要素を追加することで種類ごとに分けることができます。他にも散布図の点の形をカテゴリごとに変えたければ<span class="in">`shape = Tree`</span>のようにすれば可能です。</span>
<span id="cb70-869"><a href="#cb70-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-870"><a href="#cb70-870" aria-hidden="true" tabindex="-1"></a>まだ色遣いなどは不格好ですが、いったんこのまま進めます。</span>
<span id="cb70-871"><a href="#cb70-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-872"><a href="#cb70-872" aria-hidden="true" tabindex="-1"></a><span class="fu">### 凡例の位置</span></span>
<span id="cb70-873"><a href="#cb70-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-874"><a href="#cb70-874" aria-hidden="true" tabindex="-1"></a>次にしたいのは、凡例の設定です。凡例は現在右側に表示されていますが、まずはこれを下に表示したいとします。</span>
<span id="cb70-875"><a href="#cb70-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-876"><a href="#cb70-876" aria-hidden="true" tabindex="-1"></a>これは、<span class="in">`theme()`</span>内の<span class="in">`legend.position`</span>で設定できます。</span>
<span id="cb70-877"><a href="#cb70-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-880"><a href="#cb70-880" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-881"><a href="#cb70-881" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-orange-legend-position</span></span>
<span id="cb70-882"><a href="#cb70-882" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "凡例が下に来ました"</span></span>
<span id="cb70-883"><a href="#cb70-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-884"><a href="#cb70-884" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference, <span class="at">color =</span> Tree)) <span class="sc">+</span></span>
<span id="cb70-885"><a href="#cb70-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-886"><a href="#cb70-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb70-887"><a href="#cb70-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-888"><a href="#cb70-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-889"><a href="#cb70-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-890"><a href="#cb70-890" aria-hidden="true" tabindex="-1"></a><span class="in">`theme(legend.position = "bottom")`</span>を設定することで、凡例の位置が下になりました。もちろんbottom以外にもtop, left, right（デフォルト）などを指定することができます。</span>
<span id="cb70-891"><a href="#cb70-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-892"><a href="#cb70-892" aria-hidden="true" tabindex="-1"></a>さらに凡例を消したい場合は次のようにします。</span>
<span id="cb70-893"><a href="#cb70-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-896"><a href="#cb70-896" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-897"><a href="#cb70-897" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-orange-legend-delete</span></span>
<span id="cb70-898"><a href="#cb70-898" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "凡例を消しました"</span></span>
<span id="cb70-899"><a href="#cb70-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-900"><a href="#cb70-900" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference, <span class="at">color =</span> Tree)) <span class="sc">+</span></span>
<span id="cb70-901"><a href="#cb70-901" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-902"><a href="#cb70-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb70-903"><a href="#cb70-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-904"><a href="#cb70-904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-905"><a href="#cb70-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-906"><a href="#cb70-906" aria-hidden="true" tabindex="-1"></a><span class="in">`theme(legend.position = "none")`</span>で凡例を消すことができました。</span>
<span id="cb70-907"><a href="#cb70-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-908"><a href="#cb70-908" aria-hidden="true" tabindex="-1"></a><span class="fu">### 凡例の調整</span></span>
<span id="cb70-909"><a href="#cb70-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-910"><a href="#cb70-910" aria-hidden="true" tabindex="-1"></a>例えば、凡例のタイトルだけ消したい場合が結構あると思います。@fig-orange-color の例でいえば、Treeという文字は消したいということです。</span>
<span id="cb70-911"><a href="#cb70-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-912"><a href="#cb70-912" aria-hidden="true" tabindex="-1"></a>そんな場合は、<span class="in">`guides()`</span>を使います。</span>
<span id="cb70-913"><a href="#cb70-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-916"><a href="#cb70-916" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-917"><a href="#cb70-917" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-orange-legend-delte-title</span></span>
<span id="cb70-918"><a href="#cb70-918" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "凡例のタイトルを削除"</span></span>
<span id="cb70-919"><a href="#cb70-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-920"><a href="#cb70-920" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference, <span class="at">color =</span> Tree)) <span class="sc">+</span></span>
<span id="cb70-921"><a href="#cb70-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-922"><a href="#cb70-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="cn">NULL</span>))</span>
<span id="cb70-923"><a href="#cb70-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-924"><a href="#cb70-924" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-925"><a href="#cb70-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-926"><a href="#cb70-926" aria-hidden="true" tabindex="-1"></a>Treeというタイトルが消えました。</span>
<span id="cb70-927"><a href="#cb70-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-928"><a href="#cb70-928" aria-hidden="true" tabindex="-1"></a>ここでは<span class="in">`guides(color = guide_legend(title = NULL))`</span>としていますが、<span class="in">`aes()`</span>内で例えば<span class="in">`linetype`</span>を使っている場合は、<span class="in">`guides()`</span>内も<span class="in">`linetype =`</span>にする必要があります。</span>
<span id="cb70-929"><a href="#cb70-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-930"><a href="#cb70-930" aria-hidden="true" tabindex="-1"></a><span class="fu">## テーマ</span></span>
<span id="cb70-931"><a href="#cb70-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-932"><a href="#cb70-932" aria-hidden="true" tabindex="-1"></a>ggplotではテーマを選ぶことができます。デフォルトではこれまでの図のように背景がグレーになっていますが、ほとんどの場合で背景は白にしたいですよね。</span>
<span id="cb70-933"><a href="#cb70-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-934"><a href="#cb70-934" aria-hidden="true" tabindex="-1"></a>背景だけでなく、罫線等もテーマで変更することができます。</span>
<span id="cb70-935"><a href="#cb70-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-936"><a href="#cb70-936" aria-hidden="true" tabindex="-1"></a><span class="fu">### プリセットのテーマ</span></span>
<span id="cb70-937"><a href="#cb70-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-938"><a href="#cb70-938" aria-hidden="true" tabindex="-1"></a>いくつかのテーマが準備されています。代表的なものをいくつかご紹介します。</span>
<span id="cb70-939"><a href="#cb70-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-940"><a href="#cb70-940" aria-hidden="true" tabindex="-1"></a>:::{.panel-tabset}</span>
<span id="cb70-941"><a href="#cb70-941" aria-hidden="true" tabindex="-1"></a><span class="fu">## minimal</span></span>
<span id="cb70-942"><a href="#cb70-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-945"><a href="#cb70-945" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-946"><a href="#cb70-946" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-minimal</span></span>
<span id="cb70-947"><a href="#cb70-947" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "`theme_minimal()`"</span></span>
<span id="cb70-948"><a href="#cb70-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-949"><a href="#cb70-949" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-950"><a href="#cb70-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-951"><a href="#cb70-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb70-952"><a href="#cb70-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-953"><a href="#cb70-953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-954"><a href="#cb70-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-955"><a href="#cb70-955" aria-hidden="true" tabindex="-1"></a><span class="fu">## bw</span></span>
<span id="cb70-956"><a href="#cb70-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-959"><a href="#cb70-959" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-960"><a href="#cb70-960" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-bw</span></span>
<span id="cb70-961"><a href="#cb70-961" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "`theme_bw()`"</span></span>
<span id="cb70-962"><a href="#cb70-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-963"><a href="#cb70-963" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-964"><a href="#cb70-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-965"><a href="#cb70-965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb70-966"><a href="#cb70-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-967"><a href="#cb70-967" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-968"><a href="#cb70-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-969"><a href="#cb70-969" aria-hidden="true" tabindex="-1"></a><span class="in">`theme_minimal()`</span>と比べて外枠が付いています。</span>
<span id="cb70-970"><a href="#cb70-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-971"><a href="#cb70-971" aria-hidden="true" tabindex="-1"></a><span class="fu">## classic</span></span>
<span id="cb70-972"><a href="#cb70-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-975"><a href="#cb70-975" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-976"><a href="#cb70-976" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-classic</span></span>
<span id="cb70-977"><a href="#cb70-977" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "`theme_classic()`"</span></span>
<span id="cb70-978"><a href="#cb70-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-979"><a href="#cb70-979" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-980"><a href="#cb70-980" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-981"><a href="#cb70-981" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb70-982"><a href="#cb70-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-983"><a href="#cb70-983" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-984"><a href="#cb70-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-985"><a href="#cb70-985" aria-hidden="true" tabindex="-1"></a><span class="fu">## linedraw</span></span>
<span id="cb70-986"><a href="#cb70-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-989"><a href="#cb70-989" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-990"><a href="#cb70-990" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-linedraw</span></span>
<span id="cb70-991"><a href="#cb70-991" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "`theme_linedraw()`"</span></span>
<span id="cb70-992"><a href="#cb70-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-993"><a href="#cb70-993" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-994"><a href="#cb70-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-995"><a href="#cb70-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>()</span>
<span id="cb70-996"><a href="#cb70-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-997"><a href="#cb70-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-998"><a href="#cb70-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-999"><a href="#cb70-999" aria-hidden="true" tabindex="-1"></a><span class="fu">## light</span></span>
<span id="cb70-1000"><a href="#cb70-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1003"><a href="#cb70-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1004"><a href="#cb70-1004" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-light</span></span>
<span id="cb70-1005"><a href="#cb70-1005" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "`theme_light()`"</span></span>
<span id="cb70-1006"><a href="#cb70-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1007"><a href="#cb70-1007" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-1008"><a href="#cb70-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-1009"><a href="#cb70-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb70-1010"><a href="#cb70-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1011"><a href="#cb70-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1012"><a href="#cb70-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1013"><a href="#cb70-1013" aria-hidden="true" tabindex="-1"></a><span class="fu">## void</span></span>
<span id="cb70-1014"><a href="#cb70-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1017"><a href="#cb70-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1018"><a href="#cb70-1018" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-void</span></span>
<span id="cb70-1019"><a href="#cb70-1019" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "`theme_void()`"</span></span>
<span id="cb70-1020"><a href="#cb70-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1021"><a href="#cb70-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-1022"><a href="#cb70-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-1023"><a href="#cb70-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb70-1024"><a href="#cb70-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1025"><a href="#cb70-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1026"><a href="#cb70-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1027"><a href="#cb70-1027" aria-hidden="true" tabindex="-1"></a>さすがにやりすぎでは…と思うかもしれませんが、GISで地図を可視化するようなときに重宝します。</span>
<span id="cb70-1028"><a href="#cb70-1028" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb70-1029"><a href="#cb70-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1030"><a href="#cb70-1030" aria-hidden="true" tabindex="-1"></a><span class="fu">### `theme()`関数</span></span>
<span id="cb70-1031"><a href="#cb70-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1032"><a href="#cb70-1032" aria-hidden="true" tabindex="-1"></a>ここまでご紹介したものの中で<span class="in">`theme()`</span>を使ったものがいくつかありました。</span>
<span id="cb70-1033"><a href="#cb70-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1034"><a href="#cb70-1034" aria-hidden="true" tabindex="-1"></a>ここで<span class="in">`theme()`</span>**は**`theme_xxx()`**の後に使う**ということに注意してください。</span>
<span id="cb70-1035"><a href="#cb70-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1036"><a href="#cb70-1036" aria-hidden="true" tabindex="-1"></a>これは、<span class="in">`theme_xxx()`</span>が<span class="in">`theme()`</span>の設定を上書きしてしまうためです。</span>
<span id="cb70-1037"><a href="#cb70-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1040"><a href="#cb70-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1041"><a href="#cb70-1041" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-miss</span></span>
<span id="cb70-1042"><a href="#cb70-1042" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "失敗例"</span></span>
<span id="cb70-1043"><a href="#cb70-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1044"><a href="#cb70-1044" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-1045"><a href="#cb70-1045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-1046"><a href="#cb70-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb70-1047"><a href="#cb70-1047" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb70-1048"><a href="#cb70-1048" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1049"><a href="#cb70-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1050"><a href="#cb70-1050" aria-hidden="true" tabindex="-1"></a><span class="in">`theme(axis.title = element_text(color = "red"))`</span>で軸ラベルを赤色に設定していますが、出力されたものは黒いラベルになっています。</span>
<span id="cb70-1051"><a href="#cb70-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1052"><a href="#cb70-1052" aria-hidden="true" tabindex="-1"></a>順番を逆にすれば、</span>
<span id="cb70-1053"><a href="#cb70-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1056"><a href="#cb70-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1057"><a href="#cb70-1057" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-success</span></span>
<span id="cb70-1058"><a href="#cb70-1058" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "正しい例"</span></span>
<span id="cb70-1059"><a href="#cb70-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1060"><a href="#cb70-1060" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-1061"><a href="#cb70-1061" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-1062"><a href="#cb70-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb70-1063"><a href="#cb70-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>))</span>
<span id="cb70-1064"><a href="#cb70-1064" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1065"><a href="#cb70-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1066"><a href="#cb70-1066" aria-hidden="true" tabindex="-1"></a>このようにしっかり反映されます。</span>
<span id="cb70-1067"><a href="#cb70-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1068"><a href="#cb70-1068" aria-hidden="true" tabindex="-1"></a><span class="in">`theme()`</span>は<span class="in">`theme_xxx()`</span>で設定できない部分を細かく調整したい場合に使います。できることはたくさんあるので全てを説明することはできませんが、例えば以下のようなことができます。</span>
<span id="cb70-1069"><a href="#cb70-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1072"><a href="#cb70-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1073"><a href="#cb70-1073" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-custom</span></span>
<span id="cb70-1074"><a href="#cb70-1074" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "カスタムテーマ"</span></span>
<span id="cb70-1075"><a href="#cb70-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1076"><a href="#cb70-1076" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-1077"><a href="#cb70-1077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-1078"><a href="#cb70-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb70-1079"><a href="#cb70-1079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb70-1080"><a href="#cb70-1080" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb70-1081"><a href="#cb70-1081" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb70-1082"><a href="#cb70-1082" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb70-1083"><a href="#cb70-1083" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>, <span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb70-1084"><a href="#cb70-1084" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-1085"><a href="#cb70-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1086"><a href="#cb70-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1087"><a href="#cb70-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1088"><a href="#cb70-1088" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`panel.grid = element_blank()`</span>で罫線を消す</span>
<span id="cb70-1089"><a href="#cb70-1089" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`legend.position = "none"`</span>で凡例を消す</span>
<span id="cb70-1090"><a href="#cb70-1090" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span><span class="in">`axis.title`</span>と<span class="in">`axis.text`</span>で軸ラベルと目盛りのフォントとサイズを変更</span>
<span id="cb70-1091"><a href="#cb70-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1092"><a href="#cb70-1092" aria-hidden="true" tabindex="-1"></a>このように、「グラフのここを変えたいんだけどなぁ…」みたいなことは<span class="in">`theme()`</span>で解決できることが多かったりします。</span>
<span id="cb70-1093"><a href="#cb70-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1094"><a href="#cb70-1094" aria-hidden="true" tabindex="-1"></a>詳しくは<span class="in">`?theme`</span>で確認してみてください。引数名はわかりやすいので、比較的目的を見つけやすいと思います。</span>
<span id="cb70-1095"><a href="#cb70-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1096"><a href="#cb70-1096" aria-hidden="true" tabindex="-1"></a><span class="fu">## 新しくなった`theme()`の設定</span></span>
<span id="cb70-1097"><a href="#cb70-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1098"><a href="#cb70-1098" aria-hidden="true" tabindex="-1"></a><span class="fu">### `paper`と`ink`</span></span>
<span id="cb70-1099"><a href="#cb70-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1100"><a href="#cb70-1100" aria-hidden="true" tabindex="-1"></a>ggplot2のバージョン4.0.0からは、<span class="in">`theme_xxx()`</span>内で色に関するデフォルト設定が追加できるようになりました。</span>
<span id="cb70-1101"><a href="#cb70-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1102"><a href="#cb70-1102" aria-hidden="true" tabindex="-1"></a>百聞は一見に如かずということで、以下のコードをご覧ください。</span>
<span id="cb70-1103"><a href="#cb70-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1106"><a href="#cb70-1106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1107"><a href="#cb70-1107" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-v4</span></span>
<span id="cb70-1108"><a href="#cb70-1108" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "theme()内での色のデフォルト設定"</span></span>
<span id="cb70-1109"><a href="#cb70-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1110"><a href="#cb70-1110" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-1111"><a href="#cb70-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-1112"><a href="#cb70-1112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"papayawhip"</span>, <span class="at">ink =</span> <span class="st">"darkgreen"</span>)</span>
<span id="cb70-1113"><a href="#cb70-1113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1114"><a href="#cb70-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1115"><a href="#cb70-1115" aria-hidden="true" tabindex="-1"></a><span class="in">`paper`</span>で背景色、<span class="in">`ink`</span>で前景色を指定することができます。前景色は、軸ラベル、目盛り、点などに適用されます。</span>
<span id="cb70-1116"><a href="#cb70-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1117"><a href="#cb70-1117" aria-hidden="true" tabindex="-1"></a>ここのポイントは、使用する色を統一的に指定できるということで、例えば<span class="in">`theme()`</span>内で<span class="in">`axis.title`</span>や<span class="in">`axis.text`</span>の色を指定する必要がなくなります。</span>
<span id="cb70-1118"><a href="#cb70-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1119"><a href="#cb70-1119" aria-hidden="true" tabindex="-1"></a><span class="fu">### `geom`</span></span>
<span id="cb70-1120"><a href="#cb70-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1121"><a href="#cb70-1121" aria-hidden="true" tabindex="-1"></a>また、<span class="in">`theme()`</span>内で<span class="in">`geom`</span>を設定することで、色に関するデフォルトを設定しつつ<span class="in">`geom_xxx()`</span>内でその設定を参照することが可能です。</span>
<span id="cb70-1122"><a href="#cb70-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1125"><a href="#cb70-1125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1126"><a href="#cb70-1126" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-v4-geom</span></span>
<span id="cb70-1127"><a href="#cb70-1127" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "geom内での色のデフォルト設定"</span></span>
<span id="cb70-1128"><a href="#cb70-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1129"><a href="#cb70-1129" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-1130"><a href="#cb70-1130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-1131"><a href="#cb70-1131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"papayawhip"</span>, <span class="at">ink =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb70-1132"><a href="#cb70-1132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb70-1133"><a href="#cb70-1133" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="fu">element_geom</span>(<span class="at">color =</span> <span class="st">"coral"</span>, <span class="at">pointsize =</span> <span class="dv">3</span>)</span>
<span id="cb70-1134"><a href="#cb70-1134" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-1135"><a href="#cb70-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1136"><a href="#cb70-1136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1137"><a href="#cb70-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1138"><a href="#cb70-1138" aria-hidden="true" tabindex="-1"></a>ここでは、<span class="in">`theme(geom = element_geom(color = "coral", pointsize = 3))`</span>で点の色と大きさを指定しています。<span class="in">`element_geom()`</span>は<span class="in">`geom_point()`</span>、<span class="in">`geom_line()`</span>、<span class="in">`geom_bar()`</span>などで共通して使われる設定を指定できます。一元管理できる点が便利ですね。</span>
<span id="cb70-1139"><a href="#cb70-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1140"><a href="#cb70-1140" aria-hidden="true" tabindex="-1"></a>ちなみに<span class="in">`geom`</span>を設定しないと、点の色は<span class="in">`ink`</span>の色、すなわちdarkgreenになります。</span>
<span id="cb70-1141"><a href="#cb70-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1142"><a href="#cb70-1142" aria-hidden="true" tabindex="-1"></a><span class="fu">### `from_theme()`</span></span>
<span id="cb70-1143"><a href="#cb70-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1144"><a href="#cb70-1144" aria-hidden="true" tabindex="-1"></a>さらに、<span class="in">`geom_xxx()`</span>内で<span class="in">`from_theme()`</span>を使うことにより、<span class="in">`theme()`</span>内で設定した色を<span class="in">`geom_xxx()`</span>内で参照することも可能です。</span>
<span id="cb70-1145"><a href="#cb70-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1148"><a href="#cb70-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1149"><a href="#cb70-1149" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-v4-from_theme</span></span>
<span id="cb70-1150"><a href="#cb70-1150" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb70-1151"><a href="#cb70-1151" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap:</span></span>
<span id="cb70-1152"><a href="#cb70-1152" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "アクセントカラーを青に"</span></span>
<span id="cb70-1153"><a href="#cb70-1153" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "アクセントカラーをオレンジに"</span></span>
<span id="cb70-1154"><a href="#cb70-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1155"><a href="#cb70-1155" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width)) <span class="sc">+</span></span>
<span id="cb70-1156"><a href="#cb70-1156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">from_theme</span>(accent))) <span class="sc">+</span></span>
<span id="cb70-1157"><a href="#cb70-1157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb70-1158"><a href="#cb70-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1159"><a href="#cb70-1159" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">geom =</span> <span class="fu">element_geom</span>(<span class="at">accent =</span> <span class="st">"blue"</span>))</span>
<span id="cb70-1160"><a href="#cb70-1160" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">geom =</span> <span class="fu">element_geom</span>(<span class="at">accent =</span> <span class="st">"orange"</span>))</span>
<span id="cb70-1161"><a href="#cb70-1161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1162"><a href="#cb70-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1163"><a href="#cb70-1163" aria-hidden="true" tabindex="-1"></a>ここでは、<span class="in">`from_theme(accent)`</span>で<span class="in">`theme()`</span>内で設定した<span class="in">`accent`</span>を参照しています。<span class="in">`theme(geom = element_geom(accent = "blue"))`</span>のように設定することで、アクセントカラーを青に変更できます。</span>
<span id="cb70-1164"><a href="#cb70-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1165"><a href="#cb70-1165" aria-hidden="true" tabindex="-1"></a>これは<span class="in">`element_geom(color = "blue")`</span>と一見同じことをしているように思えますが、たくさんのプロットを作成する場合、<span class="in">`accent`</span>を一括で変更できる点で便利です。</span>
<span id="cb70-1166"><a href="#cb70-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1167"><a href="#cb70-1167" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 使用例</span></span>
<span id="cb70-1168"><a href="#cb70-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1169"><a href="#cb70-1169" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>ケース：</span>
<span id="cb70-1170"><a href="#cb70-1170" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>論文執筆をしており、論文用とスライド用で色を変えたい</span>
<span id="cb70-1171"><a href="#cb70-1171" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="in">`geom_point()`</span>と<span class="in">`geom_smooth()`</span>を使っており、<span class="in">`geom_smooth()`</span>の色は論文用とスライド用で変えたい</span>
<span id="cb70-1172"><a href="#cb70-1172" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>解決策：</span>
<span id="cb70-1173"><a href="#cb70-1173" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>テーマ側でアクセントカラーを定義</span>
<span id="cb70-1174"><a href="#cb70-1174" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`geom_line()`</span>のみ<span class="in">`from_theme(accent)`</span>を参照させる</span>
<span id="cb70-1175"><a href="#cb70-1175" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>こうするとプロットの本体コードは共通のまま、テーマを差し替えるだけで線の色だけ切り替わる</span>
<span id="cb70-1176"><a href="#cb70-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1177"><a href="#cb70-1177" aria-hidden="true" tabindex="-1"></a>まず、あらかじめテーマを2つ用意しておきます。</span>
<span id="cb70-1178"><a href="#cb70-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1181"><a href="#cb70-1181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1182"><a href="#cb70-1182" aria-hidden="true" tabindex="-1"></a><span class="co"># 論文用のテーマ</span></span>
<span id="cb70-1183"><a href="#cb70-1183" aria-hidden="true" tabindex="-1"></a>theme_paper <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"white"</span>, <span class="at">ink =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb70-1184"><a href="#cb70-1184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">geom =</span> <span class="fu">element_geom</span>(<span class="at">accent =</span> <span class="st">"navy"</span>))</span>
<span id="cb70-1185"><a href="#cb70-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1186"><a href="#cb70-1186" aria-hidden="true" tabindex="-1"></a><span class="co"># スライド用のテーマ</span></span>
<span id="cb70-1187"><a href="#cb70-1187" aria-hidden="true" tabindex="-1"></a>theme_slide <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"black"</span>, <span class="at">ink =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb70-1188"><a href="#cb70-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">geom =</span> <span class="fu">element_geom</span>(<span class="at">accent =</span> <span class="st">"orange"</span>))</span>
<span id="cb70-1189"><a href="#cb70-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1190"><a href="#cb70-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1191"><a href="#cb70-1191" aria-hidden="true" tabindex="-1"></a>次に、テーマを除くプロット本体を作成します。</span>
<span id="cb70-1192"><a href="#cb70-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1195"><a href="#cb70-1195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1196"><a href="#cb70-1196" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(age, circumference)) <span class="sc">+</span></span>
<span id="cb70-1197"><a href="#cb70-1197" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 散布図は灰色で固定</span></span>
<span id="cb70-1198"><a href="#cb70-1198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"gray60"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-1199"><a href="#cb70-1199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb70-1200"><a href="#cb70-1200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">from_theme</span>(accent)),</span>
<span id="cb70-1201"><a href="#cb70-1201" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> lm,</span>
<span id="cb70-1202"><a href="#cb70-1202" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-1203"><a href="#cb70-1203" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb70-1204"><a href="#cb70-1204" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1205"><a href="#cb70-1205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (days)"</span>, <span class="at">y =</span> <span class="st">"Circumference (mm)"</span>)</span>
<span id="cb70-1206"><a href="#cb70-1206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1207"><a href="#cb70-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1208"><a href="#cb70-1208" aria-hidden="true" tabindex="-1"></a>この時点で<span class="in">`p`</span>をプロットしても、折れ線の色は変わりません。まだ<span class="in">`theme()`</span>を付けておらず、アクセントカラーが指定されていないためです。</span>
<span id="cb70-1209"><a href="#cb70-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1210"><a href="#cb70-1210" aria-hidden="true" tabindex="-1"></a>それでは先に設定したテーマを<span class="in">`p`</span>に適用します。</span>
<span id="cb70-1211"><a href="#cb70-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1214"><a href="#cb70-1214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1215"><a href="#cb70-1215" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-theme-final</span></span>
<span id="cb70-1216"><a href="#cb70-1216" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb70-1217"><a href="#cb70-1217" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap:</span></span>
<span id="cb70-1218"><a href="#cb70-1218" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "論文用のテーマ"</span></span>
<span id="cb70-1219"><a href="#cb70-1219" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "スライド用のテーマ"</span></span>
<span id="cb70-1220"><a href="#cb70-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1221"><a href="#cb70-1221" aria-hidden="true" tabindex="-1"></a>p_paper <span class="ot">&lt;-</span> p <span class="sc">+</span> theme_paper</span>
<span id="cb70-1222"><a href="#cb70-1222" aria-hidden="true" tabindex="-1"></a>p_slide <span class="ot">&lt;-</span> p <span class="sc">+</span> theme_slide</span>
<span id="cb70-1223"><a href="#cb70-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1224"><a href="#cb70-1224" aria-hidden="true" tabindex="-1"></a>p_paper</span>
<span id="cb70-1225"><a href="#cb70-1225" aria-hidden="true" tabindex="-1"></a>p_slide</span>
<span id="cb70-1226"><a href="#cb70-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1227"><a href="#cb70-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1228"><a href="#cb70-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1229"><a href="#cb70-1229" aria-hidden="true" tabindex="-1"></a>今回は1種類のスライドを論文用とスライド用に分ける想定しかしていませんが、たくさんのスライドを作る場合、アクセントカラーを一括で変えられる点で便利です。コードはそのままに、<span class="in">`tmeme_paper`</span>と<span class="in">`theme_slide`</span>の<span class="in">`accent`</span>だけ変えればよいからです。</span>
<span id="cb70-1230"><a href="#cb70-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1231"><a href="#cb70-1231" aria-hidden="true" tabindex="-1"></a><span class="fu">## 新しくなったラベル設定</span></span>
<span id="cb70-1232"><a href="#cb70-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1233"><a href="#cb70-1233" aria-hidden="true" tabindex="-1"></a>ここまでは<span class="in">`labs()`</span>や<span class="in">`xlab()`</span>、<span class="in">`ylab()`</span>で軸ラベルを設定してきましたが、あらかじめラベルを設定しておき、自動で表示させることが可能になりました。</span>
<span id="cb70-1234"><a href="#cb70-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1235"><a href="#cb70-1235" aria-hidden="true" tabindex="-1"></a><span class="in">`Orange`</span>データセットを使って説明します。</span>
<span id="cb70-1236"><a href="#cb70-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1237"><a href="#cb70-1237" aria-hidden="true" tabindex="-1"></a>まず、何もしない場合は以下のようになります。</span>
<span id="cb70-1238"><a href="#cb70-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1241"><a href="#cb70-1241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1242"><a href="#cb70-1242" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-label-default</span></span>
<span id="cb70-1243"><a href="#cb70-1243" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "デフォルトのラベル"</span></span>
<span id="cb70-1244"><a href="#cb70-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1245"><a href="#cb70-1245" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Orange, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference)) <span class="sc">+</span></span>
<span id="cb70-1246"><a href="#cb70-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb70-1247"><a href="#cb70-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1248"><a href="#cb70-1248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1249"><a href="#cb70-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1250"><a href="#cb70-1250" aria-hidden="true" tabindex="-1"></a>X軸は<span class="in">`age`</span>、Y軸は<span class="in">`circumference`</span>と表示されています。</span>
<span id="cb70-1251"><a href="#cb70-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1252"><a href="#cb70-1252" aria-hidden="true" tabindex="-1"></a>これを、あらかじめラベルを設定しておくことができるようになりました。</span>
<span id="cb70-1253"><a href="#cb70-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1256"><a href="#cb70-1256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1257"><a href="#cb70-1257" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb70-1258"><a href="#cb70-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1259"><a href="#cb70-1259" aria-hidden="true" tabindex="-1"></a><span class="co"># tibbleは属性を保持しやすい</span></span>
<span id="cb70-1260"><a href="#cb70-1260" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Orange)</span>
<span id="cb70-1261"><a href="#cb70-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1262"><a href="#cb70-1262" aria-hidden="true" tabindex="-1"></a><span class="co"># 単位: age=days, circumference=mm</span></span>
<span id="cb70-1263"><a href="#cb70-1263" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>age, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Age (days)"</span></span>
<span id="cb70-1264"><a href="#cb70-1264" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>circumference, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Trunk circumference (mm)"</span></span>
<span id="cb70-1265"><a href="#cb70-1265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1266"><a href="#cb70-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1267"><a href="#cb70-1267" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`attr()`</span>で変数に属性を追加</span>
<span id="cb70-1268"><a href="#cb70-1268" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="in">`df`</span>の<span class="in">`age`</span>の<span class="in">`label`</span>属性に<span class="in">`Age (days)`</span>を追加している、という解釈です。</span>
<span id="cb70-1269"><a href="#cb70-1269" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="in">`Age (days)`</span>や<span class="in">`Trunk circumference (mm)`</span>の部分がラベルなのでここを自由に変更できます。</span>
<span id="cb70-1270"><a href="#cb70-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1271"><a href="#cb70-1271" aria-hidden="true" tabindex="-1"></a>これで<span class="in">`df`</span>を使ってプロットすると、</span>
<span id="cb70-1272"><a href="#cb70-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1275"><a href="#cb70-1275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1276"><a href="#cb70-1276" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-label-custom</span></span>
<span id="cb70-1277"><a href="#cb70-1277" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "カスタムラベル"</span></span>
<span id="cb70-1278"><a href="#cb70-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1279"><a href="#cb70-1279" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> circumference)) <span class="sc">+</span></span>
<span id="cb70-1280"><a href="#cb70-1280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb70-1281"><a href="#cb70-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1282"><a href="#cb70-1282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1283"><a href="#cb70-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1284"><a href="#cb70-1284" aria-hidden="true" tabindex="-1"></a><span class="in">`labs()`</span>を使わなくても、X軸とY軸のラベルが変更されました。</span>
<span id="cb70-1285"><a href="#cb70-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1286"><a href="#cb70-1286" aria-hidden="true" tabindex="-1"></a>1つのグラフであれば<span class="in">`labs()`</span>で設定した方が労力が少ないかもしれませんが、大量のグラフを作成する場合、あらかじめラベルを設定しておけば、<span class="in">`labs()`</span>をいちいち書く必要がなくなるので便利です。</span>
<span id="cb70-1287"><a href="#cb70-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1288"><a href="#cb70-1288" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb70-1289"><a href="#cb70-1289" aria-hidden="true" tabindex="-1"></a><span class="fu">## tibble形式について</span></span>
<span id="cb70-1290"><a href="#cb70-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1291"><a href="#cb70-1291" aria-hidden="true" tabindex="-1"></a>皆さんはCSVデータを読み込むとき、何の関数を使用していますか？</span>
<span id="cb70-1292"><a href="#cb70-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1293"><a href="#cb70-1293" aria-hidden="true" tabindex="-1"></a>多いのはbase Rの<span class="in">`read.csv()`</span>や、tidyverseに含まれるreadrパッケージの<span class="in">`read_csv()`</span>だと思います。</span>
<span id="cb70-1294"><a href="#cb70-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1295"><a href="#cb70-1295" aria-hidden="true" tabindex="-1"></a><span class="in">`read.csv()`</span>はdata.frame形式、<span class="in">`read_csv()`</span>はtibble形式でデータを読み込みます。**tibbleはdata.frameを改良したデータ構造**で、tidyverseの多くのパッケージで標準的に使われており、以下のような特徴があります。</span>
<span id="cb70-1296"><a href="#cb70-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1297"><a href="#cb70-1297" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>見やすい表示 すべての行を出さず、必要に応じて端だけを表示するので、データの中身を把握しやすいです。</span>
<span id="cb70-1298"><a href="#cb70-1298" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>型情報を保持 各列のデータ型（数値・文字列など）が一緒に表示され、解析時に便利です。</span>
<span id="cb70-1299"><a href="#cb70-1299" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>属性を保持 labelのような属性が処理中に消えにくく、ラベル管理や可視化との相性が良いです。</span>
<span id="cb70-1300"><a href="#cb70-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1301"><a href="#cb70-1301" aria-hidden="true" tabindex="-1"></a>tibbleはdata.frameとほぼ同じように使えるので、tidyverseを使う場合はtibble形式でデータを扱うことをおすすめします。困ったら<span class="in">`tibble::as_tibble()`</span>で変換できます。</span>
<span id="cb70-1302"><a href="#cb70-1302" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb70-1303"><a href="#cb70-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1304"><a href="#cb70-1304" aria-hidden="true" tabindex="-1"></a><span class="fu">## カラーパレット</span></span>
<span id="cb70-1305"><a href="#cb70-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1306"><a href="#cb70-1306" aria-hidden="true" tabindex="-1"></a>ggplot2では、連続値やカテゴリ値を色で表現する際に「カラーパレット」を使います。</span>
<span id="cb70-1307"><a href="#cb70-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1308"><a href="#cb70-1308" aria-hidden="true" tabindex="-1"></a>例えば<span class="in">`scale_colour_brewer()`</span>や<span class="in">`scale_fill_viridis_c()`</span>を指定すると、データの値に応じて自動的に一貫した配色が割り当てられます。</span>
<span id="cb70-1309"><a href="#cb70-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1310"><a href="#cb70-1310" aria-hidden="true" tabindex="-1"></a>パレットを選ぶことで、見やすさや配色の意味（アクセシビリティ対応や論文用の白黒印刷など）を調整でき、グラフの理解度や印象に大きく影響します。</span>
<span id="cb70-1311"><a href="#cb70-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1312"><a href="#cb70-1312" aria-hidden="true" tabindex="-1"></a><span class="fu">### 連続値のカラースケール</span></span>
<span id="cb70-1313"><a href="#cb70-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1314"><a href="#cb70-1314" aria-hidden="true" tabindex="-1"></a>まずは例を見てみましょう。</span>
<span id="cb70-1315"><a href="#cb70-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1318"><a href="#cb70-1318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1319"><a href="#cb70-1319" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color-default</span></span>
<span id="cb70-1320"><a href="#cb70-1320" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "scale_colour_continuous()を使った例"</span></span>
<span id="cb70-1321"><a href="#cb70-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1322"><a href="#cb70-1322" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">colour =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb70-1323"><a href="#cb70-1323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-1324"><a href="#cb70-1324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_continuous</span>() <span class="sc">+</span></span>
<span id="cb70-1325"><a href="#cb70-1325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Petal length"</span>)</span>
<span id="cb70-1326"><a href="#cb70-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1327"><a href="#cb70-1327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1328"><a href="#cb70-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1329"><a href="#cb70-1329" aria-hidden="true" tabindex="-1"></a><span class="in">`scale_colour_continuous()`</span>は連続変数を色で表すためのカラースケールで、デフォルトの配色が使われ、数値の大小をなめらかなグラデーションで示しています。</span>
<span id="cb70-1330"><a href="#cb70-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1331"><a href="#cb70-1331" aria-hidden="true" tabindex="-1"></a>自分で色を指定することも可能です。</span>
<span id="cb70-1332"><a href="#cb70-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1335"><a href="#cb70-1335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1336"><a href="#cb70-1336" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color-continuous-custom</span></span>
<span id="cb70-1337"><a href="#cb70-1337" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap:</span></span>
<span id="cb70-1338"><a href="#cb70-1338" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "左: 青から赤へのグラデーション"</span></span>
<span id="cb70-1339"><a href="#cb70-1339" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "右: 指定した3色のグラデーション"</span></span>
<span id="cb70-1340"><a href="#cb70-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1341"><a href="#cb70-1341" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb70-1342"><a href="#cb70-1342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-1343"><a href="#cb70-1343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_continuous</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb70-1344"><a href="#cb70-1344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Petal length"</span>)</span>
<span id="cb70-1345"><a href="#cb70-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1346"><a href="#cb70-1346" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb70-1347"><a href="#cb70-1347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-1348"><a href="#cb70-1348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_continuous</span>(<span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#FEE0D2"</span>, <span class="st">"#FC9272"</span>, <span class="st">"#DE2D26"</span>)) <span class="sc">+</span></span>
<span id="cb70-1349"><a href="#cb70-1349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Petal length"</span>)</span>
<span id="cb70-1350"><a href="#cb70-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1351"><a href="#cb70-1351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1352"><a href="#cb70-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1353"><a href="#cb70-1353" aria-hidden="true" tabindex="-1"></a>lowからhighまでの2色を指定する方法や、自分で3色以上を指定する方法などがあります。</span>
<span id="cb70-1354"><a href="#cb70-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1355"><a href="#cb70-1355" aria-hidden="true" tabindex="-1"></a>また、他の例として<span class="in">`scale_colour_viridis_c()`</span>を使う方法もあったりします。</span>
<span id="cb70-1356"><a href="#cb70-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1359"><a href="#cb70-1359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1360"><a href="#cb70-1360" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color-viridis</span></span>
<span id="cb70-1361"><a href="#cb70-1361" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "scale_colour_viridis_c()を使った例"</span></span>
<span id="cb70-1362"><a href="#cb70-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1363"><a href="#cb70-1363" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb70-1364"><a href="#cb70-1364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-1365"><a href="#cb70-1365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb70-1366"><a href="#cb70-1366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Petal length"</span>)</span>
<span id="cb70-1367"><a href="#cb70-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1368"><a href="#cb70-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1369"><a href="#cb70-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1370"><a href="#cb70-1370" aria-hidden="true" tabindex="-1"></a><span class="in">`scale_colour_viridis_c()`</span>は連続変数を色で表すためのカラースケールで、視認性・色覚バリアフリー・白黒印刷対応に優れたviridisパレットを使います。<span class="in">`plasma`</span>以外にも<span class="in">`magma`</span>や<span class="in">`inferno`</span>、<span class="in">`cividis`</span>などのバリエーションがあります。</span>
<span id="cb70-1371"><a href="#cb70-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1372"><a href="#cb70-1372" aria-hidden="true" tabindex="-1"></a><span class="fu">### カテゴリ値のカラースケール</span></span>
<span id="cb70-1373"><a href="#cb70-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1374"><a href="#cb70-1374" aria-hidden="true" tabindex="-1"></a>カテゴリ変数を色で表す場合は、<span class="in">`scale_colour_brewer()`</span>や<span class="in">`scale_colour_viridis_d()`</span>などを使います<span class="ot">[^2]</span>。</span>
<span id="cb70-1375"><a href="#cb70-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1376"><a href="#cb70-1376" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span>ちなみに<span class="in">`scale_colour_viridis`</span>の<span class="in">`c`</span>の方はcontinuousで、<span class="in">`d`</span>の方はdiscreteですね。</span>
<span id="cb70-1377"><a href="#cb70-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1380"><a href="#cb70-1380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1381"><a href="#cb70-1381" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color-brewer</span></span>
<span id="cb70-1382"><a href="#cb70-1382" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "scale_colour_brewer()を使った例"</span></span>
<span id="cb70-1383"><a href="#cb70-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1384"><a href="#cb70-1384" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Species)) <span class="sc">+</span></span>
<span id="cb70-1385"><a href="#cb70-1385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-1386"><a href="#cb70-1386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb70-1387"><a href="#cb70-1387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Species"</span>)</span>
<span id="cb70-1388"><a href="#cb70-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1389"><a href="#cb70-1389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1390"><a href="#cb70-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1391"><a href="#cb70-1391" aria-hidden="true" tabindex="-1"></a><span class="in">`scale_colour_brewer()`</span>の<span class="in">`palette`</span>には<span class="in">`Set1`</span>、<span class="in">`Set2`</span>、<span class="in">`Dark2`</span>、<span class="in">`Paired`</span>などのカラーパレットがあり、用途に応じて選択できます。</span>
<span id="cb70-1392"><a href="#cb70-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1393"><a href="#cb70-1393" aria-hidden="true" tabindex="-1"></a>また、<span class="in">`scale_colour_discrete()`</span>を使う方法もあります。</span>
<span id="cb70-1394"><a href="#cb70-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1397"><a href="#cb70-1397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1398"><a href="#cb70-1398" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color-discrete</span></span>
<span id="cb70-1399"><a href="#cb70-1399" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "scale_colour_discrete()を使った例"</span></span>
<span id="cb70-1400"><a href="#cb70-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1401"><a href="#cb70-1401" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Species)) <span class="sc">+</span></span>
<span id="cb70-1402"><a href="#cb70-1402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-1403"><a href="#cb70-1403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>() <span class="sc">+</span></span>
<span id="cb70-1404"><a href="#cb70-1404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Species"</span>)</span>
<span id="cb70-1405"><a href="#cb70-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1406"><a href="#cb70-1406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1407"><a href="#cb70-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1408"><a href="#cb70-1408" aria-hidden="true" tabindex="-1"></a>なんというか、これぞggplot2！という感じの配色ですね。もちろん色を自分で指定することも可能です。</span>
<span id="cb70-1409"><a href="#cb70-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1412"><a href="#cb70-1412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1413"><a href="#cb70-1413" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color-discrete-custom</span></span>
<span id="cb70-1414"><a href="#cb70-1414" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "指定した3色"</span></span>
<span id="cb70-1415"><a href="#cb70-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1416"><a href="#cb70-1416" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Species)) <span class="sc">+</span></span>
<span id="cb70-1417"><a href="#cb70-1417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-1418"><a href="#cb70-1418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkred"</span>, <span class="st">"darkblue"</span>, <span class="st">"darkgreen"</span>)) <span class="sc">+</span></span>
<span id="cb70-1419"><a href="#cb70-1419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Species"</span>)</span>
<span id="cb70-1420"><a href="#cb70-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1421"><a href="#cb70-1421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1422"><a href="#cb70-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1423"><a href="#cb70-1423" aria-hidden="true" tabindex="-1"></a>さらに、<span class="in">`scale_colour_viridis_d()`</span>だと以下のようになります。</span>
<span id="cb70-1424"><a href="#cb70-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1427"><a href="#cb70-1427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1428"><a href="#cb70-1428" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-color-viridis-d</span></span>
<span id="cb70-1429"><a href="#cb70-1429" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "scale_colour_viridis_d()を使った例"</span></span>
<span id="cb70-1430"><a href="#cb70-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1431"><a href="#cb70-1431" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">colour =</span> Species)) <span class="sc">+</span></span>
<span id="cb70-1432"><a href="#cb70-1432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-1433"><a href="#cb70-1433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb70-1434"><a href="#cb70-1434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Species"</span>)</span>
<span id="cb70-1435"><a href="#cb70-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1436"><a href="#cb70-1436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1437"><a href="#cb70-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1438"><a href="#cb70-1438" aria-hidden="true" tabindex="-1"></a>今回はSpeciesがカテゴリ変数なので、先ほどの<span class="in">`scale_colour_viridis_c()`</span>よりも<span class="in">`scale_colour_viridis_d()`</span>の方が適していると言えますね。</span>
<span id="cb70-1439"><a href="#cb70-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1440"><a href="#cb70-1440" aria-hidden="true" tabindex="-1"></a>今回は代表的なカラースケールをご紹介しましたが、他にもカラーパレットはたくさんあります。今回は入門編ということでこのあたりにしておきますが、いろいろ紹介してくれているページはあるので、例えば以下のようなページを参考にしてみてください。</span>
<span id="cb70-1441"><a href="#cb70-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1442"><a href="#cb70-1442" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip appearance="minimal"}</span>
<span id="cb70-1443"><a href="#cb70-1443" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">The R Graph Gallery</span><span class="co">](https://r-graph-gallery.com/)</span></span>
<span id="cb70-1444"><a href="#cb70-1444" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb70-1445"><a href="#cb70-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1446"><a href="#cb70-1446" aria-hidden="true" tabindex="-1"></a><span class="fu">## いろいろ含めたグラフを作ってみる</span></span>
<span id="cb70-1447"><a href="#cb70-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1448"><a href="#cb70-1448" aria-hidden="true" tabindex="-1"></a>ではここで、これまでの内容を踏まえて、新しいプロットを作ってみます。データはこれもデフォルトで用意されている<span class="in">`mpg`</span>データセットを使います。</span>
<span id="cb70-1449"><a href="#cb70-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1452"><a href="#cb70-1452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1453"><a href="#cb70-1453" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-complex-plot</span></span>
<span id="cb70-1454"><a href="#cb70-1454" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb70-1455"><a href="#cb70-1455" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "作ってみました"</span></span>
<span id="cb70-1456"><a href="#cb70-1456" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb70-1457"><a href="#cb70-1457" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "カットと価格の関係"</span></span>
<span id="cb70-1458"><a href="#cb70-1458" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "カラットと価格の関係"</span></span>
<span id="cb70-1459"><a href="#cb70-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1460"><a href="#cb70-1460" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(diamonds)</span>
<span id="cb70-1461"><a href="#cb70-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1462"><a href="#cb70-1462" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>cut, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Cut"</span></span>
<span id="cb70-1463"><a href="#cb70-1463" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>price, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Price (USD)"</span></span>
<span id="cb70-1464"><a href="#cb70-1464" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>carat, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Carat"</span></span>
<span id="cb70-1465"><a href="#cb70-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1466"><a href="#cb70-1466" aria-hidden="true" tabindex="-1"></a>theme_use <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"gray98"</span>, <span class="at">ink =</span> <span class="st">"navy"</span>) <span class="sc">+</span></span>
<span id="cb70-1467"><a href="#cb70-1467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb70-1468"><a href="#cb70-1468" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="fu">element_geom</span>(</span>
<span id="cb70-1469"><a href="#cb70-1469" aria-hidden="true" tabindex="-1"></a>      <span class="at">accent =</span> <span class="st">"purple"</span>,</span>
<span id="cb70-1470"><a href="#cb70-1470" aria-hidden="true" tabindex="-1"></a>      <span class="at">paper =</span> <span class="st">"pink"</span>,</span>
<span id="cb70-1471"><a href="#cb70-1471" aria-hidden="true" tabindex="-1"></a>      <span class="at">pointsize =</span> <span class="dv">2</span>,</span>
<span id="cb70-1472"><a href="#cb70-1472" aria-hidden="true" tabindex="-1"></a>      <span class="at">borderwidth =</span> <span class="dv">1</span></span>
<span id="cb70-1473"><a href="#cb70-1473" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb70-1474"><a href="#cb70-1474" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb70-1475"><a href="#cb70-1475" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb70-1476"><a href="#cb70-1476" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>),</span>
<span id="cb70-1477"><a href="#cb70-1477" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>)</span>
<span id="cb70-1478"><a href="#cb70-1478" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-1479"><a href="#cb70-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1480"><a href="#cb70-1480" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(cut, price)) <span class="sc">+</span></span>
<span id="cb70-1481"><a href="#cb70-1481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">from_theme</span>(accent))) <span class="sc">+</span></span>
<span id="cb70-1482"><a href="#cb70-1482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">paper =</span> <span class="st">"gray98"</span>, <span class="at">ink =</span> <span class="st">"navy"</span>) <span class="sc">+</span></span>
<span id="cb70-1483"><a href="#cb70-1483" aria-hidden="true" tabindex="-1"></a>  theme_use</span>
<span id="cb70-1484"><a href="#cb70-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1485"><a href="#cb70-1485" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(carat, price, <span class="at">color =</span> cut)) <span class="sc">+</span></span>
<span id="cb70-1486"><a href="#cb70-1486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-1487"><a href="#cb70-1487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb70-1488"><a href="#cb70-1488" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb70-1489"><a href="#cb70-1489" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Fair &lt; Good &lt; Very Good &lt; Premium &lt; Ideal"</span>,</span>
<span id="cb70-1490"><a href="#cb70-1490" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">3.4</span>,</span>
<span id="cb70-1491"><a href="#cb70-1491" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">2500</span>,</span>
<span id="cb70-1492"><a href="#cb70-1492" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Times New Roman"</span></span>
<span id="cb70-1493"><a href="#cb70-1493" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1494"><a href="#cb70-1494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb70-1495"><a href="#cb70-1495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb70-1496"><a href="#cb70-1496" aria-hidden="true" tabindex="-1"></a>  theme_use</span>
<span id="cb70-1497"><a href="#cb70-1497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1498"><a href="#cb70-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1499"><a href="#cb70-1499" aria-hidden="true" tabindex="-1"></a><span class="fu">## 発展：`ggrepel`</span></span>
<span id="cb70-1500"><a href="#cb70-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1501"><a href="#cb70-1501" aria-hidden="true" tabindex="-1"></a>ここからは、<span class="in">`ggrepel`</span>というパッケージを用いて折れ線グラフを発展させた例をご紹介します。ここからはだいぶややこしいので、出来上がったグラフを見て、必要性を感じていただけたらコードを読み解いてもらえればと思います。</span>
<span id="cb70-1502"><a href="#cb70-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1505"><a href="#cb70-1505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1506"><a href="#cb70-1506" aria-hidden="true" tabindex="-1"></a><span class="co"># インストール</span></span>
<span id="cb70-1507"><a href="#cb70-1507" aria-hidden="true" tabindex="-1"></a><span class="co"># pak::pak("ggrepel")</span></span>
<span id="cb70-1508"><a href="#cb70-1508" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb70-1509"><a href="#cb70-1509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1510"><a href="#cb70-1510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1511"><a href="#cb70-1511" aria-hidden="true" tabindex="-1"></a>まず、以下のようなデータがあるとします。<span class="in">`firm_id`</span>は30まであります。</span>
<span id="cb70-1512"><a href="#cb70-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1515"><a href="#cb70-1515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1516"><a href="#cb70-1516" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-data-prep</span></span>
<span id="cb70-1517"><a href="#cb70-1517" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "データの一部"</span></span>
<span id="cb70-1518"><a href="#cb70-1518" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb70-1519"><a href="#cb70-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1520"><a href="#cb70-1520" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">57</span>)</span>
<span id="cb70-1521"><a href="#cb70-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1522"><a href="#cb70-1522" aria-hidden="true" tabindex="-1"></a>n_firms <span class="ot">&lt;-</span> <span class="dv">30</span> <span class="co"># Reduce the number of firms</span></span>
<span id="cb70-1523"><a href="#cb70-1523" aria-hidden="true" tabindex="-1"></a>n_states <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb70-1524"><a href="#cb70-1524" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb70-1525"><a href="#cb70-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1526"><a href="#cb70-1526" aria-hidden="true" tabindex="-1"></a>firm_id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n_firms</span>
<span id="cb70-1527"><a href="#cb70-1527" aria-hidden="true" tabindex="-1"></a>state_id <span class="ot">&lt;-</span> <span class="fu">sample</span>(n_states, <span class="at">size =</span> n_firms, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-1528"><a href="#cb70-1528" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="dv">1980</span><span class="sc">:</span><span class="dv">2015</span></span>
<span id="cb70-1529"><a href="#cb70-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1530"><a href="#cb70-1530" aria-hidden="true" tabindex="-1"></a>fe_firm <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_firms, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> .<span class="dv">5</span>)</span>
<span id="cb70-1531"><a href="#cb70-1531" aria-hidden="true" tabindex="-1"></a>fe_year <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(T, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> .<span class="dv">5</span>)</span>
<span id="cb70-1532"><a href="#cb70-1532" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_firms <span class="sc">*</span> T, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> .<span class="dv">5</span>)</span>
<span id="cb70-1533"><a href="#cb70-1533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1534"><a href="#cb70-1534" aria-hidden="true" tabindex="-1"></a>treated_1998 <span class="ot">&lt;-</span> <span class="fu">sample</span>(</span>
<span id="cb70-1535"><a href="#cb70-1535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb70-1536"><a href="#cb70-1536" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> n_firms,</span>
<span id="cb70-1537"><a href="#cb70-1537" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-1538"><a href="#cb70-1538" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fu">c</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span>)</span>
<span id="cb70-1539"><a href="#cb70-1539" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-1540"><a href="#cb70-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1541"><a href="#cb70-1541" aria-hidden="true" tabindex="-1"></a>treated_year <span class="ot">&lt;-</span> <span class="fu">sample</span>(</span>
<span id="cb70-1542"><a href="#cb70-1542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1989</span>, <span class="dv">1998</span>, <span class="dv">2007</span>),</span>
<span id="cb70-1543"><a href="#cb70-1543" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> n_firms,</span>
<span id="cb70-1544"><a href="#cb70-1544" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-1545"><a href="#cb70-1545" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fu">c</span>(<span class="dv">17</span> <span class="sc">/</span> <span class="dv">50</span>, <span class="dv">17</span> <span class="sc">/</span> <span class="dv">50</span>, <span class="dv">16</span> <span class="sc">/</span> <span class="dv">50</span>)</span>
<span id="cb70-1546"><a href="#cb70-1546" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-1547"><a href="#cb70-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1548"><a href="#cb70-1548" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb70-1549"><a href="#cb70-1549" aria-hidden="true" tabindex="-1"></a>  <span class="at">firm_id =</span> <span class="fu">rep</span>(firm_id, <span class="at">each =</span> T),</span>
<span id="cb70-1550"><a href="#cb70-1550" aria-hidden="true" tabindex="-1"></a>  <span class="at">state_id =</span> <span class="fu">rep</span>(state_id, <span class="at">each =</span> T),</span>
<span id="cb70-1551"><a href="#cb70-1551" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">rep</span>(year, <span class="at">times =</span> n_firms),</span>
<span id="cb70-1552"><a href="#cb70-1552" aria-hidden="true" tabindex="-1"></a>  <span class="at">fe_firm =</span> <span class="fu">rep</span>(fe_firm, <span class="at">each =</span> T),</span>
<span id="cb70-1553"><a href="#cb70-1553" aria-hidden="true" tabindex="-1"></a>  <span class="at">fe_year =</span> <span class="fu">rep</span>(fe_year, <span class="at">times =</span> n_firms),</span>
<span id="cb70-1554"><a href="#cb70-1554" aria-hidden="true" tabindex="-1"></a>  <span class="at">error =</span> error,</span>
<span id="cb70-1555"><a href="#cb70-1555" aria-hidden="true" tabindex="-1"></a>  <span class="at">treated_1998 =</span> <span class="fu">rep</span>(treated_1998, <span class="at">each =</span> T),</span>
<span id="cb70-1556"><a href="#cb70-1556" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_treated =</span> <span class="fu">if_else</span>(treated_1998 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> year <span class="sc">&gt;=</span> <span class="dv">1998</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb70-1557"><a href="#cb70-1557" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">case_when</span>(</span>
<span id="cb70-1558"><a href="#cb70-1558" aria-hidden="true" tabindex="-1"></a>    is_treated <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span></span>
<span id="cb70-1559"><a href="#cb70-1559" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rnorm</span>(n_firms <span class="sc">*</span> T, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> .<span class="dv">2</span>) <span class="sc">+</span> fe_firm <span class="sc">+</span> fe_year <span class="sc">+</span> error,</span>
<span id="cb70-1560"><a href="#cb70-1560" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> fe_firm <span class="sc">+</span> fe_year <span class="sc">+</span> error</span>
<span id="cb70-1561"><a href="#cb70-1561" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-1562"><a href="#cb70-1562" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-1563"><a href="#cb70-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1564"><a href="#cb70-1564" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb70-1565"><a href="#cb70-1565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(firm_id<span class="sc">:</span>year, treated_1998<span class="sc">:</span>y) <span class="sc">|&gt;</span></span>
<span id="cb70-1566"><a href="#cb70-1566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb70-1567"><a href="#cb70-1567" aria-hidden="true" tabindex="-1"></a>  tinytable<span class="sc">::</span><span class="fu">tt</span>()</span>
<span id="cb70-1568"><a href="#cb70-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1569"><a href="#cb70-1569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1570"><a href="#cb70-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1571"><a href="#cb70-1571" aria-hidden="true" tabindex="-1"></a>これを使って横軸に<span class="in">`Year`</span>、縦軸に<span class="in">`y`</span>をとってグラフにします。</span>
<span id="cb70-1572"><a href="#cb70-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1573"><a href="#cb70-1573" aria-hidden="true" tabindex="-1"></a>詳細を書くと長くなるので、適宜メモを入れました。ご参考まで。</span>
<span id="cb70-1574"><a href="#cb70-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1577"><a href="#cb70-1577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-1578"><a href="#cb70-1578" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ggrepel</span></span>
<span id="cb70-1579"><a href="#cb70-1579" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "ggrepelを使ったプロット"</span></span>
<span id="cb70-1580"><a href="#cb70-1580" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb70-1581"><a href="#cb70-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1582"><a href="#cb70-1582" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb70-1583"><a href="#cb70-1583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb70-1584"><a href="#cb70-1584" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ハイライトする群とそれ以外に分ける</span></span>
<span id="cb70-1585"><a href="#cb70-1585" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">if_else</span>(treated_1998 <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">as.factor</span>(firm_id), <span class="st">"other"</span>),</span>
<span id="cb70-1586"><a href="#cb70-1586" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 最後の年にだけラベルを付ける</span></span>
<span id="cb70-1587"><a href="#cb70-1587" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_lab =</span> <span class="fu">if_else</span>(</span>
<span id="cb70-1588"><a href="#cb70-1588" aria-hidden="true" tabindex="-1"></a>      treated_1998 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2015</span>,</span>
<span id="cb70-1589"><a href="#cb70-1589" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"Firm "</span>, firm_id),</span>
<span id="cb70-1590"><a href="#cb70-1590" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_character_</span></span>
<span id="cb70-1591"><a href="#cb70-1591" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb70-1592"><a href="#cb70-1592" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-1593"><a href="#cb70-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1594"><a href="#cb70-1594" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb70-1595"><a href="#cb70-1595" aria-hidden="true" tabindex="-1"></a>  <span class="co"># まずハイライトする群だけプロット</span></span>
<span id="cb70-1596"><a href="#cb70-1596" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">|&gt;</span> <span class="fu">filter</span>(treated_1998 <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb70-1597"><a href="#cb70-1597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> y, <span class="at">group =</span> firm_id)</span>
<span id="cb70-1598"><a href="#cb70-1598" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb70-1599"><a href="#cb70-1599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb70-1600"><a href="#cb70-1600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb70-1601"><a href="#cb70-1601" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 罫線を削除</span></span>
<span id="cb70-1602"><a href="#cb70-1602" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb70-1603"><a href="#cb70-1603" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 凡例を削除</span></span>
<span id="cb70-1604"><a href="#cb70-1604" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb70-1605"><a href="#cb70-1605" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 軸のタイトルと文字のフォントとサイズを調整</span></span>
<span id="cb70-1606"><a href="#cb70-1606" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb70-1607"><a href="#cb70-1607" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb70-1608"><a href="#cb70-1608" aria-hidden="true" tabindex="-1"></a>    <span class="co"># X軸タイトルを若干左寄せ</span></span>
<span id="cb70-1609"><a href="#cb70-1609" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.4</span>)</span>
<span id="cb70-1610"><a href="#cb70-1610" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1611"><a href="#cb70-1611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb70-1612"><a href="#cb70-1612" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 垂直線を描写</span></span>
<span id="cb70-1613"><a href="#cb70-1613" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">1980</span>, <span class="dv">2015</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb70-1614"><a href="#cb70-1614" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray91"</span>,</span>
<span id="cb70-1615"><a href="#cb70-1615" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> .<span class="dv">6</span></span>
<span id="cb70-1616"><a href="#cb70-1616" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1617"><a href="#cb70-1617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb70-1618"><a href="#cb70-1618" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 水平線を描写</span></span>
<span id="cb70-1619"><a href="#cb70-1619" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 描写のためにデータを準備</span></span>
<span id="cb70-1620"><a href="#cb70-1620" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">y =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">5.0</span>, <span class="at">by =</span> <span class="fl">2.5</span>), <span class="at">x1 =</span> <span class="dv">1980</span>, <span class="at">x2 =</span> <span class="dv">2015</span>),</span>
<span id="cb70-1621"><a href="#cb70-1621" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">xend =</span> x2, <span class="at">y =</span> y, <span class="at">yend =</span> y),</span>
<span id="cb70-1622"><a href="#cb70-1622" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-1623"><a href="#cb70-1623" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray91"</span>,</span>
<span id="cb70-1624"><a href="#cb70-1624" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> .<span class="dv">6</span></span>
<span id="cb70-1625"><a href="#cb70-1625" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1626"><a href="#cb70-1626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb70-1627"><a href="#cb70-1627" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 薄い水平線を描写</span></span>
<span id="cb70-1628"><a href="#cb70-1628" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">y =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">4.5</span>, <span class="at">by =</span> .<span class="dv">5</span>), <span class="at">x1 =</span> <span class="dv">1980</span>, <span class="at">x2 =</span> <span class="dv">2015</span>),</span>
<span id="cb70-1629"><a href="#cb70-1629" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">xend =</span> x2, <span class="at">y =</span> y, <span class="at">yend =</span> y),</span>
<span id="cb70-1630"><a href="#cb70-1630" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-1631"><a href="#cb70-1631" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray97"</span>,</span>
<span id="cb70-1632"><a href="#cb70-1632" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> .<span class="dv">3</span></span>
<span id="cb70-1633"><a href="#cb70-1633" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1634"><a href="#cb70-1634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb70-1635"><a href="#cb70-1635" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 縦軸が0のところに水平線を描写</span></span>
<span id="cb70-1636"><a href="#cb70-1636" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">y =</span> <span class="dv">0</span>, <span class="at">x1 =</span> <span class="dv">1980</span>, <span class="at">x2 =</span> <span class="dv">2015</span>),</span>
<span id="cb70-1637"><a href="#cb70-1637" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">xend =</span> x2, <span class="at">y =</span> y),</span>
<span id="cb70-1638"><a href="#cb70-1638" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-1639"><a href="#cb70-1639" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb70-1640"><a href="#cb70-1640" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray40"</span></span>
<span id="cb70-1641"><a href="#cb70-1641" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1642"><a href="#cb70-1642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb70-1643"><a href="#cb70-1643" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 処置年に垂直線を描写</span></span>
<span id="cb70-1644"><a href="#cb70-1644" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> <span class="dv">1998</span>,</span>
<span id="cb70-1645"><a href="#cb70-1645" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb70-1646"><a href="#cb70-1646" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray40"</span></span>
<span id="cb70-1647"><a href="#cb70-1647" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1648"><a href="#cb70-1648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb70-1649"><a href="#cb70-1649" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ハイライトしない群をプロット</span></span>
<span id="cb70-1650"><a href="#cb70-1650" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df <span class="sc">|&gt;</span> <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"other"</span>),</span>
<span id="cb70-1651"><a href="#cb70-1651" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray75"</span>,</span>
<span id="cb70-1652"><a href="#cb70-1652" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb70-1653"><a href="#cb70-1653" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1654"><a href="#cb70-1654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb70-1655"><a href="#cb70-1655" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ハイライトする群をプロット</span></span>
<span id="cb70-1656"><a href="#cb70-1656" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> group)</span>
<span id="cb70-1657"><a href="#cb70-1657" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1658"><a href="#cb70-1658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb70-1659"><a href="#cb70-1659" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ハイライトした線にラベルを追加</span></span>
<span id="cb70-1660"><a href="#cb70-1660" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> group, <span class="at">label =</span> group_lab),</span>
<span id="cb70-1661"><a href="#cb70-1661" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Times"</span>,</span>
<span id="cb70-1662"><a href="#cb70-1662" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb70-1663"><a href="#cb70-1663" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2017年の位置にラベルを書く</span></span>
<span id="cb70-1664"><a href="#cb70-1664" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2017</span>, <span class="cn">NA</span>),</span>
<span id="cb70-1665"><a href="#cb70-1665" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb70-1666"><a href="#cb70-1666" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.linetype =</span> <span class="st">"dotted"</span></span>
<span id="cb70-1667"><a href="#cb70-1667" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1668"><a href="#cb70-1668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb70-1669"><a href="#cb70-1669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb70-1670"><a href="#cb70-1670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb70-1671"><a href="#cb70-1671" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb70-1672"><a href="#cb70-1672" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ラベルが見えるように図の端の2015年より広くとる</span></span>
<span id="cb70-1673"><a href="#cb70-1673" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1980</span>, <span class="dv">2021</span>),</span>
<span id="cb70-1674"><a href="#cb70-1674" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1980</span>, <span class="dv">2015</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb70-1675"><a href="#cb70-1675" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-1676"><a href="#cb70-1676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb70-1677"><a href="#cb70-1677" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb70-1678"><a href="#cb70-1678" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">5.0</span>),</span>
<span id="cb70-1679"><a href="#cb70-1679" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="dv">0</span>, <span class="fl">2.5</span>, <span class="fl">5.0</span>)</span>
<span id="cb70-1680"><a href="#cb70-1680" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-1681"><a href="#cb70-1681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-1682"><a href="#cb70-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1683"><a href="#cb70-1683" aria-hidden="true" tabindex="-1"></a><span class="fu">## おわりに</span></span>
<span id="cb70-1684"><a href="#cb70-1684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1685"><a href="#cb70-1685" aria-hidden="true" tabindex="-1"></a>ひとまず僕がよく使うggplotの設定をまとめてみました。ggplotを駆使して、スタイリッシュなプロットを作成していきましょう！</span>
<span id="cb70-1686"><a href="#cb70-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1687"><a href="#cb70-1687" aria-hidden="true" tabindex="-1"></a>適宜追記する予定ですので、ご参考になれば幸いです。</span>
</code></pre></div><button title="コピー" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2024-2025 Yosuke Abe <br> Content on this site is licensed under a <br> <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-sa" aria-label="creative-commons-sa"></i> <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons BY-SA 4.0</a></p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/5uke_y">
      <i class="bi bi-twitter-x" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../../../pages/tips/index.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
<p>This website is created with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <iconify-icon role="img" inline="" icon="simple-icons:quarto" style="color:#74aadb;" aria-label="Quarto icon" title="Quarto icon"></iconify-icon> <a href="https://quarto.org">Quarto</a> <br> <i class="fa-brands fa-github" aria-label="github"></i> <a href="https://github.com/yo5uke/yo5uke.github.io">Source code</a> <br> <i class="fa-solid fa-location-dot" aria-label="location-dot"></i> <a href="https://maps.app.goo.gl/XFHvBiCdkQK4YXku9">Yokohama</a>, Kanagawa, Japan</p>
</div>
  </div>
</footer>




</body></html>