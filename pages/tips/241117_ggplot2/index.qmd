---
title: "ã€4.0.0å¯¾å¿œï¼ã€‘[ggplot2]{.fira-code}ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰"
description: |
  ggplotã‚’ä½¿ã†ã®ã«å½¹ç«‹ã¤ã‚³ãƒãƒ³ãƒ‰ã‚’ç´¹ä»‹ã—ã¾ã™ï¼
date: 2024-11-17
date-modified: today
categories:
  - R
image: figure/fig-ggrepel.png
editor: visual
---

## ã¯ã˜ã‚ã«

çš†ã•ã‚“ã€ggplotã€ä½¿ã£ã¦ã¾ã™ã‹ï¼Ÿå¤šåˆ†ãŠä½¿ã„ã§ã™ã‚ˆã­ã€‚

åƒ•ã¯æ•°ã‹æœˆå‰ggplotã®ã‚¬ã‚¤ãƒ‰ãƒ–ãƒƒã‚¯ã‚’è²·ã„ã¾ã—ã¦ã€ã„ã‚ã„ã‚ã¨å‹‰å¼·ã—ã¦ã„ã‚‹ã¨ã“ã‚ã§ã”ã–ã„ã¾ã™ã€‚

ã“ã‚“ãªã“ã¨ã‚‚ã§ãã‚‹ã®ã‹ï¼ã¨ã„ã†ç™ºè¦‹ãŒå¤šã€…ã‚ã‚Šã€Rãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çš†æ§˜ã«ã¯ãœã²è²·ã£ã¦ã„ãŸã ããŸã„ä»£ç‰©ãªã®ã§ã™ãŒã€ã„ã‹ã‚“ã›ã‚“ãŠå€¤æ®µãŒå¼µã‚Šã¾ã™ã®ã§ã€ã„ãã¤ã‹ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã”ç´¹ä»‹ã—ã¾ã™ã€‚

æ›¸ç±ã®ãƒªãƒ³ã‚¯ã¯ä»¥ä¸‹ã§ã™ã€‚

::: {.callout-tip appearance="minimal" icon="false"}
[Rã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚¯ãƒƒã‚¯ãƒ–ãƒƒã‚¯ ç¬¬2ç‰ˆ â€•ggplot2ã«ã‚ˆã‚‹ã‚°ãƒ©ãƒ•ä½œæˆã®ãƒ¬ã‚·ãƒ”é›†](https://www.amazon.co.jp/R%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AF%E3%83%83%E3%82%AF%E3%83%96%E3%83%83%E3%82%AF-%E7%AC%AC2%E7%89%88-%E2%80%95ggplot2%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B0%E3%83%A9%E3%83%95%E4%BD%9C%E6%88%90%E3%81%AE%E3%83%AC%E3%82%B7%E3%83%94%E9%9B%86-Winston-Chang/dp/4873118921)
:::

ã•ã‚‰ã«ã€2025å¹´9æœˆã€ggplot2ãŒãƒãƒ¼ã‚¸ãƒ§ãƒ³4.0.0ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸï¼ãã‚Œã‚’è¨˜å¿µã—ã€4.0.0ã®è¦ç´ ã‚‚å–ã‚Šå…¥ã‚ŒãŸãƒšãƒ¼ã‚¸ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã—ãŸï¼ğŸ‰

ãœã²ã”å‚è€ƒã«ãªã•ã£ã¦ãã ã•ã„ï¼

## `ggplot2`ã®åŸºæœ¬

::: callout-note
ä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹æ–¹ã¯ã“ã®è¾ºã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚

ä»Šå›ä½¿ã†ãƒ‡ãƒ¼ã‚¿ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹`iris`ã¨`Orange`ã§ã™ã€‚
:::

ã²ã¨ã¾ãšä¸»è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚ã‚‹`ggplot2`ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚

```{r}
# install.packages("ggplot2")
library(ggplot2)
```

åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¨ã—ã¦ã¯ã€`ggplot()`ã¨`aes()`ã€ãã—ã¦å›³ã«å¿œã˜ã¦`geom_line()`ï¼ˆæŠ˜ã‚Œç·šï¼‰ã‚„`geom_point()`ï¼ˆæ•£å¸ƒå›³ï¼‰ãªã©ã‚’ä½¿ã£ã¦ã„ãã¾ã™ã€‚

ä»Šå›ã¯ä¾‹ã¨ã—ã¦ã€ã‚¢ã‚¤ãƒªã‚¹ã®ãŒãç‰‡ã®é•·ã•ã€å¹…ã‚’ãã‚Œãã‚Œè»¸ã¨ã—ã¦ãƒ—ãƒ­ãƒƒãƒˆã—ã¾ã™ã€‚

### æ•£å¸ƒå›³

ã¾ãšã¯åŸºæœ¬çš„ãªæ•£å¸ƒå›³ã‚’æã„ã¦ã¿ã¾ã™ã€‚æ•£å¸ƒå›³ã¯`geom_point()`ã‚’ä½¿ã†ã“ã¨ã§æç”»ã§ãã¾ã™ã€‚

```{r}
#| label: fig-iris
#| fig-cap: "irisãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ä½¿ã£ãŸæ•£å¸ƒå›³"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point()

```

1.  `ggplot(data, aes())`ã¨ã„ã†å½¢ã§ä½¿ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æŒ‡å®š
2.  `aes()`å†…ã§ã¯Xè»¸ã¨Yè»¸ã‚’ãã‚Œãã‚ŒæŒ‡å®šã™ã‚‹ã€‚
    -   ä¾‹ï¼š`aes(x = Sepal.Length, y = Sepal.Width)`
    -   ç¬¬1å¼•æ•°ãŒXã€ç¬¬2å¼•æ•°ãŒYã¨æ±ºã¾ã£ã¦ã„ã‚‹ã®ã§ã€`x =`ã‚„`y =`ã¯æ›¸ã‹ãªãã¦ã‚‚ã‚ˆã„ã§ã™ã€‚
3.  ggplotã®ã‚³ãƒãƒ³ãƒ‰ã¯`+`ã§ç¹‹ã
4.  æ•£å¸ƒå›³ã‚’ä½œã‚‹ãŸã‚ã«`geom_point()`ã‚’ç¹‹ã’ã‚‹

ã“ã‚ŒãŒåœŸå°ã§ã™ã€‚`ggplot()`ã ã‘ã§ã¯ãƒ—ãƒ­ãƒƒãƒˆã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã®ã§ã€`geom_point()`ãªã©ä½•ã‹ã—ã‚‰ç¹‹ãå½¢ã«ã—ã¦ãã ã•ã„ã€‚

**å›å¸°ç·šã‚’å¼•ããŸã„å ´åˆï¼š**

æ—©é€Ÿå¿œç”¨ã§ã¯ã‚ã‚Šã¾ã™ãŒã€æ•£å¸ƒå›³ã‚’æã„ãŸã‚‰å›å¸°ç·šã‚’å¼•ããŸã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã‚ˆã­ã€‚ãã®ãŸã‚ã«ã¯ã€`geom_smooth()`ã‚’ä½¿ã„ã¾ã™ã€‚

```{r}
#| label: fig-iris-lm
#| fig-cap: "å›å¸°ç›´ç·šã‚’å¼•ã„ãŸæ•£å¸ƒå›³"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  geom_smooth(method = lm, formula = y ~ x)

```

### æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•

## è»¸

### è»¸ãƒ©ãƒ™ãƒ«

ã¾ãšã¯Xè»¸ã€Yè»¸ã®ãƒ©ãƒ™ãƒ«ã‚’å¤‰æ›´ã—ã¾ã™ã€‚æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§å¤‰æ›´ã§ãã¾ã™ã€‚

```{r}
#| label: fig-axis-label
#| fig-cap: "è»¸ãƒ©ãƒ™ãƒ«ã‚’å¤‰æ›´"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  labs(x = "Length of Sepal", y = "Width of Sepal")

```

ã¾ãŸã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯åŒã˜çµæœã‚’ç¤ºã—ã¾ã™ã€‚

``` r
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  xlab("Length of Sepal") + 
  ylab("Width of Sepal")
```

ã™ãªã‚ã¡ã€`labs()`ã¯ãã‚Œä¸€ã¤ã§Xè»¸ã‚‚Yè»¸ã‚‚ãƒ©ãƒ™ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€`xlab()`ã€`ylab()`ã‚’ä½¿ãˆã°ç‰‡æ–¹ãšã¤å¤‰æ›´ã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

æ¬¡ã«ã€è»¸ãƒ©ãƒ™ãƒ«ã®ä½“è£ã‚’å¤‰æ›´ã—ãŸã„å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```{r}
#| label: fig-axis-font
#| fig-cap: "æ–‡å­—ã®ä½“è£ãŒå¤‰ã‚ã£ã¦ã„ã¾ã™"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  labs(x = "Length of Sepal", y = "Width of Sepal") + 
  theme(
    axis.title = element_text(family = "times", face = "italic", 
                              color = "red", size = 20)
  )

```

1.  `theme()`å†…ã®`axis.title`ã§å¤‰æ›´ã™ã‚‹
    -   Xè»¸Yè»¸ã®ã©ã¡ã‚‰ã‹ã ã‘ã«ã—ãŸã‘ã‚Œã°ã€`axis.title.x`ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚
2.  `element_text()`å†…ã§å…·ä½“çš„ã«ãƒ•ã‚©ãƒ³ãƒˆã®ä½“è£ã‚’æŒ‡å®š
    -   ä»Šå›ã¯ã‚ã‹ã‚Šã‚„ã™ãæ´¾æ‰‹ã«ã—ã¾ã—ãŸãŒã€ã“ã‚Œã‚‰ã®è¦ç´ ã‚’å¤‰æ›´ã™ã‚Œã°èª¿æ•´ã§ãã¾ã™ã€‚

    -   ä¾‹ãˆã°ã€`face = "bold"`ã«ã™ã‚Œã°å¤ªå­—ã«ã§ãã¾ã™ã€‚

    -   ä»–ã«ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãŠãŠã‚€ã­ä½¿ã†ã®ã¯ã“ã®ã‚ãŸã‚Šã§ã—ã‚‡ã†ã€‚

### è»¸ã®ç›®ç››ã‚Š

```{r}
#| label: fig-axis-scale
#| fig-cap: "ç›®ç››ã‚Šã®é–“éš”ãŒå¤‰ã‚ã£ã¦ã„ã¾ã™"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  scale_x_continuous(breaks = seq(4.5, 8, .5)) + 
  scale_y_continuous(breaks = seq(2, 4, 1))

```

ç›®ç››ã‚ŠãŒXè»¸ã¯0.5åˆ»ã¿ã€Yè»¸ã¯1åˆ»ã¿ã«ãªã‚‹ã‚ˆã†å¤‰æ›´ã—ã¾ã—ãŸã€‚ã“ã®ã‚ˆã†ã«ã€Xï¼ˆYï¼‰ãŒé€£ç¶šå€¤ã§ã‚ã‚‹å ´åˆã€`scale_x_continuous()`ï¼ˆ`scale_y_continuous()`ï¼‰ã§å¤‰æ›´ã§ãã¾ã™ã€‚`seq()`ã¯æ•°åˆ—ã‚’ä½œã‚‹é–¢æ•°ã§ã€`seq(from, to, by)`ã®é †ã«æŒ‡å®šã—ã¾ã™[^1]ã€‚

[^1]: é›¢æ•£å€¤ã®å ´åˆã¯`scale_x_discrete()`ãªã©ã§å¤‰æ›´ã§ãã¾ã™ãŒã€ä»Šå›ãã®èª¬æ˜ã¯çœãã¾ã™ã€‚

ç›®ç››ã‚Šã‚‚åŒæ§˜ã«ãƒ•ã‚©ãƒ³ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚

```{r}
#| label: fig-scale-font
#| fig-cap: "æ•°å­—ã®ãƒ•ã‚©ãƒ³ãƒˆãŒå¤‰ã‚ã£ã¦ã„ã¾ã™"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  theme(
    axis.text = element_text(family = "times", face = "bold", 
                             color = "red", size = 20)
  )

```

ã‚‚ã¯ã‚„è¨³ãŒåˆ†ã‹ã‚‰ãªã„å›³ã§ã™ãŒã€ã“ã®ã‚ˆã†ã«ä½“è£ã¯å¤‰æ›´å¯èƒ½ã§ã™ã€‚è¦ç´ ã¯å¤§ä½“ä¸Šã¨åŒã˜ã§ã€`axis.text.x`ã®ã‚ˆã†ã«ã©ã¡ã‚‰ã‹ã ã‘å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

ã¾ãŸã€`axis.ticks`ã§ç›®ç››ã‚Šã‚’æ¶ˆå»ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```{r}
#| label: fig-delete-memori
#| fig-cap: "ç›®ç››ã‚ŠãŒæ¶ˆãˆã¦ã„ã¾ã™"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  theme(
    axis.text = element_text(family = "times", face = "bold", 
                             color = "red", size = 20), 
    axis.ticks = element_blank()
  )

```

ãŠåˆ¤ã‚Šã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿè»¸ã®æ•°å­—ã¯æ®‹ã£ã¦ã„ã¾ã™ãŒã€ç›®ç››ã‚Šç·šã¯æ¶ˆãˆã¦ã„ã¾ã™ã€‚@fig-scale-font ã¨è¦‹æ¯”ã¹ã¦ã¿ã¦ãã ã•ã„ã€‚

### è»¸ã®ç¯„å›²

Xè»¸ã¨Yè»¸ã®ç¯„å›²ã‚’è¨­å®šã™ã‚‹æ–¹æ³•ã§ã™ã€‚ã“ã‚Œã¾ã§ã®å›³ã§ã¯ã ã„ãŸã„4ã‹ã‚‰8ã‚ãŸã‚ŠãŒXã®ç¯„å›²ã€2.0ã‹ã‚‰4.5ãŒYã®ç¯„å›²ã§ã—ãŸã€‚`xlim(a, b)`ã¨`ylim(a, b)`ã§è¨­å®šã§ãã¾ã™ã€‚

```{r}
#| label: fig-change-range
#| fig-cap: "ç¯„å›²ã‚’å¤‰ãˆã¾ã—ãŸ"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  xlim(5, 7) + 
  ylim(3, 4) + 
  theme(
    axis.text = element_text(family = "times", face = "bold", 
                             color = "red", size = 20), 
    axis.ticks = element_blank()
  )

```

## æ³¨é‡ˆ

### æ–‡å­—

è¡¨ã®ä¸­ã«æ–‡å­—ã‚’å…¥ã‚Œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

`annotate()`å†…ã§`"text"`ã‹`"segment"`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§æŒ¿å…¥å¯èƒ½ã§ã™ã€‚

```{r}
#| label: fig-annotate
#| fig-cap: "è¡¨å†…ã«æ–‡å­—ã‚’å…¥ã‚Œã‚‰ã‚Œã¾ã—ãŸ"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  annotate("text", label = "ggplot is\nwonderful!", x = 6.5, y = 4, 
           family = "times", color = "#CC6666", size = 10)

```

1.  `annotate("text", label = "hogehoge")`ã§æ–‡å­—ã‚’å…¥ã‚Œã‚‹ã“ã¨ãŒã§ãã‚‹

2.  `x`ã¨`y`ã‚’æŒ‡å®šã—ãªã„ã¨åæ˜ ã•ã‚Œãªã„

3.  æ”¹è¡Œã—ãŸã„å ´åˆã€`\n`ã‚’å…¥ã‚Œã‚‹

4.  ãƒ•ã‚©ãƒ³ãƒˆã€è‰²ã€ã‚µã‚¤ã‚ºã‚‚æŒ‡å®šã§ãã‚‹

é–¢æ•°ä¸€ã¤ã§æ„å¤–ã¨ç°¡å˜ã«ã§ãã¾ã™ã€‚

### ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ

æ£’ç·šã‚„çŸ¢å°ã‚’ä»˜ã‘ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```{r}
#| label: fig-segment-1
#| fig-cap: "æ–œã‚ã«æ£’ç·šãŒå…¥ã‚Šã¾ã—ãŸã€‚"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  annotate("segment", x = 5, xend = 7, y = 4, yend = 2.5, 
           linewidth = 2, color = "#CC6666")

```

```{r}
#| label: fig-segment-2
#| fig-cap: "çŸ¢å°ã«ãªã‚Šã¾ã—ãŸã€‚"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  annotate("segment", x = 5, xend = 7, y = 4, yend = 2.5, 
           linewidth = 2, color = "#CC6666", 
           arrow = arrow(length = unit(2, units = "cm")))

```

1.  `"segment"`ã§æ£’ç·šãŒã§ãã‚‹
2.  `x`ã¨`xend`ã€`y`ã¨`yend`ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹
    -   $(x, y)$ã‹ã‚‰$(xend, yend)$ã¾ã§ã®2ç‚¹ã‚’çµã¶ã‚ˆã†ã«ã§ãã¾ã™ã€‚
3.  `linewidth`ã§ç·šã®å¤ªã•ã‚’æŒ‡å®šå¯
    -   ä»–ã®è¦ç´ ã‚‚æ–‡å­—ã¨åŒæ§˜ã«æŒ‡å®šã§ãã¾ã™ãŒã€`size`ãŒ`linewidth`ã«ç½®ãæ›ã‚ã£ã¦ã„ã¾ã™ã€‚
4.  `arrow = arrow(length = unit(x, units = "cm"))`ã§çŸ¢ã˜ã‚ŠãŒä»˜ã
    -   `x`ã§çŸ¢ã˜ã‚Šã®ã‚µã‚¤ã‚ºã€`units`ã¯å˜ä½ã§ã€ä»–ã«mmã‚„inchesãªã©ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸Šã®ã‚ˆã†ã«ã€æ–‡å­—ã ã‘ã§ãªãç·šã‚„çŸ¢å°ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## è¤‡æ•°ã®ãƒ—ãƒ­ãƒƒãƒˆã¨å‡¡ä¾‹

### è¤‡æ•°ã®ã‚«ãƒ†ã‚´ãƒªã®ãƒ—ãƒ­ãƒƒãƒˆ

ã“ã“ã§ã¯`Orange`ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ã£ã¦è¤‡æ•°ã®ã‚«ãƒ†ã‚´ãƒªã®ãƒ—ãƒ­ãƒƒãƒˆã¨ã€å‡¡ä¾‹ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

è¤‡æ•°ã®ã‚«ãƒ†ã‚´ãƒªã®ãƒ—ãƒ­ãƒƒãƒˆã¨ã¯ã€ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã¦ã„ãŸã ã‘ã‚‹ã¨æ—©ã„ã¨æ€ã„ã¾ã™ã€‚

```{r}
#| echo: false
#| label: tbl-orange
#| tbl-cap: "`Orange`ã®ä¸€éƒ¨"

Orange |> 
  head(10) |> 
  tinytable::tt(width = 8)

```

`Tree`ã¯æœ¨ã®è­˜åˆ¥å­ã§ã€1ï½5ã¾ã§ã‚ã‚Šã¾ã™ã€‚`age`ã¯æ—¥é½¢ã€`circumference`ã¯å¹¹ã®å‘¨å›²ã§ã™ã€‚

ã“ã“ã§ã‚„ã‚ŠãŸã„ã“ã¨ã¯ã€æœ¨ã®ç¨®é¡ã”ã¨ã«ã€æ—¥é½¢ã¨å¹¹ã®å‘¨å›²ã‚’è»¸ã«ã¨ã£ã¦ãƒ—ãƒ­ãƒƒãƒˆã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã‚’ãŸã ãƒ—ãƒ­ãƒƒãƒˆã—ã¦ã—ã¾ã†ã¨ã€

```{r}
#| label: fig-orange-pool
#| fig-cap: "ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ”¾ã‚Šè¾¼ã¿ã¾ã—ãŸ"

ggplot(Orange, aes(x = age, y = circumference)) + 
  geom_point()

```

ã“ã‚Œã§ã¯å„ç‚¹ãŒã©ã®æœ¨ã®ã‚‚ã®ãªã®ã‹åˆ¤åˆ¥ã§ããªã„çŠ¶æ…‹ã§ã™ã€‚ã“ã‚Œã‚’è­˜åˆ¥ã™ã‚‹ã«ã¯æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```{r}
#| label: fig-orange-color
#| fig-cap: "è‰²ãŒåˆ†ã‹ã‚Œã¾ã—ãŸ"

ggplot(Orange, aes(x = age, y = circumference, color = Tree)) + 
  geom_point()

```

ã“ã‚Œã§ã¨ã‚Šã‚ãˆãšã¯ã©ã®ç‚¹ãŒã©ã®æœ¨ã®ã‚‚ã®ã‹ã‚ã‹ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚`color = Tree`ã§ã€æœ¨ã®ç¨®é¡ã”ã¨ã«è‰²ã‚’ä½¿ã†ã“ã¨ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

ä»Šã¯æ•£å¸ƒå›³ãªã®ã§è‰²ã‚’åˆ†ã‘ã‚‹ã ã‘ã§æ¸ˆã¿ã¾ã™ãŒã€æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã®ã‚ˆã†ãªå ´åˆã¯ã€è‰²ã ã‘ã§ãªãç·šã®ç¨®é¡ã‚’å¤‰ãˆãŸã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãã‚“ãªæ™‚ã¯æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```{r}
#| label: fig-orange-linetype
#| fig-cap: "æŠ˜ã‚Œç·šã®ç¨®é¡ã‚‚åˆ†ã‹ã‚Œã¾ã—ãŸ"

ggplot(Orange, aes(x = age, y = circumference, color = Tree, linetype = Tree)) + 
  geom_point() + 
  geom_line()

```

`linetype = Tree`ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ç·šã®ç¨®é¡ã‚‚æœ¨ã®ç¨®é¡ã”ã¨ã«å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ã“ã®ã‚ˆã†ã«`aes()`å†…ã§è¦ç´ ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ç¨®é¡ã”ã¨ã«åˆ†ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ã è‰²é£ã„ãªã©ã¯ä¸æ ¼å¥½ã§ã™ãŒã€ã„ã£ãŸã‚“ã“ã®ã¾ã¾é€²ã‚ã¾ã™ã€‚

### å‡¡ä¾‹ã®ä½ç½®

æ¬¡ã«ã—ãŸã„ã®ã¯ã€å‡¡ä¾‹ã®è¨­å®šã§ã™ã€‚å‡¡ä¾‹ã¯ç¾åœ¨å³å´ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ãŒã€ã¾ãšã¯ã“ã‚Œã‚’ä¸‹ã«è¡¨ç¤ºã—ãŸã„ã¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã§ã§ãã¾ã™ã€‚

```{r}
#| label: fig-orange-legend-position
#| fig-cap: "å‡¡ä¾‹ãŒä¸‹ã«æ¥ã¾ã—ãŸ"

ggplot(Orange, aes(x = age, y = circumference, color = Tree)) + 
  geom_point() + 
  theme(legend.position = "bottom")

```

`theme(legend.position = "bottom")`ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€å‡¡ä¾‹ã®ä½ç½®ãŒä¸‹ã«ãªã‚Šã¾ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“bottomä»¥å¤–ã«ã‚‚top, left, rightï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ãªã©ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã•ã‚‰ã«å‡¡ä¾‹ã‚’æ¶ˆã—ãŸã„å ´åˆã¯æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```{r}
#| label: fig-orange-legend-delete
#| fig-cap: "å‡¡ä¾‹ã‚’æ¶ˆã—ã¾ã—ãŸ"

ggplot(Orange, aes(x = age, y = circumference, color = Tree)) + 
  geom_point() + 
  theme(legend.position = "none")

```

`theme(legend.position = "none")`ã§å‡¡ä¾‹ã‚’æ¶ˆã™ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

### å‡¡ä¾‹ã®èª¿æ•´

ä¾‹ãˆã°ã€å‡¡ä¾‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã¯æ¶ˆã—ãŸã„å ´åˆãŒçµæ§‹ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚@fig-orange-color ã®ä¾‹ã§ã„ãˆã°ã€Treeã¨ã„ã†æ–‡å­—ã¯æ¶ˆã—ãŸã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚

ãã‚“ãªå ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```{r}
#| label: fig-orange-legend-delte-title
#| fig-cap: "å‡¡ä¾‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å‰Šé™¤"

ggplot(Orange, aes(x = age, y = circumference, color = Tree)) + 
  geom_point() + 
  guides(color = guide_legend(title = NULL))

```

Treeã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ãŒæ¶ˆãˆã¾ã—ãŸã€‚

ã“ã“ã§ã¯`guides(color = guide_legend(title = NULL))`ã¨ã—ã¦ã„ã¾ã™ãŒã€`aes()`å†…ã§ä¾‹ãˆã°`linetype`ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€`guides()`å†…ã‚‚`linetype =`ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## ãƒ†ãƒ¼ãƒ

ggplotã§ã¯ãƒ†ãƒ¼ãƒã‚’é¸ã¶ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã“ã‚Œã¾ã§ã®å›³ã®ã‚ˆã†ã«èƒŒæ™¯ãŒã‚°ãƒ¬ãƒ¼ã«ãªã£ã¦ã„ã¾ã™ãŒã€ã»ã¨ã‚“ã©ã®å ´åˆã§èƒŒæ™¯ã¯ç™½ã«ã—ãŸã„ã§ã™ã‚ˆã­ã€‚

èƒŒæ™¯ã ã‘ã§ãªãã€ç½«ç·šç­‰ã‚‚ãƒ†ãƒ¼ãƒã§å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ãƒ—ãƒªã‚»ãƒƒãƒˆã®ãƒ†ãƒ¼ãƒ

ã„ãã¤ã‹ã®ãƒ†ãƒ¼ãƒãŒæº–å‚™ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»£è¡¨çš„ãªã‚‚ã®ã‚’ã„ãã¤ã‹ã”ç´¹ä»‹ã—ã¾ã™ã€‚

::: panel-tabset
## minimal

```{r}
#| label: fig-theme-minimal
#| fig-cap: "`theme_minimal()`"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  theme_minimal()

```

## bw

```{r}
#| label: fig-theme-bw
#| fig-cap: "`theme_bw()`"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  theme_bw()

```

`theme_minimal()`ã¨æ¯”ã¹ã¦å¤–æ ãŒä»˜ã„ã¦ã„ã¾ã™ã€‚

## classic

```{r}
#| label: fig-theme-classic
#| fig-cap: "`theme_classic()`"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  theme_classic()

```

## linedraw

```{r}
#| label: fig-theme-linedraw
#| fig-cap: "`theme_linedraw()`"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  theme_linedraw()

```

## light

```{r}
#| label: fig-theme-light
#| fig-cap: "`theme_light()`"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  theme_light()

```

## void

```{r}
#| label: fig-theme-void
#| fig-cap: "`theme_void()`"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  theme_void()

```

ã•ã™ãŒã«ã‚„ã‚Šã™ãã§ã¯â€¦ã¨æ€ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€GISã§åœ°å›³ã‚’å¯è¦–åŒ–ã™ã‚‹ã‚ˆã†ãªã¨ãã«é‡å®ã—ã¾ã™ã€‚
:::

### `theme()`é–¢æ•°

ã“ã“ã¾ã§ã”ç´¹ä»‹ã—ãŸã‚‚ã®ã®ä¸­ã§`theme()`ã‚’ä½¿ã£ãŸã‚‚ã®ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã—ãŸã€‚

ã“ã“ã§`theme()`**ã¯**`theme_xxx()`**ã®å¾Œã«ä½¿ã†**ã¨ã„ã†ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

ã“ã‚Œã¯ã€`theme_xxx()`ãŒ`theme()`ã‚’ä¸Šæ›¸ãã—ã¦ã—ã¾ã†ãŸã‚ã§ã™ã€‚

```{r}
#| label: fig-theme-miss
#| fig-cap: "å¤±æ•—ä¾‹"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  theme(axis.title = element_text(color = "red")) + 
  theme_minimal()
```

`theme(axis.title = element_text(color = "red"))`ã§è»¸ãƒ©ãƒ™ãƒ«ã‚’èµ¤è‰²ã«è¨­å®šã—ã¦ã„ã¾ã™ãŒã€å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®ã¯é»’ã„ãƒ©ãƒ™ãƒ«ã«ãªã£ã¦ã„ã¾ã™ã€‚

é †ç•ªã‚’é€†ã«ã™ã‚Œã°ã€

```{r}
#| label: fig-theme-success
#| fig-cap: "æ­£ã—ã„ä¾‹"

ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point() + 
  theme_minimal() + 
  theme(axis.title = element_text(color = "red"))
```

ã“ã®ã‚ˆã†ã«ã—ã£ã‹ã‚Šåæ˜ ã•ã‚Œã¾ã™ã€‚

## ç™ºå±•1ï¼š`ggrepel`

ã“ã“ã‹ã‚‰ã¯ã€`ggrepel`ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç”¨ã„ã¦æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã‚’ç™ºå±•ã•ã›ãŸä¾‹ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚

```{r}
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# pak::pak("ggrepel")
library(ggrepel)
```

ã¾ãšã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚`firm_id`ã¯30ã¾ã§ã‚ã‚Šã¾ã™ã€‚

```{r}
#| label: tbl-data-prep
#| tbl-cap: "ãƒ‡ãƒ¼ã‚¿ã®ä¸€éƒ¨"
#| echo: false

library(tidyverse)
set.seed(57)

n_firms <- 30   # Reduce the number of firms
n_states <- 50
T <- 36

firm_id <- 1:n_firms
state_id <- sample(n_states, size = n_firms, replace = TRUE)
year <- 1980:2015

fe_firm <- rnorm(n_firms, mean = 0, sd = .5)
fe_year <- rnorm(T, mean = 0, sd = .5)
error <- rnorm(n_firms * T, mean = 0, sd = .5)

treated_1998 <- sample(c(1, 0), size = n_firms, 
                       replace = TRUE, prob = c(1/5, 4/5))

treated_year <- sample(c(1989, 1998, 2007), size = n_firms, 
                       replace = TRUE, prob = c(17/50, 17/50, 16/50))

df <- tibble(
  firm_id = rep(firm_id, each = T), 
  state_id = rep(state_id, each = T), 
  year = rep(year, times = n_firms), 
  fe_firm = rep(fe_firm, each = T), 
  fe_year = rep(fe_year, times = n_firms), 
  error = error, 
  treated_1998 = rep(treated_1998, each = T), 
  is_treated = if_else(treated_1998 == 1 & year >= 1998, 1, 0), 
  y = case_when(
    is_treated == 1 ~ 
      rnorm(n_firms * T, mean = 2, sd = .2) + fe_firm + fe_year + error, 
    .default = fe_firm + fe_year + error
  )
)

df |> 
  select(firm_id:year, treated_1998:y) |> 
  head() |> 
  tinytable::tt()

```

ã“ã‚Œã‚’ä½¿ã£ã¦æ¨ªè»¸ã«`Year`ã€ç¸¦è»¸ã«`y`ã‚’ã¨ã£ã¦ã‚°ãƒ©ãƒ•ã«ã—ã¾ã™ã€‚

è©³ç´°ã‚’æ›¸ãã¨é•·ããªã‚‹ã®ã§ã€é©å®œãƒ¡ãƒ¢ã‚’å…¥ã‚Œã¾ã—ãŸã€‚ã”å‚è€ƒã¾ã§ã€‚

```{r}
#| label: fig-ggrepel
#| fig-cap: "ggrepelã‚’ä½¿ã£ãŸãƒ—ãƒ­ãƒƒãƒˆ"
#| fig-align: center

df <- df |> 
  mutate(
    # ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ç¾¤ã¨ãã‚Œä»¥å¤–ã«åˆ†ã‘ã‚‹
    group = if_else(treated_1998 == 1, as.factor(firm_id), "other"), 
    # æœ€å¾Œã®å¹´ã«ã ã‘ãƒ©ãƒ™ãƒ«ã‚’ä»˜ã‘ã‚‹
    group_lab = if_else(treated_1998 == 1 & year == 2015, 
                        paste0("Firm ", firm_id), NA_character_)
  )

ggplot(
  # ã¾ãšãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ç¾¤ã ã‘ãƒ—ãƒ­ãƒƒãƒˆ
  df |> filter(treated_1998 == 1), 
  aes(x = year, y = y, group = firm_id)
) + 
  theme_minimal() + 
  theme(
    # ç½«ç·šã‚’å‰Šé™¤
    panel.grid = element_blank(), 
    # å‡¡ä¾‹ã‚’å‰Šé™¤
    legend.position = "none", 
    # è»¸ã®ã‚¿ã‚¤ãƒˆãƒ«ã¨æ–‡å­—ã®ãƒ•ã‚©ãƒ³ãƒˆã¨ã‚µã‚¤ã‚ºã‚’èª¿æ•´
    axis.title = element_text(family = "Times", size = 18), 
    axis.text = element_text(family = "Times", size = 14)
  ) + 
  geom_vline(
    # å‚ç›´ç·šã‚’æå†™
    xintercept = seq(1980, 2015, by = 5), 
    color = "gray91", 
    linewidth = .6
  ) + 
  geom_segment(
    # æ°´å¹³ç·šã‚’æå†™
    # æå†™ã®ãŸã‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
    data = tibble(y = seq(-2.5, 5.0, by = 2.5), x1 = 1980, x2 = 2015), 
    aes(x = x1, xend = x2, y = y, yend = y), 
    inherit.aes = FALSE, 
    color = "gray91", 
    linewidth = .6
  ) + 
  geom_segment(
    # è–„ã„æ°´å¹³ç·šã‚’æå†™
    data = tibble(y = seq(-2.0, 4.5, by = .5), x1 = 1980, x2 = 2015), 
    aes(x = x1, xend = x2, y = y, yend = y), 
    inherit.aes = FALSE, 
    color = "gray97", 
    linewidth = .3
  ) + 
  geom_segment(
    # ç¸¦è»¸ãŒ0ã®ã¨ã“ã‚ã«æ°´å¹³ç·šã‚’æå†™
    data = tibble(y = 0, x1 = 1980, x2 = 2015), 
    aes(x = x1, xend = x2, y = y), 
    inherit.aes = FALSE, 
    linetype = "dashed", 
    color = "gray40"
  ) + 
  geom_vline(
    # å‡¦ç½®å¹´ã«å‚ç›´ç·šã‚’æå†™
    xintercept = 1998, 
    linetype = "dashed", 
    color = "gray40"
  ) + 
  geom_line(
    # ãƒã‚¤ãƒ©ã‚¤ãƒˆã—ãªã„ç¾¤ã‚’ãƒ—ãƒ­ãƒƒãƒˆ
    data = df |> filter(group == "other"), 
    color = "gray75", 
    alpha = .5
  ) + 
  geom_line(
    # ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ç¾¤ã‚’ãƒ—ãƒ­ãƒƒãƒˆ
    aes(color = group)
  ) + 
  geom_text_repel(
    # ãƒã‚¤ãƒ©ã‚¤ãƒˆã—ãŸç·šã«ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
    aes(color = group, label = group_lab), 
    family = "Times", 
    hjust = 0, 
    # 2017å¹´ã®ä½ç½®ã«ãƒ©ãƒ™ãƒ«ã‚’æ›¸ã
    xlim = c(2017, NA), 
    size = 4, 
    segment.linetype = "dotted"
  ) + 
  xlab("Year") + 
  ylab("Value") + 
  scale_x_continuous(
    expand = c(0, 0), 
    # ãƒ©ãƒ™ãƒ«ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«å›³ã®ç«¯ã®2015å¹´ã‚ˆã‚Šåºƒãã¨ã‚‹
    limits = c(1980, 2021), 
    breaks = seq(1980, 2015, by = 5)
  ) + 
  scale_y_continuous(
    expand = c(0, 0), 
    limits = c(-2.5, 5.0), 
    breaks = c(-2.5, 0, 2.5, 5.0)
  )
```

## ãŠã‚ã‚Šã«

ã²ã¨ã¾ãšåƒ•ãŒã‚ˆãä½¿ã†ggplotã®è¨­å®šã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚ggplotã‚’é§†ä½¿ã—ã¦ã€ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãªãƒ—ãƒ­ãƒƒãƒˆã‚’ä½œæˆã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

é©å®œè¿½è¨˜ã™ã‚‹äºˆå®šã§ã™ã®ã§ã€ã”å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚