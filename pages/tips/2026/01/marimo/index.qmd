---
title: "uv, marimo, DuckDB, Polarsで始めるPython×データ分析"
description: "Jupyter Notebookを用いずに、次世代ツールのmarimoを使ってデータ分析環境を整えていきます。"
date: 2026-01-09
categories: 
  - Python
  - SQL
  - データ処理
image: /pages/tips/2026/01/marimo/image/marimo_run_sql.png
---

## はじめに

Pythonでデータ分析を行う際、Jupyter Notebookは非常に便利なツールですが、次世代のノートブック環境である**marimo**を使うことで、より再現性高く、安定した分析環境を構築できます。

また、これまで単発の記事で紹介してきた**uv**、**DuckDB**、**Polars**といったパッケージを組み合わせることで、高速かつ効率的なデータ処理が可能になると考えており、今回はそれらを活用したデータ分析環境の構築方法について書きたいと思います。

過去に紹介したそれぞれのツールについても改めて簡単に説明していきます。

また、これまでの記事については以下をご参照ください。

{{< linkcard url="/pages/tips/2025/09/250926_virtual_environment/index.qmd" description="Rはrenv、Pythonはvenvを使います。注目のuvも紹介！" >}}

{{< linkcard url="/pages/tips/2025/09/250919_duckdb/index.qmd" title="DuckDBをRで使う【duckplyrも】" no-image=true >}}

{{< linkcard url="/pages/tips/2025/11/251125_r_polars/index.qmd" title="【R】polarsでデータ処理を高速化する" >}}

## marimoについて

今回初登場となるのは**marimo**です。marimoは

> 再現性が高く、Git に優しく、スクリプトやアプリとして展開できるリアクティブな Python ノートブック

であり、ノートブックであることからJupyter NotebookやQuartoと同様にコードと文章を組み合わせたファイルを作成できるのですが、以下のような特徴があります。

- ⚡リアクティブ：コードセルの依存関係を自動的に解析し、依存するセルを再実行（[参考](https://docs.marimo.io/guides/reactivity/)）
- 🛢️データのためのデザイン：データフレームやデータベースをSQLでクエリできたり、データフレームのフィルタ・検索が可能（DuckDBとの親和性。[参考](https://docs.marimo.io/guides/working_with_data/sql/)）
- 🐍ピュアPython：ファイルは`.ipynb`などではなく、純粋なPythonファイル（`.py`）として保存（Gitでの差分管理も容易に^[`.ipynb`はJSON形式で保存されるため、わずかな変更でも大きな差分が発生しがちです。]）

この他にもインタラクティブなプロットを簡単に作成できたり、webアプリにエクスポートできたりと、Quartoと似たような機能も備えています。

{{< linkcard url="https://github.com/marimo-team/marimo/blob/main/README_Japanese.md" title="marimo-team/marimo" >}}

### リアクティブのメリット

ちなみにリアクティブというのは**隠れた状態**（hidden state）の問題を解決するのに役立ちます。

Jupyter Notebookではセルの実行順序が自由であるため、セル1でデータの整理、セル2で分析、セル3で可視化を行う場合に、セル2を実行したのだけれどやっぱりセル1が修正する必要があった、というときに、セル1を修正後セル2を実行し忘れると修正前のデータが使われたまま分析が進んでしまうという問題があります^[これはQuartoでも同様ですが、Renderすれば上から順番通りに実行されます。手元の修正忘れの結果とレンダリングした結果が異なる、ということは起こり得ますが…。]。

以下のようなコードを考えてみてください。

```python
# Cell 1
x = 10

# Cell 2  
y = x * 2  # y = 20

# Cell 3
print(y)  # 20と表示される
```

```python
# Cell 1を修正
x = 20  # xを20に変更

# Cell 2を実行し忘れ

# Cell 3
print(y)  # 20と表示されてしまう（y=x*2なので本来は40になるはず）
``` 

このようにセルの実行順序を間違えると、意図しない結果が出力されてしまうことがあります。

しかしmarimoではセル間の依存関係を自動的に解析し、セル1が修正された場合にはセル2も自動的に再実行されるため、上記のような問題を防ぐことができます。これは魅力的ですよね…！

それでは、次からは分析環境の構築に入っていきます。

## 環境構築

今回は以下の環境で進めていきます。

- OS: Windows 11
- Python: 3.14
- エディタ: VSCode

## uvの設定

**uv**はPythonの新しい仮想環境管理ツールであり、高速に仮想環境を作成できることが特徴です。

詳しくは[こちら](/pages/tips/2025/09/250926_virtual_environment/index.qmd)。

### uvのインストール

まずはuvをインストールしましょう。PowerShell^[macOS/Linuxではターミナル]で以下のコマンドを実行してください。

:::{.panel-tabset}
## Windows
```bash
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
```

## macOS / Linux
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```
:::

### プロジェクトの作成

uvでは`uv init プロジェクト名`でプロジェクトを作成できます。以下のコマンドを実行してください。

```bash
uv init marimo-project
```

すると`marimo-project`というディレクトリが作成されるので、このディレクトリをVSCodeで開いてください。

ここからはVSCodeのターミナルでコマンドを実行していきます^[{{< kbd win="Ctrl-J" mac="Cmd-J" >}}で開くことができます。]。

### uvでパッケージをインストール

uvでは`uv add パッケージ名`でパッケージをインストールできます。venv環境は裏で自動的に作成されるため、手動で仮想環境を作成する必要はありません。

今回使用するパッケージをインストールするには以下のコマンドを実行してください。

```bash
uv add marimo polars duckdb pyarrow sqlglot
```

### パッケージの管理

uvでは`requirements.txt`を使わずに、`uv.lock`というファイルでパッケージのバージョン管理を行います。`uv add`を実行すると自動的に`uv.lock`が生成され、自動でパッケージの依存関係も解決されます。

別環境などで`uv.lock`からパッケージをインストールしたい場合は、以下のコマンドを実行してください。

```bash
uv sync
```

## marimoノートブックの作成

ここが本日のメインです。marimoノートブックを作成していきます。

marimoはuvを使ってインストールすることができ、先ほどのコマンドでインストールされているので、導入は簡単です。

### Pythonファイルの作成

先述の通り、marimoノートブックは`.py`ファイルとして保存されます。まずはファイルを任意のディレクトリに作成しましょう。例えば`analysis.py`という名前にします。

ディレクトリの構造は以下のようなイメージです。

```
project-directory/
 ├── .venv/
 ├── .gitignore
 ├── analysis.py     ← 作成したファイル
 ├── pyproject.toml
 └── uv.lock
```

### marimoの起動

marimoはVSCode上で動作するのではなく、コマンドラインから起動してブラウザで操作します。以下のコマンドを実行してください。

```bash
uv run marimo edit analysis.py
```

するとブラウザが起動し、以下のような画面が表示されます。  

![marimoの起動画面](image/marimo_browser.png)

### marimoノートブックの基本操作

画面を見ていただいてわかる通り、`import marimo as mo`と最初に書かれており、その下にPython、Markdown、SQLのセルを追加できるようになっています。

まずはタイトルから書きたいとして、最初のセルに追記して以下のようにします。

```python
import marimo as mo

mo.md("# marimoを始めよう🍃")
```

実行ボタン（▶️）を押すと、以下のようにタイトルが表示されます。

![marimoでタイトル表示](image/marimo_add_title.png)

続いてPythonコードを書いてみます。

```python
import polars as pl
import duckdb

df = pl.DataFrame({
    "Name": ["Michel", "James", "Daniel"],
    "Age": [25, 30, 22]
})

duckdb.sql("SELECT * FROM df")
```

実行ボタンを押すと、以下のようにデータフレームが表示されます。

![marimoで結果を表示](image/marimo_run.png)

また、SQLセルを追加して以下のように書くこともできます。

```sql
SELECT Name, Age FROM df WHERE Age > 23
```

実行ボタンを押すと、以下のようにSQLの結果が表示されます。

![marimoでSQL結果を表示](image/marimo_run_sql.png)

SQLセルでは**自動でDuckDBが使われ**、SQL用の特別な設定も不要なのでとても便利だと思っています。

もちろんマークダウンセルでは通常のマークダウンと同様の記述ができます。

![marimoでマークダウンセル](image/marimo_markdown.png)

### エクスポート

marimoノートブックは様々な形式にエクスポートできます。今回はQuartoでもおなじみのHTML形式にエクスポートしてみます。

コマンドラインからだと

```bash
uv run marimo export html analysis.py -o analysis.html
```

で、エディタからだと

![marimoでエクスポート](image/marimo_export.png)

でエクスポートできます。

エクスポートされたHTMLファイルをブラウザで開くと、以下のように表示されます。

![marimoでエクスポートしたHTML](image/marimo_html.png)

## PolarsとDuckDBの活用

今回はmarimoにフォーカスしてきたため、DuckDBとPolarsの詳細な使い方については省略しますが、**uv × marimo × DuckDB × Polars**の組み合わせは非常に強力だと考えています。

強力な点として、

- uvで簡単に仮想環境を管理できる
- marimoで再現性の高いノートブックを作成できる
- DuckDBで大規模データも効率的にSQLクエリが可能
- Polarsで高速にデータ処理ができる

が挙げられます。

DuckDBではデータをメモリに読み込まずにSQLクエリを実行できるため、大規模データを扱う際にメモリ不足の問題を回避できます。ローデータからの抽出等はDuckDBで行い、集計や変形はPolarsで行う、というワークフローが考えられ、しかもこれが高速というのは非常に魅力的だと考えています。

## おわりに

今回はuv、marimo、DuckDB、Polarsを組み合わせたデータ分析環境の構築方法について紹介しました。

とは言ってもmarimoの紹介がメインになってしまいましたが、2026年のPython環境としてはだいぶモダンな構成なのではないかと考えています。

こちら2026年1本目の記事ですが、このこぢんまり下サイトを見てくださっている方、今年もどうぞよろしくお願いいたします。

## 余談

リンクカードを実装しました。

Quartoにはリンクカードの機能がないので、これまでは

:::{.callout-tip appearance="minimal"}
[yo5uke.com](index.qmd)
:::

のようにcalloutを使ってリンクを紹介していたのですが、リンクカードの拡張機能を実装したことで

{{< linkcard url="index.qmd" >}}

みたいにできるようになりました。

まだ修正は必要そうですが、2026年はこれでいきたいと思います！
