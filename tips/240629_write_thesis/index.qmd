---
title: "【PDF】Quarto で論文を書く"
description: |
    Quarto を使って論文を書く方法（テクニカル）をまとめました。
date: 2024-06-29
categories:
  - Quarto
  - R
  - LaTeX
image: image/create_document.png
execute: 
  cache: true
  echo: false
draft: true
---

# はじめに

これまでの記事で R Markdown や Quarto を使って $\LaTeX$  経由で PDF 出力する方法や、それらで使えるチャンクオプションについてご紹介してきました。

::: {.callout-tip appearance="minimal"}
[R MarkdownでPDF出力【LaTeX】](https://yo5uke.github.io/tips/240329_rmarkdown_pdf/)
:::

::: {.callout-tip appearance="minimal"}
[【Quarto】チャンクオプションまとめてみた【R Markdown】](https://yo5uke.github.io/tips/240509_chunk_option/)
:::

今回は、Quarto を使って論文を書く方法について包括的にまとめてみました。

ぜひ参考にしてみてください。

また、環境として RStudio を使用していると仮定します。

# 準備

Quarto は R Markdown の亜種、と考えてもらえればと思います。マークダウン形式で記述することができ、$\LaTeX$ 記法を必ずしも用いる必要がないのが特徴です^[$\LaTeX$ コードを埋め込むこともできます。]。$\LaTeX$ を深く学ばなくてもスタイリッシュな論文が書けるのではないでしょうか。

ここからは、書くのに最低限必要な使い方を紹介します。

## プロジェクトの作成

必須ではありませんが推奨します。プロジェクトを作成することで、ファイルの管理がしやすくなります。

プロジェクトの作成については以下の記事で紹介しています。$\LaTeX$ との差別化点として、分析結果をそのまま埋め込めることがあげられ、プロジェクトを作成することで、その恩恵を最大限受けられると考えています。

::: {.callout-tip appearance="minimal"}
[【R】プロジェクトを使う](https://yo5uke.github.io/tips/240515_rproj/)
:::

## ファイルの作成

Quarto で論文を書くには、拡張子が `.qmd` のファイルを作成します。これは Quarto Markdown の略です。

RStudio 画面左上の ![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAkCAYAAADl9UilAAACvElEQVR4Xu2XTWgTQRSA0/wo4k9VghH14MWzB+9S0YMHbxJBsZDdTdJS3aTBghQPKRRUrF6EWIpNtjSKGo0XTS96CA00CUVpmqot2tLGHvTSNDYFE0jGfUkj4bn52e0EL/vBO+3MvI+Zt29nNRoVlf/BQ36nTrB0tvmYYJvALGsEJg+h9TEp/SgT3DvMsedu2tvNZrMOT20dXvaiKLEqBqkXouQPo4e1dfb17Xa73Vq8DD0CZp1WsNzDAo3i/LM7a6Fw9FM4lpidnE4mlEQknryFdf4i7sAQTgqBwc8h7O8fk0zmFykUCnh4U4Ac9ilTPr5/EjYrBuGJT5CNjSwpFot4SkOkxQLmHZo6NYXBzytx6AlPFldWyO9cDk9piKSYzsdcxUmUiEHcDr8ka+m07COVFBNbwmucQKnYmVeDJPV9leRk7pq0mMCkakk0S2W+yc+TL/MLJJvdxEPqIimmKTdPKmL6MY7MJJJkPZPBQ+pSS2yTptiHjzOlOpODpJjYVJdoiZn81+mJ6b3sm8rCUoHBz6vj9IsBeke5Z4TrwgmUivWHBHrF3+Hu3Q8fZJxErphx/BoJT0XptQu4usAtASeSKzYQGieJ2Tl6DRaAq8u+YW4MJ2tW7FLwPonFp0u7Re2TBMB96rLTaWp/xD3FSRsFSEWiMfJtcYnyR3wLUU5vtTpNxx/Y+g2jbM2aq8QRv4O4xeODnQKp1lx7tgA5u/2G8YrDcerEkO3uAQ83ZfCyP8WXI2fwccWjfic5Gxgk7gk/mRR3KZGcKx0f7JRSKaChGADHCjVn5fljbBd/0trd22Hrdl4YEZ4vQ/OEAp9f+FoSgkKHmlJyfNU0JVYB3laXy7WL41wHLT09h9++i3xOp9dLzRP6VD6f39YuVSNLDAOT8YK0UMXkoorJZVti8FMKC7Qi6v7wqqi0iD86M3fnY/LjkAAAAABJRU5ErkJggg==) をクリックし、「Quarto Document...」を選択します。

以下のようにタイトルと著者名、PDF を選択し、Create をクリックします。"Use visual markdown editor" はオフにしてください^[僕は使い方が分かりません。]。

![](image/create_document.png)

作成出来たら、![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAkCAYAAAD7PHgWAAABBklEQVR4Xu2XMQrCQBBFBQvR6wgJHsEDpHVjBDvvoBhbI3bWCkZbFUyhFrYiEat0WgmC6AVkdQqbIVmWZAOi82C64b+/bDWZDEEQP4phTLMaa9d003bTGMgu1psF7JVGNzuWPdzs18GDz443rgrIcndXbvW8g1axGfZKo7P2eBXc+WB74a3FGXtiA1kwzfnpqTF7hL3SwDfAaz+BqvjkwYADe6WhglQwJlQwKVQwKakVTGOoYNL5z4JxwBlUMEwqAu9SwTCpCLxLBcOkIvCusoKT9/WFQ6OkIvCukoJwt5rO0sehUVIReBem6ng+OLBXmnKjn4PbGM5PeKnqgXIlo5vHXoL4Nl4ZYqbbEGA7+wAAAABJRU5ErkJggg==) でファイルを任意の場所に保存します^[僕は基本的に `code` フォルダを作ってそこに保存しています。]。

もし Quarto や R Markdown を使うのが初めての場合、上部に "Package rmarkdown required but not installed. Install Don't show again" というメッセージが表示されるかもしれません。その場合、"Install" をクリックしてインストールしてください。

## Global Options の設定

RStudio 上部のメニューから "Tools" > "Global Options..." を選択します。

その中の "Sweave" を選択し、"Typeset LaTeX into PDF using:" で "XeLaTeX" を選択します。また、その下にある "Use tinytex when compiling .tex files" にチェックを入れます。

最後に OK を押して閉じてください。

## ヘッダーの記述

ファイルを作成すると、ドキュメントの上部に`---`で囲まれた部分があります。これを YAML ヘッダーと呼び、ここで文書の設定を行います。

以下は、最低限必要な設定です。

```yaml
---
title: "【PDF】Quarto で論文を書く"
author: "阿部洋輔"
date: 2024-06-29  # 日付は適宜変更してください
format: 
  pdf: 
    documentclass: article
    lang: ja  # 日本語で書くなら推奨（英語なら不要）
    number-sections: true
    include-in-header: 
      - text: |
          \usepackage{zxjatype}
          \usepackage[ipaex]{zxjafont} 
execute: 
  echo: false  # コードを表示しない
  warning: false # 警告とメッセージを表示しない
language: 
  crossref-fig-title: "図"
  crossref-tbl-title: "表"
  crossref-eq-prefix: "式"
---
```

分析コードや実行の際に表示されるメッセージ・警告は出力しなくてよいので `false` にしてあります。

また、デフォルトだと英語設定でキャプションが Table 1 や Figure 1 と表示されてしまうので、それを日本語に直すために `language` を追加しています。他にも英語出力されてしまって困る際は[こちら](https://github.com/quarto-dev/quarto-cli/blob/main/src/resources/language/_language-ja.yml)から該当するものを探し、下に追加していってください^[本当は `lang: ja` を設定するだけで万事解決のはずなのですが、パッケージのインストールがどうしてもうまくいかないのでこのような場当たり的な対処になっています。]。

もちろん英語論文を執筆する際には不要です。

# 本文の書き方（マークダウン編）

本文は Markdown で記述します。$\LaTeX$ 記法を使うこともできますが、必ずしも使う必要はありません。もちろん、数式などは $\LaTeX$ 記法を使うことができます。

以下のコードは、基本的な書き方の例です。

```markdown
# 見出し1

## 見出し2

### 見出し3

本文です。セクションに応じて見出しをつけることができます。基本的には3段階までの見出しを使います。

- 箇条書き1

    - 箇条書き2

        - 箇条書き3

箇条書きを使うときは、ハイフンとスペースを入れてください。2段階目、3段階目を使用するときは、半角スペース4つを入れてください。

1. 番号付きリスト1

    - 箇条書き

2. 番号付きリスト2

番号付きリストを使うときは、数字とピリオドとスペースを入れてください。

また、改行するときは空行を入れなければなりません。

文中で数式を使いたいときは、`$` で囲んでください。例えば、$y = ax + b$ のように記述します。

数式を別行で書きたいときは、`$$` で囲んでください。例えば、

$$
y = ax + b
$$ {#eq-equation-name}

のように記述します。数式にラベルをつけることもできます。`#eq-` の後にラベル名を記述します。

数式を引用するときは、`@eq-equation-name` のように記述します。
```

以上が基本的な書き方です。

コードチャンクを使うときは、上記のように記述します。コードは YAML ヘッダーで `echo: false` としているので、出力されません。結果は出力されます^[結果も隠したいときは `result: false` をチャンクオプションとして指定します。チャンクオプションについては[こちら](https://yo5uke.github.io/tips/240509_chunk_option/)]。

出力された PDF は[こちら](https://drive.google.com/file/d/1fMClmrPQzGhZvzmn2cJkuVT3H-nMJX_H/view?usp=sharing)から確認してください。

# 本文の書き方（テーブル編）

Quarto で論文を書くことの醍醐味ともいえる、コードとその出力について説明します。

ここではデフォルトで使用できる `iris` というデータセットを利用して分析、表の出力をしてみたいと思います。

例えば以下のコードを実行すると @tbl-regression のように出力されます。

```r
#| label: tbl-regression
#| tbl-cap: "iris を使用した回帰分析"

library(tidyverse)
library(fixest)
library(modelsummary)
library(tinytable)

# リスト形式で保存すると複数の分析結果を1つの表に表示可能
regression <- list(
  "(1)" = iris |> 
    feols(Sepal.Length ~ Sepal.Width, se = "hetero"), 
  "(2)" = iris |> 
    feols(Sepal.Length ~ Sepal.Width + Petal.Length, se = "hetero"), 
  "(3)" = iris |> 
    feols(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, se = "hetero")
)

# ここで変数名の表記を変更
cm <- c(
  "Sepal.Width" = "がく片の幅（cm）", 
  "Petal.Length" = "花弁の長さ（cm）", 
  "Petal.Width" =  "花弁の幅（cm）", 
  "Species" = "アイリスの種類"
)

# 表に加える統計量を整理
gm <- tibble(
  "raw" = c("nobs", "r.squared"), 
  "clean" = c("Observations", "R\u00B2"), 
  "fmt" = c(0, 2)
)

# フットノートを書く
fn <- "注：標準誤差は括弧内に記載。+p < 10%, *p < 5%, **p < 1%"

msummary(regression, estimate = "{estimate}{stars}", 
         notes = fn, coef_map = cm, gof_map = gm, 
         stars = c("+" = .1, "*" = .05, "**" = .01)) |> 
  group_tt(j = list("がく片の長さ（cm）" = 2:4))
```

```{r}
#| label: tbl-regression
#| tbl-cap: "iris を使用した回帰分析"

library(tidyverse)
library(fixest)
library(modelsummary)
library(tinytable)

# リスト形式で保存すると複数の分析結果を1つの表に表示可能
regression <- list(
  "(1)" = iris |> 
    feols(Sepal.Length ~ Sepal.Width, se = "hetero"), 
  "(2)" = iris |> 
    feols(Sepal.Length ~ Sepal.Width + Petal.Length, se = "hetero"), 
  "(3)" = iris |> 
    feols(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, se = "hetero")
)

# ここで変数名の表記を変更
cm <- c(
  "Sepal.Width" = "がく片の幅（cm）", 
  "Petal.Length" = "花弁の長さ（cm）", 
  "Petal.Width" =  "花弁の幅（cm）", 
  "Species" = "アイリスの種類"
)

# 表に加える統計量を整理
gm <- tibble(
  "raw" = c("nobs", "r.squared"), 
  "clean" = c("Observations", "R\u00B2"), 
  "fmt" = c(0, 2)
)

# フットノートを書く
fn <- "注：標準誤差は括弧内に記載。+p < 10%, *p < 5%, **p < 1%"

msummary(regression, estimate = "{estimate}{stars}", 
         notes = fn, coef_map = cm, gof_map = gm, 
         stars = c("+" = .1, "*" = .05, "**" = .01)) |> 
  group_tt(j = list("がく片の長さ（cm）" = 2:4))
```

出力された PDF は[こちら](https://drive.google.com/file/d/1eXA9ElJUtSfFGN5W0MSdeX5EHIzkVhVF/view?usp=sharing)から確認してください。

ここからは、表作成におけるポイントを説明します。
