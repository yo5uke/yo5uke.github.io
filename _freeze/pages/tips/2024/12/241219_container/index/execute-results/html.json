{
  "hash": "612a44728fa38c0222314e8b8337d441",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: 【改訂版】開発コンテナを使ってR環境を構築！\ndescription: |\n  ローカル環境から卒業！\ndate: 2024-12-19\ndate-modified: 2026-02-01\ncategories:\n- R\n- Docker\n- Windows\n- Mac\n- Ubuntu\n- VSCode\n- GitHub\nimage: image/Rlogo.png\naliases:\n- /pages/tips/241219_container/index.html\n---\n\n## はじめに\n\n::: callout-note\n## 本記事について\n\n本記事は以前投稿した同タイトルの記事をアップデートしたものです。\n\n今回の主な変更点:\n\n1.  DVCの設定をサービスアカウント方式に変更（OAuth方式は非推奨）\n2.  Juliaセクションの削除\n3.  全体的な記述の見直し\n\nなお、Dockerfileやdevcontainer.jsonの最新のシンプルな構成については、[こちらの記事](/pages/tips/2025/10/251011_dev_container/index.qmd)もあわせてご覧ください。\n:::\n\nDockerとVSCodeを使ってRの環境を構築する方法を説明します。\n\n開発コンテナを使うメリットは、環境を簡単に共有でき、他の環境に影響を受けずに作業ができることです。\n\nあまり環境構築に詳しくなくても実装できるよう意識して書いていますので、最後まで自分のPCでも実装してみてください。\n\n## 事前準備 {#sec-pre}\n\nまず、WSL2, Ubuntu, Homebrew, VSCode, Docker, Git, そしてGitHubの準備をします。WindowsとMacでの設定が異なるため、それぞれについて説明します。\n\n全体的に、導入済みの箇所は飛ばしてください。\n\n### WSL2 / Homebrew {#sec-wsl2-setting}\n\nWindowsではWSL2（Linux環境）を、MacではHomebrew（パッケージマネージャー）をそれぞれ準備します。\n\n::: {.panel-tabset}\n\n#### Windows（WSL2）\n\n1.  PowerShellまたはWindowsコマンドプロンプトを管理者権限で開く\n    - 右クリックで管理者権限を使えます。\n\n![](image/powershell.png){width=\"70%\" fig-align=\"center\"}\n\n2.  以下のコマンドを入力して実行\n    - これでインストールはできるはずですが、詳しくは[こちらのサイト](https://learn.microsoft.com/ja-jp/windows/wsl/install)を参照してください。\n\n``` {.sh filename=\"PowerShell\"}\nwsl --install\n```\n\n3.  ユーザー名とパスワードを設定\n    - インストールが終わると、Linuxディストリビューションのユーザー名とパスワードの作成を求められます[^1]。\n    - ユーザー名は何でも大丈夫です。パスワードもめちゃくちゃ簡単で問題ありません。\n    - パスワードは**画面上には表示されませんが、ちゃんと入力されています**。慌てて何回も入力しないようにしてください。\n\n[^1]: 求められない場合は、続けて`wsl`とだけ入力して実行してください。\n\nエクスプローラーからLinuxに入り[^2]、Ubuntu→home→\\[ユーザー名\\]と入ったところがメインとなるディレクトリです。\n\n[^2]: 左のサイドバーの1番下です。\n\n#### Mac（Homebrew）\n\nHomebrewを使って諸々インストールしていくので、まだの方はここでインストールしてください。\n\n1.  ターミナルを開く\n    - アプリ一覧から「ターミナル」を探してください。\n2.  以下のコマンドを入力して実行\n    - パスワードを求められるので、入力してください。\n\n``` {.sh filename=\"Terminal\"}\n/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n```\n\n:::\n\n### VSCode {#sec-vscode-setting}\n\n1.  VSCodeの[ダウンロードサイト](https://code.visualstudio.com/)からダウンロード、インストール\n    - Download for Windows[^3]をクリックしてダウンロードできます。\n    - インストールができたら、VSCodeを開いてください。\n2.  （任意）日本語の拡張機能をインストール\n    - 画面左側に拡張機能のアイコン{{< iconify gg:extension >}}があります。ここの検索ボックスに`MS-CEINTL.vscode-language-pack-ja`と入力し、1番上に出てきたものをインストールします[^4]。\n    - インストール後、VSCodeを再起動すれば日本語が反映されていると思います。\n\n[^3]: もしくは Mac\n\n[^4]: 単にJapaneseでも出てきます。笑\n\n![](image/vscode-ja.png)\n\n3.  拡張機能のインストール\n    - 拡張機能の検索ボックスで、次のIDを入力し、インストールします。\n    - `ms-vscode-remote.remote-containers` (Dev Containers)\n    - `ms-vscode-remote.remote-wsl` (WSL, Windowsユーザーのみ)\\\n4.  WSLに接続（Windowsユーザーのみ）\n    - VSCodeから先ほどインストールしたWSLに接続します。\n    - 画面左下の青い{{< iconify gg:remote >}}をクリックして、「WSLへの接続」をクリックします。\n\n![](image/vscode-wsl.png)\n\n### Docker\n\nDockerをインストールします。\n\n1.  Windowsの方は[ここ](https://docs.docker.com/desktop/install/windows-install/)からDocker Desktop for Windowsを、Macの方は[こちら](https://docs.docker.com/desktop/install/mac-install/)からダウンロード＆インストール\n2.  設定の確認（Windowsのみ）\n    - インストール出来たら、画面上部の設定ボタンからResources、WSL integrationと進み、チェックボックスにチェック、Ubuntuがオンになっていることを確認してください。\n    - たまに、何もしていないのにここがオフになっていて、トラブることがあります。\n    - 詳しくは[こちら](https://docs.docker.jp/docker-for-windows/install.html)をご覧ください。日本語で書いてあります。\n\n![](image/docker-desktop.png)\n\n3.  画面左側のVolumesに進み、Createからボリュームを作成\n    - 次の4つを作成します（大文字小文字に注意！）。\n    - `TinyTeX`, `cache`, `fonts`, `venv`\n\n![Macでの画面](image/create_volume_mac.png)\n\n::: {.callout-tip collapse=\"true\"}\n## ボリュームを使わない構成について\n\nボリュームを使わないよりシンプルな構成もあります。詳しくは[こちらの記事](/pages/tips/2025/10/251011_dev_container/index.qmd)をご覧ください。\n:::\n\n### Git\n\n::: {.panel-tabset}\n\n#### Windows\n\n1.  UbuntuでGitをインストール\n    - Windowsのアプリ一覧からUbuntuを探し、開いてください。開いたら、以下のコマンドを入力して実行します。\n    - `sudo`を使うとパスワードを求められますが、最初に設定したものです。\n\n``` {.sh filename=\"Ubuntu\"}\nsudo apt-get install git\n```\n\n![Ubuntu](image/ubuntu-git.png){width=\"70%\"}\n\n#### Mac\n\n1.  HomebrewでGitをインストール\n    - ターミナルを開いて、以下のコマンドを入力して実行します。\n\n``` {.sh filename=\"Terminal\"}\nbrew install git\n```\n\n![このMacでは2回目なのでgit is already installedと表示されてます…。](image/homebrew.png){width=\"70%\"}\n\n:::\n\nGitをインストールしたら、以下のコマンドでユーザー名とメールアドレスを設定してください。`[]`ごと置き換えてください。\n\n``` {.sh filename=\"Terminal\"}\ngit config --global user.name [任意のユーザ名]\ngit config --global user.email [任意のメールアドレス]\n```\n\n### GitHubアカウントの作成\n\nファイルは基本的にGitHubで管理するので、[ここ](https://github.com/)からアカウントを作成してください。\n\n**ポイント：**\n\nGitHubアカウントを作成したら、VSCodeにログインしておきましょう。\n\n1.  VSCodeを開く\n2.  画面左下のアイコンをクリック\n    - GitHubでサインインを行う\n\nGitHubにログインすることで、その後の作業がスムーズに進みます。\n\n事前準備は以上です！\n\n## 開発環境の構築\n\n::: callout-note\n## RStudioで出てくる警告について\n\nRStudioでこの後作業することになりますが、コマンドを打つと以下の警告が出てくるかもしれません。\n\n`警告メッセージ: Character set is not UTF-8; please change your locale`\n\nしかし、警告は出るものの、実際の作業には特に問題ありません。これに対処しようと試みましたが、できませんでした…。\n\nもし詳しくて対処できた方は、コメントから教えていただけると幸いです。\n:::\n\nまずは基本設定[^5]から説明します。\n\n[^5]: 単独研究ならここのみでOK、共同研究ならホストが行う設定。\n\n### 基本設定\n\n#### GitHubリポジトリを作成\n\n1.  テンプレートの[GitHub リポジトリ](https://github.com/yo5uke/R-template)にアクセス\n2.  画面右の「Use this template」から「Create a new repository」を選択\n3.  Repository nameを記入\n4.  Privateを選択\n    - 通常の研究プロジェクトならPrivateでOK\n5.  「Create repository」をクリック\n\n#### リポジトリをクローン {#sec-host-vscode}\n\n1.  VSCodeを開く\n2.  画面左側の{{< fa code-branch >}}を開く\n3.  「リポジトリの複製」を選択し、さらに「GitHubから複製」を選ぶ\n4.  リポジトリを選択し、クローン\n    - リポジトリは、「ユーザー名/リポジトリ名」の形式で表示されます。\n    - 基本的に表示されると思いますが、表示されない場合は手入力してください。\n    - クローンしたリポジトリを開くか問われるので、開いてください。\n5.  画面右下に「コンテナーで再度開く」と出たらクリック\n    - 出ない場合、画面左下「{{< iconify gg:remote >}} WSL: Ubuntu」[^6]をクリックし、「コンテナーで再度開く」を選択してください。\n    - 初めて環境を構築する場合、ここでかなり時間がかかるので辛抱強く待ちましょう。\n\n[^6]: Mac なら{{< iconify gg:remote >}}\n\n![「コンテナーで再度開く」をクリック](image/reopen.png)\n\nエクスプローラーを開き、`\\Ubuntu\\home\\ユーザー名`の中を確認してみてください。リポジトリ名と同じフォルダができていると思います。\n\nMacの場合は、ユーザー名の下にできているはずです。\n\n::: {.callout-note collapse=\"true\"}\n## Macでファイルが見当たらない？\n\nクローンしたフォルダを見てみると、リポジトリにはあるはずのファイルやフォルダが見当たらないかもしれません。\n\n![ファイルが見当たらない…？](image/finder_mac_after_clone.png){width=\"70%\"}\n\nこのようなときは、Finderの隠しファイルを表示する設定を変更する必要があります。\n\n以下をターミナルで実行してください。\n\n``` {.sh filename=\"Terminal\"}\ndefaults write com.apple.finder AppleShowAllFiles TRUE\nkillall Finder\n```\n\nこれで、隠しファイルも表示されるようになります。\n\n正直なところ、この設定は隠しファイルが邪魔であればしなくてもよいと思います[^7]。VSCode上ではきちんと表示されますので。\n:::\n\n[^7]: TRUE のところを FALSE にして再度実行すれば消せます。\n\n#### RStudioで開く\n\nここで、ブラウザを用いてRStudioを開きます。毎度この手順を踏む前に、VSCode上で開発コンテナに接続していることを確認してください。開いていないと、次のリンクは無効なものになってしまいます。\n\n1.  任意のブラウザで、アドレスバーに`localhost:8787`と入力して開く\n2.  右上の ![](data:image/png;base64,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) をクリックし、「New Project...」を選択\n3.  「Existing Directory」を選択\n4.  「Browse...」より「work」を選択して「Choose」をクリック\n    - 「Create project」をクリックするとプロジェクトが作成されます。\n5.  コンソールに以下を入力して実行\n    - `renv`はパッケージを管理するためのパッケージです。\n    - Dockerfileでインストールすることを指示しているので、コンソールでインストールせずとも既に使用可能です[^8]。\n\n[^8]: 余談ですが、`renv::init()`のように`パッケージ名::関数`のような書き方をすれば、`library(パッケージ名)`をせずとも関数を使えます。1度だけ使いたいようなときに便利です。\n\n``` {.r filename=\"R\"}\nrenv::init()\n```\n\n#### Pythonの設定（任意）\n\nPythonを使う場合、以下のパッケージをインストールしておきます。\n\n使わない場合はスキップしてください。\n\n使い方としては、Quarto上でPythonのコードを書く or `.ipynb`で書くことを想定しています。そのために必要なパッケージですが、その他のパッケージを使用する場合も同様の方法でインストールしてください。\n\n1.  VSCodeに戻る\n2.  画面上部「ターミナル」より「新しいターミナル」を選択\n3.  以下のコマンドを入力して実行\n\n``` {.sh filename=\"Terminal\"}\npip install ipykernel jupyter\n```\n\nパッケージはcacheにキャッシュがあるので、1回インストールすれば、2回目以降の環境構築では不要です。\n\n#### DVCの設定 {#sec-dvc-setting}\n\nDVCはデータを管理するためのツールです。GitHubの容量制限（100MiB）を超えるデータを扱う場合に便利です。\n\nここではサービスアカウントを使った方法で設定します。OAuthに比べてトークン切れの問題がなく、一度設定すれば再認証が不要です。\n\n詳しい設定手順は[DVCの設定まとめ](/pages/tips/2025/06/250601_dvc/index.qmd#サービスアカウントの作成)にまとめていますので、あわせてご覧ください。\n\n##### 事前準備\n\n1.  自分のGoogleドライブの任意の場所で、データを入れる用のフォルダを作成\n    - 共同プロジェクトの場合は、フォルダの共有も設定してください。\n2.  Google Cloud Consoleでサービスアカウントを作成し、JSONキーをダウンロード\n    - 詳しくは[DVCの設定まとめ](/pages/tips/2025/06/250601_dvc/index.qmd#サービスアカウントの作成)を参照してください。\n3.  Googleドライブのフォルダをサービスアカウントのメールアドレスに「編集者」権限で共有\n\n##### パッケージのインストール\n\n1.  VSCodeに戻る\n2.  画面上部「ターミナル」より「新しいターミナル」を選択\n    - 既に画面下部にターミナルが表示されている場合はスキップしてください。\n3.  以下のコマンドを入力して実行\n    - 初めて環境構築するときに1回実行しておけば、2回目以降の環境構築では不要です。\n\n``` {.sh filename=\"Terminal\"}\npip install dvc dvc-gdrive\n```\n\n##### DVCの初期化とリモート設定\n\n1.  Googleドライブで作成したフォルダのIDをコピー\n    - IDは、ドライブでフォルダを開いたときのURLで、最後のスラッシュ（\\~/folders/）より右側の部分です。\n2.  次のコマンドを順番に実行してください。\n\n``` {.sh filename=\"Terminal\"}\ndvc init && dvc remote add -d myremote gdrive://[Google DriveのフォルダID]\n```\n\n``` {.sh filename=\"Terminal\"}\ndvc remote modify myremote gdrive_use_service_account true\n```\n\n3.  JSONキーのパスを設定\n    - `.secrets/key.json`にキーを配置してください。\n\n``` {.sh filename=\"Terminal\"}\ndvc remote modify myremote --local \\\n    gdrive_service_account_json_file_path .secrets/key.json\n```\n\n4.  `.gitignore`に`.secrets/`を追記\n    - キーファイルは機密情報なので、Gitで追跡しないようにしてください。\n\n``` {filename=\".gitignore\"}\n/.secrets/\n```\n\n#### LaTeXの設定\n\nR Markdownなどで$\\LaTeX$を使用するために、TinyTeXをインストールします。\n\nRStudioのコンソールに以下のコマンドを入力して実行してください。\n\nまた、TinyTeXもキャッシュされるので、1回インストールすれば、2回目以降の環境構築では実行不要です。\n\n``` {.r filename=\"R\"}\ninstall.packages(\"tinytex\")\ntinytex::install_tinytex(force = TRUE, dir = \"/home/rstudio/.TinyTeX\")\n```\n\nTinyTeXは、$\\LaTeX$コードをコンパイルする際に必要なパッケージを自動でダウンロードしてくれるので、ローカルに面倒な設定をしなくて良いのが魅力です。\n\nR MarkdownやQuartoでのPDF出力の仕方については、[こちらの記事](https://yo5uke.github.io/tips/240329_rmarkdown_pdf/)もご覧ください。\n\n::: {.callout-warning collapse=\"true\"}\n## VSCode上でのファイル等の作成\n\nVSCode上でファイルやフォルダを作成するためには、左側のアイコン一番上の「エクスプローラー」をクリックし、その中の上部にあるアイコンの「新しいファイル…」や「新しいファイル…」を選択することでできます。\n\nここで注意点ですが、状況によっては意図せずフォルダの中に作ってしまうことがあります。\n\nワーキングディレクトリにファイルを作成したい場合は、まずエクスプローラーの空き部分をクリックします。すると、枠全体が青い線で囲まれると思います。\n\nこの状態であれば、ワーキングディレクトリにファイルやフォルダが新規作成されます。下の画像の左側に注目してください。\n\n![エクスプローラーの空いている部分をクリックすると、全体が青枠で囲まれます。](image/vscode-explorer1.png)\n\n一方、特定のフォルダの中に作成したい場合は、そのフォルダをクリックしてから新規作成を行ってください。\n\n![特定のフォルダをクリックすると、そのフォルダが青枠で囲まれます。](image/vscode-explorer2.png)\n:::\n\n#### 共同プロジェクトの場合\n\n共同プロジェクトの場合は、GitHubで共有するため、以下の手順を踏んでおいてください。\n\n- GitHubリポジトリでコラボレーターを追加\n  - リポジトリのSettingsからCollaboratorsに進み、コラボレーターを追加してください。\n  - Add peopleから招待できます。\n\nホスト側の環境構築はここで一区切りです！\n\n### 共同作業者の設定\n\n**前提：**[事前準備](#sec-pre)を終わらせている\n\n1.  GitHubで招待を受ける\n    - メールが届いているはずですので、そこからGitHubにログインしてください。\n    - リポジトリにアクセスできるようになります。\n2.  リポジトリをクローン\n    - ホスト側が作成したリポジトリをクローンします。\n    - ホスト側の設定と同様にしてクローンし、開いてください。\n\n一旦ここまでで、共同作業者の設定は終わりです。\n\n## 研究作業（ワークフロー）\n\n研究における作業の流れについて説明します。\n\nGitHub関連[^9]については[こちらの記事](https://yo5uke.github.io/tips/240525_vscode_github/)で詳しめに解説しましたので、そちらも参考にしてください。\n\n[^9]: コミット、プッシュやブランチなど\n\n### Rのパッケージ\n\n基本的にはブラウザ上のRStudio ServerでローカルのRStudioと同様に作業できます。ここではプロジェクトを管理する観点から説明します。\n\n作業中新たにパッケージを使用した場合、それを`renv.lock`ファイルに記録することで、必要なパッケージを記録することができます。記録することで環境を移したときに必要なパッケージをすぐインストールできたり、共同研究者と必要なパッケージを（バージョン込みで）共有することができます。\n\nバージョンごと記録できるので、全く同じ環境を再現することが可能です。\n\n新しいパッケージをインストールし、コード内で使用したら、以下のコードを実行し、lockファイルに記録してください[^10]。\n\n[^10]: インストールしただけでコード内で使用していない場合は記録されません。\n\n``` {.r filename=\"R\"}\nrenv::snapshot()\n```\n\n異なる環境に移行した場合、ディレクトリに`renv.lock`ファイルがあれば、以下のコードで記録したパッケージを一括インストールできます。\n\n``` {.r filename=\"R\"}\nrenv::restore()\n```\n\nこれでRの開発環境を揃えることができます。PCを変えた場合などにも役立ちます。\n\nまた、新しいパッケージを使ったら、その作業が終わるごとに`renv::snapshot()`で記録しましょう。\n\n### Python のパッケージ\n\n設定ではPythonの設定も加えていますので、必要に応じてPythonも使用できます。\n\nまた、そもそもDVCがPythonのパッケージなので、それも`renv`と同様に記録できます。Pythonの場合はvenvを用いてパッケージを管理します。\n\n1.  Pythonのパッケージを追加\n    - [先ほど](#sec-dvc-setting)と同様に、新しいターミナルを開いて、以下のコードでパッケージをインストールします。\n    - DVC以外特に使うものがなければ、ここはスキップしてください。\n\n``` {.sh filename=\"Terminal\"}\npip install [パッケージ名]\n```\n\n2.  パッケージを記録\n    - Rと同様に、作業が終わったら以下のコードでパッケージを記録します。\n    - `requirements.txt`は`renv.lock`と同じような役割です。\n\n``` {.sh filename=\"Terminal\"}\npip freeze > requirements.txt\n```\n\n3.  パッケージをインストール（異なる環境に移行した場合）\n    - 次のコードで、`requirements.txt`に記録したパッケージをインストールできます。\n    - つまり`renv::restore()`と同じ役割です。\n\n``` {.sh filename=\"Terminal\"}\npip install -r requirements.txt\n```\n\n### データの管理\n\nデータはDVCで管理し、Google Drive上で保管します。\n\n[DVCの設定](#sec-dvc-setting)が済んでいれば、以下の手順でデータを管理できます。\n\n1.  ワーキングディレクトリに`data`というフォルダを作成\n2.  データが入ったら、以下のコードを実行\n    - `data`フォルダごとドライブに追加します。\n    - `data`フォルダは`.gitignore`に記載されているため、GitHubにはアップロードされません。\n\n``` {.sh filename=\"Terminal\"}\ndvc add data/\n```\n\n::: {.callout-tip collapse=\"true\"}\n## データの入れ方\n\nデータは、WindowsのエクスプローラーやMacのFinderから直接フォルダに入れて大丈夫です（通常のWindowsやMacでの作業のように）。\n\nちなみにWindowsユーザーの方で、一回ローカルに落としてからLinuxにデータやコードを入れたら`Zone.Identifier`というファイルができることがありますが、これは無視して大丈夫です。邪魔であればまとめて消してください。\n:::\n\n3.  データをアップロード\n\n``` {.sh filename=\"Terminal\"}\ndvc push\n```\n\n4.  データのダウンロード\n    - プッシュしたデータをダウンロードしたい場合は、以下を実行します。\n\n``` {.sh filename=\"Terminal\"}\ndvc pull\n```\n\n### まとめ\n\n以上の作業を通じて、再現可能な研究を行うことができます。\n\n環境を揃えるためには、コミット、プッシュ、プルを行い、記録したファイルを共有することが重要です。\n\n以上がワークフローです。お疲れ様でした！\n\n## 環境構築まとめ\n\n作業フローは、~~超適当にまとめると~~次のようになります。\n\n### ホスト\n\n0.  必要なソフト等をインストールし、事前準備を行う。\n    - WSL2, Ubuntu, Homebrew, VSCode, Docker, Git, GitHub\n1.  GitHubでリポジトリをインポート、クローン\n2.  RStudio Serverでプロジェクトを作成\n    - `renv::init()` でrenvを開始\n    - `renv::snapshot()`で適宜パッケージを記録\n3.  `.secrets`フォルダにサービスアカウントのキーを配置し、DVCを設定\n    - データは`data`内に追加\n    - `dvc add data/`と`dvc push`を使用\n4.  VSCode上でコミット、プッシュ\n\n### 共同作業者\n\n0.  必要なソフト等をインストールし、事前準備を行う。\n    - WSL2, Ubuntu, Homebrew, VSCode, Docker, Git, GitHub\n1.  GitHubでリポジトリをクローン\n2.  RStudio Serverでプロジェクトを開く\n    - `renv::restore()` でパッケージをインストール\n3.  ホストから`.secrets`フォルダを受け取り、ワーキングディレクトリに配置\n4.  VSCode上で`pip install -r requirements.txt`を実行\n    - Pythonパッケージをインストール\n5.  DVCのリモート設定を行い、`dvc pull`でデータをダウンロード\n    - 詳しくは[DVCの設定まとめ](/pages/tips/2025/06/250601_dvc/index.qmd)の「共同作業者の設定」を参照\n6.  VSCode上でコミット、プッシュ\n\n## おわりに\n\n今回はDocker & VSCodeを用いた開発環境を説明しました。\n\n個人的な経験として、環境構築はエラーとの戦いです。できるだけエラーに遭遇しないよう丁寧に書いたつもりですが、まだまだ把握していないエラーがたくさんあると思います。\n\n何かエラー等ありましたら、コメントしていただけると幸いです。\n\n## 参考文献\n\n{{< linkcard url=\"/pages/tips/2025/10/251011_dev_container/index.qmd\" >}}\n\n{{< linkcard url=\"https://zenn.dev/nicetak/articles/vscode-docker-2023\" title=\"VSCode + Dockerでよりミニマルでポータブルな研究環境を\" description=\"もっとミニマルで簡単なポータブルな環境を!\" >}}\n\n{{< linkcard url=\"https://qiita.com/tommy_g/items/771ac45b89b02e8a5d64\" no-image=true >}}\n\n{{< linkcard url=\"https://qiita.com/future_kame/items/9fa256aea09faa28b357\" no-image=true >}}\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}