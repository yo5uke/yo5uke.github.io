{
  "hash": "2207a7ff9ab80afacba89a0a43250ae8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"ã€ãƒ‡ãƒ¼ã‚¿ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€‘pivot_longer()ã‚’ä½¿ã£ã¦ãƒ­ãƒ³ã‚°å½¢å¼ã®ãƒ‘ãƒãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚‹\"\ndescription: |\n  ãƒ¯ã‚¤ãƒ‰ã‹ã‚‰ãƒ­ãƒ³ã‚°ã¸ã€ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›ã—ã¾ã™ã€‚\ndate: 2024-09-17\ncategories: \n  - R\n  - ãƒ‡ãƒ¼ã‚¿å‡¦ç†\nimage: image/computer_document_spreadsheet.png\neditor: visual\n---\n\n\n\n## ã¯ã˜ã‚ã«\n\nä»Šå›ã¯`tidyr`ã®`pivot_longer()`ã‚’ä½¿ã£ã¦ãƒ¯ã‚¤ãƒ‰å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ³ã‚°å½¢å¼ã«ã™ã‚‹æ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚\n\n## ä½¿ç”¨ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸\n\n`tidyverse`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚`tidyverse`ã«ã¯`dplyr`ã‚„`tidyr`ã‚’ã¯ã˜ã‚ã¨ã—ãŸè«¸ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€ä¸€æ‹¬ã§ã‚„ã‚‹ã®ãŒä¾¿åˆ©ã§åƒ•ã¯å¥½ãã§ã™ã€‚\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n\n## ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™\n\nä»Šå›ã¯é©å½“ã«ä½œæˆã—ã¦ã„ãã¾ã™ã€‚\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- tibble(\n  Region_id = 1:2, \n  Region = c(\"Region1\", \"Region2\"),\n  Income_2000 = c(40000, 35000),\n  Income_2005 = c(42000, 37000),\n  Income_2010 = c(45000, 39000),\n  Population_2000 = c(500000, 450000),\n  Population_2005 = c(520000, 460000),\n  Population_2010 = c(540000, 470000)\n)\n```\n:::\n\n::: {#tbl-wide .cell tbl-cap='ãƒ¯ã‚¤ãƒ‰å½¢å¼ã®ãƒ‘ãƒãƒ«ãƒ‡ãƒ¼ã‚¿'}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_t0r9qvu9ezvfqqeeu9jo(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_t0r9qvu9ezvfqqeeu9jo\");\n          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_t0r9qvu9ezvfqqeeu9jo');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_t0r9qvu9ezvfqqeeu9jo(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_t0r9qvu9ezvfqqeeu9jo\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: 0, j: 0 }, { i: 0, j: 1 }, { i: 0, j: 2 }, { i: 0, j: 3 }, { i: 0, j: 4 }, { i: 0, j: 5 }, { i: 0, j: 6 }, { i: 0, j: 7 },  ], css_id: 'tinytable_css_v3gy49ptphsyyck56bm3',}, \n          { positions: [ { i: 2, j: 0 }, { i: 2, j: 1 }, { i: 2, j: 2 }, { i: 2, j: 3 }, { i: 2, j: 4 }, { i: 2, j: 5 }, { i: 2, j: 6 }, { i: 2, j: 7 },  ], css_id: 'tinytable_css_n2coclsx7nkeovu9v5j1',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_t0r9qvu9ezvfqqeeu9jo(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_v3gy49ptphsyyck56bm3, .table th.tinytable_css_v3gy49ptphsyyck56bm3 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_n2coclsx7nkeovu9v5j1, .table th.tinytable_css_n2coclsx7nkeovu9v5j1 { border-bottom: solid #d3d8dc 0.1em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_t0r9qvu9ezvfqqeeu9jo\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\">Region_id</th>\n                <th scope=\"col\">Region</th>\n                <th scope=\"col\">Income_2000</th>\n                <th scope=\"col\">Income_2005</th>\n                <th scope=\"col\">Income_2010</th>\n                <th scope=\"col\">Population_2000</th>\n                <th scope=\"col\">Population_2005</th>\n                <th scope=\"col\">Population_2010</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td>1</td>\n                  <td>Region1</td>\n                  <td>40000</td>\n                  <td>42000</td>\n                  <td>45000</td>\n                  <td>500000</td>\n                  <td>520000</td>\n                  <td>540000</td>\n                </tr>\n                <tr>\n                  <td>2</td>\n                  <td>Region2</td>\n                  <td>35000</td>\n                  <td>37000</td>\n                  <td>39000</td>\n                  <td>450000</td>\n                  <td>460000</td>\n                  <td>470000</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n\n2ã¤ã®åœ°åŸŸã«ã¤ã„ã¦åå…¥ã¨äººå£ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚Šã¾ã—ãŸã€‚\n\nãƒã‚¤ãƒ³ãƒˆã¯ã€ä¸»è¦ãªãƒ‡ãƒ¼ã‚¿ã«ãŠã„ã¦`å¤‰æ•°å_å¹´`ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚\n\n## `pivot_longer()`ã‚’ä½¿ã†\n\nä¸€ç•ªãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãªã‚„ã‚Šæ–¹ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_long <- df |> \n  pivot_longer(\n    cols = starts_with(c(\"Income_\", \"Population_\")), \n    names_to = c(\".value\", \"Year\"), \n    names_sep = \"_\"\n  )\n```\n:::\n\n\n\n`cols`ã§ã¯ãƒ­ãƒ³ã‚°å½¢å¼ã«å¤‰æ›ã—ãŸã„å¤‰æ•°ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚`dplyr`ã®`starts_with()`ã‚’ä½¿ãˆã°ã€è¤‡æ•°å¹´åˆ†ã®å¤‰æ•°ã‚’ä¸€æ‹¬ã§æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»Šå›ã¯`Income_`ã¨`Population_`ã§å§‹ã¾ã‚‹å¤‰æ•°ã¨ã„ã†æ„å‘³ã§ã™ã€‚\n\n`names_to`ã¯æ–°ã—ã„åˆ—åã‚’ã©ã†ã™ã‚‹ã‹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚`names_sep`ã§åˆ†å‰²ã®åŒºåˆ‡ã‚Šã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§ã™ãŒï¼ˆã“ã®å ´åˆã¯ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ï¼‰ã€ãã®åŒºåˆ‡ã‚Šå‰ãªã‚‰`.value`ï¼ˆã™ãªã‚ã¡ã€ã‚‚ã¨ã®åå‰ã®ã¾ã¾[^1]ï¼‰ã€åŒºåˆ‡ã‚Šå¾Œã¯`Year`ã¨ã„ã†åˆ—ã«æ ¼ç´ã™ã‚‹ã¨ã„ã†æ„å‘³ã§ã™ã€‚\n\n[^1]: ã“ã®å ´åˆãªã‚‰`Income`ã‚„`Population`\n\nã§ããŸãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\n\n\n\n::: {#tbl-long .cell tbl-cap='ãƒ­ãƒ³ã‚°å½¢å¼ã®ãƒ‘ãƒãƒ«ãƒ‡ãƒ¼ã‚¿'}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_u02zuu6qv807o7oik4fc(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_u02zuu6qv807o7oik4fc\");\n          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_u02zuu6qv807o7oik4fc');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_u02zuu6qv807o7oik4fc(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_u02zuu6qv807o7oik4fc\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: 6, j: 0 }, { i: 6, j: 1 }, { i: 6, j: 2 }, { i: 6, j: 3 }, { i: 6, j: 4 },  ], css_id: 'tinytable_css_fycm0tj6mqxnksjem4a5',}, \n          { positions: [ { i: 0, j: 0 }, { i: 0, j: 1 }, { i: 0, j: 2 }, { i: 0, j: 3 }, { i: 0, j: 4 },  ], css_id: 'tinytable_css_fgqbic0r2bwfshtcsv97',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_u02zuu6qv807o7oik4fc(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_fycm0tj6mqxnksjem4a5, .table th.tinytable_css_fycm0tj6mqxnksjem4a5 { border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_fgqbic0r2bwfshtcsv97, .table th.tinytable_css_fgqbic0r2bwfshtcsv97 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_u02zuu6qv807o7oik4fc\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\">Region_id</th>\n                <th scope=\"col\">Region</th>\n                <th scope=\"col\">Year</th>\n                <th scope=\"col\">Income</th>\n                <th scope=\"col\">Population</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td>1</td>\n                  <td>Region1</td>\n                  <td>2000</td>\n                  <td>40000</td>\n                  <td>500000</td>\n                </tr>\n                <tr>\n                  <td>1</td>\n                  <td>Region1</td>\n                  <td>2005</td>\n                  <td>42000</td>\n                  <td>520000</td>\n                </tr>\n                <tr>\n                  <td>1</td>\n                  <td>Region1</td>\n                  <td>2010</td>\n                  <td>45000</td>\n                  <td>540000</td>\n                </tr>\n                <tr>\n                  <td>2</td>\n                  <td>Region2</td>\n                  <td>2000</td>\n                  <td>35000</td>\n                  <td>450000</td>\n                </tr>\n                <tr>\n                  <td>2</td>\n                  <td>Region2</td>\n                  <td>2005</td>\n                  <td>37000</td>\n                  <td>460000</td>\n                </tr>\n                <tr>\n                  <td>2</td>\n                  <td>Region2</td>\n                  <td>2010</td>\n                  <td>39000</td>\n                  <td>470000</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n\nã‚‚ã—ä»®ã«ã€ãƒ­ãƒ³ã‚°å½¢å¼ã«å¤‰æ›ã—ãŸã„å¤‰æ•°ãŒã™ã¹ã¦ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã§åŒºåˆ‡ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆ[^2]ã€`cols = contain(\"_\")`ã¨ã™ã‚Œã°ã€å¤‰æ•°ãŒå¤šãã¦ã‚‚ä¸€æ°—ã«æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ä»Šå›ã®å ´åˆã€`Region_id`ãŒã‚ã‚Šã¾ã™ã‹ã‚‰ã†ã¾ãã„ãã¾ã›ã‚“ã­ã€‚ä½¿ãˆã‚‹å ´é¢ã¯é™ã‚‰ã‚Œãã†ã§ã™ã€‚\n\n[^2]: é€†ã«è¨€ã†ã¨ã€ã»ã‹ã®å¤‰æ•°ã¯ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ãŒç”¨ã„ã‚‰ã‚Œã¦ã„ãªã„å ´åˆ\n\n## ãŠã‚ã‚Šã«\n\nä»Šå›ã¯ãƒ¯ã‚¤ãƒ‰å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ãƒ­ãƒ³ã‚°å½¢å¼ã«å¤‰æ›ã™ã‚‹æ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã—ãŸã€‚\n\nåƒ•è‡ªèº«`pivot_longer()`ã‚’ä½¿ã†æ™‚ã„ã¤ã‚‚ä½•ã‚’æŒ‡å®šã™ã‚Œã°ã„ã„ã‚“ã ã£ã‘ï¼Ÿã¨ãªã‚‹ã®ã§ã€å‚™å¿˜éŒ²çš„ãªæ„å‘³åˆã„ãŒå¼·ã„ã§ã™ğŸ˜…\n\nã”å‚è€ƒã¾ã§ã€‚\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}