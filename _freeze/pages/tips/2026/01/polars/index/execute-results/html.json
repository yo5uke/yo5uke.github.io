{
  "hash": "6a22c71ecf764e101e589043ee088361",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"RユーザーのためのPolars入門\"\ndescription: \"RユーザーがPolarsを使い始めるための基本的な手順とコード例を紹介します。\"\ndate: 2026-01-24\ndate-modified: 2026-02-02\ncategories:\n  - Python\n  - データ処理\nengine: jupyter\n---\n\n## はじめに\n\nPolarsは、高速で効率的なデータフレーム操作を可能にするPythonのライブラリです。\n\nこれまでRでPolarsを使う方法や、Python環境の構築に関する記事で何回か言及してきたものの、いまだにPythonにおけるPolarsについてはまとめてきませんでした。\n\nこの記事では、Rユーザー、特にTidyverseに慣れた方々がPolarsを使い始めるための基本的な手順とコード例を紹介します。\n\nこれまでの記事に関しては以下をご覧ください。\n\n{{< linkcard url=\"/pages/tips/2025/11/251125_r_polars/index.qmd\" title=\"【R】polarsでデータ処理を高速化する\" >}}\n\n{{< linkcard url=\"/pages/tips/2026/01/marimo/index.qmd\" >}}\n\n## Polarsのインストール\n\nPolarsはPythonのパッケージとして提供されており、以下のコマンドでインストールできます。\n\n```bash\npip install polars\n```\n\nuvを使っている場合は以下でも可能です。\n\n```bash\nuv add polars\n```\n\n## 基本的な使い方\n\nここからは、Tidyverseでよく使われる関数を挙げながら、Polarsでの対応する操作を紹介します。\n\n### データの読み込み（read_csv）\n\nまずはデータの読み込みから始めます。以下の例では、CSVファイルを読み込んでいます。\n\n::: {#8576c082 .cell execution_count=1}\n``` {.python .cell-code}\nimport polars as pl\n\ndf = pl.read_csv(\"data/iris.csv\")\n```\n:::\n\n\nこれが一番基本的な読み込み方法です。Rの`read_csv()`関数に相当します。\n\nPolarsでデータを読み込む場合、**shift-jisのファイルを読み込むことはできません**。その場合はPandasを使って読み込み、PolarsのDataFrameに変換する必要があります。\n\n```python\nimport pandas as pd\nimport polars as pl\n\npdf = pd.read_csv(\"data_shift_jis.csv\", encoding=\"shift-jis\")\ndf = pl.from_pandas(pdf)\n```\n\n### データの確認（head, tail）\n\nデータの先頭や末尾を確認するには、`head()`と`tail()`メソッドを使用します。\n\n::: {#e153b38e .cell execution_count=2}\n``` {.python .cell-code}\n# 先頭5行を表示\nprint(df.head())\n# 末尾5行を表示\nprint(df.tail())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (5, 5)\n┌──────────────┬─────────────┬──────────────┬─────────────┬─────────┐\n│ Sepal.Length ┆ Sepal.Width ┆ Petal.Length ┆ Petal.Width ┆ Species │\n│ ---          ┆ ---         ┆ ---          ┆ ---         ┆ ---     │\n│ f64          ┆ f64         ┆ f64          ┆ f64         ┆ str     │\n╞══════════════╪═════════════╪══════════════╪═════════════╪═════════╡\n│ 5.1          ┆ 3.5         ┆ 1.4          ┆ 0.2         ┆ setosa  │\n│ 4.9          ┆ 3.0         ┆ 1.4          ┆ 0.2         ┆ setosa  │\n│ 4.7          ┆ 3.2         ┆ 1.3          ┆ 0.2         ┆ setosa  │\n│ 4.6          ┆ 3.1         ┆ 1.5          ┆ 0.2         ┆ setosa  │\n│ 5.0          ┆ 3.6         ┆ 1.4          ┆ 0.2         ┆ setosa  │\n└──────────────┴─────────────┴──────────────┴─────────────┴─────────┘\nshape: (5, 5)\n┌──────────────┬─────────────┬──────────────┬─────────────┬───────────┐\n│ Sepal.Length ┆ Sepal.Width ┆ Petal.Length ┆ Petal.Width ┆ Species   │\n│ ---          ┆ ---         ┆ ---          ┆ ---         ┆ ---       │\n│ f64          ┆ f64         ┆ f64          ┆ f64         ┆ str       │\n╞══════════════╪═════════════╪══════════════╪═════════════╪═══════════╡\n│ 6.7          ┆ 3.0         ┆ 5.2          ┆ 2.3         ┆ virginica │\n│ 6.3          ┆ 2.5         ┆ 5.0          ┆ 1.9         ┆ virginica │\n│ 6.5          ┆ 3.0         ┆ 5.2          ┆ 2.0         ┆ virginica │\n│ 6.2          ┆ 3.4         ┆ 5.4          ┆ 2.3         ┆ virginica │\n│ 5.9          ┆ 3.0         ┆ 5.1          ┆ 1.8         ┆ virginica │\n└──────────────┴─────────────┴──────────────┴─────────────┴───────────┘\n```\n:::\n:::\n\n\n### 列の選択（select）\n\nPolarsで特定の列を選択するには、`select()`メソッドを使用します。\n\n::: {#fb09d4fb .cell execution_count=3}\n``` {.python .cell-code}\n# \"sepal_length\"と\"sepal_width\"の列を選択\nselected_df = df.select([\"Sepal.Length\", \"Sepal.Width\"])\nprint(selected_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (150, 2)\n┌──────────────┬─────────────┐\n│ Sepal.Length ┆ Sepal.Width │\n│ ---          ┆ ---         │\n│ f64          ┆ f64         │\n╞══════════════╪═════════════╡\n│ 5.1          ┆ 3.5         │\n│ 4.9          ┆ 3.0         │\n│ 4.7          ┆ 3.2         │\n│ 4.6          ┆ 3.1         │\n│ 5.0          ┆ 3.6         │\n│ …            ┆ …           │\n│ 6.7          ┆ 3.0         │\n│ 6.3          ┆ 2.5         │\n│ 6.5          ┆ 3.0         │\n│ 6.2          ┆ 3.4         │\n│ 5.9          ┆ 3.0         │\n└──────────────┴─────────────┘\n```\n:::\n:::\n\n\nRでは列名を単にベクトルで指定しますが、Polarsではリストで指定します。ダブルクォーテーションで囲まなければならないのも、Rユーザーにとっては地味に面倒ですが…。\n\n### フィルタリング（filter）\n\nデータを条件でフィルタリングするには、`filter()`メソッドを使用します。\n\n::: {#84fc44bf .cell execution_count=4}\n``` {.python .cell-code}\n# \"Sepal.Length\"が5.0より大きい行をフィルタリング\nfiltered_df = df.filter(pl.col(\"Sepal.Length\") > 5.0)\nprint(filtered_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (118, 5)\n┌──────────────┬─────────────┬──────────────┬─────────────┬───────────┐\n│ Sepal.Length ┆ Sepal.Width ┆ Petal.Length ┆ Petal.Width ┆ Species   │\n│ ---          ┆ ---         ┆ ---          ┆ ---         ┆ ---       │\n│ f64          ┆ f64         ┆ f64          ┆ f64         ┆ str       │\n╞══════════════╪═════════════╪══════════════╪═════════════╪═══════════╡\n│ 5.1          ┆ 3.5         ┆ 1.4          ┆ 0.2         ┆ setosa    │\n│ 5.4          ┆ 3.9         ┆ 1.7          ┆ 0.4         ┆ setosa    │\n│ 5.4          ┆ 3.7         ┆ 1.5          ┆ 0.2         ┆ setosa    │\n│ 5.8          ┆ 4.0         ┆ 1.2          ┆ 0.2         ┆ setosa    │\n│ 5.7          ┆ 4.4         ┆ 1.5          ┆ 0.4         ┆ setosa    │\n│ …            ┆ …           ┆ …            ┆ …           ┆ …         │\n│ 6.7          ┆ 3.0         ┆ 5.2          ┆ 2.3         ┆ virginica │\n│ 6.3          ┆ 2.5         ┆ 5.0          ┆ 1.9         ┆ virginica │\n│ 6.5          ┆ 3.0         ┆ 5.2          ┆ 2.0         ┆ virginica │\n│ 6.2          ┆ 3.4         ┆ 5.4          ┆ 2.3         ┆ virginica │\n│ 5.9          ┆ 3.0         ┆ 5.1          ┆ 1.8         ┆ virginica │\n└──────────────┴─────────────┴──────────────┴─────────────┴───────────┘\n```\n:::\n:::\n\n\nRの`filter()`では`filter(Sepal.Length > 5.0)`のように書きますが、Polarsでは`pl.col`を使って`pl.col(\"Sepal.Length\")`のように列を指定します。正直こちらもRの方が書きやすいなとか思ってしまいますが、慣れの問題でしょうか。\n\n### 新しい列の追加（mutate）\n\n新しい列を追加するには、`with_columns()`メソッドを使用します。Rの`mutate()`に相当します。\n\n::: {#989db57c .cell execution_count=5}\n``` {.python .cell-code}\n# \"Sepal.Ratio\"という新しい列を追加\nmutated_df = df.with_columns(\n    (pl.col(\"Sepal.Length\") / pl.col(\"Sepal.Width\")).alias(\"Sepal.Ratio\")\n).select([\"Sepal.Length\", \"Sepal.Width\", \"Sepal.Ratio\"])\nprint(mutated_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (150, 3)\n┌──────────────┬─────────────┬─────────────┐\n│ Sepal.Length ┆ Sepal.Width ┆ Sepal.Ratio │\n│ ---          ┆ ---         ┆ ---         │\n│ f64          ┆ f64         ┆ f64         │\n╞══════════════╪═════════════╪═════════════╡\n│ 5.1          ┆ 3.5         ┆ 1.457143    │\n│ 4.9          ┆ 3.0         ┆ 1.633333    │\n│ 4.7          ┆ 3.2         ┆ 1.46875     │\n│ 4.6          ┆ 3.1         ┆ 1.483871    │\n│ 5.0          ┆ 3.6         ┆ 1.388889    │\n│ …            ┆ …           ┆ …           │\n│ 6.7          ┆ 3.0         ┆ 2.233333    │\n│ 6.3          ┆ 2.5         ┆ 2.52        │\n│ 6.5          ┆ 3.0         ┆ 2.166667    │\n│ 6.2          ┆ 3.4         ┆ 1.823529    │\n│ 5.9          ┆ 3.0         ┆ 1.966667    │\n└──────────────┴─────────────┴─────────────┘\n```\n:::\n:::\n\n\nRと異なる点として、Rでは先に列名を指定し、その後に計算式を書くのに対し、Polarsでは計算式を先に書き、その後に`alias()`で列名を指定します。\n\nまた、作った列を見やすくするために、ちゃっかり`select()`をつなげて必要な列だけを抽出しています。Rのパイプでつなげて処理できるのと同様に、Polarsでもメソッドチェーンでつなげて処理できます。\n\n### グループ化と集計(group_by, summarise)\n\nデータをグループ化して集計するには、`group_by()`と`agg()`メソッドを使用します。Rで言うところの`group_by()`と`summarise()`に相当します。\n\n::: {#e20ea7a2 .cell execution_count=6}\n``` {.python .cell-code}\n# \"Species\"でグループ化し、\"Sepal.Length\"の平均を計算\ngrouped_df = df.group_by(\"Species\").agg(\n    pl.col(\"Sepal.Length\").mean().alias(\"Avg_Sepal_Length\")\n)\nprint(grouped_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (3, 2)\n┌────────────┬──────────────────┐\n│ Species    ┆ Avg_Sepal_Length │\n│ ---        ┆ ---              │\n│ str        ┆ f64              │\n╞════════════╪══════════════════╡\n│ setosa     ┆ 5.006            │\n│ virginica  ┆ 6.588            │\n│ versicolor ┆ 5.936            │\n└────────────┴──────────────────┘\n```\n:::\n:::\n\n\nここでも`with_columns()`と同様に、集計結果の列名を`alias()`で指定しています。\n\n### データの並び替え（arrange）{#sec-sort}\n\nデータを特定の列で並び替えるには、`sort()`メソッドを使用します。Rの`arrange()`に相当します。\n\n::: {#698621e2 .cell execution_count=7}\n``` {.python .cell-code}\n# \"Sepal.Length\"で昇順に並び替え\nsorted_df = df.sort(\"Sepal.Length\")\nprint(sorted_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (150, 5)\n┌──────────────┬─────────────┬──────────────┬─────────────┬───────────┐\n│ Sepal.Length ┆ Sepal.Width ┆ Petal.Length ┆ Petal.Width ┆ Species   │\n│ ---          ┆ ---         ┆ ---          ┆ ---         ┆ ---       │\n│ f64          ┆ f64         ┆ f64          ┆ f64         ┆ str       │\n╞══════════════╪═════════════╪══════════════╪═════════════╪═══════════╡\n│ 4.3          ┆ 3.0         ┆ 1.1          ┆ 0.1         ┆ setosa    │\n│ 4.4          ┆ 2.9         ┆ 1.4          ┆ 0.2         ┆ setosa    │\n│ 4.4          ┆ 3.0         ┆ 1.3          ┆ 0.2         ┆ setosa    │\n│ 4.4          ┆ 3.2         ┆ 1.3          ┆ 0.2         ┆ setosa    │\n│ 4.5          ┆ 2.3         ┆ 1.3          ┆ 0.3         ┆ setosa    │\n│ …            ┆ …           ┆ …            ┆ …           ┆ …         │\n│ 7.7          ┆ 3.8         ┆ 6.7          ┆ 2.2         ┆ virginica │\n│ 7.7          ┆ 2.6         ┆ 6.9          ┆ 2.3         ┆ virginica │\n│ 7.7          ┆ 2.8         ┆ 6.7          ┆ 2.0         ┆ virginica │\n│ 7.7          ┆ 3.0         ┆ 6.1          ┆ 2.3         ┆ virginica │\n│ 7.9          ┆ 3.8         ┆ 6.4          ┆ 2.0         ┆ virginica │\n└──────────────┴─────────────┴──────────────┴─────────────┴───────────┘\n```\n:::\n:::\n\n\n降順に並び替える場合は、`descending=True`を指定します。\n\n::: {#800a9b1e .cell execution_count=8}\n``` {.python .cell-code}\n# \"Sepal.Length\"で降順に並び替え\nsorted_df_desc = df.sort(\"Sepal.Length\", descending=True)\nprint(sorted_df_desc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (150, 5)\n┌──────────────┬─────────────┬──────────────┬─────────────┬───────────┐\n│ Sepal.Length ┆ Sepal.Width ┆ Petal.Length ┆ Petal.Width ┆ Species   │\n│ ---          ┆ ---         ┆ ---          ┆ ---         ┆ ---       │\n│ f64          ┆ f64         ┆ f64          ┆ f64         ┆ str       │\n╞══════════════╪═════════════╪══════════════╪═════════════╪═══════════╡\n│ 7.9          ┆ 3.8         ┆ 6.4          ┆ 2.0         ┆ virginica │\n│ 7.7          ┆ 3.8         ┆ 6.7          ┆ 2.2         ┆ virginica │\n│ 7.7          ┆ 2.6         ┆ 6.9          ┆ 2.3         ┆ virginica │\n│ 7.7          ┆ 2.8         ┆ 6.7          ┆ 2.0         ┆ virginica │\n│ 7.7          ┆ 3.0         ┆ 6.1          ┆ 2.3         ┆ virginica │\n│ …            ┆ …           ┆ …            ┆ …           ┆ …         │\n│ 4.5          ┆ 2.3         ┆ 1.3          ┆ 0.3         ┆ setosa    │\n│ 4.4          ┆ 2.9         ┆ 1.4          ┆ 0.2         ┆ setosa    │\n│ 4.4          ┆ 3.0         ┆ 1.3          ┆ 0.2         ┆ setosa    │\n│ 4.4          ┆ 3.2         ┆ 1.3          ┆ 0.2         ┆ setosa    │\n│ 4.3          ┆ 3.0         ┆ 1.1          ┆ 0.1         ┆ setosa    │\n└──────────────┴─────────────┴──────────────┴─────────────┴───────────┘\n```\n:::\n:::\n\n\n### データの結合（join）\n\nデータフレームを結合するには、`join()`メソッドを使用します。Rの`left_join()`や`inner_join()`に相当します。Rとは違って関数自体は同じですが、結合の種類を`how`引数で指定します。\n\nまずは左結合（`left_join()`）の例を示します。\n\n::: {#53e23f7f .cell execution_count=9}\n``` {.python .cell-code}\n# 例として2つのデータフレームを作成\ndf1 = pl.DataFrame({\n    \"key\": [1, 2, 3],\n    \"value1\": [\"A\", \"B\", \"C\"]\n})\ndf2 = pl.DataFrame({\n    \"key\": [2, 3, 4],\n    \"value2\": [\"D\", \"E\", \"F\"]\n})\n\n# df1とdf2を\"key\"列で左結合\njoined_df = df1.join(df2, on=\"key\", how=\"left\")\nprint(joined_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (3, 3)\n┌─────┬────────┬────────┐\n│ key ┆ value1 ┆ value2 │\n│ --- ┆ ---    ┆ ---    │\n│ i64 ┆ str    ┆ str    │\n╞═════╪════════╪════════╡\n│ 1   ┆ A      ┆ null   │\n│ 2   ┆ B      ┆ D      │\n│ 3   ┆ C      ┆ E      │\n└─────┴────────┴────────┘\n```\n:::\n:::\n\n\n次に、内部結合（`inner_join()`）の例を示します。\n\n::: {#152ba610 .cell execution_count=10}\n``` {.python .cell-code}\n# df1とdf2を\"key\"列で内部結合\njoined_df_inner = df1.join(df2, on=\"key\", how=\"inner\")\nprint(joined_df_inner)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (2, 3)\n┌─────┬────────┬────────┐\n│ key ┆ value1 ┆ value2 │\n│ --- ┆ ---    ┆ ---    │\n│ i64 ┆ str    ┆ str    │\n╞═════╪════════╪════════╡\n│ 2   ┆ B      ┆ D      │\n│ 3   ┆ C      ┆ E      │\n└─────┴────────┴────────┘\n```\n:::\n:::\n\n\n次に、完全結合(`full_join()`)の例を示します。\n\n::: {#0fd2b140 .cell execution_count=11}\n``` {.python .cell-code}\n# df1とdf2を\"key\"列で完全結合\njoined_df_full = df1.join(df2, on=\"key\", how=\"full\")\nprint(joined_df_full)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (4, 4)\n┌──────┬────────┬───────────┬────────┐\n│ key  ┆ value1 ┆ key_right ┆ value2 │\n│ ---  ┆ ---    ┆ ---       ┆ ---    │\n│ i64  ┆ str    ┆ i64       ┆ str    │\n╞══════╪════════╪═══════════╪════════╡\n│ 2    ┆ B      ┆ 2         ┆ D      │\n│ 3    ┆ C      ┆ 3         ┆ E      │\n│ null ┆ null   ┆ 4         ┆ F      │\n│ 1    ┆ A      ┆ null      ┆ null   │\n└──────┴────────┴───────────┴────────┘\n```\n:::\n:::\n\n\n最後に、準結合（`semi_join()`）の例を示します^[準結合とは、左のデータフレームの行が右のデータフレームに存在するかどうかでフィルタリングする結合方法です。]。\n\n::: {#d66f2e7a .cell execution_count=12}\n``` {.python .cell-code}\n# df1とdf2を\"key\"列で準結合\njoined_df_semi = df1.join(df2, on=\"key\", how=\"semi\")\nprint(joined_df_semi)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (2, 2)\n┌─────┬────────┐\n│ key ┆ value1 │\n│ --- ┆ ---    │\n│ i64 ┆ str    │\n╞═════╪════════╡\n│ 2   ┆ B      │\n│ 3   ┆ C      │\n└─────┴────────┘\n```\n:::\n:::\n\n\n### テーブルの転置（pivot）\n\nデータフレームを転置するには、`pivot()`メソッドを使用します。Rの`pivot_wider()`や`pivot_longer()`に相当します。\n\n::: {#5b565dd8 .cell execution_count=13}\n``` {.python .cell-code}\n# 例としてデータフレームを作成\ndf = pl.DataFrame({\n    \"id\": [1, 1, 2, 2],\n    \"variable\": [\"A\", \"B\", \"A\", \"B\"],\n    \"value\": [10, 20, 30, 40]\n})\nprint(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (4, 3)\n┌─────┬──────────┬───────┐\n│ id  ┆ variable ┆ value │\n│ --- ┆ ---      ┆ ---   │\n│ i64 ┆ str      ┆ i64   │\n╞═════╪══════════╪═══════╡\n│ 1   ┆ A        ┆ 10    │\n│ 1   ┆ B        ┆ 20    │\n│ 2   ┆ A        ┆ 30    │\n│ 2   ┆ B        ┆ 40    │\n└─────┴──────────┴───────┘\n```\n:::\n:::\n\n\nまずは、`pivot_wider()`の例を示します。\n\n::: {#2b0cdf53 .cell execution_count=14}\n``` {.python .cell-code}\n# pivot_widerの例\npivoted_df = df.pivot(values=\"value\", index=\"id\", on=\"variable\")\nprint(pivoted_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (2, 3)\n┌─────┬─────┬─────┐\n│ id  ┆ A   ┆ B   │\n│ --- ┆ --- ┆ --- │\n│ i64 ┆ i64 ┆ i64 │\n╞═════╪═════╪═════╡\n│ 1   ┆ 10  ┆ 20  │\n│ 2   ┆ 30  ┆ 40  │\n└─────┴─────┴─────┘\n```\n:::\n:::\n\n\n次に、ワイド形式にしたデータを`pivot_longer()`のように処理する例を示します。\n\n::: {#a7dddea9 .cell execution_count=15}\n``` {.python .cell-code}\n# pivot_longerの例\nmelted_df = pivoted_df.unpivot(\n    index=[\"id\"],\n    on=[\"A\", \"B\"],\n    variable_name=\"variable\",\n    value_name=\"value\"\n)\nprint(melted_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (4, 3)\n┌─────┬──────────┬───────┐\n│ id  ┆ variable ┆ value │\n│ --- ┆ ---      ┆ ---   │\n│ i64 ┆ str      ┆ i64   │\n╞═════╪══════════╪═══════╡\n│ 1   ┆ A        ┆ 10    │\n│ 2   ┆ A        ┆ 30    │\n│ 1   ┆ B        ┆ 20    │\n│ 2   ┆ B        ┆ 40    │\n└─────┴──────────┴───────┘\n```\n:::\n:::\n\n\n元のデータの形に戻りました。並べ替えたいときは[先述](#sec-sort)の`sort()`メソッドを使ってください。\n\n## おわりに\n\n以上がよく使うRのTidyverse関数とPolarsでの対応する操作の基本的な例です。\n\nこの記事では、RユーザーがPolarsを使い始めるための基本的な手順とコード例を紹介しました。Polarsは高速で効率的なデータ処理を可能にする強力なツールであり、Python環境でのデータ分析において有用です。\n\nこれまではずっと Rだけを使ってきましたが、いろいろ調べていくうちにPythonはそのユーザー数の多さから開発も活発であり、新しく便利なツールやライブラリが次々と登場しているなと感じることが多くなってきました。これからもRとPythonの両方を使い分けていきたいと思っています。\n\n今後も必要に応じて追記していきますので、是非参考にしてみてください。\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}