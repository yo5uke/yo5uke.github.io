{
  "hash": "3bef66657802e6488584c70d9be08f66",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"[recode]{.fira-code}関数でデータフレームの中身を置き換える\"\ndescription: |\n  表を作るときに重宝するかも…？\ndate: 2025-07-27\ndate-modified: 2025-10-23\ncategories:\n  - R\n  - データ処理\n---\n\n## はじめに\n\n今回は{dplyr}パッケージの`recode()`関数を紹介します。\n\n例えばデータフレーム内の変数がカテゴリ変数で、便宜的に数値で表されているような場合、そのまま表に出すことはできないかもしれません。\n\nそんなときに中身を置き換える手段として使えるのが`recode()`関数で、イメージとしては`case_when()`と似ているかもしれません^[ただし、`case_when()`だと「○○以上○○以下」みたいな条件分岐に対応できるという強みがありますが、今回は想定しません。あくまでもデータフレーム内の値をある別の表記に値 = 値で置き換えるということを想定します。]。\n\n1度きりの変換であれば`case_when`でもあまり労力は変わらないかもしれませんが、何回も繰り返し置き換えたいときは、シンプルで強みを発揮します。\n\n## 使い方\n\n### パッケージ\n\n{dplyr}に入っているので、{tidyverse}を読み込んでいれば使えます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n# あるいは\n# library(dplyr)\n```\n:::\n\n\n### データフレーム\n\n今回は以下のようなデータフレームを想定します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- tibble(\n  id = 1:4,\n  sex = rep(1:2, times = 2)\n)\n```\n:::\n\n\n\n::: {#tbl-example .cell tbl-cap='テーブルの例'}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_kkcxjzdjkxp47nzgoun0 = TinyTable.createTableFunctions(\"tinytable_kkcxjzdjkxp47nzgoun0\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '4', j: 1 }, { i: '4', j: 2 } ], css_id: 'tinytable_css_xu2invivbrygfuui6tq1',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 } ], css_id: 'tinytable_css_7gspbhvjub8i0qecgakr',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_kkcxjzdjkxp47nzgoun0.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_kkcxjzdjkxp47nzgoun0 td.tinytable_css_xu2invivbrygfuui6tq1, #tinytable_kkcxjzdjkxp47nzgoun0 th.tinytable_css_xu2invivbrygfuui6tq1 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_kkcxjzdjkxp47nzgoun0 td.tinytable_css_7gspbhvjub8i0qecgakr, #tinytable_kkcxjzdjkxp47nzgoun0 th.tinytable_css_7gspbhvjub8i0qecgakr {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_kkcxjzdjkxp47nzgoun0\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">id</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">sex</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">1</td>\n                  <td data-row=\"1\" data-col=\"2\">1</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">2</td>\n                  <td data-row=\"2\" data-col=\"2\">2</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">3</td>\n                  <td data-row=\"3\" data-col=\"2\">1</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">4</td>\n                  <td data-row=\"4\" data-col=\"2\">2</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n超絶簡単なデータフレームです。4人のIDと性別が1, 2の表記で含まれているだけです。ここで1を男性、2を女性とします。\n\n### 対応表を作る\n\nこれを表に起こしたいとき、たとえばそのまま`tinytable::tt()`で表示したとしたら、 @tbl-example がそのまま出てきてしまい、数字が誰を、何を表しているのかがわかりませんよね。\n\nそこで、あらかじめ対応表を作って置きます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nid_map <- c(\n  \"1\" = \"Michael\",\n  \"2\" = \"Emily\",\n  \"3\" = \"John\",\n  \"4\" = \"Jessica\"\n)\n\nsex_map <- c(\n  \"1\" = \"Male\",\n  \"2\" = \"Female\"\n)\n```\n:::\n\n\n`c()`の中に、`=`の左にデータフレーム内の表記を、右に表示したい表記を書いていきます。\n\n今回はIDと性別を両方書き換えたいので、2種類の対応関係を示したベクトルを作成しています。\n\n### `recode()`を使う\n\nこの対応表をもとに、`recode()`関数を使っていきます。使う際は、`mutate()`と組み合わせます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_recode <- df |>\n  mutate(\n    id = recode(id, !!!id_map),\n    sex = recode(sex, !!!sex_map)\n  )\n```\n:::\n\n\n\n::: {#tbl-recode .cell tbl-cap='`recode()`を使用した表'}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_x59oebz5r1t10dzyse8s = TinyTable.createTableFunctions(\"tinytable_x59oebz5r1t10dzyse8s\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '4', j: 1 }, { i: '4', j: 2 } ], css_id: 'tinytable_css_zrqb29afbeh5911qo06c',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 } ], css_id: 'tinytable_css_j7yj3yx8w82t7zupbuun',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_x59oebz5r1t10dzyse8s.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_x59oebz5r1t10dzyse8s td.tinytable_css_zrqb29afbeh5911qo06c, #tinytable_x59oebz5r1t10dzyse8s th.tinytable_css_zrqb29afbeh5911qo06c {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_x59oebz5r1t10dzyse8s td.tinytable_css_j7yj3yx8w82t7zupbuun, #tinytable_x59oebz5r1t10dzyse8s th.tinytable_css_j7yj3yx8w82t7zupbuun {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_x59oebz5r1t10dzyse8s\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">id</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">sex</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">Michael</td>\n                  <td data-row=\"1\" data-col=\"2\">Male</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">Emily</td>\n                  <td data-row=\"2\" data-col=\"2\">Female</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">John</td>\n                  <td data-row=\"3\" data-col=\"2\">Male</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">Jessica</td>\n                  <td data-row=\"4\" data-col=\"2\">Female</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nしっかり置き換えられていますね。\n\n`!!!`という表記は見慣れないと思いますが、`id_map`や`sex_map`で作成したベクトルをバラバラにして渡すということです^[ややこしいですが、`id_map`自体はベクトルなので、ベクトルを渡すのではなく、中身を展開して渡したいということです。]。`recode(sex, \"1\" = \"Male\", \"2\" = \"Female\")`と同じ働きをします。\n\nあらかじめ対応関係を表すベクトルを作って置くことで、使いまわすことができ、特に何回も表を作る際に効率化が図れます。\n\n## おまけ\n\n表にするなら、列名も変えたいですよね。そんなときは{purrr}パッケージの`set_names()`関数を使います。これも{tidyverse}に入っていますので、特に追加でライブラリを読み込む必要はありません。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncol_names <- c(\"名前\", \"性別\")\n\ndf_set_names <- df_recode |>\n  set_names(col_names)\n```\n:::\n\n\n\n::: {#tbl-set-names .cell tbl-cap='列名を変更'}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_2ink8zr2ik3puyeozcgl = TinyTable.createTableFunctions(\"tinytable_2ink8zr2ik3puyeozcgl\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '4', j: 1 }, { i: '4', j: 2 } ], css_id: 'tinytable_css_xsm39ovdcp9p80fe8h31',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 } ], css_id: 'tinytable_css_9c3lv39xxofoxu1uu73x',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_2ink8zr2ik3puyeozcgl.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_2ink8zr2ik3puyeozcgl td.tinytable_css_xsm39ovdcp9p80fe8h31, #tinytable_2ink8zr2ik3puyeozcgl th.tinytable_css_xsm39ovdcp9p80fe8h31 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_2ink8zr2ik3puyeozcgl td.tinytable_css_9c3lv39xxofoxu1uu73x, #tinytable_2ink8zr2ik3puyeozcgl th.tinytable_css_9c3lv39xxofoxu1uu73x {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_2ink8zr2ik3puyeozcgl\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">名前</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">性別</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">Michael</td>\n                  <td data-row=\"1\" data-col=\"2\">Male</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">Emily</td>\n                  <td data-row=\"2\" data-col=\"2\">Female</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">John</td>\n                  <td data-row=\"3\" data-col=\"2\">Male</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">Jessica</td>\n                  <td data-row=\"4\" data-col=\"2\">Female</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nあらかじめ`col_names`を作成しておきましたが、ここは任意です。`set_names()`の中に直接書くのも可能です。\n\n## おわりに\n\n今回は表を整えるための`recode()`関数とおまけの`set_names()`関数をまとめました。\n\n以前[Quartoで論文を書くという記事](../../../2024/06/240629_write_thesis/index.qmd)を書きましたが、論文はLaTeXで書きたい！という方には表だけLaTeXコードにして出力するという方法もありますので、それもまたまとめようかと思います。",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}