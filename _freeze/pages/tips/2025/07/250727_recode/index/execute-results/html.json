{
  "hash": "b9bd7dea3d51558aeea3f7fe3d5602de",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: '[recode]{.fira-code}関数でデータフレームの中身を置き換える'\ndescription: |\n  表を作るときに重宝するかも…？\ndate: 2025-07-27\ndate-modified: 2025-12-20\ncategories:\n- R\n- データ処理\naliases:\n- /pages/tips/250727_recode/index.html\n---\n\n:::{.callout-caution}\n## recode()関数について\n\nこのページでは{dplyr}パッケージの`recode()`関数を紹介しますが、現在`recode()`はsuperseded（置き換えられた）状態にあり^[まだ関数は残っているので、使うことはできます。]、代わりに`case_match()`関数の使用が推奨されています。  \n`case_match()`に関しては以下をご覧ください。\n\n[【R】[case_match()]{.fira-code}でデータフレームの中身を置き換える](/pages/tips/2025/11/251124_case_match/index.qmd)\n:::\n\n## はじめに\n\n今回は{dplyr}パッケージの`recode()`関数を紹介します。\n\n例えばデータフレーム内の変数がカテゴリ変数で、便宜的に数値で表されているような場合、そのまま表に出すことはできないかもしれません。\n\nそんなときに中身を置き換える手段として使えるのが`recode()`関数で、イメージとしては`case_when()`と似ているかもしれません^[ただし、`case_when()`だと「○○以上○○以下」みたいな条件分岐に対応できるという強みがありますが、今回は想定しません。あくまでもデータフレーム内の値をある別の表記に値 = 値で置き換えるということを想定します。]。\n\n1度きりの変換であれば`case_when`でもあまり労力は変わらないかもしれませんが、何回も繰り返し置き換えたいときは、シンプルで強みを発揮します。\n\n## 使い方\n\n### パッケージ\n\n{dplyr}に入っているので、{tidyverse}を読み込んでいれば使えます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n# あるいは\n# library(dplyr)\n```\n:::\n\n\n### データフレーム\n\n今回は以下のようなデータフレームを想定します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- tibble(\n  id = 1:4,\n  sex = rep(1:2, times = 2)\n)\n```\n:::\n\n\n\n::: {#tbl-example .cell tbl-cap='テーブルの例'}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_sh8cl2i6buv2750rxu0s = TinyTable.createTableFunctions(\"tinytable_sh8cl2i6buv2750rxu0s\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '4', j: 1 }, { i: '4', j: 2 } ], css_id: 'tinytable_css_xgas7om6i0ix2gt461yw',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 } ], css_id: 'tinytable_css_l7o69ovuz9w23fqmspv9',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_sh8cl2i6buv2750rxu0s.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_sh8cl2i6buv2750rxu0s td.tinytable_css_xgas7om6i0ix2gt461yw, #tinytable_sh8cl2i6buv2750rxu0s th.tinytable_css_xgas7om6i0ix2gt461yw {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_sh8cl2i6buv2750rxu0s td.tinytable_css_l7o69ovuz9w23fqmspv9, #tinytable_sh8cl2i6buv2750rxu0s th.tinytable_css_l7o69ovuz9w23fqmspv9 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_sh8cl2i6buv2750rxu0s\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">id</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">sex</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">1</td>\n                  <td data-row=\"1\" data-col=\"2\">1</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">2</td>\n                  <td data-row=\"2\" data-col=\"2\">2</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">3</td>\n                  <td data-row=\"3\" data-col=\"2\">1</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">4</td>\n                  <td data-row=\"4\" data-col=\"2\">2</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n超絶簡単なデータフレームです。4人のIDと性別が1, 2の表記で含まれているだけです。ここで1を男性、2を女性とします。\n\n### 対応表を作る\n\nこれを表に起こしたいとき、たとえばそのまま`tinytable::tt()`で表示したとしたら、 @tbl-example がそのまま出てきてしまい、数字が誰を、何を表しているのかがわかりませんよね。\n\nそこで、あらかじめ対応表を作って置きます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nid_map <- c(\n  \"1\" = \"Michael\",\n  \"2\" = \"Emily\",\n  \"3\" = \"John\",\n  \"4\" = \"Jessica\"\n)\n\nsex_map <- c(\n  \"1\" = \"Male\",\n  \"2\" = \"Female\"\n)\n```\n:::\n\n\n`c()`の中に、`=`の左にデータフレーム内の表記を、右に表示したい表記を書いていきます。\n\n今回はIDと性別を両方書き換えたいので、2種類の対応関係を示したベクトルを作成しています。\n\n### `recode()`を使う\n\nこの対応表をもとに、`recode()`関数を使っていきます。使う際は、`mutate()`と組み合わせます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_recode <- df |>\n  mutate(\n    id = recode(id, !!!id_map),\n    sex = recode(sex, !!!sex_map)\n  )\n```\n:::\n\n\n\n::: {#tbl-recode .cell tbl-cap='`recode()`を使用した表'}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_4s3j1hcltqzidtb90pmo = TinyTable.createTableFunctions(\"tinytable_4s3j1hcltqzidtb90pmo\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '4', j: 1 }, { i: '4', j: 2 } ], css_id: 'tinytable_css_es442noph79h6ki4t54p',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 } ], css_id: 'tinytable_css_xt295vrro2r64a75ogo5',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_4s3j1hcltqzidtb90pmo.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_4s3j1hcltqzidtb90pmo td.tinytable_css_es442noph79h6ki4t54p, #tinytable_4s3j1hcltqzidtb90pmo th.tinytable_css_es442noph79h6ki4t54p {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_4s3j1hcltqzidtb90pmo td.tinytable_css_xt295vrro2r64a75ogo5, #tinytable_4s3j1hcltqzidtb90pmo th.tinytable_css_xt295vrro2r64a75ogo5 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_4s3j1hcltqzidtb90pmo\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">id</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">sex</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">Michael</td>\n                  <td data-row=\"1\" data-col=\"2\">Male</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">Emily</td>\n                  <td data-row=\"2\" data-col=\"2\">Female</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">John</td>\n                  <td data-row=\"3\" data-col=\"2\">Male</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">Jessica</td>\n                  <td data-row=\"4\" data-col=\"2\">Female</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nしっかり置き換えられていますね。\n\n`!!!`という表記は見慣れないと思いますが、`id_map`や`sex_map`で作成したベクトルをバラバラにして渡すということです^[ややこしいですが、`id_map`自体はベクトルなので、ベクトルを渡すのではなく、中身を展開して渡したいということです。]。`recode(sex, \"1\" = \"Male\", \"2\" = \"Female\")`と同じ働きをします。\n\nあらかじめ対応関係を表すベクトルを作って置くことで、使いまわすことができ、特に何回も表を作る際に効率化が図れます。\n\n## おまけ\n\n表にするなら、列名も変えたいですよね。そんなときは{purrr}パッケージの`set_names()`関数を使います。これも{tidyverse}に入っていますので、特に追加でライブラリを読み込む必要はありません。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncol_names <- c(\"名前\", \"性別\")\n\ndf_set_names <- df_recode |>\n  set_names(col_names)\n```\n:::\n\n\n\n::: {#tbl-set-names .cell tbl-cap='列名を変更'}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_1hiubydwm664xi1y4vkw = TinyTable.createTableFunctions(\"tinytable_1hiubydwm664xi1y4vkw\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '4', j: 1 }, { i: '4', j: 2 } ], css_id: 'tinytable_css_krfly964c86ylcdck4rw',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 } ], css_id: 'tinytable_css_7v8tqy40mzvgq14xzauc',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_1hiubydwm664xi1y4vkw.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_1hiubydwm664xi1y4vkw td.tinytable_css_krfly964c86ylcdck4rw, #tinytable_1hiubydwm664xi1y4vkw th.tinytable_css_krfly964c86ylcdck4rw {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_1hiubydwm664xi1y4vkw td.tinytable_css_7v8tqy40mzvgq14xzauc, #tinytable_1hiubydwm664xi1y4vkw th.tinytable_css_7v8tqy40mzvgq14xzauc {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_1hiubydwm664xi1y4vkw\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">名前</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">性別</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">Michael</td>\n                  <td data-row=\"1\" data-col=\"2\">Male</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">Emily</td>\n                  <td data-row=\"2\" data-col=\"2\">Female</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">John</td>\n                  <td data-row=\"3\" data-col=\"2\">Male</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">Jessica</td>\n                  <td data-row=\"4\" data-col=\"2\">Female</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nあらかじめ`col_names`を作成しておきましたが、ここは任意です。`set_names()`の中に直接書くのも可能です。\n\n## おわりに\n\n今回は表を整えるための`recode()`関数とおまけの`set_names()`関数をまとめました。\n\n以前[Quartoで論文を書くという記事](/pages/tips/2024/06/240629_write_thesis/index.qmd)を書きましたが、論文はLaTeXで書きたい！という方には表だけLaTeXコードにして出力するという方法もありますので、それもまたまとめようかと思います。",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}